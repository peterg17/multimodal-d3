!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=36)}([function(t,e,n){(function(){var n=this,r=n._,i={},o=Array.prototype,a=Object.prototype,s=Function.prototype,h=o.push,u=o.slice,c=o.concat,l=a.toString,f=a.hasOwnProperty,p=o.forEach,d=o.map,m=o.reduce,g=o.reduceRight,v=o.filter,y=o.every,x=o.some,_=o.indexOf,b=o.lastIndexOf,w=Array.isArray,M=Object.keys,A=s.bind,S=function(t){return t instanceof S?t:this instanceof S?void(this._wrapped=t):new S(t)};t.exports&&(e=t.exports=S),e._=S,S.VERSION="1.4.4";var C=S.each=S.forEach=function(t,e,n){if(null!=t)if(p&&t.forEach===p)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,o=t.length;r<o;r++)if(e.call(n,t[r],r,t)===i)return}else for(var a in t)if(S.has(t,a)&&e.call(n,t[a],a,t)===i)return};S.map=S.collect=function(t,e,n){var r=[];return null==t?r:d&&t.map===d?t.map(e,n):(C(t,function(t,i,o){r[r.length]=e.call(n,t,i,o)}),r)};var T="Reduce of empty array with no initial value";S.reduce=S.foldl=S.inject=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),m&&t.reduce===m)return r&&(e=S.bind(e,r)),i?t.reduce(e,n):t.reduce(e);if(C(t,function(t,o,a){i?n=e.call(r,n,t,o,a):(n=t,i=!0)}),!i)throw new TypeError(T);return n},S.reduceRight=S.foldr=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),g&&t.reduceRight===g)return r&&(e=S.bind(e,r)),i?t.reduceRight(e,n):t.reduceRight(e);var o=t.length;if(o!==+o){var a=S.keys(t);o=a.length}if(C(t,function(s,h,u){h=a?a[--o]:--o,i?n=e.call(r,n,t[h],h,u):(n=t[h],i=!0)}),!i)throw new TypeError(T);return n},S.find=S.detect=function(t,e,n){var r;return E(t,function(t,i,o){if(e.call(n,t,i,o))return r=t,!0}),r},S.filter=S.select=function(t,e,n){var r=[];return null==t?r:v&&t.filter===v?t.filter(e,n):(C(t,function(t,i,o){e.call(n,t,i,o)&&(r[r.length]=t)}),r)},S.reject=function(t,e,n){return S.filter(t,function(t,r,i){return!e.call(n,t,r,i)},n)},S.every=S.all=function(t,e,n){e||(e=S.identity);var r=!0;return null==t?r:y&&t.every===y?t.every(e,n):(C(t,function(t,o,a){if(!(r=r&&e.call(n,t,o,a)))return i}),!!r)};var E=S.some=S.any=function(t,e,n){e||(e=S.identity);var r=!1;return null==t?r:x&&t.some===x?t.some(e,n):(C(t,function(t,o,a){if(r||(r=e.call(n,t,o,a)))return i}),!!r)};S.contains=S.include=function(t,e){return null!=t&&(_&&t.indexOf===_?-1!=t.indexOf(e):E(t,function(t){return t===e}))},S.invoke=function(t,e){var n=u.call(arguments,2),r=S.isFunction(e);return S.map(t,function(t){return(r?e:t[e]).apply(t,n)})},S.pluck=function(t,e){return S.map(t,function(t){return t[e]})},S.where=function(t,e,n){return S.isEmpty(e)?n?null:[]:S[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},S.findWhere=function(t,e){return S.where(t,e,!0)},S.max=function(t,e,n){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&S.isEmpty(t))return-1/0;var r={computed:-1/0,value:-1/0};return C(t,function(t,i,o){var a=e?e.call(n,t,i,o):t;a>=r.computed&&(r={value:t,computed:a})}),r.value},S.min=function(t,e,n){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&S.isEmpty(t))return 1/0;var r={computed:1/0,value:1/0};return C(t,function(t,i,o){var a=e?e.call(n,t,i,o):t;a<r.computed&&(r={value:t,computed:a})}),r.value},S.shuffle=function(t){var e,n=0,r=[];return C(t,function(t){e=S.random(n++),r[n-1]=r[e],r[e]=t}),r};var L=function(t){return S.isFunction(t)?t:function(e){return e[t]}};S.sortBy=function(t,e,n){var r=L(e);return S.pluck(S.map(t,function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index<e.index?-1:1}),"value")};var P=function(t,e,n,r){var i={},o=L(e||S.identity);return C(t,function(e,a){var s=o.call(n,e,a,t);r(i,s,e)}),i};S.groupBy=function(t,e,n){return P(t,e,n,function(t,e,n){(S.has(t,e)?t[e]:t[e]=[]).push(n)})},S.countBy=function(t,e,n){return P(t,e,n,function(t,e){S.has(t,e)||(t[e]=0),t[e]++})},S.sortedIndex=function(t,e,n,r){for(var i=(n=null==n?S.identity:L(n)).call(r,e),o=0,a=t.length;o<a;){var s=o+a>>>1;n.call(r,t[s])<i?o=s+1:a=s}return o},S.toArray=function(t){return t?S.isArray(t)?u.call(t):t.length===+t.length?S.map(t,S.identity):S.values(t):[]},S.size=function(t){return null==t?0:t.length===+t.length?t.length:S.keys(t).length},S.first=S.head=S.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:u.call(t,0,e)},S.initial=function(t,e,n){return u.call(t,0,t.length-(null==e||n?1:e))},S.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:u.call(t,Math.max(t.length-e,0))},S.rest=S.tail=S.drop=function(t,e,n){return u.call(t,null==e||n?1:e)},S.compact=function(t){return S.filter(t,S.identity)};var D=function(t,e,n){return C(t,function(t){S.isArray(t)?e?h.apply(n,t):D(t,e,n):n.push(t)}),n};S.flatten=function(t,e){return D(t,e,[])},S.without=function(t){return S.difference(t,u.call(arguments,1))},S.uniq=S.unique=function(t,e,n,r){S.isFunction(e)&&(r=n,n=e,e=!1);var i=n?S.map(t,n,r):t,o=[],a=[];return C(i,function(n,r){(e?r&&a[a.length-1]===n:S.contains(a,n))||(a.push(n),o.push(t[r]))}),o},S.union=function(){return S.uniq(c.apply(o,arguments))},S.intersection=function(t){var e=u.call(arguments,1);return S.filter(S.uniq(t),function(t){return S.every(e,function(e){return S.indexOf(e,t)>=0})})},S.difference=function(t){var e=c.apply(o,u.call(arguments,1));return S.filter(t,function(t){return!S.contains(e,t)})},S.zip=function(){for(var t=u.call(arguments),e=S.max(S.pluck(t,"length")),n=new Array(e),r=0;r<e;r++)n[r]=S.pluck(t,""+r);return n},S.object=function(t,e){if(null==t)return{};for(var n={},r=0,i=t.length;r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},S.indexOf=function(t,e,n){if(null==t)return-1;var r=0,i=t.length;if(n){if("number"!=typeof n)return t[r=S.sortedIndex(t,e)]===e?r:-1;r=n<0?Math.max(0,i+n):n}if(_&&t.indexOf===_)return t.indexOf(e,n);for(;r<i;r++)if(t[r]===e)return r;return-1},S.lastIndexOf=function(t,e,n){if(null==t)return-1;var r=null!=n;if(b&&t.lastIndexOf===b)return r?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var i=r?n:t.length;i--;)if(t[i]===e)return i;return-1},S.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=0,o=new Array(r);i<r;)o[i++]=t,t+=n;return o},S.bind=function(t,e){if(t.bind===A&&A)return A.apply(t,u.call(arguments,1));var n=u.call(arguments,2);return function(){return t.apply(e,n.concat(u.call(arguments)))}},S.partial=function(t){var e=u.call(arguments,1);return function(){return t.apply(this,e.concat(u.call(arguments)))}},S.bindAll=function(t){var e=u.call(arguments,1);return 0===e.length&&(e=S.functions(t)),C(e,function(e){t[e]=S.bind(t[e],t)}),t},S.memoize=function(t,e){var n={};return e||(e=S.identity),function(){var r=e.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=t.apply(this,arguments)}},S.delay=function(t,e){var n=u.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},S.defer=function(t){return S.delay.apply(S,[t,1].concat(u.call(arguments,1)))},S.throttle=function(t,e){var n,r,i,o,a=0,s=function(){a=new Date,i=null,o=t.apply(n,r)};return function(){var h=new Date,u=e-(h-a);return n=this,r=arguments,u<=0?(clearTimeout(i),i=null,a=h,o=t.apply(n,r)):i||(i=setTimeout(s,u)),o}},S.debounce=function(t,e,n){var r,i;return function(){var o=this,a=arguments,s=n&&!r;return clearTimeout(r),r=setTimeout(function(){r=null,n||(i=t.apply(o,a))},e),s&&(i=t.apply(o,a)),i}},S.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},S.wrap=function(t,e){return function(){var n=[t];return h.apply(n,arguments),e.apply(this,n)}},S.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},S.after=function(t,e){return t<=0?e():function(){if(--t<1)return e.apply(this,arguments)}},S.keys=M||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)S.has(t,n)&&(e[e.length]=n);return e},S.values=function(t){var e=[];for(var n in t)S.has(t,n)&&e.push(t[n]);return e},S.pairs=function(t){var e=[];for(var n in t)S.has(t,n)&&e.push([n,t[n]]);return e},S.invert=function(t){var e={};for(var n in t)S.has(t,n)&&(e[t[n]]=n);return e},S.functions=S.methods=function(t){var e=[];for(var n in t)S.isFunction(t[n])&&e.push(n);return e.sort()},S.extend=function(t){return C(u.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},S.pick=function(t){var e={},n=c.apply(o,u.call(arguments,1));return C(n,function(n){n in t&&(e[n]=t[n])}),e},S.omit=function(t){var e={},n=c.apply(o,u.call(arguments,1));for(var r in t)S.contains(n,r)||(e[r]=t[r]);return e},S.defaults=function(t){return C(u.call(arguments,1),function(e){if(e)for(var n in e)null==t[n]&&(t[n]=e[n])}),t},S.clone=function(t){return S.isObject(t)?S.isArray(t)?t.slice():S.extend({},t):t},S.tap=function(t,e){return e(t),t};var R=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof S&&(t=t._wrapped),e instanceof S&&(e=e._wrapped);var i=l.call(t);if(i!=l.call(e))return!1;switch(i){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=n.length;o--;)if(n[o]==t)return r[o]==e;n.push(t),r.push(e);var a=0,s=!0;if("[object Array]"==i){if(s=(a=t.length)==e.length)for(;a--&&(s=R(t[a],e[a],n,r)););}else{var h=t.constructor,u=e.constructor;if(h!==u&&!(S.isFunction(h)&&h instanceof h&&S.isFunction(u)&&u instanceof u))return!1;for(var c in t)if(S.has(t,c)&&(a++,!(s=S.has(e,c)&&R(t[c],e[c],n,r))))break;if(s){for(c in e)if(S.has(e,c)&&!a--)break;s=!a}}return n.pop(),r.pop(),s};S.isEqual=function(t,e){return R(t,e,[],[])},S.isEmpty=function(t){if(null==t)return!0;if(S.isArray(t)||S.isString(t))return 0===t.length;for(var e in t)if(S.has(t,e))return!1;return!0},S.isElement=function(t){return!(!t||1!==t.nodeType)},S.isArray=w||function(t){return"[object Array]"==l.call(t)},S.isObject=function(t){return t===Object(t)},C(["Arguments","Function","String","Number","Date","RegExp"],function(t){S["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),S.isArguments(arguments)||(S.isArguments=function(t){return!(!t||!S.has(t,"callee"))}),S.isFunction=function(t){return"function"==typeof t},S.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},S.isNaN=function(t){return S.isNumber(t)&&t!=+t},S.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==l.call(t)},S.isNull=function(t){return null===t},S.isUndefined=function(t){return void 0===t},S.has=function(t,e){return f.call(t,e)},S.noConflict=function(){return n._=r,this},S.identity=function(t){return t},S.times=function(t,e,n){for(var r=Array(t),i=0;i<t;i++)r[i]=e.call(n,i);return r},S.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=S.invert(F.escape);var k={escape:new RegExp("["+S.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(F.unescape).join("|")+")","g")};S.each(["escape","unescape"],function(t){S[t]=function(e){return null==e?"":(""+e).replace(k[t],function(e){return F[t][e]})}}),S.result=function(t,e){if(null==t)return null;var n=t[e];return S.isFunction(n)?n.call(t):n},S.mixin=function(t){C(S.functions(t),function(e){var n=S[e]=t[e];S.prototype[e]=function(){var t=[this._wrapped];return h.apply(t,arguments),I.call(this,n.apply(S,t))}})};var B=0;S.uniqueId=function(t){var e=++B+"";return t?t+e:e},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},U=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(t,e,n){var r;n=S.defaults({},n,S.templateSettings);var i=new RegExp([(n.escape||z).source,(n.interpolate||z).source,(n.evaluate||z).source].join("|")+"|$","g"),o=0,a="__p+='";t.replace(i,function(e,n,r,i,s){return a+=t.slice(o,s).replace(U,function(t){return"\\"+N[t]}),n&&(a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(a+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(a+="';\n"+i+"\n__p+='"),o=s+e.length,e}),a+="';\n",n.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{r=new Function(n.variable||"obj","_",a)}catch(t){throw t.source=a,t}if(e)return r(e,S);var s=function(t){return r.call(this,t,S)};return s.source="function("+(n.variable||"obj")+"){\n"+a+"}",s},S.chain=function(t){return S(t).chain()};var I=function(t){return this._chain?S(t).chain():t};S.mixin(S),C(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=o[t];S.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],I.call(this,n)}}),C(["concat","join","slice"],function(t){var e=o[t];S.prototype[t]=function(){return I.call(this,e.apply(this._wrapped,arguments))}}),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},function(t,e,n){!function(t){"use strict";var n={};n.exports=e,function(t){if(!e)var e=1e-6;if(!n)var n="undefined"!=typeof Float32Array?Float32Array:Array;if(!r)var r=Math.random;var i={setMatrixArrayType:function(t){n=t}};void 0!==t&&(t.glMatrix=i);var o=Math.PI/180;i.toRadian=function(t){return t*o};var a,s={};s.create=function(){var t=new n(2);return t[0]=0,t[1]=0,t},s.clone=function(t){var e=new n(2);return e[0]=t[0],e[1]=t[1],e},s.fromValues=function(t,e){var r=new n(2);return r[0]=t,r[1]=e,r},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},s.set=function(t,e,n){return t[0]=e,t[1]=n,t},s.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},s.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},s.sub=s.subtract,s.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},s.mul=s.multiply,s.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},s.div=s.divide,s.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},s.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},s.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},s.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},s.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)},s.dist=s.distance,s.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},s.len=s.length,s.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},s.normalize=function(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},s.cross=function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t},s.lerp=function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t},s.random=function(t,e){e=e||1;var n=2*r()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},s.transformMat2=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t},s.transformMat2d=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t},s.transformMat3=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t},s.transformMat4=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t},s.forEach=(a=s.create(),function(t,e,n,r,i,o){var s,h;for(e||(e=2),n||(n=0),h=r?Math.min(r*e+n,t.length):t.length,s=n;s<h;s+=e)a[0]=t[s],a[1]=t[s+1],i(a,a,o),t[s]=a[0],t[s+1]=a[1];return t}),s.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},void 0!==t&&(t.vec2=s);var h={create:function(){var t=new n(3);return t[0]=0,t[1]=0,t[2]=0,t},clone:function(t){var e=new n(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},fromValues:function(t,e,r){var i=new n(3);return i[0]=t,i[1]=e,i[2]=r,i},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}};h.sub=h.subtract,h.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},h.mul=h.multiply,h.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},h.div=h.divide,h.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},h.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},h.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},h.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},h.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)},h.dist=h.distance,h.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i},h.sqrDist=h.squaredDistance,h.length=function(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)},h.len=h.length,h.squaredLength=function(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r},h.sqrLen=h.squaredLength,h.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},h.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},h.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},h.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],h=n[2];return t[0]=i*h-o*s,t[1]=o*a-r*h,t[2]=r*s-i*a,t},h.lerp=function(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t},h.random=function(t,e){e=e||1;var n=2*r()*Math.PI,i=2*r()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*o,t[1]=Math.sin(n)*o,t[2]=i*e,t},h.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12],t[1]=n[1]*r+n[5]*i+n[9]*o+n[13],t[2]=n[2]*r+n[6]*i+n[10]*o+n[14],t},h.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},h.transformQuat=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],h=n[2],u=n[3],c=u*r+s*o-h*i,l=u*i+h*r-a*o,f=u*o+a*i-s*r,p=-a*r-s*i-h*o;return t[0]=c*u+p*-a+l*-h-f*-s,t[1]=l*u+p*-s+f*-a-c*-h,t[2]=f*u+p*-h+c*-s-l*-a,t},h.rotateX=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},h.rotateY=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},h.rotateZ=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},h.forEach=function(){var t=h.create();return function(e,n,r,i,o,a){var s,h;for(n||(n=3),r||(r=0),h=i?Math.min(i*n+r,e.length):e.length,s=r;s<h;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),h.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},void 0!==t&&(t.vec3=h);var u={create:function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},clone:function(t){var e=new n(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function(t,e,r,i){var o=new n(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},set:function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}};u.sub=u.subtract,u.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},u.mul=u.multiply,u.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t},u.div=u.divide,u.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},u.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},u.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},u.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},u.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(n*n+r*r+i*i+o*o)},u.dist=u.distance,u.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o},u.sqrDist=u.squaredDistance,u.length=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)},u.len=u.length,u.squaredLength=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i},u.sqrLen=u.squaredLength,u.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},u.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a),t},u.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},u.lerp=function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t},u.random=function(t,e){return e=e||1,t[0]=r(),t[1]=r(),t[2]=r(),t[3]=r(),u.normalize(t,t),u.scale(t,t,e),t},u.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t},u.transformQuat=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],h=n[2],u=n[3],c=u*r+s*o-h*i,l=u*i+h*r-a*o,f=u*o+a*i-s*r,p=-a*r-s*i-h*o;return t[0]=c*u+p*-a+l*-h-f*-s,t[1]=l*u+p*-s+f*-a-c*-h,t[2]=f*u+p*-h+c*-s-l*-a,t},u.forEach=function(){var t=u.create();return function(e,n,r,i,o,a){var s,h;for(n||(n=4),r||(r=0),h=i?Math.min(i*n+r,e.length):e.length,s=r;s<h;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),u.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.vec4=u);var c={create:function(){var t=new n(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},clone:function(t){var e=new n(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},transpose:function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*o-i*r;return a?(a=1/a,t[0]=o*a,t[1]=-r*a,t[2]=-i*a,t[3]=n*a,t):null},adjoint:function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],h=n[1],u=n[2],c=n[3];return t[0]=r*s+o*h,t[1]=i*s+a*h,t[2]=r*u+o*c,t[3]=i*u+a*c,t}};c.mul=c.multiply,c.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),h=Math.cos(n);return t[0]=r*h+o*s,t[1]=i*h+a*s,t[2]=r*-s+o*h,t[3]=i*-s+a*h,t},c.scale=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],h=n[1];return t[0]=r*s,t[1]=i*s,t[2]=o*h,t[3]=a*h,t},c.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},c.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},c.LDU=function(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]},void 0!==t&&(t.mat2=c);var l={create:function(){var t=new n(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},clone:function(t){var e=new n(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=n*o-r*i;return h?(h=1/h,t[0]=o*h,t[1]=-r*h,t[2]=-i*h,t[3]=n*h,t[4]=(i*s-o*a)*h,t[5]=(r*a-n*s)*h,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=n[0],c=n[1],l=n[2],f=n[3],p=n[4],d=n[5];return t[0]=r*u+o*c,t[1]=i*u+a*c,t[2]=r*l+o*f,t[3]=i*l+a*f,t[4]=r*p+o*d+s,t[5]=i*p+a*d+h,t}};l.mul=l.multiply,l.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=Math.sin(n),c=Math.cos(n);return t[0]=r*c+o*u,t[1]=i*c+a*u,t[2]=r*-u+o*c,t[3]=i*-u+a*c,t[4]=s,t[5]=h,t},l.scale=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=n[0],c=n[1];return t[0]=r*u,t[1]=i*u,t[2]=o*c,t[3]=a*c,t[4]=s,t[5]=h,t},l.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=n[0],c=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=r*u+o*c+s,t[5]=i*u+a*c+h,t},l.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},l.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},void 0!==t&&(t.mat2d=l);var f={create:function(){var t=new n(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new n(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=c*a-s*u,f=-c*o+s*h,p=u*o-a*h,d=n*l+r*f+i*p;return d?(d=1/d,t[0]=l*d,t[1]=(-c*r+i*u)*d,t[2]=(s*r-i*a)*d,t[3]=f*d,t[4]=(c*n-i*h)*d,t[5]=(-s*n+i*o)*d,t[6]=p*d,t[7]=(-u*n+r*h)*d,t[8]=(a*n-r*o)*d,t):null},adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8];return t[0]=a*c-s*u,t[1]=i*u-r*c,t[2]=r*s-i*a,t[3]=s*h-o*c,t[4]=n*c-i*h,t[5]=i*o-n*s,t[6]=o*u-a*h,t[7]=r*h-n*u,t[8]=n*a-r*o,t},determinant:function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],h=t[7],u=t[8];return e*(u*o-a*h)+n*(-u*i+a*s)+r*(h*i-o*s)},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=n[0],p=n[1],d=n[2],m=n[3],g=n[4],v=n[5],y=n[6],x=n[7],_=n[8];return t[0]=f*r+p*a+d*u,t[1]=f*i+p*s+d*c,t[2]=f*o+p*h+d*l,t[3]=m*r+g*a+v*u,t[4]=m*i+g*s+v*c,t[5]=m*o+g*h+v*l,t[6]=y*r+x*a+_*u,t[7]=y*i+x*s+_*c,t[8]=y*o+x*h+_*l,t}};f.mul=f.multiply,f.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=n[0],p=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=h,t[6]=f*r+p*a+u,t[7]=f*i+p*s+c,t[8]=f*o+p*h+l,t},f.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=Math.sin(n),p=Math.cos(n);return t[0]=p*r+f*a,t[1]=p*i+f*s,t[2]=p*o+f*h,t[3]=p*a-f*r,t[4]=p*s-f*i,t[5]=p*h-f*o,t[6]=u,t[7]=c,t[8]=l,t},f.scale=function(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},f.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},f.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,h=i+i,u=n*a,c=r*a,l=r*s,f=i*a,p=i*s,d=i*h,m=o*a,g=o*s,v=o*h;return t[0]=1-l-d,t[3]=c-v,t[6]=f+g,t[1]=c+v,t[4]=1-u-d,t[7]=p-m,t[2]=f-g,t[5]=p+m,t[8]=1-u-l,t},f.normalFromMat4=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],p=e[11],d=e[12],m=e[13],g=e[14],v=e[15],y=n*s-r*a,x=n*h-i*a,_=n*u-o*a,b=r*h-i*s,w=r*u-o*s,M=i*u-o*h,A=c*m-l*d,S=c*g-f*d,C=c*v-p*d,T=l*g-f*m,E=l*v-p*m,L=f*v-p*g,P=y*L-x*E+_*T+b*C-w*S+M*A;return P?(P=1/P,t[0]=(s*L-h*E+u*T)*P,t[1]=(h*C-a*L-u*S)*P,t[2]=(a*E-s*C+u*A)*P,t[3]=(i*E-r*L-o*T)*P,t[4]=(n*L-i*C+o*S)*P,t[5]=(r*C-n*E-o*A)*P,t[6]=(m*M-g*w+v*b)*P,t[7]=(g*_-d*M-v*x)*P,t[8]=(d*w-m*_+v*y)*P,t):null},f.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},f.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},void 0!==t&&(t.mat3=f);var p={create:function(){var t=new n(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},clone:function(t){var e=new n(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transpose:function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],p=e[11],d=e[12],m=e[13],g=e[14],v=e[15],y=n*s-r*a,x=n*h-i*a,_=n*u-o*a,b=r*h-i*s,w=r*u-o*s,M=i*u-o*h,A=c*m-l*d,S=c*g-f*d,C=c*v-p*d,T=l*g-f*m,E=l*v-p*m,L=f*v-p*g,P=y*L-x*E+_*T+b*C-w*S+M*A;return P?(P=1/P,t[0]=(s*L-h*E+u*T)*P,t[1]=(i*E-r*L-o*T)*P,t[2]=(m*M-g*w+v*b)*P,t[3]=(f*w-l*M-p*b)*P,t[4]=(h*C-a*L-u*S)*P,t[5]=(n*L-i*C+o*S)*P,t[6]=(g*_-d*M-v*x)*P,t[7]=(c*M-f*_+p*x)*P,t[8]=(a*E-s*C+u*A)*P,t[9]=(r*C-n*E-o*A)*P,t[10]=(d*w-m*_+v*y)*P,t[11]=(l*_-c*w-p*y)*P,t[12]=(s*S-a*T-h*A)*P,t[13]=(n*T-r*S+i*A)*P,t[14]=(m*x-d*b-g*y)*P,t[15]=(c*b-l*x+f*y)*P,t):null},adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],p=e[11],d=e[12],m=e[13],g=e[14],v=e[15];return t[0]=s*(f*v-p*g)-l*(h*v-u*g)+m*(h*p-u*f),t[1]=-(r*(f*v-p*g)-l*(i*v-o*g)+m*(i*p-o*f)),t[2]=r*(h*v-u*g)-s*(i*v-o*g)+m*(i*u-o*h),t[3]=-(r*(h*p-u*f)-s*(i*p-o*f)+l*(i*u-o*h)),t[4]=-(a*(f*v-p*g)-c*(h*v-u*g)+d*(h*p-u*f)),t[5]=n*(f*v-p*g)-c*(i*v-o*g)+d*(i*p-o*f),t[6]=-(n*(h*v-u*g)-a*(i*v-o*g)+d*(i*u-o*h)),t[7]=n*(h*p-u*f)-a*(i*p-o*f)+c*(i*u-o*h),t[8]=a*(l*v-p*m)-c*(s*v-u*m)+d*(s*p-u*l),t[9]=-(n*(l*v-p*m)-c*(r*v-o*m)+d*(r*p-o*l)),t[10]=n*(s*v-u*m)-a*(r*v-o*m)+d*(r*u-o*s),t[11]=-(n*(s*p-u*l)-a*(r*p-o*l)+c*(r*u-o*s)),t[12]=-(a*(l*g-f*m)-c*(s*g-h*m)+d*(s*f-h*l)),t[13]=n*(l*g-f*m)-c*(r*g-i*m)+d*(r*f-i*l),t[14]=-(n*(s*g-h*m)-a*(r*g-i*m)+d*(r*h-i*s)),t[15]=n*(s*f-h*l)-a*(r*f-i*l)+c*(r*h-i*s),t},determinant:function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],h=t[7],u=t[8],c=t[9],l=t[10],f=t[11],p=t[12],d=t[13],m=t[14],g=t[15];return(e*a-n*o)*(l*g-f*m)-(e*s-r*o)*(c*g-f*d)+(e*h-i*o)*(c*m-l*d)+(n*s-r*a)*(u*g-f*p)-(n*h-i*a)*(u*m-l*p)+(r*h-i*s)*(u*d-c*p)},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=e[9],p=e[10],d=e[11],m=e[12],g=e[13],v=e[14],y=e[15],x=n[0],_=n[1],b=n[2],w=n[3];return t[0]=x*r+_*s+b*l+w*m,t[1]=x*i+_*h+b*f+w*g,t[2]=x*o+_*u+b*p+w*v,t[3]=x*a+_*c+b*d+w*y,x=n[4],_=n[5],b=n[6],w=n[7],t[4]=x*r+_*s+b*l+w*m,t[5]=x*i+_*h+b*f+w*g,t[6]=x*o+_*u+b*p+w*v,t[7]=x*a+_*c+b*d+w*y,x=n[8],_=n[9],b=n[10],w=n[11],t[8]=x*r+_*s+b*l+w*m,t[9]=x*i+_*h+b*f+w*g,t[10]=x*o+_*u+b*p+w*v,t[11]=x*a+_*c+b*d+w*y,x=n[12],_=n[13],b=n[14],w=n[15],t[12]=x*r+_*s+b*l+w*m,t[13]=x*i+_*h+b*f+w*g,t[14]=x*o+_*u+b*p+w*v,t[15]=x*a+_*c+b*d+w*y,t}};p.mul=p.multiply,p.translate=function(t,e,n){var r,i,o,a,s,h,u,c,l,f,p,d,m=n[0],g=n[1],v=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*v+e[12],t[13]=e[1]*m+e[5]*g+e[9]*v+e[13],t[14]=e[2]*m+e[6]*g+e[10]*v+e[14],t[15]=e[3]*m+e[7]*g+e[11]*v+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=e[9],p=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=f,t[10]=p,t[11]=d,t[12]=r*m+s*g+l*v+e[12],t[13]=i*m+h*g+f*v+e[13],t[14]=o*m+u*g+p*v+e[14],t[15]=a*m+c*g+d*v+e[15]),t},p.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.rotate=function(t,n,r,i){var o,a,s,h,u,c,l,f,p,d,m,g,v,y,x,_,b,w,M,A,S,C,T,E,L=i[0],P=i[1],D=i[2],R=Math.sqrt(L*L+P*P+D*D);return Math.abs(R)<e?null:(L*=R=1/R,P*=R,D*=R,o=Math.sin(r),s=1-(a=Math.cos(r)),h=n[0],u=n[1],c=n[2],l=n[3],f=n[4],p=n[5],d=n[6],m=n[7],g=n[8],v=n[9],y=n[10],x=n[11],_=L*L*s+a,b=P*L*s+D*o,w=D*L*s-P*o,M=L*P*s-D*o,A=P*P*s+a,S=D*P*s+L*o,C=L*D*s+P*o,T=P*D*s-L*o,E=D*D*s+a,t[0]=h*_+f*b+g*w,t[1]=u*_+p*b+v*w,t[2]=c*_+d*b+y*w,t[3]=l*_+m*b+x*w,t[4]=h*M+f*A+g*S,t[5]=u*M+p*A+v*S,t[6]=c*M+d*A+y*S,t[7]=l*M+m*A+x*S,t[8]=h*C+f*T+g*E,t[9]=u*C+p*T+v*E,t[10]=c*C+d*T+y*E,t[11]=l*C+m*T+x*E,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)},p.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],h=e[7],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*r,t[5]=a*i+c*r,t[6]=s*i+l*r,t[7]=h*i+f*r,t[8]=u*i-o*r,t[9]=c*i-a*r,t[10]=l*i-s*r,t[11]=f*i-h*r,t},p.rotateY=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],h=e[3],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-u*r,t[1]=a*i-c*r,t[2]=s*i-l*r,t[3]=h*i-f*r,t[8]=o*r+u*i,t[9]=a*r+c*i,t[10]=s*r+l*i,t[11]=h*r+f*i,t},p.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],h=e[3],u=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*r,t[1]=a*i+c*r,t[2]=s*i+l*r,t[3]=h*i+f*r,t[4]=u*i-o*r,t[5]=c*i-a*r,t[6]=l*i-s*r,t[7]=f*i-h*r,t},p.fromRotationTranslation=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,h=i+i,u=o+o,c=r*s,l=r*h,f=r*u,p=i*h,d=i*u,m=o*u,g=a*s,v=a*h,y=a*u;return t[0]=1-(p+m),t[1]=l+y,t[2]=f-v,t[3]=0,t[4]=l-y,t[5]=1-(c+m),t[6]=d+g,t[7]=0,t[8]=f+v,t[9]=d-g,t[10]=1-(c+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},p.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,h=i+i,u=n*a,c=r*a,l=r*s,f=i*a,p=i*s,d=i*h,m=o*a,g=o*s,v=o*h;return t[0]=1-l-d,t[1]=c+v,t[2]=f-g,t[3]=0,t[4]=c-v,t[5]=1-u-d,t[6]=p+m,t[7]=0,t[8]=f+g,t[9]=p-m,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},p.frustum=function(t,e,n,r,i,o,a){var s=1/(n-e),h=1/(i-r),u=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*h,t[10]=(a+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*u,t[15]=0,t},p.perspective=function(t,e,n,r,i){var o=1/Math.tan(e/2),a=1/(r-i);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*a,t[15]=0,t},p.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),h=1/(r-i),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*h,t[14]=(a+o)*u,t[15]=1,t},p.lookAt=function(t,n,r,i){var o,a,s,h,u,c,l,f,d,m,g=n[0],v=n[1],y=n[2],x=i[0],_=i[1],b=i[2],w=r[0],M=r[1],A=r[2];return Math.abs(g-w)<e&&Math.abs(v-M)<e&&Math.abs(y-A)<e?p.identity(t):(l=g-w,f=v-M,d=y-A,o=_*(d*=m=1/Math.sqrt(l*l+f*f+d*d))-b*(f*=m),a=b*(l*=m)-x*d,s=x*f-_*l,(m=Math.sqrt(o*o+a*a+s*s))?(o*=m=1/m,a*=m,s*=m):(o=0,a=0,s=0),h=f*s-d*a,u=d*o-l*s,c=l*a-f*o,(m=Math.sqrt(h*h+u*u+c*c))?(h*=m=1/m,u*=m,c*=m):(h=0,u=0,c=0),t[0]=o,t[1]=h,t[2]=l,t[3]=0,t[4]=a,t[5]=u,t[6]=f,t[7]=0,t[8]=s,t[9]=c,t[10]=d,t[11]=0,t[12]=-(o*g+a*v+s*y),t[13]=-(h*g+u*v+c*y),t[14]=-(l*g+f*v+d*y),t[15]=1,t)},p.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},p.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},void 0!==t&&(t.mat4=p);var d,m,g,v,y={};y.create=function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},y.rotationTo=(d=h.create(),m=h.fromValues(1,0,0),g=h.fromValues(0,1,0),function(t,e,n){var r=h.dot(e,n);return r<-.999999?(h.cross(d,m,e),h.length(d)<1e-6&&h.cross(d,g,e),h.normalize(d,d),y.setAxisAngle(t,d,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(h.cross(d,e,n),t[0]=d[0],t[1]=d[1],t[2]=d[2],t[3]=1+r,y.normalize(t,t))}),y.setAxes=(v=f.create(),function(t,e,n,r){return v[0]=n[0],v[3]=n[1],v[6]=n[2],v[1]=r[0],v[4]=r[1],v[7]=r[2],v[2]=-e[0],v[5]=-e[1],v[8]=-e[2],y.normalize(t,y.fromMat3(t,v))}),y.clone=u.clone,y.fromValues=u.fromValues,y.copy=u.copy,y.set=u.set,y.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},y.setAxisAngle=function(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t},y.add=u.add,y.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],h=n[1],u=n[2],c=n[3];return t[0]=r*c+a*s+i*u-o*h,t[1]=i*c+a*h+o*s-r*u,t[2]=o*c+a*u+r*h-i*s,t[3]=a*c-r*s-i*h-o*u,t},y.mul=y.multiply,y.scale=u.scale,y.rotateX=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),h=Math.cos(n);return t[0]=r*h+a*s,t[1]=i*h+o*s,t[2]=o*h-i*s,t[3]=a*h-r*s,t},y.rotateY=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),h=Math.cos(n);return t[0]=r*h-o*s,t[1]=i*h+a*s,t[2]=o*h+r*s,t[3]=a*h-i*s,t},y.rotateZ=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),h=Math.cos(n);return t[0]=r*h+i*s,t[1]=i*h-r*s,t[2]=o*h+a*s,t[3]=a*h-o*s,t},y.calculateW=function(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t},y.dot=u.dot,y.lerp=u.lerp,y.slerp=function(t,e,n,r){var i,o,a,s,h,u=e[0],c=e[1],l=e[2],f=e[3],p=n[0],d=n[1],m=n[2],g=n[3];return(o=u*p+c*d+l*m+f*g)<0&&(o=-o,p=-p,d=-d,m=-m,g=-g),1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,h=Math.sin(r*i)/a):(s=1-r,h=r),t[0]=s*u+h*p,t[1]=s*c+h*d,t[2]=s*l+h*m,t[3]=s*f+h*g,t},y.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t},y.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},y.length=u.length,y.len=y.length,y.squaredLength=u.squaredLength,y.sqrLen=y.squaredLength,y.normalize=u.normalize,y.fromMat3=function(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[7]-e[5])*n,t[1]=(e[2]-e[6])*n,t[2]=(e[3]-e[1])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*a+o]-e[3*o+a])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t},y.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.quat=y)}(n.exports)}()},function(t,e,n){n(1).vec3;var r=t.exports=function(t){this.valid=!0,this.id=t.id,this.handId=t.handId,this.length=t.length,this.tool=t.tool,this.width=t.width,this.direction=t.direction,this.stabilizedTipPosition=t.stabilizedTipPosition,this.tipPosition=t.tipPosition,this.tipVelocity=t.tipVelocity,this.touchZone=t.touchZone,this.touchDistance=t.touchDistance,this.timeVisible=t.timeVisible};r.prototype.toString=function(){return"Pointable [ id:"+this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"},r.prototype.hand=function(){return this.frame.hand(this.handId)},r.Invalid={valid:!1}},function(t,e,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function s(){s.init.call(this)}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var h=10;function u(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function c(t,e,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]),void 0===a)a=o[e]=n,++t._eventsCount;else if("function"==typeof a?a=o[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=u(t))>0&&a.length>i&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=a.length,s=h,console&&console.warn&&console.warn(s)}return t}function l(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,t))}.bind(r);return i.listener=n,r.wrapFn=i,i}function f(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):d(i,i.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function d(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var h=i[t];if(void 0===h)return!1;if("function"==typeof h)o(h,this,e);else{var u=h.length,c=d(h,u);for(n=0;n<u;++n)o(c[n],this,e)}return!0},s.prototype.addListener=function(t,e){return c(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return c(this,t,e,!0)},s.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,l(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,l(this,t,e)),this},s.prototype.removeListener=function(t,e){var n,r,i,o,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},s.prototype.listeners=function(t){return f(this,t,!0)},s.prototype.rawListeners=function(t){return f(this,t,!1)},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(t,e,n){var r=n(2),i=n(10),o=n(1),a=o.mat3,s=o.vec3,h=n(0),u=t.exports=function(t){this.id=t.id,this.palmPosition=t.palmPosition,this.direction=t.direction,this.palmVelocity=t.palmVelocity,this.palmNormal=t.palmNormal,this.sphereCenter=t.sphereCenter,this.sphereRadius=t.sphereRadius,this.valid=!0,this.pointables=[],this.fingers=[],t.armBasis?this.arm=new i(this,{type:4,width:t.armWidth,prevJoint:t.elbow,nextJoint:t.wrist,basis:t.armBasis}):this.arm=null,this.tools=[],this._translation=t.t,this._rotation=h.flatten(t.r),this._scaleFactor=t.s,this.timeVisible=t.timeVisible,this.stabilizedPalmPosition=t.stabilizedPalmPosition,this.type=t.type,this.grabStrength=t.grabStrength,this.pinchStrength=t.pinchStrength,this.confidence=t.confidence};u.prototype.finger=function(t){var e=this.frame.finger(t);return e&&e.handId==this.id?e:r.Invalid},u.prototype.rotationAngle=function(t,e){if(!this.valid||!t.valid)return 0;if(!t.hand(this.id).valid)return 0;var n=this.rotationMatrix(t),r=.5*(n[0]+n[4]+n[8]-1),i=Math.acos(r);if(i=isNaN(i)?0:i,void 0!==e){var o=this.rotationAxis(t);i*=s.dot(o,s.normalize(s.create(),e))}return i},u.prototype.rotationAxis=function(t){if(!this.valid||!t.valid)return s.create();var e=t.hand(this.id);return e.valid?s.normalize(s.create(),[this._rotation[7]-e._rotation[5],this._rotation[2]-e._rotation[6],this._rotation[3]-e._rotation[1]]):s.create()},u.prototype.rotationMatrix=function(t){if(!this.valid||!t.valid)return a.create();var e=t.hand(this.id);if(!e.valid)return a.create();var n=a.transpose(a.create(),this._rotation);return a.multiply(a.create(),e._rotation,n)},u.prototype.scaleFactor=function(t){if(!this.valid||!t.valid)return 1;var e=t.hand(this.id);return e.valid?Math.exp(this._scaleFactor-e._scaleFactor):1},u.prototype.translation=function(t){if(!this.valid||!t.valid)return s.create();var e=t.hand(this.id);return e.valid?[this._translation[0]-e._translation[0],this._translation[1]-e._translation[1],this._translation[2]-e._translation[2]]:s.create()},u.prototype.toString=function(){return"Hand ("+this.type+") [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "},u.prototype.pitch=function(){return Math.atan2(this.direction[1],-this.direction[2])},u.prototype.yaw=function(){return Math.atan2(this.direction[0],-this.direction[2])},u.prototype.roll=function(){return Math.atan2(this.palmNormal[0],-this.palmNormal[1])},u.Invalid={valid:!1,fingers:[],tools:[],pointables:[],left:!1,pointable:function(){return r.Invalid},finger:function(){return r.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return a.create()},rotationAxis:function(){return s.create()},scaleFactor:function(){return 1},translation:function(){return s.create()}}},function(t,e,n){var r=n(2),i=n(10),o=n(12),a=n(0),s=t.exports=function(t){r.call(this,t),this.dipPosition=t.dipPosition,this.pipPosition=t.pipPosition,this.mcpPosition=t.mcpPosition,this.carpPosition=t.carpPosition,this.extended=t.extended,this.type=t.type,this.finger=!0,this.positions=[this.carpPosition,this.mcpPosition,this.pipPosition,this.dipPosition,this.tipPosition],t.bases?this.addBones(t):o.warnBones()};a.extend(s.prototype,r.prototype),s.prototype.addBones=function(t){this.metacarpal=new i(this,{type:0,width:this.width,prevJoint:this.carpPosition,nextJoint:this.mcpPosition,basis:t.bases[0]}),this.proximal=new i(this,{type:1,width:this.width,prevJoint:this.mcpPosition,nextJoint:this.pipPosition,basis:t.bases[1]}),this.medial=new i(this,{type:2,width:this.width,prevJoint:this.pipPosition,nextJoint:this.dipPosition,basis:t.bases[2]}),this.distal=new i(this,{type:3,width:this.width,prevJoint:this.dipPosition,nextJoint:t.btipPosition,basis:t.bases[3]}),this.bones=[this.metacarpal,this.proximal,this.medial,this.distal]},s.prototype.toString=function(){return"Finger [ id:"+this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"},s.Invalid={valid:!1}},function(t,e,n){var r=n(4),i=n(2),o=n(7).createGesture,a=n(1),s=a.mat3,h=a.vec3,u=n(11),c=n(5),l=n(0),f=t.exports=function(t){if(this.valid=!0,this.id=t.id,this.timestamp=t.timestamp,this.hands=[],this.handsMap={},this.pointables=[],this.tools=[],this.fingers=[],t.interactionBox&&(this.interactionBox=new u(t.interactionBox)),this.gestures=[],this.pointablesMap={},this._translation=t.t,this._rotation=l.flatten(t.r),this._scaleFactor=t.s,this.data=t,this.type="frame",this.currentFrameRate=t.currentFrameRate,t.gestures)for(var e=0,n=t.gestures.length;e!=n;e++)this.gestures.push(o(t.gestures[e]));this.postprocessData(t)};f.prototype.postprocessData=function(t){t||(t=this.data);for(var e=0,n=t.hands.length;e!=n;e++){var o=new r(t.hands[e]);o.frame=this,this.hands.push(o),this.handsMap[o.id]=o}t.pointables=l.sortBy(t.pointables,function(t){return t.id});for(var a=0,s=t.pointables.length;a!=s;a++){var h=t.pointables[a],u=h.dipPosition?new c(h):new i(h);u.frame=this,this.addPointable(u)}},f.prototype.addPointable=function(t){if(this.pointables.push(t),this.pointablesMap[t.id]=t,(t.tool?this.tools:this.fingers).push(t),void 0!==t.handId&&this.handsMap.hasOwnProperty(t.handId)){var e=this.handsMap[t.handId];switch(e.pointables.push(t),(t.tool?e.tools:e.fingers).push(t),t.type){case 0:e.thumb=t;break;case 1:e.indexFinger=t;break;case 2:e.middleFinger=t;break;case 3:e.ringFinger=t;break;case 4:e.pinky=t}}},f.prototype.tool=function(t){var e=this.pointable(t);return e.tool?e:i.Invalid},f.prototype.pointable=function(t){return this.pointablesMap[t]||i.Invalid},f.prototype.finger=function(t){var e=this.pointable(t);return e.tool?i.Invalid:e},f.prototype.hand=function(t){return this.handsMap[t]||r.Invalid},f.prototype.rotationAngle=function(t,e){if(!this.valid||!t.valid)return 0;var n=this.rotationMatrix(t),r=.5*(n[0]+n[4]+n[8]-1),i=Math.acos(r);if(i=isNaN(i)?0:i,void 0!==e){var o=this.rotationAxis(t);i*=h.dot(o,h.normalize(h.create(),e))}return i},f.prototype.rotationAxis=function(t){return this.valid&&t.valid?h.normalize(h.create(),[this._rotation[7]-t._rotation[5],this._rotation[2]-t._rotation[6],this._rotation[3]-t._rotation[1]]):h.create()},f.prototype.rotationMatrix=function(t){if(!this.valid||!t.valid)return s.create();var e=s.transpose(s.create(),this._rotation);return s.multiply(s.create(),t._rotation,e)},f.prototype.scaleFactor=function(t){return this.valid&&t.valid?Math.exp(this._scaleFactor-t._scaleFactor):1},f.prototype.translation=function(t){return this.valid&&t.valid?h.subtract(h.create(),this._translation,t._translation):h.create()},f.prototype.toString=function(){var t="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";return this.gestures&&(t+=" | Gesture count:("+this.gestures.length+")"),t+=" ]"},f.prototype.dump=function(){var t="";t+="Frame Info:<br/>",t+=this.toString(),t+="<br/><br/>Hands:<br/>";for(var e=0,n=this.hands.length;e!=n;e++)t+="  "+this.hands[e].toString()+"<br/>";t+="<br/><br/>Pointables:<br/>";for(var r=0,i=this.pointables.length;r!=i;r++)t+="  "+this.pointables[r].toString()+"<br/>";if(this.gestures){t+="<br/><br/>Gestures:<br/>";for(var o=0,a=this.gestures.length;o!=a;o++)t+="  "+this.gestures[o].toString()+"<br/>"}return t+="<br/><br/>Raw JSON:<br/>",t+=JSON.stringify(this.data)},f.Invalid={valid:!1,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return i.Invalid},finger:function(){return i.Invalid},hand:function(){return r.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return s.create()},rotationAxis:function(){return h.create()},scaleFactor:function(){return 1},translation:function(){return h.create()}}},function(t,e,n){var r=n(1).vec3,i=n(3).EventEmitter,o=n(0),a=(e.createGesture=function(t){var e;switch(t.type){case"circle":e=new s(t);break;case"swipe":e=new h(t);break;case"screenTap":e=new u(t);break;case"keyTap":e=new c(t);break;default:throw"unknown gesture type"}return e.id=t.id,e.handIds=t.handIds.slice(),e.pointableIds=t.pointableIds.slice(),e.duration=t.duration,e.state=t.state,e.type=t.type,e},e.gestureListener=function(t,e){var n={},r={};t.on("gesture",function(t,i){if(t.type==e){if(("start"==t.state||"stop"==t.state)&&void 0===r[t.id]){var s=new a(t,i);r[t.id]=s,o.each(n,function(t,e){s.on(e,t)})}r[t.id].update(t,i),"stop"==t.state&&delete r[t.id]}});var i={start:function(t){return n.start=t,i},stop:function(t){return n.stop=t,i},complete:function(t){return n.stop=t,i},update:function(t){return n.update=t,i}};return i},e.Gesture=function(t,e){this.gestures=[t],this.frames=[e]});a.prototype.update=function(t,e){this.lastGesture=t,this.lastFrame=e,this.gestures.push(t),this.frames.push(e),this.emit(t.state,this)},a.prototype.translation=function(){return r.subtract(r.create(),this.lastGesture.startPosition,this.lastGesture.position)},o.extend(a.prototype,i.prototype);var s=function(t){this.center=t.center,this.normal=t.normal,this.progress=t.progress,this.radius=t.radius};s.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var h=function(t){this.startPosition=t.startPosition,this.position=t.position,this.direction=t.direction,this.speed=t.speed};h.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var u=function(t){this.position=t.position,this.direction=t.direction,this.progress=t.progress};u.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var c=function(t){this.position=t.position,this.direction=t.direction,this.progress=t.progress};c.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+"]"}},function(t,e,n){t.exports={Controller:n(19),Frame:n(6),Gesture:n(7),Hand:n(4),Pointable:n(2),Finger:n(5),InteractionBox:n(11),CircularBuffer:n(13),UI:n(24),JSONProtocol:n(15).JSONProtocol,glMatrix:n(1),mat3:n(1).mat3,vec3:n(1).vec3,loopController:void 0,version:n(27),_:n(0),EventEmitter:n(3).EventEmitter,loop:function(t,e){return t&&void 0===e&&"[object Function]"==={}.toString.call(t)&&(e=t,t={}),this.loopController?t&&this.loopController.setupFrameEvents(t):this.loopController=new this.Controller(t),this.loopController.loop(e),this.loopController},plugin:function(t,e){this.Controller.plugin(t,e)}}},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var h,u=[],c=!1,l=-1;function f(){c&&h&&(c=!1,h.length?u=h.concat(u):l=-1,u.length&&p())}function p(){if(!c){var t=s(f);c=!0;for(var e=u.length;e;){for(h=u,u=[];++l<e;)h&&h[l].run();l=-1,e=u.length}h=null,c=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new d(t,e)),1!==u.length||c||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){n(2);var r=n(1),i=r.vec3,o=r.mat3,a=r.mat4,s=(n(0),t.exports=function(t,e){this.finger=t,this._center=null,this._matrix=null,this.type=e.type,this.prevJoint=e.prevJoint,this.nextJoint=e.nextJoint,this.width=e.width;var n=new Array(3);i.sub(n,e.nextJoint,e.prevJoint),this.length=i.length(n),this.basis=e.basis});s.prototype.left=function(){return this._left?this._left:(this._left=o.determinant(this.basis[0].concat(this.basis[1]).concat(this.basis[2]))<0,this._left)},s.prototype.matrix=function(){if(this._matrix)return this._matrix;var t=this.basis,e=this._matrix=a.create();return e[0]=t[0][0],e[1]=t[0][1],e[2]=t[0][2],e[4]=t[1][0],e[5]=t[1][1],e[6]=t[1][2],e[8]=t[2][0],e[9]=t[2][1],e[10]=t[2][2],e[3]=this.center()[0],e[7]=this.center()[1],e[11]=this.center()[2],this.left()&&(e[0]*=-1,e[1]*=-1,e[2]*=-1),this._matrix},s.prototype.lerp=function(t,e){i.lerp(t,this.prevJoint,this.nextJoint,e)},s.prototype.center=function(){if(this._center)return this._center;var t=i.create();return this.lerp(t,.5),this._center=t,t},s.prototype.direction=function(){return[-1*this.basis[2][0],-1*this.basis[2][1],-1*this.basis[2][2]]}},function(t,e,n){var r=n(1).vec3,i=t.exports=function(t){this.valid=!0,this.center=t.center,this.size=t.size,this.width=t.size[0],this.height=t.size[1],this.depth=t.size[2]};i.prototype.denormalizePoint=function(t){return r.fromValues((t[0]-.5)*this.size[0]+this.center[0],(t[1]-.5)*this.size[1]+this.center[1],(t[2]-.5)*this.size[2]+this.center[2])},i.prototype.normalizePoint=function(t,e){var n=r.fromValues((t[0]-this.center[0])/this.size[0]+.5,(t[1]-this.center[1])/this.size[1]+.5,(t[2]-this.center[2])/this.size[2]+.5);return e&&(n[0]=Math.min(Math.max(n[0],0),1),n[1]=Math.min(Math.max(n[1],0),1),n[2]=Math.min(Math.max(n[2],0),1)),n},i.prototype.toString=function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"},i.Invalid={valid:!1}},function(t,e,n){(function(e){var n=t.exports=function(t,e){this.options=e||{},this.message=t,this.createElement()};n.prototype.createElement=function(){this.element=document.createElement("div"),this.element.className="leapjs-dialog",this.element.style.position="fixed",this.element.style.top="8px",this.element.style.left=0,this.element.style.right=0,this.element.style.textAlign="center",this.element.style.zIndex=1e3;var t=document.createElement("div");this.element.appendChild(t),t.style.className="leapjs-dialog",t.style.display="inline-block",t.style.margin="auto",t.style.padding="8px",t.style.color="#222",t.style.background="#eee",t.style.borderRadius="4px",t.style.border="1px solid #999",t.style.textAlign="left",t.style.cursor="pointer",t.style.whiteSpace="nowrap",t.style.transition="box-shadow 1s linear",t.innerHTML=this.message,this.options.onclick&&t.addEventListener("click",this.options.onclick),this.options.onmouseover&&t.addEventListener("mouseover",this.options.onmouseover),this.options.onmouseout&&t.addEventListener("mouseout",this.options.onmouseout),this.options.onmousemove&&t.addEventListener("mousemove",this.options.onmousemove)},n.prototype.show=function(){return document.body.appendChild(this.element),this},n.prototype.hide=function(){return document.body.removeChild(this.element),this},n.warnOutOfDate=function(t){t||(t={});var e="http://developer.leapmotion.com?";for(var r in t.returnTo=window.location.href,t)e+=r+"="+encodeURIComponent(t[r])+"&";var i;return(i=new n("This site requires Leap Motion Tracking V2.<button id='leapjs-accept-upgrade'  style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 16px;'>Upgrade</button><button id='leapjs-decline-upgrade' style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 8px; '>Not Now</button>",{onclick:function(t){if("leapjs-decline-upgrade"!=t.target.id){var n=window.open(e,"_blank","height=800,width=1000,location=1,menubar=1,resizable=1,status=1,toolbar=1,scrollbars=1");window.focus&&n.focus()}return i.hide(),!0},onmousemove:function(t){t.target==document.getElementById("leapjs-decline-upgrade")?(document.getElementById("leapjs-decline-upgrade").style.color="#000",document.getElementById("leapjs-decline-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-accept-upgrade").style.color="#444",document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"):(document.getElementById("leapjs-accept-upgrade").style.color="#000",document.getElementById("leapjs-accept-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-decline-upgrade").style.color="#444",document.getElementById("leapjs-decline-upgrade").style.boxShadow="none")},onmouseout:function(){document.getElementById("leapjs-decline-upgrade").style.color="#444",document.getElementById("leapjs-decline-upgrade").style.boxShadow="none",document.getElementById("leapjs-accept-upgrade").style.color="#444",document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"}})).show()},n.hasWarnedBones=!1,n.warnBones=function(){this.hasWarnedBones||(this.hasWarnedBones=!0,console.warn("Your Leap Service is out of date"),void 0!==e&&e.versions&&e.versions.node||this.warnOutOfDate({reason:"bones"}))}}).call(this,n(9))},function(t,e){var n=t.exports=function(t){this.pos=0,this._buf=[],this.size=t};n.prototype.get=function(t){if(null==t&&(t=0),!(t>=this.size||t>=this._buf.length))return this._buf[(this.pos-t-1)%this.size]},n.prototype.push=function(t){return this._buf[this.pos%this.size]=t,this.pos++}},function(t,e,n){var r=n(15).chooseProtocol,i=n(3).EventEmitter,o=n(0),a=t.exports=function(t){this.opts=o.defaults(t||{},{host:"127.0.0.1",enableGestures:!1,scheme:this.getScheme(),port:this.getPort(),background:!1,optimizeHMD:!1,requestProtocolVersion:a.defaultProtocolVersion}),this.host=this.opts.host,this.port=this.opts.port,this.scheme=this.opts.scheme,this.protocolVersionVerified=!1,this.background=null,this.optimizeHMD=null,this.on("ready",function(){this.enableGestures(this.opts.enableGestures),this.setBackground(this.opts.background),this.setOptimizeHMD(this.opts.optimizeHMD),this.opts.optimizeHMD?console.log("Optimized for head mounted display usage."):console.log("Optimized for desktop usage.")})};a.defaultProtocolVersion=6,a.prototype.getUrl=function(){return this.scheme+"//"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"},a.prototype.getScheme=function(){return"ws:"},a.prototype.getPort=function(){return 6437},a.prototype.setBackground=function(t){this.opts.background=t,this.protocol&&this.protocol.sendBackground&&this.background!==this.opts.background&&(this.background=this.opts.background,this.protocol.sendBackground(this,this.opts.background))},a.prototype.setOptimizeHMD=function(t){this.opts.optimizeHMD=t,this.protocol&&this.protocol.sendOptimizeHMD&&this.optimizeHMD!==this.opts.optimizeHMD&&(this.optimizeHMD=this.opts.optimizeHMD,this.protocol.sendOptimizeHMD(this,this.opts.optimizeHMD))},a.prototype.handleOpen=function(){this.connected||(this.connected=!0,this.emit("connect"))},a.prototype.enableGestures=function(t){this.gesturesEnabled=!!t,this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))},a.prototype.handleClose=function(t,e){this.connected&&(this.disconnect(),1001===t&&this.opts.requestProtocolVersion>1&&(this.protocolVersionVerified?this.protocolVersionVerified=!1:this.opts.requestProtocolVersion--),this.startReconnection())},a.prototype.startReconnection=function(){var t=this;this.reconnectionTimer||(this.reconnectionTimer=setInterval(function(){t.reconnect()},500))},a.prototype.stopReconnection=function(){this.reconnectionTimer=clearInterval(this.reconnectionTimer)},a.prototype.disconnect=function(t){if(t||this.stopReconnection(),this.socket)return this.socket.close(),delete this.socket,delete this.protocol,delete this.background,delete this.optimizeHMD,delete this.focusedState,this.connected&&(this.connected=!1,this.emit("disconnect")),!0},a.prototype.reconnect=function(){this.connected?this.stopReconnection():(this.disconnect(!0),this.connect())},a.prototype.handleData=function(t){var e,n=JSON.parse(t);void 0===this.protocol?(e=this.protocol=r(n),this.protocolVersionVerified=!0,this.emit("ready")):e=this.protocol(n),this.emit(e.type,e)},a.prototype.connect=function(){if(!this.socket)return this.socket=this.setupSocket(),!0},a.prototype.send=function(t){this.socket.send(t)},a.prototype.reportFocus=function(t){this.connected&&this.focusedState!==t&&(this.focusedState=t,this.emit(this.focusedState?"focus":"blur"),this.protocol&&this.protocol.sendFocused&&this.protocol.sendFocused(this,this.focusedState))},o.extend(a.prototype,i.prototype)},function(t,e,n){var r=n(6),i=(n(4),n(2),n(5),n(0)),o=n(3).EventEmitter,a=function(t){this.type=t.type,this.state=t.state};e.chooseProtocol=function(t){var e;switch(t.version){case 1:case 2:case 3:case 4:case 5:case 6:(e=s(t)).sendBackground=function(t,n){t.send(e.encode({background:n}))},e.sendFocused=function(t,n){t.send(e.encode({focused:n}))},e.sendOptimizeHMD=function(t,n){t.send(e.encode({optimizeHMD:n}))};break;default:throw"unrecognized version"}return e};var s=e.JSONProtocol=function(t){var e=function(t){if(t.event)return new a(t.event);e.emit("beforeFrameCreated",t);var n=new r(t);return e.emit("afterFrameCreated",n,t),n};return e.encode=function(t){return JSON.stringify(t)},e.version=t.version,e.serviceVersion=t.serviceVersion,e.versionLong="Version "+t.version,e.type="protocol",i.extend(e,o.prototype),e}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){(function(t,r){var i;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var o,a=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",u="__lodash_hash_undefined__",c=500,l="__lodash_placeholder__",f=1,p=2,d=4,m=1,g=2,v=1,y=2,x=4,_=8,b=16,w=32,M=64,A=128,S=256,C=512,T=30,E="...",L=800,P=16,D=1,R=2,F=1/0,k=9007199254740991,B=1.7976931348623157e308,z=NaN,N=4294967295,U=N-1,I=N>>>1,O=[["ary",A],["bind",v],["bindKey",y],["curry",_],["curryRight",b],["flip",C],["partial",w],["partialRight",M],["rearg",S]],V="[object Arguments]",H="[object Array]",G="[object AsyncFunction]",j="[object Boolean]",W="[object Date]",X="[object DOMException]",q="[object Error]",Q="[object Function]",Y="[object GeneratorFunction]",K="[object Map]",J="[object Number]",Z="[object Null]",$="[object Object]",tt="[object Proxy]",et="[object RegExp]",nt="[object Set]",rt="[object String]",it="[object Symbol]",ot="[object Undefined]",at="[object WeakMap]",st="[object WeakSet]",ht="[object ArrayBuffer]",ut="[object DataView]",ct="[object Float32Array]",lt="[object Float64Array]",ft="[object Int8Array]",pt="[object Int16Array]",dt="[object Int32Array]",mt="[object Uint8Array]",gt="[object Uint8ClampedArray]",vt="[object Uint16Array]",yt="[object Uint32Array]",xt=/\b__p \+= '';/g,_t=/\b(__p \+=) '' \+/g,bt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,wt=/&(?:amp|lt|gt|quot|#39);/g,Mt=/[&<>"']/g,At=RegExp(wt.source),St=RegExp(Mt.source),Ct=/<%-([\s\S]+?)%>/g,Tt=/<%([\s\S]+?)%>/g,Et=/<%=([\s\S]+?)%>/g,Lt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pt=/^\w*$/,Dt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Rt=/[\\^$.*+?()[\]{}|]/g,Ft=RegExp(Rt.source),kt=/^\s+|\s+$/g,Bt=/^\s+/,zt=/\s+$/,Nt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ut=/\{\n\/\* \[wrapped with (.+)\] \*/,It=/,? & /,Ot=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Vt=/\\(\\)?/g,Ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Gt=/\w*$/,jt=/^[-+]0x[0-9a-f]+$/i,Wt=/^0b[01]+$/i,Xt=/^\[object .+?Constructor\]$/,qt=/^0o[0-7]+$/i,Qt=/^(?:0|[1-9]\d*)$/,Yt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Kt=/($^)/,Jt=/['\n\r\u2028\u2029\\]/g,Zt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",$t="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",te="[\\ud800-\\udfff]",ee="["+$t+"]",ne="["+Zt+"]",re="\\d+",ie="[\\u2700-\\u27bf]",oe="[a-z\\xdf-\\xf6\\xf8-\\xff]",ae="[^\\ud800-\\udfff"+$t+re+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",se="\\ud83c[\\udffb-\\udfff]",he="[^\\ud800-\\udfff]",ue="(?:\\ud83c[\\udde6-\\uddff]){2}",ce="[\\ud800-\\udbff][\\udc00-\\udfff]",le="[A-Z\\xc0-\\xd6\\xd8-\\xde]",fe="(?:"+oe+"|"+ae+")",pe="(?:"+le+"|"+ae+")",de="(?:"+ne+"|"+se+")"+"?",me="[\\ufe0e\\ufe0f]?"+de+("(?:\\u200d(?:"+[he,ue,ce].join("|")+")[\\ufe0e\\ufe0f]?"+de+")*"),ge="(?:"+[ie,ue,ce].join("|")+")"+me,ve="(?:"+[he+ne+"?",ne,ue,ce,te].join("|")+")",ye=RegExp("[']","g"),xe=RegExp(ne,"g"),_e=RegExp(se+"(?="+se+")|"+ve+me,"g"),be=RegExp([le+"?"+oe+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[ee,le,"$"].join("|")+")",pe+"+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[ee,le+fe,"$"].join("|")+")",le+"?"+fe+"+(?:['](?:d|ll|m|re|s|t|ve))?",le+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",re,ge].join("|"),"g"),we=RegExp("[\\u200d\\ud800-\\udfff"+Zt+"\\ufe0e\\ufe0f]"),Me=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ae=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Se=-1,Ce={};Ce[ct]=Ce[lt]=Ce[ft]=Ce[pt]=Ce[dt]=Ce[mt]=Ce[gt]=Ce[vt]=Ce[yt]=!0,Ce[V]=Ce[H]=Ce[ht]=Ce[j]=Ce[ut]=Ce[W]=Ce[q]=Ce[Q]=Ce[K]=Ce[J]=Ce[$]=Ce[et]=Ce[nt]=Ce[rt]=Ce[at]=!1;var Te={};Te[V]=Te[H]=Te[ht]=Te[ut]=Te[j]=Te[W]=Te[ct]=Te[lt]=Te[ft]=Te[pt]=Te[dt]=Te[K]=Te[J]=Te[$]=Te[et]=Te[nt]=Te[rt]=Te[it]=Te[mt]=Te[gt]=Te[vt]=Te[yt]=!0,Te[q]=Te[Q]=Te[at]=!1;var Ee={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Le=parseFloat,Pe=parseInt,De="object"==typeof t&&t&&t.Object===Object&&t,Re="object"==typeof self&&self&&self.Object===Object&&self,Fe=De||Re||Function("return this")(),ke=e&&!e.nodeType&&e,Be=ke&&"object"==typeof r&&r&&!r.nodeType&&r,ze=Be&&Be.exports===ke,Ne=ze&&De.process,Ue=function(){try{var t=Be&&Be.require&&Be.require("util").types;return t||Ne&&Ne.binding&&Ne.binding("util")}catch(t){}}(),Ie=Ue&&Ue.isArrayBuffer,Oe=Ue&&Ue.isDate,Ve=Ue&&Ue.isMap,He=Ue&&Ue.isRegExp,Ge=Ue&&Ue.isSet,je=Ue&&Ue.isTypedArray;function We(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Xe(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r}function qe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Qe(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Ye(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Ke(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Je(t,e){return!!(null==t?0:t.length)&&hn(t,e,0)>-1}function Ze(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function $e(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function tn(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function en(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function nn(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function rn(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var on=fn("length");function an(t,e,n){var r;return n(t,function(t,n,i){if(e(t,n,i))return r=n,!1}),r}function sn(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}function hn(t,e,n){return e==e?function(t,e,n){var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):sn(t,cn,n)}function un(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function cn(t){return t!=t}function ln(t,e){var n=null==t?0:t.length;return n?mn(t,e)/n:z}function fn(t){return function(e){return null==e?o:e[t]}}function pn(t){return function(e){return null==t?o:t[e]}}function dn(t,e,n,r,i){return i(t,function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)}),n}function mn(t,e){for(var n,r=-1,i=t.length;++r<i;){var a=e(t[r]);a!==o&&(n=n===o?a:n+a)}return n}function gn(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function vn(t){return function(e){return t(e)}}function yn(t,e){return $e(e,function(e){return t[e]})}function xn(t,e){return t.has(e)}function _n(t,e){for(var n=-1,r=t.length;++n<r&&hn(e,t[n],0)>-1;);return n}function bn(t,e){for(var n=t.length;n--&&hn(e,t[n],0)>-1;);return n}var wn=pn({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),Mn=pn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function An(t){return"\\"+Ee[t]}function Sn(t){return we.test(t)}function Cn(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function Tn(t,e){return function(n){return t(e(n))}}function En(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==l||(t[n]=l,o[i++]=n)}return o}function Ln(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function Pn(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}function Dn(t){return Sn(t)?function(t){var e=_e.lastIndex=0;for(;_e.test(t);)++e;return e}(t):on(t)}function Rn(t){return Sn(t)?function(t){return t.match(_e)||[]}(t):function(t){return t.split("")}(t)}var Fn=pn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var kn=function t(e){var n,r=(e=null==e?Fe:kn.defaults(Fe.Object(),e,kn.pick(Fe,Ae))).Array,i=e.Date,Zt=e.Error,$t=e.Function,te=e.Math,ee=e.Object,ne=e.RegExp,re=e.String,ie=e.TypeError,oe=r.prototype,ae=$t.prototype,se=ee.prototype,he=e["__core-js_shared__"],ue=ae.toString,ce=se.hasOwnProperty,le=0,fe=(n=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",pe=se.toString,de=ue.call(ee),me=Fe._,ge=ne("^"+ue.call(ce).replace(Rt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ve=ze?e.Buffer:o,_e=e.Symbol,we=e.Uint8Array,Ee=ve?ve.allocUnsafe:o,De=Tn(ee.getPrototypeOf,ee),Re=ee.create,ke=se.propertyIsEnumerable,Be=oe.splice,Ne=_e?_e.isConcatSpreadable:o,Ue=_e?_e.iterator:o,on=_e?_e.toStringTag:o,pn=function(){try{var t=Io(ee,"defineProperty");return t({},"",{}),t}catch(t){}}(),Bn=e.clearTimeout!==Fe.clearTimeout&&e.clearTimeout,zn=i&&i.now!==Fe.Date.now&&i.now,Nn=e.setTimeout!==Fe.setTimeout&&e.setTimeout,Un=te.ceil,In=te.floor,On=ee.getOwnPropertySymbols,Vn=ve?ve.isBuffer:o,Hn=e.isFinite,Gn=oe.join,jn=Tn(ee.keys,ee),Wn=te.max,Xn=te.min,qn=i.now,Qn=e.parseInt,Yn=te.random,Kn=oe.reverse,Jn=Io(e,"DataView"),Zn=Io(e,"Map"),$n=Io(e,"Promise"),tr=Io(e,"Set"),er=Io(e,"WeakMap"),nr=Io(ee,"create"),rr=er&&new er,ir={},or=la(Jn),ar=la(Zn),sr=la($n),hr=la(tr),ur=la(er),cr=_e?_e.prototype:o,lr=cr?cr.valueOf:o,fr=cr?cr.toString:o;function pr(t){if(Es(t)&&!vs(t)&&!(t instanceof vr)){if(t instanceof gr)return t;if(ce.call(t,"__wrapped__"))return fa(t)}return new gr(t)}var dr=function(){function t(){}return function(e){if(!Ts(e))return{};if(Re)return Re(e);t.prototype=e;var n=new t;return t.prototype=o,n}}();function mr(){}function gr(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=o}function vr(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=N,this.__views__=[]}function yr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function xr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function _r(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function br(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new _r;++e<n;)this.add(t[e])}function wr(t){var e=this.__data__=new xr(t);this.size=e.size}function Mr(t,e){var n=vs(t),r=!n&&gs(t),i=!n&&!r&&bs(t),o=!n&&!r&&!i&&zs(t),a=n||r||i||o,s=a?gn(t.length,re):[],h=s.length;for(var u in t)!e&&!ce.call(t,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Xo(u,h))||s.push(u);return s}function Ar(t){var e=t.length;return e?t[bi(0,e-1)]:o}function Sr(t,e){return ha(no(t),kr(e,0,t.length))}function Cr(t){return ha(no(t))}function Tr(t,e,n){(n===o||ps(t[e],n))&&(n!==o||e in t)||Rr(t,e,n)}function Er(t,e,n){var r=t[e];ce.call(t,e)&&ps(r,n)&&(n!==o||e in t)||Rr(t,e,n)}function Lr(t,e){for(var n=t.length;n--;)if(ps(t[n][0],e))return n;return-1}function Pr(t,e,n,r){return Ir(t,function(t,i,o){e(r,t,n(t),o)}),r}function Dr(t,e){return t&&ro(e,ih(e),t)}function Rr(t,e,n){"__proto__"==e&&pn?pn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Fr(t,e){for(var n=-1,i=e.length,a=r(i),s=null==t;++n<i;)a[n]=s?o:$s(t,e[n]);return a}function kr(t,e,n){return t==t&&(n!==o&&(t=t<=n?t:n),e!==o&&(t=t>=e?t:e)),t}function Br(t,e,n,r,i,a){var s,h=e&f,u=e&p,c=e&d;if(n&&(s=i?n(t,r,i,a):n(t)),s!==o)return s;if(!Ts(t))return t;var l=vs(t);if(l){if(s=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&ce.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!h)return no(t,s)}else{var m=Ho(t),g=m==Q||m==Y;if(bs(t))return Ki(t,h);if(m==$||m==V||g&&!i){if(s=u||g?{}:jo(t),!h)return u?function(t,e){return ro(t,Vo(t),e)}(t,function(t,e){return t&&ro(e,oh(e),t)}(s,t)):function(t,e){return ro(t,Oo(t),e)}(t,Dr(s,t))}else{if(!Te[m])return i?t:{};s=function(t,e,n){var r,i,o,a=t.constructor;switch(e){case ht:return Ji(t);case j:case W:return new a(+t);case ut:return function(t,e){var n=e?Ji(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case ct:case lt:case ft:case pt:case dt:case mt:case gt:case vt:case yt:return Zi(t,n);case K:return new a;case J:case rt:return new a(t);case et:return(o=new(i=t).constructor(i.source,Gt.exec(i))).lastIndex=i.lastIndex,o;case nt:return new a;case it:return r=t,lr?ee(lr.call(r)):{}}}(t,m,h)}}a||(a=new wr);var v=a.get(t);if(v)return v;if(a.set(t,s),Fs(t))return t.forEach(function(r){s.add(Br(r,e,n,r,t,a))}),s;if(Ls(t))return t.forEach(function(r,i){s.set(i,Br(r,e,n,i,t,a))}),s;var y=l?o:(c?u?Ro:Do:u?oh:ih)(t);return qe(y||t,function(r,i){y&&(r=t[i=r]),Er(s,i,Br(r,e,n,i,t,a))}),s}function zr(t,e,n){var r=n.length;if(null==t)return!r;for(t=ee(t);r--;){var i=n[r],a=e[i],s=t[i];if(s===o&&!(i in t)||!a(s))return!1}return!0}function Nr(t,e,n){if("function"!=typeof t)throw new ie(h);return ia(function(){t.apply(o,n)},e)}function Ur(t,e,n,r){var i=-1,o=Je,s=!0,h=t.length,u=[],c=e.length;if(!h)return u;n&&(e=$e(e,vn(n))),r?(o=Ze,s=!1):e.length>=a&&(o=xn,s=!1,e=new br(e));t:for(;++i<h;){var l=t[i],f=null==n?l:n(l);if(l=r||0!==l?l:0,s&&f==f){for(var p=c;p--;)if(e[p]===f)continue t;u.push(l)}else o(e,f,r)||u.push(l)}return u}pr.templateSettings={escape:Ct,evaluate:Tt,interpolate:Et,variable:"",imports:{_:pr}},pr.prototype=mr.prototype,pr.prototype.constructor=pr,gr.prototype=dr(mr.prototype),gr.prototype.constructor=gr,vr.prototype=dr(mr.prototype),vr.prototype.constructor=vr,yr.prototype.clear=function(){this.__data__=nr?nr(null):{},this.size=0},yr.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},yr.prototype.get=function(t){var e=this.__data__;if(nr){var n=e[t];return n===u?o:n}return ce.call(e,t)?e[t]:o},yr.prototype.has=function(t){var e=this.__data__;return nr?e[t]!==o:ce.call(e,t)},yr.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=nr&&e===o?u:e,this},xr.prototype.clear=function(){this.__data__=[],this.size=0},xr.prototype.delete=function(t){var e=this.__data__,n=Lr(e,t);return!(n<0||(n==e.length-1?e.pop():Be.call(e,n,1),--this.size,0))},xr.prototype.get=function(t){var e=this.__data__,n=Lr(e,t);return n<0?o:e[n][1]},xr.prototype.has=function(t){return Lr(this.__data__,t)>-1},xr.prototype.set=function(t,e){var n=this.__data__,r=Lr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},_r.prototype.clear=function(){this.size=0,this.__data__={hash:new yr,map:new(Zn||xr),string:new yr}},_r.prototype.delete=function(t){var e=No(this,t).delete(t);return this.size-=e?1:0,e},_r.prototype.get=function(t){return No(this,t).get(t)},_r.prototype.has=function(t){return No(this,t).has(t)},_r.prototype.set=function(t,e){var n=No(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},br.prototype.add=br.prototype.push=function(t){return this.__data__.set(t,u),this},br.prototype.has=function(t){return this.__data__.has(t)},wr.prototype.clear=function(){this.__data__=new xr,this.size=0},wr.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},wr.prototype.get=function(t){return this.__data__.get(t)},wr.prototype.has=function(t){return this.__data__.has(t)},wr.prototype.set=function(t,e){var n=this.__data__;if(n instanceof xr){var r=n.__data__;if(!Zn||r.length<a-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new _r(r)}return n.set(t,e),this.size=n.size,this};var Ir=ao(qr),Or=ao(Qr,!0);function Vr(t,e){var n=!0;return Ir(t,function(t,r,i){return n=!!e(t,r,i)}),n}function Hr(t,e,n){for(var r=-1,i=t.length;++r<i;){var a=t[r],s=e(a);if(null!=s&&(h===o?s==s&&!Bs(s):n(s,h)))var h=s,u=a}return u}function Gr(t,e){var n=[];return Ir(t,function(t,r,i){e(t,r,i)&&n.push(t)}),n}function jr(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=Wo),i||(i=[]);++o<a;){var s=t[o];e>0&&n(s)?e>1?jr(s,e-1,n,r,i):tn(i,s):r||(i[i.length]=s)}return i}var Wr=so(),Xr=so(!0);function qr(t,e){return t&&Wr(t,e,ih)}function Qr(t,e){return t&&Xr(t,e,ih)}function Yr(t,e){return Ke(e,function(e){return As(t[e])})}function Kr(t,e){for(var n=0,r=(e=Xi(e,t)).length;null!=t&&n<r;)t=t[ca(e[n++])];return n&&n==r?t:o}function Jr(t,e,n){var r=e(t);return vs(t)?r:tn(r,n(t))}function Zr(t){return null==t?t===o?ot:Z:on&&on in ee(t)?function(t){var e=ce.call(t,on),n=t[on];try{t[on]=o;var r=!0}catch(t){}var i=pe.call(t);return r&&(e?t[on]=n:delete t[on]),i}(t):function(t){return pe.call(t)}(t)}function $r(t,e){return t>e}function ti(t,e){return null!=t&&ce.call(t,e)}function ei(t,e){return null!=t&&e in ee(t)}function ni(t,e,n){for(var i=n?Ze:Je,a=t[0].length,s=t.length,h=s,u=r(s),c=1/0,l=[];h--;){var f=t[h];h&&e&&(f=$e(f,vn(e))),c=Xn(f.length,c),u[h]=!n&&(e||a>=120&&f.length>=120)?new br(h&&f):o}f=t[0];var p=-1,d=u[0];t:for(;++p<a&&l.length<c;){var m=f[p],g=e?e(m):m;if(m=n||0!==m?m:0,!(d?xn(d,g):i(l,g,n))){for(h=s;--h;){var v=u[h];if(!(v?xn(v,g):i(t[h],g,n)))continue t}d&&d.push(g),l.push(m)}}return l}function ri(t,e,n){var r=null==(t=ea(t,e=Xi(e,t)))?t:t[ca(Ma(e))];return null==r?o:We(r,t,n)}function ii(t){return Es(t)&&Zr(t)==V}function oi(t,e,n,r,i){return t===e||(null==t||null==e||!Es(t)&&!Es(e)?t!=t&&e!=e:function(t,e,n,r,i,a){var s=vs(t),h=vs(e),u=s?H:Ho(t),c=h?H:Ho(e),l=(u=u==V?$:u)==$,f=(c=c==V?$:c)==$,p=u==c;if(p&&bs(t)){if(!bs(e))return!1;s=!0,l=!1}if(p&&!l)return a||(a=new wr),s||zs(t)?Lo(t,e,n,r,i,a):function(t,e,n,r,i,o,a){switch(n){case ut:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case ht:return!(t.byteLength!=e.byteLength||!o(new we(t),new we(e)));case j:case W:case J:return ps(+t,+e);case q:return t.name==e.name&&t.message==e.message;case et:case rt:return t==e+"";case K:var s=Cn;case nt:var h=r&m;if(s||(s=Ln),t.size!=e.size&&!h)return!1;var u=a.get(t);if(u)return u==e;r|=g,a.set(t,e);var c=Lo(s(t),s(e),r,i,o,a);return a.delete(t),c;case it:if(lr)return lr.call(t)==lr.call(e)}return!1}(t,e,u,n,r,i,a);if(!(n&m)){var d=l&&ce.call(t,"__wrapped__"),v=f&&ce.call(e,"__wrapped__");if(d||v){var y=d?t.value():t,x=v?e.value():e;return a||(a=new wr),i(y,x,n,r,a)}}return!!p&&(a||(a=new wr),function(t,e,n,r,i,a){var s=n&m,h=Do(t),u=h.length,c=Do(e).length;if(u!=c&&!s)return!1;for(var l=u;l--;){var f=h[l];if(!(s?f in e:ce.call(e,f)))return!1}var p=a.get(t);if(p&&a.get(e))return p==e;var d=!0;a.set(t,e),a.set(e,t);for(var g=s;++l<u;){f=h[l];var v=t[f],y=e[f];if(r)var x=s?r(y,v,f,e,t,a):r(v,y,f,t,e,a);if(!(x===o?v===y||i(v,y,n,r,a):x)){d=!1;break}g||(g="constructor"==f)}if(d&&!g){var _=t.constructor,b=e.constructor;_!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b)&&(d=!1)}return a.delete(t),a.delete(e),d}(t,e,n,r,i,a))}(t,e,n,r,oi,i))}function ai(t,e,n,r){var i=n.length,a=i,s=!r;if(null==t)return!a;for(t=ee(t);i--;){var h=n[i];if(s&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++i<a;){var u=(h=n[i])[0],c=t[u],l=h[1];if(s&&h[2]){if(c===o&&!(u in t))return!1}else{var f=new wr;if(r)var p=r(c,l,u,t,e,f);if(!(p===o?oi(l,c,m|g,r,f):p))return!1}}return!0}function si(t){return!(!Ts(t)||(e=t,fe&&fe in e))&&(As(t)?ge:Xt).test(la(t));var e}function hi(t){return"function"==typeof t?t:null==t?Ph:"object"==typeof t?vs(t)?di(t[0],t[1]):pi(t):Ih(t)}function ui(t){if(!Jo(t))return jn(t);var e=[];for(var n in ee(t))ce.call(t,n)&&"constructor"!=n&&e.push(n);return e}function ci(t){if(!Ts(t))return function(t){var e=[];if(null!=t)for(var n in ee(t))e.push(n);return e}(t);var e=Jo(t),n=[];for(var r in t)("constructor"!=r||!e&&ce.call(t,r))&&n.push(r);return n}function li(t,e){return t<e}function fi(t,e){var n=-1,i=xs(t)?r(t.length):[];return Ir(t,function(t,r,o){i[++n]=e(t,r,o)}),i}function pi(t){var e=Uo(t);return 1==e.length&&e[0][2]?$o(e[0][0],e[0][1]):function(n){return n===t||ai(n,t,e)}}function di(t,e){return Qo(t)&&Zo(e)?$o(ca(t),e):function(n){var r=$s(n,t);return r===o&&r===e?th(n,t):oi(e,r,m|g)}}function mi(t,e,n,r,i){t!==e&&Wr(e,function(a,s){if(Ts(a))i||(i=new wr),function(t,e,n,r,i,a,s){var h=na(t,n),u=na(e,n),c=s.get(u);if(c)Tr(t,n,c);else{var l=a?a(h,u,n+"",t,e,s):o,f=l===o;if(f){var p=vs(u),d=!p&&bs(u),m=!p&&!d&&zs(u);l=u,p||d||m?vs(h)?l=h:_s(h)?l=no(h):d?(f=!1,l=Ki(u,!0)):m?(f=!1,l=Zi(u,!0)):l=[]:Ds(u)||gs(u)?(l=h,gs(h)?l=js(h):Ts(h)&&!As(h)||(l=jo(u))):f=!1}f&&(s.set(u,l),i(l,u,r,a,s),s.delete(u)),Tr(t,n,l)}}(t,e,s,n,mi,r,i);else{var h=r?r(na(t,s),a,s+"",t,e,i):o;h===o&&(h=a),Tr(t,s,h)}},oh)}function gi(t,e){var n=t.length;if(n)return Xo(e+=e<0?n:0,n)?t[e]:o}function vi(t,e,n){var r=-1;return e=$e(e.length?e:[Ph],vn(zo())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(fi(t,function(t,n,i){return{criteria:$e(e,function(e){return e(t)}),index:++r,value:t}}),function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;++r<a;){var h=$i(i[r],o[r]);if(h){if(r>=s)return h;var u=n[r];return h*("desc"==u?-1:1)}}return t.index-e.index}(t,e,n)})}function yi(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=Kr(t,a);n(s,a)&&Ci(o,Xi(a,t),s)}return o}function xi(t,e,n,r){var i=r?un:hn,o=-1,a=e.length,s=t;for(t===e&&(e=no(e)),n&&(s=$e(t,vn(n)));++o<a;)for(var h=0,u=e[o],c=n?n(u):u;(h=i(s,c,h,r))>-1;)s!==t&&Be.call(s,h,1),Be.call(t,h,1);return t}function _i(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;Xo(i)?Be.call(t,i,1):Ui(t,i)}}return t}function bi(t,e){return t+In(Yn()*(e-t+1))}function wi(t,e){var n="";if(!t||e<1||e>k)return n;do{e%2&&(n+=t),(e=In(e/2))&&(t+=t)}while(e);return n}function Mi(t,e){return oa(ta(t,e,Ph),t+"")}function Ai(t){return Ar(ph(t))}function Si(t,e){var n=ph(t);return ha(n,kr(e,0,n.length))}function Ci(t,e,n,r){if(!Ts(t))return t;for(var i=-1,a=(e=Xi(e,t)).length,s=a-1,h=t;null!=h&&++i<a;){var u=ca(e[i]),c=n;if(i!=s){var l=h[u];(c=r?r(l,u,h):o)===o&&(c=Ts(l)?l:Xo(e[i+1])?[]:{})}Er(h,u,c),h=h[u]}return t}var Ti=rr?function(t,e){return rr.set(t,e),t}:Ph,Ei=pn?function(t,e){return pn(t,"toString",{configurable:!0,enumerable:!1,value:Th(e),writable:!0})}:Ph;function Li(t){return ha(ph(t))}function Pi(t,e,n){var i=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var a=r(o);++i<o;)a[i]=t[i+e];return a}function Di(t,e){var n;return Ir(t,function(t,r,i){return!(n=e(t,r,i))}),!!n}function Ri(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=I){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!Bs(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return Fi(t,e,Ph,n)}function Fi(t,e,n,r){e=n(e);for(var i=0,a=null==t?0:t.length,s=e!=e,h=null===e,u=Bs(e),c=e===o;i<a;){var l=In((i+a)/2),f=n(t[l]),p=f!==o,d=null===f,m=f==f,g=Bs(f);if(s)var v=r||m;else v=c?m&&(r||p):h?m&&p&&(r||!d):u?m&&p&&!d&&(r||!g):!d&&!g&&(r?f<=e:f<e);v?i=l+1:a=l}return Xn(a,U)}function ki(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!ps(s,h)){var h=s;o[i++]=0===a?0:a}}return o}function Bi(t){return"number"==typeof t?t:Bs(t)?z:+t}function zi(t){if("string"==typeof t)return t;if(vs(t))return $e(t,zi)+"";if(Bs(t))return fr?fr.call(t):"";var e=t+"";return"0"==e&&1/t==-F?"-0":e}function Ni(t,e,n){var r=-1,i=Je,o=t.length,s=!0,h=[],u=h;if(n)s=!1,i=Ze;else if(o>=a){var c=e?null:Mo(t);if(c)return Ln(c);s=!1,i=xn,u=new br}else u=e?[]:h;t:for(;++r<o;){var l=t[r],f=e?e(l):l;if(l=n||0!==l?l:0,s&&f==f){for(var p=u.length;p--;)if(u[p]===f)continue t;e&&u.push(f),h.push(l)}else i(u,f,n)||(u!==h&&u.push(f),h.push(l))}return h}function Ui(t,e){return null==(t=ea(t,e=Xi(e,t)))||delete t[ca(Ma(e))]}function Ii(t,e,n,r){return Ci(t,e,n(Kr(t,e)),r)}function Oi(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?Pi(t,r?0:o,r?o+1:i):Pi(t,r?o+1:0,r?i:o)}function Vi(t,e){var n=t;return n instanceof vr&&(n=n.value()),en(e,function(t,e){return e.func.apply(e.thisArg,tn([t],e.args))},n)}function Hi(t,e,n){var i=t.length;if(i<2)return i?Ni(t[0]):[];for(var o=-1,a=r(i);++o<i;)for(var s=t[o],h=-1;++h<i;)h!=o&&(a[o]=Ur(a[o]||s,t[h],e,n));return Ni(jr(a,1),e,n)}function Gi(t,e,n){for(var r=-1,i=t.length,a=e.length,s={};++r<i;){var h=r<a?e[r]:o;n(s,t[r],h)}return s}function ji(t){return _s(t)?t:[]}function Wi(t){return"function"==typeof t?t:Ph}function Xi(t,e){return vs(t)?t:Qo(t,e)?[t]:ua(Ws(t))}var qi=Mi;function Qi(t,e,n){var r=t.length;return n=n===o?r:n,!e&&n>=r?t:Pi(t,e,n)}var Yi=Bn||function(t){return Fe.clearTimeout(t)};function Ki(t,e){if(e)return t.slice();var n=t.length,r=Ee?Ee(n):new t.constructor(n);return t.copy(r),r}function Ji(t){var e=new t.constructor(t.byteLength);return new we(e).set(new we(t)),e}function Zi(t,e){var n=e?Ji(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function $i(t,e){if(t!==e){var n=t!==o,r=null===t,i=t==t,a=Bs(t),s=e!==o,h=null===e,u=e==e,c=Bs(e);if(!h&&!c&&!a&&t>e||a&&s&&u&&!h&&!c||r&&s&&u||!n&&u||!i)return 1;if(!r&&!a&&!c&&t<e||c&&n&&i&&!r&&!a||h&&n&&i||!s&&i||!u)return-1}return 0}function to(t,e,n,i){for(var o=-1,a=t.length,s=n.length,h=-1,u=e.length,c=Wn(a-s,0),l=r(u+c),f=!i;++h<u;)l[h]=e[h];for(;++o<s;)(f||o<a)&&(l[n[o]]=t[o]);for(;c--;)l[h++]=t[o++];return l}function eo(t,e,n,i){for(var o=-1,a=t.length,s=-1,h=n.length,u=-1,c=e.length,l=Wn(a-h,0),f=r(l+c),p=!i;++o<l;)f[o]=t[o];for(var d=o;++u<c;)f[d+u]=e[u];for(;++s<h;)(p||o<a)&&(f[d+n[s]]=t[o++]);return f}function no(t,e){var n=-1,i=t.length;for(e||(e=r(i));++n<i;)e[n]=t[n];return e}function ro(t,e,n,r){var i=!n;n||(n={});for(var a=-1,s=e.length;++a<s;){var h=e[a],u=r?r(n[h],t[h],h,n,t):o;u===o&&(u=t[h]),i?Rr(n,h,u):Er(n,h,u)}return n}function io(t,e){return function(n,r){var i=vs(n)?Xe:Pr,o=e?e():{};return i(n,t,zo(r,2),o)}}function oo(t){return Mi(function(e,n){var r=-1,i=n.length,a=i>1?n[i-1]:o,s=i>2?n[2]:o;for(a=t.length>3&&"function"==typeof a?(i--,a):o,s&&qo(n[0],n[1],s)&&(a=i<3?o:a,i=1),e=ee(e);++r<i;){var h=n[r];h&&t(e,h,r,a)}return e})}function ao(t,e){return function(n,r){if(null==n)return n;if(!xs(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=ee(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function so(t){return function(e,n,r){for(var i=-1,o=ee(e),a=r(e),s=a.length;s--;){var h=a[t?s:++i];if(!1===n(o[h],h,o))break}return e}}function ho(t){return function(e){var n=Sn(e=Ws(e))?Rn(e):o,r=n?n[0]:e.charAt(0),i=n?Qi(n,1).join(""):e.slice(1);return r[t]()+i}}function uo(t){return function(e){return en(Ah(gh(e).replace(ye,"")),t,"")}}function co(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=dr(t.prototype),r=t.apply(n,e);return Ts(r)?r:n}}function lo(t){return function(e,n,r){var i=ee(e);if(!xs(e)){var a=zo(n,3);e=ih(e),n=function(t){return a(i[t],t,i)}}var s=t(e,n,r);return s>-1?i[a?e[s]:s]:o}}function fo(t){return Po(function(e){var n=e.length,r=n,i=gr.prototype.thru;for(t&&e.reverse();r--;){var a=e[r];if("function"!=typeof a)throw new ie(h);if(i&&!s&&"wrapper"==ko(a))var s=new gr([],!0)}for(r=s?r:n;++r<n;){var u=ko(a=e[r]),c="wrapper"==u?Fo(a):o;s=c&&Yo(c[0])&&c[1]==(A|_|w|S)&&!c[4].length&&1==c[9]?s[ko(c[0])].apply(s,c[3]):1==a.length&&Yo(a)?s[u]():s.thru(a)}return function(){var t=arguments,r=t[0];if(s&&1==t.length&&vs(r))return s.plant(r).value();for(var i=0,o=n?e[i].apply(this,t):r;++i<n;)o=e[i].call(this,o);return o}})}function po(t,e,n,i,a,s,h,u,c,l){var f=e&A,p=e&v,d=e&y,m=e&(_|b),g=e&C,x=d?o:co(t);return function v(){for(var y=arguments.length,_=r(y),b=y;b--;)_[b]=arguments[b];if(m)var w=Bo(v),M=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(_,w);if(i&&(_=to(_,i,a,m)),s&&(_=eo(_,s,h,m)),y-=M,m&&y<l){var A=En(_,w);return bo(t,e,po,v.placeholder,n,_,A,u,c,l-y)}var S=p?n:this,C=d?S[t]:t;return y=_.length,u?_=function(t,e){for(var n=t.length,r=Xn(e.length,n),i=no(t);r--;){var a=e[r];t[r]=Xo(a,n)?i[a]:o}return t}(_,u):g&&y>1&&_.reverse(),f&&c<y&&(_.length=c),this&&this!==Fe&&this instanceof v&&(C=x||co(C)),C.apply(S,_)}}function mo(t,e){return function(n,r){return function(t,e,n,r){return qr(t,function(t,i,o){e(r,n(t),i,o)}),r}(n,t,e(r),{})}}function go(t,e){return function(n,r){var i;if(n===o&&r===o)return e;if(n!==o&&(i=n),r!==o){if(i===o)return r;"string"==typeof n||"string"==typeof r?(n=zi(n),r=zi(r)):(n=Bi(n),r=Bi(r)),i=t(n,r)}return i}}function vo(t){return Po(function(e){return e=$e(e,vn(zo())),Mi(function(n){var r=this;return t(e,function(t){return We(t,r,n)})})})}function yo(t,e){var n=(e=e===o?" ":zi(e)).length;if(n<2)return n?wi(e,t):e;var r=wi(e,Un(t/Dn(e)));return Sn(e)?Qi(Rn(r),0,t).join(""):r.slice(0,t)}function xo(t){return function(e,n,i){return i&&"number"!=typeof i&&qo(e,n,i)&&(n=i=o),e=Os(e),n===o?(n=e,e=0):n=Os(n),function(t,e,n,i){for(var o=-1,a=Wn(Un((e-t)/(n||1)),0),s=r(a);a--;)s[i?a:++o]=t,t+=n;return s}(e,n,i=i===o?e<n?1:-1:Os(i),t)}}function _o(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=Gs(e),n=Gs(n)),t(e,n)}}function bo(t,e,n,r,i,a,s,h,u,c){var l=e&_;e|=l?w:M,(e&=~(l?M:w))&x||(e&=~(v|y));var f=[t,e,i,l?a:o,l?s:o,l?o:a,l?o:s,h,u,c],p=n.apply(o,f);return Yo(t)&&ra(p,f),p.placeholder=r,aa(p,t,e)}function wo(t){var e=te[t];return function(t,n){if(t=Gs(t),n=null==n?0:Xn(Vs(n),292)){var r=(Ws(t)+"e").split("e");return+((r=(Ws(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Mo=tr&&1/Ln(new tr([,-0]))[1]==F?function(t){return new tr(t)}:Bh;function Ao(t){return function(e){var n=Ho(e);return n==K?Cn(e):n==nt?Pn(e):function(t,e){return $e(e,function(e){return[e,t[e]]})}(e,t(e))}}function So(t,e,n,i,a,s,u,c){var f=e&y;if(!f&&"function"!=typeof t)throw new ie(h);var p=i?i.length:0;if(p||(e&=~(w|M),i=a=o),u=u===o?u:Wn(Vs(u),0),c=c===o?c:Vs(c),p-=a?a.length:0,e&M){var d=i,m=a;i=a=o}var g=f?o:Fo(t),C=[t,e,n,i,a,d,m,s,u,c];if(g&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<(v|y|A),a=r==A&&n==_||r==A&&n==S&&t[7].length<=e[8]||r==(A|S)&&e[7].length<=e[8]&&n==_;if(!o&&!a)return t;r&v&&(t[2]=e[2],i|=n&v?0:x);var s=e[3];if(s){var h=t[3];t[3]=h?to(h,s,e[4]):s,t[4]=h?En(t[3],l):e[4]}(s=e[5])&&(h=t[5],t[5]=h?eo(h,s,e[6]):s,t[6]=h?En(t[5],l):e[6]),(s=e[7])&&(t[7]=s),r&A&&(t[8]=null==t[8]?e[8]:Xn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(C,g),t=C[0],e=C[1],n=C[2],i=C[3],a=C[4],!(c=C[9]=C[9]===o?f?0:t.length:Wn(C[9]-p,0))&&e&(_|b)&&(e&=~(_|b)),e&&e!=v)T=e==_||e==b?function(t,e,n){var i=co(t);return function a(){for(var s=arguments.length,h=r(s),u=s,c=Bo(a);u--;)h[u]=arguments[u];var l=s<3&&h[0]!==c&&h[s-1]!==c?[]:En(h,c);return(s-=l.length)<n?bo(t,e,po,a.placeholder,o,h,l,o,o,n-s):We(this&&this!==Fe&&this instanceof a?i:t,this,h)}}(t,e,c):e!=w&&e!=(v|w)||a.length?po.apply(o,C):function(t,e,n,i){var o=e&v,a=co(t);return function e(){for(var s=-1,h=arguments.length,u=-1,c=i.length,l=r(c+h),f=this&&this!==Fe&&this instanceof e?a:t;++u<c;)l[u]=i[u];for(;h--;)l[u++]=arguments[++s];return We(f,o?n:this,l)}}(t,e,n,i);else var T=function(t,e,n){var r=e&v,i=co(t);return function e(){return(this&&this!==Fe&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,n);return aa((g?Ti:ra)(T,C),t,e)}function Co(t,e,n,r){return t===o||ps(t,se[n])&&!ce.call(r,n)?e:t}function To(t,e,n,r,i,a){return Ts(t)&&Ts(e)&&(a.set(e,t),mi(t,e,o,To,a),a.delete(e)),t}function Eo(t){return Ds(t)?o:t}function Lo(t,e,n,r,i,a){var s=n&m,h=t.length,u=e.length;if(h!=u&&!(s&&u>h))return!1;var c=a.get(t);if(c&&a.get(e))return c==e;var l=-1,f=!0,p=n&g?new br:o;for(a.set(t,e),a.set(e,t);++l<h;){var d=t[l],v=e[l];if(r)var y=s?r(v,d,l,e,t,a):r(d,v,l,t,e,a);if(y!==o){if(y)continue;f=!1;break}if(p){if(!rn(e,function(t,e){if(!xn(p,e)&&(d===t||i(d,t,n,r,a)))return p.push(e)})){f=!1;break}}else if(d!==v&&!i(d,v,n,r,a)){f=!1;break}}return a.delete(t),a.delete(e),f}function Po(t){return oa(ta(t,o,ya),t+"")}function Do(t){return Jr(t,ih,Oo)}function Ro(t){return Jr(t,oh,Vo)}var Fo=rr?function(t){return rr.get(t)}:Bh;function ko(t){for(var e=t.name+"",n=ir[e],r=ce.call(ir,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function Bo(t){return(ce.call(pr,"placeholder")?pr:t).placeholder}function zo(){var t=pr.iteratee||Dh;return t=t===Dh?hi:t,arguments.length?t(arguments[0],arguments[1]):t}function No(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Uo(t){for(var e=ih(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Zo(i)]}return e}function Io(t,e){var n=function(t,e){return null==t?o:t[e]}(t,e);return si(n)?n:o}var Oo=On?function(t){return null==t?[]:(t=ee(t),Ke(On(t),function(e){return ke.call(t,e)}))}:Hh,Vo=On?function(t){for(var e=[];t;)tn(e,Oo(t)),t=De(t);return e}:Hh,Ho=Zr;function Go(t,e,n){for(var r=-1,i=(e=Xi(e,t)).length,o=!1;++r<i;){var a=ca(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&Cs(i)&&Xo(a,i)&&(vs(t)||gs(t))}function jo(t){return"function"!=typeof t.constructor||Jo(t)?{}:dr(De(t))}function Wo(t){return vs(t)||gs(t)||!!(Ne&&t&&t[Ne])}function Xo(t,e){var n=typeof t;return!!(e=null==e?k:e)&&("number"==n||"symbol"!=n&&Qt.test(t))&&t>-1&&t%1==0&&t<e}function qo(t,e,n){if(!Ts(n))return!1;var r=typeof e;return!!("number"==r?xs(n)&&Xo(e,n.length):"string"==r&&e in n)&&ps(n[e],t)}function Qo(t,e){if(vs(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Bs(t))||Pt.test(t)||!Lt.test(t)||null!=e&&t in ee(e)}function Yo(t){var e=ko(t),n=pr[e];if("function"!=typeof n||!(e in vr.prototype))return!1;if(t===n)return!0;var r=Fo(n);return!!r&&t===r[0]}(Jn&&Ho(new Jn(new ArrayBuffer(1)))!=ut||Zn&&Ho(new Zn)!=K||$n&&"[object Promise]"!=Ho($n.resolve())||tr&&Ho(new tr)!=nt||er&&Ho(new er)!=at)&&(Ho=function(t){var e=Zr(t),n=e==$?t.constructor:o,r=n?la(n):"";if(r)switch(r){case or:return ut;case ar:return K;case sr:return"[object Promise]";case hr:return nt;case ur:return at}return e});var Ko=he?As:Gh;function Jo(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||se)}function Zo(t){return t==t&&!Ts(t)}function $o(t,e){return function(n){return null!=n&&n[t]===e&&(e!==o||t in ee(n))}}function ta(t,e,n){return e=Wn(e===o?t.length-1:e,0),function(){for(var i=arguments,o=-1,a=Wn(i.length-e,0),s=r(a);++o<a;)s[o]=i[e+o];o=-1;for(var h=r(e+1);++o<e;)h[o]=i[o];return h[e]=n(s),We(t,this,h)}}function ea(t,e){return e.length<2?t:Kr(t,Pi(e,0,-1))}function na(t,e){if("__proto__"!=e)return t[e]}var ra=sa(Ti),ia=Nn||function(t,e){return Fe.setTimeout(t,e)},oa=sa(Ei);function aa(t,e,n){var r=e+"";return oa(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(Nt,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return qe(O,function(n){var r="_."+n[0];e&n[1]&&!Je(t,r)&&t.push(r)}),t.sort()}(function(t){var e=t.match(Ut);return e?e[1].split(It):[]}(r),n)))}function sa(t){var e=0,n=0;return function(){var r=qn(),i=P-(r-n);if(n=r,i>0){if(++e>=L)return arguments[0]}else e=0;return t.apply(o,arguments)}}function ha(t,e){var n=-1,r=t.length,i=r-1;for(e=e===o?r:e;++n<e;){var a=bi(n,i),s=t[a];t[a]=t[n],t[n]=s}return t.length=e,t}var ua=function(t){var e=ss(t,function(t){return n.size===c&&n.clear(),t}),n=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Dt,function(t,n,r,i){e.push(r?i.replace(Vt,"$1"):n||t)}),e});function ca(t){if("string"==typeof t||Bs(t))return t;var e=t+"";return"0"==e&&1/t==-F?"-0":e}function la(t){if(null!=t){try{return ue.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function fa(t){if(t instanceof vr)return t.clone();var e=new gr(t.__wrapped__,t.__chain__);return e.__actions__=no(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var pa=Mi(function(t,e){return _s(t)?Ur(t,jr(e,1,_s,!0)):[]}),da=Mi(function(t,e){var n=Ma(e);return _s(n)&&(n=o),_s(t)?Ur(t,jr(e,1,_s,!0),zo(n,2)):[]}),ma=Mi(function(t,e){var n=Ma(e);return _s(n)&&(n=o),_s(t)?Ur(t,jr(e,1,_s,!0),o,n):[]});function ga(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Vs(n);return i<0&&(i=Wn(r+i,0)),sn(t,zo(e,3),i)}function va(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r-1;return n!==o&&(i=Vs(n),i=n<0?Wn(r+i,0):Xn(i,r-1)),sn(t,zo(e,3),i,!0)}function ya(t){return null!=t&&t.length?jr(t,1):[]}function xa(t){return t&&t.length?t[0]:o}var _a=Mi(function(t){var e=$e(t,ji);return e.length&&e[0]===t[0]?ni(e):[]}),ba=Mi(function(t){var e=Ma(t),n=$e(t,ji);return e===Ma(n)?e=o:n.pop(),n.length&&n[0]===t[0]?ni(n,zo(e,2)):[]}),wa=Mi(function(t){var e=Ma(t),n=$e(t,ji);return(e="function"==typeof e?e:o)&&n.pop(),n.length&&n[0]===t[0]?ni(n,o,e):[]});function Ma(t){var e=null==t?0:t.length;return e?t[e-1]:o}var Aa=Mi(Sa);function Sa(t,e){return t&&t.length&&e&&e.length?xi(t,e):t}var Ca=Po(function(t,e){var n=null==t?0:t.length,r=Fr(t,e);return _i(t,$e(e,function(t){return Xo(t,n)?+t:t}).sort($i)),r});function Ta(t){return null==t?t:Kn.call(t)}var Ea=Mi(function(t){return Ni(jr(t,1,_s,!0))}),La=Mi(function(t){var e=Ma(t);return _s(e)&&(e=o),Ni(jr(t,1,_s,!0),zo(e,2))}),Pa=Mi(function(t){var e=Ma(t);return e="function"==typeof e?e:o,Ni(jr(t,1,_s,!0),o,e)});function Da(t){if(!t||!t.length)return[];var e=0;return t=Ke(t,function(t){if(_s(t))return e=Wn(t.length,e),!0}),gn(e,function(e){return $e(t,fn(e))})}function Ra(t,e){if(!t||!t.length)return[];var n=Da(t);return null==e?n:$e(n,function(t){return We(e,o,t)})}var Fa=Mi(function(t,e){return _s(t)?Ur(t,e):[]}),ka=Mi(function(t){return Hi(Ke(t,_s))}),Ba=Mi(function(t){var e=Ma(t);return _s(e)&&(e=o),Hi(Ke(t,_s),zo(e,2))}),za=Mi(function(t){var e=Ma(t);return e="function"==typeof e?e:o,Hi(Ke(t,_s),o,e)}),Na=Mi(Da);var Ua=Mi(function(t){var e=t.length,n=e>1?t[e-1]:o;return n="function"==typeof n?(t.pop(),n):o,Ra(t,n)});function Ia(t){var e=pr(t);return e.__chain__=!0,e}function Oa(t,e){return e(t)}var Va=Po(function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,i=function(e){return Fr(e,t)};return!(e>1||this.__actions__.length)&&r instanceof vr&&Xo(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:Oa,args:[i],thisArg:o}),new gr(r,this.__chain__).thru(function(t){return e&&!t.length&&t.push(o),t})):this.thru(i)});var Ha=io(function(t,e,n){ce.call(t,n)?++t[n]:Rr(t,n,1)});var Ga=lo(ga),ja=lo(va);function Wa(t,e){return(vs(t)?qe:Ir)(t,zo(e,3))}function Xa(t,e){return(vs(t)?Qe:Or)(t,zo(e,3))}var qa=io(function(t,e,n){ce.call(t,n)?t[n].push(e):Rr(t,n,[e])});var Qa=Mi(function(t,e,n){var i=-1,o="function"==typeof e,a=xs(t)?r(t.length):[];return Ir(t,function(t){a[++i]=o?We(e,t,n):ri(t,e,n)}),a}),Ya=io(function(t,e,n){Rr(t,n,e)});function Ka(t,e){return(vs(t)?$e:fi)(t,zo(e,3))}var Ja=io(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});var Za=Mi(function(t,e){if(null==t)return[];var n=e.length;return n>1&&qo(t,e[0],e[1])?e=[]:n>2&&qo(e[0],e[1],e[2])&&(e=[e[0]]),vi(t,jr(e,1),[])}),$a=zn||function(){return Fe.Date.now()};function ts(t,e,n){return e=n?o:e,e=t&&null==e?t.length:e,So(t,A,o,o,o,o,e)}function es(t,e){var n;if("function"!=typeof e)throw new ie(h);return t=Vs(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=o),n}}var ns=Mi(function(t,e,n){var r=v;if(n.length){var i=En(n,Bo(ns));r|=w}return So(t,r,e,n,i)}),rs=Mi(function(t,e,n){var r=v|y;if(n.length){var i=En(n,Bo(rs));r|=w}return So(e,r,t,n,i)});function is(t,e,n){var r,i,a,s,u,c,l=0,f=!1,p=!1,d=!0;if("function"!=typeof t)throw new ie(h);function m(e){var n=r,a=i;return r=i=o,l=e,s=t.apply(a,n)}function g(t){var n=t-c;return c===o||n>=e||n<0||p&&t-l>=a}function v(){var t=$a();if(g(t))return y(t);u=ia(v,function(t){var n=e-(t-c);return p?Xn(n,a-(t-l)):n}(t))}function y(t){return u=o,d&&r?m(t):(r=i=o,s)}function x(){var t=$a(),n=g(t);if(r=arguments,i=this,c=t,n){if(u===o)return function(t){return l=t,u=ia(v,e),f?m(t):s}(c);if(p)return u=ia(v,e),m(c)}return u===o&&(u=ia(v,e)),s}return e=Gs(e)||0,Ts(n)&&(f=!!n.leading,a=(p="maxWait"in n)?Wn(Gs(n.maxWait)||0,e):a,d="trailing"in n?!!n.trailing:d),x.cancel=function(){u!==o&&Yi(u),l=0,r=c=i=u=o},x.flush=function(){return u===o?s:y($a())},x}var os=Mi(function(t,e){return Nr(t,1,e)}),as=Mi(function(t,e,n){return Nr(t,Gs(e)||0,n)});function ss(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new ie(h);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(ss.Cache||_r),n}function hs(t){if("function"!=typeof t)throw new ie(h);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}ss.Cache=_r;var us=qi(function(t,e){var n=(e=1==e.length&&vs(e[0])?$e(e[0],vn(zo())):$e(jr(e,1),vn(zo()))).length;return Mi(function(r){for(var i=-1,o=Xn(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return We(t,this,r)})}),cs=Mi(function(t,e){var n=En(e,Bo(cs));return So(t,w,o,e,n)}),ls=Mi(function(t,e){var n=En(e,Bo(ls));return So(t,M,o,e,n)}),fs=Po(function(t,e){return So(t,S,o,o,o,e)});function ps(t,e){return t===e||t!=t&&e!=e}var ds=_o($r),ms=_o(function(t,e){return t>=e}),gs=ii(function(){return arguments}())?ii:function(t){return Es(t)&&ce.call(t,"callee")&&!ke.call(t,"callee")},vs=r.isArray,ys=Ie?vn(Ie):function(t){return Es(t)&&Zr(t)==ht};function xs(t){return null!=t&&Cs(t.length)&&!As(t)}function _s(t){return Es(t)&&xs(t)}var bs=Vn||Gh,ws=Oe?vn(Oe):function(t){return Es(t)&&Zr(t)==W};function Ms(t){if(!Es(t))return!1;var e=Zr(t);return e==q||e==X||"string"==typeof t.message&&"string"==typeof t.name&&!Ds(t)}function As(t){if(!Ts(t))return!1;var e=Zr(t);return e==Q||e==Y||e==G||e==tt}function Ss(t){return"number"==typeof t&&t==Vs(t)}function Cs(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=k}function Ts(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Es(t){return null!=t&&"object"==typeof t}var Ls=Ve?vn(Ve):function(t){return Es(t)&&Ho(t)==K};function Ps(t){return"number"==typeof t||Es(t)&&Zr(t)==J}function Ds(t){if(!Es(t)||Zr(t)!=$)return!1;var e=De(t);if(null===e)return!0;var n=ce.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&ue.call(n)==de}var Rs=He?vn(He):function(t){return Es(t)&&Zr(t)==et};var Fs=Ge?vn(Ge):function(t){return Es(t)&&Ho(t)==nt};function ks(t){return"string"==typeof t||!vs(t)&&Es(t)&&Zr(t)==rt}function Bs(t){return"symbol"==typeof t||Es(t)&&Zr(t)==it}var zs=je?vn(je):function(t){return Es(t)&&Cs(t.length)&&!!Ce[Zr(t)]};var Ns=_o(li),Us=_o(function(t,e){return t<=e});function Is(t){if(!t)return[];if(xs(t))return ks(t)?Rn(t):no(t);if(Ue&&t[Ue])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[Ue]());var e=Ho(t);return(e==K?Cn:e==nt?Ln:ph)(t)}function Os(t){return t?(t=Gs(t))===F||t===-F?(t<0?-1:1)*B:t==t?t:0:0===t?t:0}function Vs(t){var e=Os(t),n=e%1;return e==e?n?e-n:e:0}function Hs(t){return t?kr(Vs(t),0,N):0}function Gs(t){if("number"==typeof t)return t;if(Bs(t))return z;if(Ts(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ts(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(kt,"");var n=Wt.test(t);return n||qt.test(t)?Pe(t.slice(2),n?2:8):jt.test(t)?z:+t}function js(t){return ro(t,oh(t))}function Ws(t){return null==t?"":zi(t)}var Xs=oo(function(t,e){if(Jo(e)||xs(e))ro(e,ih(e),t);else for(var n in e)ce.call(e,n)&&Er(t,n,e[n])}),qs=oo(function(t,e){ro(e,oh(e),t)}),Qs=oo(function(t,e,n,r){ro(e,oh(e),t,r)}),Ys=oo(function(t,e,n,r){ro(e,ih(e),t,r)}),Ks=Po(Fr);var Js=Mi(function(t,e){t=ee(t);var n=-1,r=e.length,i=r>2?e[2]:o;for(i&&qo(e[0],e[1],i)&&(r=1);++n<r;)for(var a=e[n],s=oh(a),h=-1,u=s.length;++h<u;){var c=s[h],l=t[c];(l===o||ps(l,se[c])&&!ce.call(t,c))&&(t[c]=a[c])}return t}),Zs=Mi(function(t){return t.push(o,To),We(sh,o,t)});function $s(t,e,n){var r=null==t?o:Kr(t,e);return r===o?n:r}function th(t,e){return null!=t&&Go(t,e,ei)}var eh=mo(function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=pe.call(e)),t[e]=n},Th(Ph)),nh=mo(function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=pe.call(e)),ce.call(t,e)?t[e].push(n):t[e]=[n]},zo),rh=Mi(ri);function ih(t){return xs(t)?Mr(t):ui(t)}function oh(t){return xs(t)?Mr(t,!0):ci(t)}var ah=oo(function(t,e,n){mi(t,e,n)}),sh=oo(function(t,e,n,r){mi(t,e,n,r)}),hh=Po(function(t,e){var n={};if(null==t)return n;var r=!1;e=$e(e,function(e){return e=Xi(e,t),r||(r=e.length>1),e}),ro(t,Ro(t),n),r&&(n=Br(n,f|p|d,Eo));for(var i=e.length;i--;)Ui(n,e[i]);return n});var uh=Po(function(t,e){return null==t?{}:function(t,e){return yi(t,e,function(e,n){return th(t,n)})}(t,e)});function ch(t,e){if(null==t)return{};var n=$e(Ro(t),function(t){return[t]});return e=zo(e),yi(t,n,function(t,n){return e(t,n[0])})}var lh=Ao(ih),fh=Ao(oh);function ph(t){return null==t?[]:yn(t,ih(t))}var dh=uo(function(t,e,n){return e=e.toLowerCase(),t+(n?mh(e):e)});function mh(t){return Mh(Ws(t).toLowerCase())}function gh(t){return(t=Ws(t))&&t.replace(Yt,wn).replace(xe,"")}var vh=uo(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),yh=uo(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),xh=ho("toLowerCase");var _h=uo(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});var bh=uo(function(t,e,n){return t+(n?" ":"")+Mh(e)});var wh=uo(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),Mh=ho("toUpperCase");function Ah(t,e,n){return t=Ws(t),(e=n?o:e)===o?function(t){return Me.test(t)}(t)?function(t){return t.match(be)||[]}(t):function(t){return t.match(Ot)||[]}(t):t.match(e)||[]}var Sh=Mi(function(t,e){try{return We(t,o,e)}catch(t){return Ms(t)?t:new Zt(t)}}),Ch=Po(function(t,e){return qe(e,function(e){e=ca(e),Rr(t,e,ns(t[e],t))}),t});function Th(t){return function(){return t}}var Eh=fo(),Lh=fo(!0);function Ph(t){return t}function Dh(t){return hi("function"==typeof t?t:Br(t,f))}var Rh=Mi(function(t,e){return function(n){return ri(n,t,e)}}),Fh=Mi(function(t,e){return function(n){return ri(t,n,e)}});function kh(t,e,n){var r=ih(e),i=Yr(e,r);null!=n||Ts(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Yr(e,ih(e)));var o=!(Ts(n)&&"chain"in n&&!n.chain),a=As(t);return qe(i,function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__);return(n.__actions__=no(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,tn([this.value()],arguments))})}),t}function Bh(){}var zh=vo($e),Nh=vo(Ye),Uh=vo(rn);function Ih(t){return Qo(t)?fn(ca(t)):function(t){return function(e){return Kr(e,t)}}(t)}var Oh=xo(),Vh=xo(!0);function Hh(){return[]}function Gh(){return!1}var jh=go(function(t,e){return t+e},0),Wh=wo("ceil"),Xh=go(function(t,e){return t/e},1),qh=wo("floor");var Qh,Yh=go(function(t,e){return t*e},1),Kh=wo("round"),Jh=go(function(t,e){return t-e},0);return pr.after=function(t,e){if("function"!=typeof e)throw new ie(h);return t=Vs(t),function(){if(--t<1)return e.apply(this,arguments)}},pr.ary=ts,pr.assign=Xs,pr.assignIn=qs,pr.assignInWith=Qs,pr.assignWith=Ys,pr.at=Ks,pr.before=es,pr.bind=ns,pr.bindAll=Ch,pr.bindKey=rs,pr.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return vs(t)?t:[t]},pr.chain=Ia,pr.chunk=function(t,e,n){e=(n?qo(t,e,n):e===o)?1:Wn(Vs(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var a=0,s=0,h=r(Un(i/e));a<i;)h[s++]=Pi(t,a,a+=e);return h},pr.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i},pr.concat=function(){var t=arguments.length;if(!t)return[];for(var e=r(t-1),n=arguments[0],i=t;i--;)e[i-1]=arguments[i];return tn(vs(n)?no(n):[n],jr(e,1))},pr.cond=function(t){var e=null==t?0:t.length,n=zo();return t=e?$e(t,function(t){if("function"!=typeof t[1])throw new ie(h);return[n(t[0]),t[1]]}):[],Mi(function(n){for(var r=-1;++r<e;){var i=t[r];if(We(i[0],this,n))return We(i[1],this,n)}})},pr.conforms=function(t){return function(t){var e=ih(t);return function(n){return zr(n,t,e)}}(Br(t,f))},pr.constant=Th,pr.countBy=Ha,pr.create=function(t,e){var n=dr(t);return null==e?n:Dr(n,e)},pr.curry=function t(e,n,r){var i=So(e,_,o,o,o,o,o,n=r?o:n);return i.placeholder=t.placeholder,i},pr.curryRight=function t(e,n,r){var i=So(e,b,o,o,o,o,o,n=r?o:n);return i.placeholder=t.placeholder,i},pr.debounce=is,pr.defaults=Js,pr.defaultsDeep=Zs,pr.defer=os,pr.delay=as,pr.difference=pa,pr.differenceBy=da,pr.differenceWith=ma,pr.drop=function(t,e,n){var r=null==t?0:t.length;return r?Pi(t,(e=n||e===o?1:Vs(e))<0?0:e,r):[]},pr.dropRight=function(t,e,n){var r=null==t?0:t.length;return r?Pi(t,0,(e=r-(e=n||e===o?1:Vs(e)))<0?0:e):[]},pr.dropRightWhile=function(t,e){return t&&t.length?Oi(t,zo(e,3),!0,!0):[]},pr.dropWhile=function(t,e){return t&&t.length?Oi(t,zo(e,3),!0):[]},pr.fill=function(t,e,n,r){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&qo(t,e,n)&&(n=0,r=i),function(t,e,n,r){var i=t.length;for((n=Vs(n))<0&&(n=-n>i?0:i+n),(r=r===o||r>i?i:Vs(r))<0&&(r+=i),r=n>r?0:Hs(r);n<r;)t[n++]=e;return t}(t,e,n,r)):[]},pr.filter=function(t,e){return(vs(t)?Ke:Gr)(t,zo(e,3))},pr.flatMap=function(t,e){return jr(Ka(t,e),1)},pr.flatMapDeep=function(t,e){return jr(Ka(t,e),F)},pr.flatMapDepth=function(t,e,n){return n=n===o?1:Vs(n),jr(Ka(t,e),n)},pr.flatten=ya,pr.flattenDeep=function(t){return null!=t&&t.length?jr(t,F):[]},pr.flattenDepth=function(t,e){return null!=t&&t.length?jr(t,e=e===o?1:Vs(e)):[]},pr.flip=function(t){return So(t,C)},pr.flow=Eh,pr.flowRight=Lh,pr.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},pr.functions=function(t){return null==t?[]:Yr(t,ih(t))},pr.functionsIn=function(t){return null==t?[]:Yr(t,oh(t))},pr.groupBy=qa,pr.initial=function(t){return null!=t&&t.length?Pi(t,0,-1):[]},pr.intersection=_a,pr.intersectionBy=ba,pr.intersectionWith=wa,pr.invert=eh,pr.invertBy=nh,pr.invokeMap=Qa,pr.iteratee=Dh,pr.keyBy=Ya,pr.keys=ih,pr.keysIn=oh,pr.map=Ka,pr.mapKeys=function(t,e){var n={};return e=zo(e,3),qr(t,function(t,r,i){Rr(n,e(t,r,i),t)}),n},pr.mapValues=function(t,e){var n={};return e=zo(e,3),qr(t,function(t,r,i){Rr(n,r,e(t,r,i))}),n},pr.matches=function(t){return pi(Br(t,f))},pr.matchesProperty=function(t,e){return di(t,Br(e,f))},pr.memoize=ss,pr.merge=ah,pr.mergeWith=sh,pr.method=Rh,pr.methodOf=Fh,pr.mixin=kh,pr.negate=hs,pr.nthArg=function(t){return t=Vs(t),Mi(function(e){return gi(e,t)})},pr.omit=hh,pr.omitBy=function(t,e){return ch(t,hs(zo(e)))},pr.once=function(t){return es(2,t)},pr.orderBy=function(t,e,n,r){return null==t?[]:(vs(e)||(e=null==e?[]:[e]),vs(n=r?o:n)||(n=null==n?[]:[n]),vi(t,e,n))},pr.over=zh,pr.overArgs=us,pr.overEvery=Nh,pr.overSome=Uh,pr.partial=cs,pr.partialRight=ls,pr.partition=Ja,pr.pick=uh,pr.pickBy=ch,pr.property=Ih,pr.propertyOf=function(t){return function(e){return null==t?o:Kr(t,e)}},pr.pull=Aa,pr.pullAll=Sa,pr.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?xi(t,e,zo(n,2)):t},pr.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?xi(t,e,o,n):t},pr.pullAt=Ca,pr.range=Oh,pr.rangeRight=Vh,pr.rearg=fs,pr.reject=function(t,e){return(vs(t)?Ke:Gr)(t,hs(zo(e,3)))},pr.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=zo(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return _i(t,i),n},pr.rest=function(t,e){if("function"!=typeof t)throw new ie(h);return Mi(t,e=e===o?e:Vs(e))},pr.reverse=Ta,pr.sampleSize=function(t,e,n){return e=(n?qo(t,e,n):e===o)?1:Vs(e),(vs(t)?Sr:Si)(t,e)},pr.set=function(t,e,n){return null==t?t:Ci(t,e,n)},pr.setWith=function(t,e,n,r){return r="function"==typeof r?r:o,null==t?t:Ci(t,e,n,r)},pr.shuffle=function(t){return(vs(t)?Cr:Li)(t)},pr.slice=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&qo(t,e,n)?(e=0,n=r):(e=null==e?0:Vs(e),n=n===o?r:Vs(n)),Pi(t,e,n)):[]},pr.sortBy=Za,pr.sortedUniq=function(t){return t&&t.length?ki(t):[]},pr.sortedUniqBy=function(t,e){return t&&t.length?ki(t,zo(e,2)):[]},pr.split=function(t,e,n){return n&&"number"!=typeof n&&qo(t,e,n)&&(e=n=o),(n=n===o?N:n>>>0)?(t=Ws(t))&&("string"==typeof e||null!=e&&!Rs(e))&&!(e=zi(e))&&Sn(t)?Qi(Rn(t),0,n):t.split(e,n):[]},pr.spread=function(t,e){if("function"!=typeof t)throw new ie(h);return e=null==e?0:Wn(Vs(e),0),Mi(function(n){var r=n[e],i=Qi(n,0,e);return r&&tn(i,r),We(t,this,i)})},pr.tail=function(t){var e=null==t?0:t.length;return e?Pi(t,1,e):[]},pr.take=function(t,e,n){return t&&t.length?Pi(t,0,(e=n||e===o?1:Vs(e))<0?0:e):[]},pr.takeRight=function(t,e,n){var r=null==t?0:t.length;return r?Pi(t,(e=r-(e=n||e===o?1:Vs(e)))<0?0:e,r):[]},pr.takeRightWhile=function(t,e){return t&&t.length?Oi(t,zo(e,3),!1,!0):[]},pr.takeWhile=function(t,e){return t&&t.length?Oi(t,zo(e,3)):[]},pr.tap=function(t,e){return e(t),t},pr.throttle=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new ie(h);return Ts(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),is(t,e,{leading:r,maxWait:e,trailing:i})},pr.thru=Oa,pr.toArray=Is,pr.toPairs=lh,pr.toPairsIn=fh,pr.toPath=function(t){return vs(t)?$e(t,ca):Bs(t)?[t]:no(ua(Ws(t)))},pr.toPlainObject=js,pr.transform=function(t,e,n){var r=vs(t),i=r||bs(t)||zs(t);if(e=zo(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:Ts(t)&&As(o)?dr(De(t)):{}}return(i?qe:qr)(t,function(t,r,i){return e(n,t,r,i)}),n},pr.unary=function(t){return ts(t,1)},pr.union=Ea,pr.unionBy=La,pr.unionWith=Pa,pr.uniq=function(t){return t&&t.length?Ni(t):[]},pr.uniqBy=function(t,e){return t&&t.length?Ni(t,zo(e,2)):[]},pr.uniqWith=function(t,e){return e="function"==typeof e?e:o,t&&t.length?Ni(t,o,e):[]},pr.unset=function(t,e){return null==t||Ui(t,e)},pr.unzip=Da,pr.unzipWith=Ra,pr.update=function(t,e,n){return null==t?t:Ii(t,e,Wi(n))},pr.updateWith=function(t,e,n,r){return r="function"==typeof r?r:o,null==t?t:Ii(t,e,Wi(n),r)},pr.values=ph,pr.valuesIn=function(t){return null==t?[]:yn(t,oh(t))},pr.without=Fa,pr.words=Ah,pr.wrap=function(t,e){return cs(Wi(e),t)},pr.xor=ka,pr.xorBy=Ba,pr.xorWith=za,pr.zip=Na,pr.zipObject=function(t,e){return Gi(t||[],e||[],Er)},pr.zipObjectDeep=function(t,e){return Gi(t||[],e||[],Ci)},pr.zipWith=Ua,pr.entries=lh,pr.entriesIn=fh,pr.extend=qs,pr.extendWith=Qs,kh(pr,pr),pr.add=jh,pr.attempt=Sh,pr.camelCase=dh,pr.capitalize=mh,pr.ceil=Wh,pr.clamp=function(t,e,n){return n===o&&(n=e,e=o),n!==o&&(n=(n=Gs(n))==n?n:0),e!==o&&(e=(e=Gs(e))==e?e:0),kr(Gs(t),e,n)},pr.clone=function(t){return Br(t,d)},pr.cloneDeep=function(t){return Br(t,f|d)},pr.cloneDeepWith=function(t,e){return Br(t,f|d,e="function"==typeof e?e:o)},pr.cloneWith=function(t,e){return Br(t,d,e="function"==typeof e?e:o)},pr.conformsTo=function(t,e){return null==e||zr(t,e,ih(e))},pr.deburr=gh,pr.defaultTo=function(t,e){return null==t||t!=t?e:t},pr.divide=Xh,pr.endsWith=function(t,e,n){t=Ws(t),e=zi(e);var r=t.length,i=n=n===o?r:kr(Vs(n),0,r);return(n-=e.length)>=0&&t.slice(n,i)==e},pr.eq=ps,pr.escape=function(t){return(t=Ws(t))&&St.test(t)?t.replace(Mt,Mn):t},pr.escapeRegExp=function(t){return(t=Ws(t))&&Ft.test(t)?t.replace(Rt,"\\$&"):t},pr.every=function(t,e,n){var r=vs(t)?Ye:Vr;return n&&qo(t,e,n)&&(e=o),r(t,zo(e,3))},pr.find=Ga,pr.findIndex=ga,pr.findKey=function(t,e){return an(t,zo(e,3),qr)},pr.findLast=ja,pr.findLastIndex=va,pr.findLastKey=function(t,e){return an(t,zo(e,3),Qr)},pr.floor=qh,pr.forEach=Wa,pr.forEachRight=Xa,pr.forIn=function(t,e){return null==t?t:Wr(t,zo(e,3),oh)},pr.forInRight=function(t,e){return null==t?t:Xr(t,zo(e,3),oh)},pr.forOwn=function(t,e){return t&&qr(t,zo(e,3))},pr.forOwnRight=function(t,e){return t&&Qr(t,zo(e,3))},pr.get=$s,pr.gt=ds,pr.gte=ms,pr.has=function(t,e){return null!=t&&Go(t,e,ti)},pr.hasIn=th,pr.head=xa,pr.identity=Ph,pr.includes=function(t,e,n,r){t=xs(t)?t:ph(t),n=n&&!r?Vs(n):0;var i=t.length;return n<0&&(n=Wn(i+n,0)),ks(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&hn(t,e,n)>-1},pr.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Vs(n);return i<0&&(i=Wn(r+i,0)),hn(t,e,i)},pr.inRange=function(t,e,n){return e=Os(e),n===o?(n=e,e=0):n=Os(n),function(t,e,n){return t>=Xn(e,n)&&t<Wn(e,n)}(t=Gs(t),e,n)},pr.invoke=rh,pr.isArguments=gs,pr.isArray=vs,pr.isArrayBuffer=ys,pr.isArrayLike=xs,pr.isArrayLikeObject=_s,pr.isBoolean=function(t){return!0===t||!1===t||Es(t)&&Zr(t)==j},pr.isBuffer=bs,pr.isDate=ws,pr.isElement=function(t){return Es(t)&&1===t.nodeType&&!Ds(t)},pr.isEmpty=function(t){if(null==t)return!0;if(xs(t)&&(vs(t)||"string"==typeof t||"function"==typeof t.splice||bs(t)||zs(t)||gs(t)))return!t.length;var e=Ho(t);if(e==K||e==nt)return!t.size;if(Jo(t))return!ui(t).length;for(var n in t)if(ce.call(t,n))return!1;return!0},pr.isEqual=function(t,e){return oi(t,e)},pr.isEqualWith=function(t,e,n){var r=(n="function"==typeof n?n:o)?n(t,e):o;return r===o?oi(t,e,o,n):!!r},pr.isError=Ms,pr.isFinite=function(t){return"number"==typeof t&&Hn(t)},pr.isFunction=As,pr.isInteger=Ss,pr.isLength=Cs,pr.isMap=Ls,pr.isMatch=function(t,e){return t===e||ai(t,e,Uo(e))},pr.isMatchWith=function(t,e,n){return n="function"==typeof n?n:o,ai(t,e,Uo(e),n)},pr.isNaN=function(t){return Ps(t)&&t!=+t},pr.isNative=function(t){if(Ko(t))throw new Zt(s);return si(t)},pr.isNil=function(t){return null==t},pr.isNull=function(t){return null===t},pr.isNumber=Ps,pr.isObject=Ts,pr.isObjectLike=Es,pr.isPlainObject=Ds,pr.isRegExp=Rs,pr.isSafeInteger=function(t){return Ss(t)&&t>=-k&&t<=k},pr.isSet=Fs,pr.isString=ks,pr.isSymbol=Bs,pr.isTypedArray=zs,pr.isUndefined=function(t){return t===o},pr.isWeakMap=function(t){return Es(t)&&Ho(t)==at},pr.isWeakSet=function(t){return Es(t)&&Zr(t)==st},pr.join=function(t,e){return null==t?"":Gn.call(t,e)},pr.kebabCase=vh,pr.last=Ma,pr.lastIndexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r;return n!==o&&(i=(i=Vs(n))<0?Wn(r+i,0):Xn(i,r-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,i):sn(t,cn,i,!0)},pr.lowerCase=yh,pr.lowerFirst=xh,pr.lt=Ns,pr.lte=Us,pr.max=function(t){return t&&t.length?Hr(t,Ph,$r):o},pr.maxBy=function(t,e){return t&&t.length?Hr(t,zo(e,2),$r):o},pr.mean=function(t){return ln(t,Ph)},pr.meanBy=function(t,e){return ln(t,zo(e,2))},pr.min=function(t){return t&&t.length?Hr(t,Ph,li):o},pr.minBy=function(t,e){return t&&t.length?Hr(t,zo(e,2),li):o},pr.stubArray=Hh,pr.stubFalse=Gh,pr.stubObject=function(){return{}},pr.stubString=function(){return""},pr.stubTrue=function(){return!0},pr.multiply=Yh,pr.nth=function(t,e){return t&&t.length?gi(t,Vs(e)):o},pr.noConflict=function(){return Fe._===this&&(Fe._=me),this},pr.noop=Bh,pr.now=$a,pr.pad=function(t,e,n){t=Ws(t);var r=(e=Vs(e))?Dn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return yo(In(i),n)+t+yo(Un(i),n)},pr.padEnd=function(t,e,n){t=Ws(t);var r=(e=Vs(e))?Dn(t):0;return e&&r<e?t+yo(e-r,n):t},pr.padStart=function(t,e,n){t=Ws(t);var r=(e=Vs(e))?Dn(t):0;return e&&r<e?yo(e-r,n)+t:t},pr.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Qn(Ws(t).replace(Bt,""),e||0)},pr.random=function(t,e,n){if(n&&"boolean"!=typeof n&&qo(t,e,n)&&(e=n=o),n===o&&("boolean"==typeof e?(n=e,e=o):"boolean"==typeof t&&(n=t,t=o)),t===o&&e===o?(t=0,e=1):(t=Os(t),e===o?(e=t,t=0):e=Os(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=Yn();return Xn(t+i*(e-t+Le("1e-"+((i+"").length-1))),e)}return bi(t,e)},pr.reduce=function(t,e,n){var r=vs(t)?en:dn,i=arguments.length<3;return r(t,zo(e,4),n,i,Ir)},pr.reduceRight=function(t,e,n){var r=vs(t)?nn:dn,i=arguments.length<3;return r(t,zo(e,4),n,i,Or)},pr.repeat=function(t,e,n){return e=(n?qo(t,e,n):e===o)?1:Vs(e),wi(Ws(t),e)},pr.replace=function(){var t=arguments,e=Ws(t[0]);return t.length<3?e:e.replace(t[1],t[2])},pr.result=function(t,e,n){var r=-1,i=(e=Xi(e,t)).length;for(i||(i=1,t=o);++r<i;){var a=null==t?o:t[ca(e[r])];a===o&&(r=i,a=n),t=As(a)?a.call(t):a}return t},pr.round=Kh,pr.runInContext=t,pr.sample=function(t){return(vs(t)?Ar:Ai)(t)},pr.size=function(t){if(null==t)return 0;if(xs(t))return ks(t)?Dn(t):t.length;var e=Ho(t);return e==K||e==nt?t.size:ui(t).length},pr.snakeCase=_h,pr.some=function(t,e,n){var r=vs(t)?rn:Di;return n&&qo(t,e,n)&&(e=o),r(t,zo(e,3))},pr.sortedIndex=function(t,e){return Ri(t,e)},pr.sortedIndexBy=function(t,e,n){return Fi(t,e,zo(n,2))},pr.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=Ri(t,e);if(r<n&&ps(t[r],e))return r}return-1},pr.sortedLastIndex=function(t,e){return Ri(t,e,!0)},pr.sortedLastIndexBy=function(t,e,n){return Fi(t,e,zo(n,2),!0)},pr.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var n=Ri(t,e,!0)-1;if(ps(t[n],e))return n}return-1},pr.startCase=bh,pr.startsWith=function(t,e,n){return t=Ws(t),n=null==n?0:kr(Vs(n),0,t.length),e=zi(e),t.slice(n,n+e.length)==e},pr.subtract=Jh,pr.sum=function(t){return t&&t.length?mn(t,Ph):0},pr.sumBy=function(t,e){return t&&t.length?mn(t,zo(e,2)):0},pr.template=function(t,e,n){var r=pr.templateSettings;n&&qo(t,e,n)&&(e=o),t=Ws(t),e=Qs({},e,r,Co);var i,a,s=Qs({},e.imports,r.imports,Co),h=ih(s),u=yn(s,h),c=0,l=e.interpolate||Kt,f="__p += '",p=ne((e.escape||Kt).source+"|"+l.source+"|"+(l===Et?Ht:Kt).source+"|"+(e.evaluate||Kt).source+"|$","g"),d="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++Se+"]")+"\n";t.replace(p,function(e,n,r,o,s,h){return r||(r=o),f+=t.slice(c,h).replace(Jt,An),n&&(i=!0,f+="' +\n__e("+n+") +\n'"),s&&(a=!0,f+="';\n"+s+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=h+e.length,e}),f+="';\n";var m=e.variable;m||(f="with (obj) {\n"+f+"\n}\n"),f=(a?f.replace(xt,""):f).replace(_t,"$1").replace(bt,"$1;"),f="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var g=Sh(function(){return $t(h,d+"return "+f).apply(o,u)});if(g.source=f,Ms(g))throw g;return g},pr.times=function(t,e){if((t=Vs(t))<1||t>k)return[];var n=N,r=Xn(t,N);e=zo(e),t-=N;for(var i=gn(r,e);++n<t;)e(n);return i},pr.toFinite=Os,pr.toInteger=Vs,pr.toLength=Hs,pr.toLower=function(t){return Ws(t).toLowerCase()},pr.toNumber=Gs,pr.toSafeInteger=function(t){return t?kr(Vs(t),-k,k):0===t?t:0},pr.toString=Ws,pr.toUpper=function(t){return Ws(t).toUpperCase()},pr.trim=function(t,e,n){if((t=Ws(t))&&(n||e===o))return t.replace(kt,"");if(!t||!(e=zi(e)))return t;var r=Rn(t),i=Rn(e);return Qi(r,_n(r,i),bn(r,i)+1).join("")},pr.trimEnd=function(t,e,n){if((t=Ws(t))&&(n||e===o))return t.replace(zt,"");if(!t||!(e=zi(e)))return t;var r=Rn(t);return Qi(r,0,bn(r,Rn(e))+1).join("")},pr.trimStart=function(t,e,n){if((t=Ws(t))&&(n||e===o))return t.replace(Bt,"");if(!t||!(e=zi(e)))return t;var r=Rn(t);return Qi(r,_n(r,Rn(e))).join("")},pr.truncate=function(t,e){var n=T,r=E;if(Ts(e)){var i="separator"in e?e.separator:i;n="length"in e?Vs(e.length):n,r="omission"in e?zi(e.omission):r}var a=(t=Ws(t)).length;if(Sn(t)){var s=Rn(t);a=s.length}if(n>=a)return t;var h=n-Dn(r);if(h<1)return r;var u=s?Qi(s,0,h).join(""):t.slice(0,h);if(i===o)return u+r;if(s&&(h+=u.length-h),Rs(i)){if(t.slice(h).search(i)){var c,l=u;for(i.global||(i=ne(i.source,Ws(Gt.exec(i))+"g")),i.lastIndex=0;c=i.exec(l);)var f=c.index;u=u.slice(0,f===o?h:f)}}else if(t.indexOf(zi(i),h)!=h){var p=u.lastIndexOf(i);p>-1&&(u=u.slice(0,p))}return u+r},pr.unescape=function(t){return(t=Ws(t))&&At.test(t)?t.replace(wt,Fn):t},pr.uniqueId=function(t){var e=++le;return Ws(t)+e},pr.upperCase=wh,pr.upperFirst=Mh,pr.each=Wa,pr.eachRight=Xa,pr.first=xa,kh(pr,(Qh={},qr(pr,function(t,e){ce.call(pr.prototype,e)||(Qh[e]=t)}),Qh),{chain:!1}),pr.VERSION="4.17.11",qe(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){pr[t].placeholder=pr}),qe(["drop","take"],function(t,e){vr.prototype[t]=function(n){n=n===o?1:Wn(Vs(n),0);var r=this.__filtered__&&!e?new vr(this):this.clone();return r.__filtered__?r.__takeCount__=Xn(n,r.__takeCount__):r.__views__.push({size:Xn(n,N),type:t+(r.__dir__<0?"Right":"")}),r},vr.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),qe(["filter","map","takeWhile"],function(t,e){var n=e+1,r=n==D||3==n;vr.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:zo(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}}),qe(["head","last"],function(t,e){var n="take"+(e?"Right":"");vr.prototype[t]=function(){return this[n](1).value()[0]}}),qe(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");vr.prototype[t]=function(){return this.__filtered__?new vr(this):this[n](1)}}),vr.prototype.compact=function(){return this.filter(Ph)},vr.prototype.find=function(t){return this.filter(t).head()},vr.prototype.findLast=function(t){return this.reverse().find(t)},vr.prototype.invokeMap=Mi(function(t,e){return"function"==typeof t?new vr(this):this.map(function(n){return ri(n,t,e)})}),vr.prototype.reject=function(t){return this.filter(hs(zo(t)))},vr.prototype.slice=function(t,e){t=Vs(t);var n=this;return n.__filtered__&&(t>0||e<0)?new vr(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==o&&(n=(e=Vs(e))<0?n.dropRight(-e):n.take(e-t)),n)},vr.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},vr.prototype.toArray=function(){return this.take(N)},qr(vr.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),i=pr[r?"take"+("last"==e?"Right":""):e],a=r||/^find/.test(e);i&&(pr.prototype[e]=function(){var e=this.__wrapped__,s=r?[1]:arguments,h=e instanceof vr,u=s[0],c=h||vs(e),l=function(t){var e=i.apply(pr,tn([t],s));return r&&f?e[0]:e};c&&n&&"function"==typeof u&&1!=u.length&&(h=c=!1);var f=this.__chain__,p=!!this.__actions__.length,d=a&&!f,m=h&&!p;if(!a&&c){e=m?e:new vr(this);var g=t.apply(e,s);return g.__actions__.push({func:Oa,args:[l],thisArg:o}),new gr(g,f)}return d&&m?t.apply(this,s):(g=this.thru(l),d?r?g.value()[0]:g.value():g)})}),qe(["pop","push","shift","sort","splice","unshift"],function(t){var e=oe[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);pr.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(vs(i)?i:[],t)}return this[n](function(n){return e.apply(vs(n)?n:[],t)})}}),qr(vr.prototype,function(t,e){var n=pr[e];if(n){var r=n.name+"";(ir[r]||(ir[r]=[])).push({name:e,func:n})}}),ir[po(o,y).name]=[{name:"wrapper",func:o}],vr.prototype.clone=function(){var t=new vr(this.__wrapped__);return t.__actions__=no(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=no(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=no(this.__views__),t},vr.prototype.reverse=function(){if(this.__filtered__){var t=new vr(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},vr.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=vs(t),r=e<0,i=n?t.length:0,o=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Xn(e,t+a);break;case"takeRight":t=Wn(t,e-a)}}return{start:t,end:e}}(0,i,this.__views__),a=o.start,s=o.end,h=s-a,u=r?s:a-1,c=this.__iteratees__,l=c.length,f=0,p=Xn(h,this.__takeCount__);if(!n||!r&&i==h&&p==h)return Vi(t,this.__actions__);var d=[];t:for(;h--&&f<p;){for(var m=-1,g=t[u+=e];++m<l;){var v=c[m],y=v.iteratee,x=v.type,_=y(g);if(x==R)g=_;else if(!_){if(x==D)continue t;break t}}d[f++]=g}return d},pr.prototype.at=Va,pr.prototype.chain=function(){return Ia(this)},pr.prototype.commit=function(){return new gr(this.value(),this.__chain__)},pr.prototype.next=function(){this.__values__===o&&(this.__values__=Is(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?o:this.__values__[this.__index__++]}},pr.prototype.plant=function(t){for(var e,n=this;n instanceof mr;){var r=fa(n);r.__index__=0,r.__values__=o,e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e},pr.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof vr){var e=t;return this.__actions__.length&&(e=new vr(this)),(e=e.reverse()).__actions__.push({func:Oa,args:[Ta],thisArg:o}),new gr(e,this.__chain__)}return this.thru(Ta)},pr.prototype.toJSON=pr.prototype.valueOf=pr.prototype.value=function(){return Vi(this.__wrapped__,this.__actions__)},pr.prototype.first=pr.prototype.head,Ue&&(pr.prototype[Ue]=function(){return this}),pr}();Fe._=kn,(i=function(){return kn}.call(e,n,e,r))===o||(r.exports=i)}).call(this)}).call(this,n(16),n(17)(t))},function(t,e,n){(function(e){var r=n(6),i=n(4),o=n(2),a=n(5),s=n(13),h=n(20),u=n(3).EventEmitter,c=n(7).gestureListener,l=n(12),f=n(0),p=t.exports=function(t){var i=void 0!==e&&e.versions&&e.versions.node,o=this;t=f.defaults(t||{},{inNode:i}),this.inNode=t.inNode,t=f.defaults(t||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",suppressAnimationLoop:!this.useAnimationLoop(),loopWhileDisconnected:!0,useAllPlugins:!1,checkVersion:!0}),this.animationFrameRequested=!1,this.onAnimationFrame=function(t){o.lastConnectionFrame.valid&&o.emit("animationFrame",o.lastConnectionFrame),o.emit("frameEnd",t),o.loopWhileDisconnected&&(!1!==o.connection.focusedState||o.connection.opts.background)?window.requestAnimationFrame(o.onAnimationFrame):o.animationFrameRequested=!1},this.suppressAnimationLoop=t.suppressAnimationLoop,this.loopWhileDisconnected=t.loopWhileDisconnected,this.frameEventName=t.frameEventName,this.useAllPlugins=t.useAllPlugins,this.history=new s(200),this.lastFrame=r.Invalid,this.lastValidFrame=r.Invalid,this.lastConnectionFrame=r.Invalid,this.accumulatedGestures=[],this.checkVersion=t.checkVersion,void 0===t.connectionType?this.connectionType=this.inBrowser()?n(21):n(22):this.connectionType=t.connectionType,this.connection=new this.connectionType(t),this.streamingCount=0,this.devices={},this.plugins={},this._pluginPipelineSteps={},this._pluginExtendedMethods={},t.useAllPlugins&&this.useRegisteredPlugins(),this.setupFrameEvents(t),this.setupConnectionEvents(),this.startAnimationLoop()};p.prototype.gesture=function(t,e){var n=c(this,t);return void 0!==e&&n.stop(e),n},p.prototype.setBackground=function(t){return this.connection.setBackground(t),this},p.prototype.setOptimizeHMD=function(t){return this.connection.setOptimizeHMD(t),this},p.prototype.inBrowser=function(){return!this.inNode},p.prototype.useAnimationLoop=function(){return this.inBrowser()&&!this.inBackgroundPage()},p.prototype.inBackgroundPage=function(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.getBackgroundPage&&chrome.extension.getBackgroundPage()===window},p.prototype.connect=function(){return this.connection.connect(),this},p.prototype.streaming=function(){return this.streamingCount>0},p.prototype.connected=function(){return!!this.connection.connected},p.prototype.startAnimationLoop=function(){this.suppressAnimationLoop||this.animationFrameRequested||(this.animationFrameRequested=!0,window.requestAnimationFrame(this.onAnimationFrame))},p.prototype.disconnect=function(){return this.connection.disconnect(),this},p.prototype.frame=function(t){return this.history.get(t)||r.Invalid},p.prototype.loop=function(t){return t&&("function"==typeof t?this.on(this.frameEventName,t):this.setupFrameEvents(t)),this.connect()},p.prototype.addStep=function(t){this.pipeline||(this.pipeline=new h(this)),this.pipeline.addStep(t)},p.prototype.processFrame=function(t){t.gestures&&(this.accumulatedGestures=this.accumulatedGestures.concat(t.gestures)),this.lastConnectionFrame=t,this.startAnimationLoop(),this.emit("deviceFrame",t)},p.prototype.processFinishedFrame=function(t){if(this.lastFrame=t,t.valid&&(this.lastValidFrame=t),t.controller=this,t.historyIdx=this.history.push(t),t.gestures){t.gestures=this.accumulatedGestures,this.accumulatedGestures=[];for(var e=0;e!=t.gestures.length;e++)this.emit("gesture",t.gestures[e],t)}this.pipeline&&((t=this.pipeline.run(t))||(t=r.Invalid)),this.emit("frame",t),this.emitHandEvents(t)},p.prototype.emitHandEvents=function(t){for(var e=0;e<t.hands.length;e++)this.emit("hand",t.hands[e])},p.prototype.setupFrameEvents=function(t){t.frame&&this.on("frame",t.frame),t.hand&&this.on("hand",t.hand)},p.prototype.setupConnectionEvents=function(){var t=this;this.connection.on("frame",function(e){t.processFrame(e)}),this.on(this.frameEventName,function(e){t.processFinishedFrame(e)});var e=function(){if(t.connection.opts.requestProtocolVersion<5&&0==t.streamingCount){t.streamingCount=1;var n={attached:!0,streaming:!0,type:"unknown",id:"Lx00000000000"};t.devices[n.id]=n,t.emit("deviceAttached",n),t.emit("deviceStreaming",n),t.emit("streamingStarted",n),t.connection.removeListener("frame",e)}},n=function(){if(t.streamingCount>0){for(var e in t.devices)t.emit("deviceStopped",t.devices[e]),t.emit("deviceRemoved",t.devices[e]);for(var e in t.emit("streamingStopped",t.devices[e]),t.streamingCount=0,t.devices)delete t.devices[e]}};this.connection.on("focus",function(){t.loopWhileDisconnected&&t.startAnimationLoop(),t.emit("focus")}),this.connection.on("blur",function(){t.emit("blur")}),this.connection.on("protocol",function(e){e.on("beforeFrameCreated",function(e){t.emit("beforeFrameCreated",e)}),e.on("afterFrameCreated",function(e,n){t.emit("afterFrameCreated",e,n)}),t.emit("protocol",e)}),this.connection.on("ready",function(){t.checkVersion&&!t.inNode&&t.checkOutOfDate(),t.emit("ready")}),this.connection.on("connect",function(){t.emit("connect"),t.connection.removeListener("frame",e),t.connection.on("frame",e)}),this.connection.on("disconnect",function(){t.emit("disconnect"),n()}),this.connection.on("deviceConnect",function(r){r.state?(t.emit("deviceConnected"),t.connection.removeListener("frame",e),t.connection.on("frame",e)):(t.emit("deviceDisconnected"),n())}),this.connection.on("deviceEvent",function(e){var n=e.state,r=t.devices[n.id],i={};for(var o in n)r&&r.hasOwnProperty(o)&&r[o]==n[o]||(i[o]=!0);t.devices[n.id]=n,i.attached&&t.emit(n.attached?"deviceAttached":"deviceRemoved",n),i.streaming&&(n.streaming?(t.streamingCount++,t.emit("deviceStreaming",n),1==t.streamingCount&&t.emit("streamingStarted",n),i.attached||t.emit("deviceConnected")):i.attached&&n.attached||(t.streamingCount--,t.emit("deviceStopped",n),0==t.streamingCount&&t.emit("streamingStopped",n),t.emit("deviceDisconnected")))}),this.on("newListener",function(t,e){"deviceConnected"!=t&&"deviceDisconnected"!=t||console.warn(t+" events are depricated.  Consider using 'streamingStarted/streamingStopped' or 'deviceStreaming/deviceStopped' instead")})},p.prototype.checkOutOfDate=function(){console.assert(this.connection&&this.connection.protocol);var t=this.connection.protocol.serviceVersion,e=this.connection.protocol.version,n=this.connectionType.defaultProtocolVersion;return n>e&&(console.warn("Your Protocol Version is v"+e+", this app was designed for v"+n),l.warnOutOfDate({sV:t,pV:e}),!0)},p._pluginFactories={},p.plugin=function(t,e){return this._pluginFactories[t]&&console.warn('Plugin "'+t+'" already registered'),this._pluginFactories[t]=e},p.plugins=function(){return f.keys(this._pluginFactories)};var d=function(t,e,n){-1!=["beforeFrameCreated","afterFrameCreated"].indexOf(e)?this.on(e,n):(this.pipeline||(this.pipeline=new h(this)),this._pluginPipelineSteps[t]||(this._pluginPipelineSteps[t]=[]),this._pluginPipelineSteps[t].push(this.pipeline.addWrappedStep(e,n)))},m=function(t,e,n){var s;switch(this._pluginExtendedMethods[t]||(this._pluginExtendedMethods[t]=[]),e){case"frame":s=r;break;case"hand":s=i;break;case"pointable":s=o,f.extend(a.prototype,n),f.extend(a.Invalid,n);break;case"finger":s=a;break;default:throw t+' specifies invalid object type "'+e+'" for prototypical extension'}f.extend(s.prototype,n),f.extend(s.Invalid,n),this._pluginExtendedMethods[t].push([s,n])};p.prototype.use=function(t,e){var n,r,i,o;if(!(r="function"==typeof t?t:p._pluginFactories[t]))throw"Leap Plugin "+t+" not found.";if(e||(e={}),this.plugins[t])return f.extend(this.plugins[t],e),this;for(i in this.plugins[t]=e,o=r.call(this,e))"function"==typeof(n=o[i])?d.call(this,t,i,n):m.call(this,t,i,n);return this},p.prototype.stopUsing=function(t){var e,n=this._pluginPipelineSteps[t],r=this._pluginExtendedMethods[t],i=0;if(this.plugins[t]){if(n)for(i=0;i<n.length;i++)this.pipeline.removeStep(n[i]);if(r)for(i=0;i<r.length;i++)for(var o in e=r[i][0],r[i][1])delete e.prototype[o],delete e.Invalid[o];return delete this.plugins[t],this}},p.prototype.useRegisteredPlugins=function(){for(var t in p._pluginFactories)this.use(t)},f.extend(p.prototype,u.prototype)}).call(this,n(9))},function(t,e){var n=t.exports=function(t){this.steps=[],this.controller=t};n.prototype.addStep=function(t){this.steps.push(t)},n.prototype.run=function(t){for(var e=this.steps.length,n=0;n!=e&&t;n++)t=this.steps[n](t);return t},n.prototype.removeStep=function(t){var e=this.steps.indexOf(t);if(-1===e)throw"Step not found in pipeline";this.steps.splice(e,1)},n.prototype.addWrappedStep=function(t,e){var n=this.controller,r=function(r){var i,o,a;for(o=0,a=(i="frame"==t?[r]:r[t+"s"]||[]).length;o<a;o++)e.call(n,i[o]);return r};return this.addStep(r),r}},function(t,e,n){var r=t.exports=n(14),i=n(0),o=t.exports=function(t){r.call(this,t);var e=this;this.on("ready",function(){e.startFocusLoop()}),this.on("disconnect",function(){e.stopFocusLoop()})};i.extend(o.prototype,r.prototype),o.__proto__=r,o.prototype.useSecure=function(){return"https:"===location.protocol},o.prototype.getScheme=function(){return this.useSecure()?"wss:":"ws:"},o.prototype.getPort=function(){return this.useSecure()?6436:6437},o.prototype.setupSocket=function(){var t=this,e=new WebSocket(this.getUrl());return e.onopen=function(){t.handleOpen()},e.onclose=function(e){t.handleClose(e.code,e.reason)},e.onmessage=function(e){t.handleData(e.data)},e.onerror=function(e){t.useSecure()&&"wss:"===t.scheme&&(t.scheme="ws:",t.port=6437,t.disconnect(),t.connect())},e},o.prototype.startFocusLoop=function(){if(!this.focusDetectorTimer){var t=this,e=null;e=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":void 0,void 0===t.windowVisible&&(t.windowVisible=void 0===e||!1===document[e]);var n=window.addEventListener("focus",function(e){t.windowVisible=!0,i()}),r=window.addEventListener("blur",function(e){t.windowVisible=!1,i()});this.on("disconnect",function(){window.removeEventListener("focus",n),window.removeEventListener("blur",r)});var i=function(){var n=void 0===e||!1===document[e];t.reportFocus(n&&t.windowVisible)};i(),this.focusDetectorTimer=setInterval(i,100)}},o.prototype.stopFocusLoop=function(){this.focusDetectorTimer&&(clearTimeout(this.focusDetectorTimer),delete this.focusDetectorTimer)}},function(t,e,n){var r=n(23),i=n(14),o=n(0),a=t.exports=function(t){i.call(this,t);var e=this;this.on("ready",function(){e.reportFocus(!0)})};o.extend(a.prototype,i.prototype),a.__proto__=i,a.prototype.setupSocket=function(){var t=this,e=new r(this.getUrl());return e.on("open",function(){t.handleOpen()}),e.on("message",function(e){t.handleData(e)}),e.on("close",function(e,n){t.handleClose(e,n)}),e.on("error",function(){t.startReconnection()}),e}},function(t,e,n){(function(e){t.exports=function(){return e.WebSocket||e.MozWebSocket}}).call(this,n(16))},function(t,e,n){e.UI={Region:n(25),Cursor:n(26)}},function(t,e,n){var r=n(3).EventEmitter,i=n(0),o=t.exports=function(t,e){this.start=new Vector(t),this.end=new Vector(e),this.enteredFrame=null};o.prototype.hasPointables=function(t){for(var e=0;e!=t.pointables.length;e++){var n=t.pointables[e].tipPosition;if(n.x>=this.start.x&&n.x<=this.end.x&&n.y>=this.start.y&&n.y<=this.end.y&&n.z>=this.start.z&&n.z<=this.end.z)return!0}return!1},o.prototype.listener=function(t){var e=this;return t&&t.nearThreshold&&this.setupNearRegion(t.nearThreshold),function(t){return e.updatePosition(t)}},o.prototype.clipper=function(){var t=this;return function(e){return t.updatePosition(e),t.enteredFrame?e:null}},o.prototype.setupNearRegion=function(t){var e=this.nearRegion=new o([this.start.x-t,this.start.y-t,this.start.z-t],[this.end.x+t,this.end.y+t,this.end.z+t]),n=this;e.on("enter",function(t){n.emit("near",t)}),e.on("exit",function(t){n.emit("far",t)}),n.on("exit",function(t){n.emit("near",t)})},o.prototype.updatePosition=function(t){return this.nearRegion&&this.nearRegion.updatePosition(t),this.hasPointables(t)&&null==this.enteredFrame?(this.enteredFrame=t,this.emit("enter",this.enteredFrame)):this.hasPointables(t)||null==this.enteredFrame||(this.enteredFrame=null,this.emit("exit",this.enteredFrame)),t},o.prototype.normalize=function(t){return new Vector([(t.x-this.start.x)/(this.end.x-this.start.x),(t.y-this.start.y)/(this.end.y-this.start.y),(t.z-this.start.z)/(this.end.z-this.start.z)])},o.prototype.mapToXY=function(t,e,n){var r=this.normalize(t),i=r.x,o=r.y;return i>1?i=1:i<-1&&(i=-1),o>1?o=1:o<-1&&(o=-1),[(i+1)/2*e,(1-o)/2*n,r.z]},i.extend(o.prototype,r.prototype)},function(t,e){t.exports=function(){return function(t){var e=t.pointables.sort(function(t,e){return t.z-e.z})[0];return e&&e.valid&&(t.cursorPosition=e.tipPosition),t}}},function(t,e){t.exports={full:"0.6.4",major:0,minor:6,dot:4}},function(t,e,n){Leap=n(8),n(29),n(30),n(31),n(33),n(34),n(35),t.exports=!0},function(t,e,n){(function(){var e;e=function(){var t;return t=[],0===Leap.version.major&&Leap.version.minor<5&&console.warn("The hand entry plugin requires LeapJS 0.5.0 or newer."),this.on("deviceStopped",function(){for(var e=0,n=t.length;e<n;e++)id=t[e],t.splice(e,1),this.emit("handLost",this.lastConnectionFrame.hand(id)),e--,n--}),{frame:function(e){var n,r,i,o,a;r=e.hands.map(function(t){return t.id});for(var s=0,h=t.length;s<h;s++)n=t[s],-1==r.indexOf(n)&&(t.splice(s,1),this.emit("handLost",this.frame(1).hand(n)),s--,h--);for(a=[],i=0,o=r.length;i<o;i++)n=r[i],-1===t.indexOf(n)?(t.push(n),a.push(this.emit("handFound",e.hand(n)))):a.push(void 0);return a}}},"undefined"!=typeof Leap&&Leap.Controller?Leap.Controller.plugin("handEntry",e):t.exports.handEntry=e}).call(this)},function(t,e,n){(function(){var e;e=function(){var t,e;return e={},t=function(t,n,r){var i,o,a,s;if(e[a=t+this.id]||(e[a]=[]),i=e[t+this.id],void 0!==r)return i[n]=r;if("[object String]"==={}.toString.call(n))return i[n];for(o in s=[],n)void 0===(r=n[o])?s.push(delete i[o]):s.push(i[o]=r);return s},{hand:{data:function(e,n){return t.call(this,"h",e,n)},hold:function(t){return t?this.data({holding:t}):this.hold(this.hovering())},holding:function(){return this.data("holding")},release:function(){var t;return t=this.data("holding"),this.data({holding:void 0}),t},hoverFn:function(t){return this.data({getHover:t})},hovering:function(){var t;if(t=this.data("getHover"))return this._hovering||(this._hovering=t.call(this))}},pointable:{data:function(e,n){return t.call(this,"p",e,n)}}}},"undefined"!=typeof Leap&&Leap.Controller?Leap.Controller.plugin("handHold",e):t.exports.handHold=e}).call(this)},function(t,e,n){(function(){var t,e,r,i,o,a,s,h,u,c,l,f,p,d,m;m=null,e=n(32),u=function(t,n){var r,i,o,a,s,h;return m.scene=new e.Scene,m.rendererOps||(m.rendererOps={}),void 0===m.rendererOps.alpha&&(m.rendererOps.alpha=!0),m.renderer=s=new e.WebGLRenderer(m.rendererOps),h=m.width||window.innerWidth,o=m.height||window.innerHeight,s.setClearColor(0,0),s.setSize(h,o),s.domElement.className="leap-boneHand",s.shadowMap.enabled=!0,s.shadowMap.type=e.PCFSoftShadowMap,t.appendChild(s.domElement),a=1,i=1e4,n&&(a*=n,i*=n),m.camera=r=new e.PerspectiveCamera(45,h/o,a,i),r.position.set(0,300,500),r.lookAt(new e.Vector3(0,160,0)),m.scene.add(r),m.width||m.height||window.addEventListener("resize",function(){return h=window.innerWidth,o=window.innerHeight,r.aspect=h/o,r.updateProjectionMatrix(),s.setSize(h,o),s.render(m.scene,r)},!1),m.render||(m.render=function(t){return s.render(m.scene,m.camera)}),m.render()},i=null,c=null,o=null,h=null,f=null,s=null,l=null,p=null,r=null,t=function(){function t(){var t,n,i,a,u,d,g,v,y;for(p=isNaN(m.opacity)?new e.MeshPhongMaterial({fog:!1}):new e.MeshPhongMaterial({fog:!1,transparent:!0,opacity:m.opacity}),s=40*h,l=40*f,this.fingerMeshes=[],i=d=0;d<5;i=++d){for(n=[],t=0===i?3:4,a=g=0;0<=t?g<t:g>t;a=0<=t?++g:--g)(u=new e.Mesh(new e.SphereGeometry(l,32,32),p.clone())).name="hand-bone-"+a,u.material.color.copy(c),u.renderOrder=(9*i+2*a)/36,u.castShadow=!0,m.scene.add(u),n.push(u),(u=new e.Mesh(new e.CylinderGeometry(s,s,40,32),p.clone())).name="hand-joint-"+a,u.material.color.copy(o),u.renderOrder=(9*i+2*a+1)/36,u.castShadow=!0,m.scene.add(u),n.push(u);(u=new e.Mesh(new e.SphereGeometry(l,32,32),p.clone())).material.color.copy(c),u.castShadow=!0,m.scene.add(u),n.push(u),this.fingerMeshes.push(n)}if(m.arm){for(this.armMesh=new e.Object3D,this.armBones=[],this.armSpheres=[],i=v=0;v<=3;i=++v)this.armBones.push(new e.Mesh(new e.CylinderGeometry(s,s,i<2?1e3:100,32),p.clone())),this.armBones[i].material.color.copy(o),this.armBones[i].castShadow=!0,this.armBones[i].name="ArmBone"+i,i>1&&this.armBones[i].quaternion.multiply(r),this.armMesh.add(this.armBones[i]);for(this.armSpheres=[],i=y=0;y<=3;i=++y)this.armSpheres.push(new e.Mesh(new e.SphereGeometry(l,32,32),p.clone())),this.armSpheres[i].material.color.copy(c),this.armSpheres[i].castShadow=!0,this.armSpheres[i].name="ArmSphere"+i,this.armMesh.add(this.armSpheres[i]);m.scene.add(this.armMesh)}}return t.unusedHandMeshes=[],t.get=function(){var e;return 0===t.unusedHandMeshes.length&&(e=t.create()),(e=t.unusedHandMeshes.pop()).show(),e},t.prototype.replace=function(){return this.hide(),t.unusedHandMeshes.push(this)},t.create=function(){var e;return(e=new t).setVisibility(!1),t.unusedHandMeshes.push(e),t.onMeshCreated&&t.onMeshCreated(e),e},t.prototype.traverse=function(t){var e,n,r,i,o;for(e=n=0;n<5;e=++n)for(r=0,i=(o=this.fingerMeshes[e]).length;r<i;r++)t(o[r]);return this.armMesh&&this.armMesh.traverse(t)},t.prototype.scaleTo=function(t){var e,n,r,i,o,a,s,h,u,c,l,f,p;for(r=t.middleFinger.proximal.length/this.fingerMeshes[2][1].geometry.parameters.height,u=f=0;f<5;u=++f)for(a=t.fingers[u],c=0;;){if(c===this.fingerMeshes[u].length-1){(l=this.fingerMeshes[u][c]).scale.set(r,r,r);break}i=a.bones[3-c/2],(l=this.fingerMeshes[u][c]).scale.set(r,r,r),c++,l=this.fingerMeshes[u][c],s=i.length/l.geometry.parameters.height,l.scale.set(r,s,r),c++}if(m.arm){for(e=t.arm.length/(this.armBones[0].geometry.parameters.height+this.armBones[0].geometry.parameters.radiusTop),n=t.arm.width/(this.armBones[2].geometry.parameters.height+this.armBones[2].geometry.parameters.radiusTop),u=p=0;p<=3;u=++p)this.armBones[u].scale.set(r,u<2?e:n,r),this.armSpheres[u].scale.set(r,r,r);o=t.arm.width/2*.85,h=t.arm.length/2,this.armBones[0].position.setX(o),this.armBones[1].position.setX(-o),this.armBones[2].position.setY(h),this.armBones[3].position.setY(-h),this.armSpheres[0].position.set(-o,h,0),this.armSpheres[1].position.set(o,h,0),this.armSpheres[2].position.set(o,-h,0),this.armSpheres[3].position.set(-o,-h,0)}return this},t.prototype.formTo=function(t){var n,r,o,a,s,h;for(o=h=0;h<5;o=++h)for(r=t.fingers[o],a=0;;){if(a===this.fingerMeshes[o].length-1){(s=this.fingerMeshes[o][a]).position.fromArray(n.prevJoint);break}n=r.bones[3-a/2],(s=this.fingerMeshes[o][a]).position.fromArray(n.nextJoint),++a,(s=this.fingerMeshes[o][a]).position.fromArray(n.center()),s.setRotationFromMatrix((new e.Matrix4).fromArray(n.matrix())),s.quaternion.multiply(i),++a}return this.armMesh&&(this.armMesh.position.fromArray(t.arm.center()),this.armMesh.setRotationFromMatrix((new e.Matrix4).fromArray(t.arm.matrix())),this.armMesh.quaternion.multiply(i)),this},t.prototype.setVisibility=function(t){var e,n,r,i,o;for(e=r=0;r<5;e=++r)for(n=0;this.fingerMeshes[e][n].visible=t,++n!==this.fingerMeshes[e].length;);if(m.arm){for(o=[],e=i=0;i<=3;e=++i)this.armBones[e].visible=t,o.push(this.armSpheres[e].visible=t);return o}},t.prototype.show=function(){return this.setVisibility(!0)},t.prototype.hide=function(){return this.setVisibility(!1)},t}(),d=function(e){var n;if(m.scene)return(n=e.data("handMesh"))||(n=t.get().scaleTo(e),e.data("handMesh",n),t.onMeshUsed&&t.onMeshUsed(n)),n.formTo(e)},a=function(t){var e;return(e=t.data("handMesh"))&&e.replace(),t.data("handMesh",null)},Leap.plugin("boneHand",function(n){var g,v;return null==n&&(n={}),m=n,g=this,c=(new e.Color).setHex(6138368),o=(new e.Color).setHex(16777215),m.boneScale&&(h=m.boneScale),m.jointScale&&(f=m.jointScale),m.boneColor&&(o=m.boneColor),m.jointColor&&(c=m.jointColor),m.HandMesh=t,m.addShadowCamera=function(){if(m.light=new e.SpotLight(16777215,1),m.light.castShadow=!0,m.light.shadow.mapSize.width=1024,m.light.shadow.mapSize.height=1024,m.light.shadow.camera.near=500,m.light.shadow.camera.far=3e3,m.light.position.set(0,1e3,1e3),m.light.target.position.set(0,0,-1e3),m.camera.add(m.light.target),m.camera.add(m.light),g.plugins.transform&&(g.plugins.transform.getScale()&&(m.light.shadowCameraNear*=g.plugins.transform.scale.x,m.light.shadowCameraFar*=g.plugins.transform.scale.x,m.light.target.position.multiply(g.plugins.transform.scale),m.light.position.multiply(g.plugins.transform.scale)),!0===g.plugins.transform.vr&&m.camera.position.set(0,0,0),"desktop"===g.plugins.transform.vr))return m.camera.position.set(0,.15,.3)},i=(new e.Quaternion).setFromEuler(new e.Euler(Math.PI/2,0,0)),h=1/6,f=.2,s=null,l=null,p=null,r=(new e.Quaternion).setFromEuler(new e.Euler(0,0,Math.PI/2)),t.onMeshCreated=function(t){return g.emit("handMeshCreated",t)},t.onMeshUsed=function(t){return g.emit("handMeshUsed",t)},this.use("handEntry"),this.use("handHold"),void 0===m.scene&&(console.assert(m.targetEl),this.plugins.transform&&this.plugins.transform.getScale()&&(v=this.plugins.transform.scale.x),u(m.targetEl,v),m.addShadowCamera()),m.scene&&(t.create(),t.create(),0===Leap.version.major&&Leap.version.minor<7&&Leap.version.dot<4&&console.warn("BoneHand default scene render requires LeapJS > 0.6.3. You're running have "+Leap.version.full),this.on("frameEnd",function(t){if(m.render)return m.render(t)})),this.on("handLost",a),{hand:d}})}).call(this)},function(t,e,n){var r,i,o,a,s,h,u,c,l,f,p,d,m,g,v,y,x,_,b,w,M,A,S,C,T,E,L,P,D,R,F,k,B,z,N,U,I,O,V,H,G,j,W,X,q,Q,Y,K,J,Z,$,tt,et=et||{},nt={REVISION:"69"};t.exports=nt,void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:0}),nt.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},nt.CullFaceNone=0,nt.CullFaceBack=1,nt.CullFaceFront=2,nt.CullFaceFrontBack=3,nt.FrontFaceDirectionCW=0,nt.FrontFaceDirectionCCW=1,nt.BasicShadowMap=0,nt.PCFShadowMap=1,nt.PCFSoftShadowMap=2,nt.FrontSide=0,nt.BackSide=1,nt.DoubleSide=2,nt.NoShading=0,nt.FlatShading=1,nt.SmoothShading=2,nt.NoColors=0,nt.FaceColors=1,nt.VertexColors=2,nt.NoBlending=0,nt.NormalBlending=1,nt.AdditiveBlending=2,nt.SubtractiveBlending=3,nt.MultiplyBlending=4,nt.CustomBlending=5,nt.AddEquation=100,nt.SubtractEquation=101,nt.ReverseSubtractEquation=102,nt.MinEquation=103,nt.MaxEquation=104,nt.ZeroFactor=200,nt.OneFactor=201,nt.SrcColorFactor=202,nt.OneMinusSrcColorFactor=203,nt.SrcAlphaFactor=204,nt.OneMinusSrcAlphaFactor=205,nt.DstAlphaFactor=206,nt.OneMinusDstAlphaFactor=207,nt.DstColorFactor=208,nt.OneMinusDstColorFactor=209,nt.SrcAlphaSaturateFactor=210,nt.MultiplyOperation=0,nt.MixOperation=1,nt.AddOperation=2,nt.UVMapping=function(){},nt.CubeReflectionMapping=function(){},nt.CubeRefractionMapping=function(){},nt.SphericalReflectionMapping=function(){},nt.SphericalRefractionMapping=function(){},nt.RepeatWrapping=1e3,nt.ClampToEdgeWrapping=1001,nt.MirroredRepeatWrapping=1002,nt.NearestFilter=1003,nt.NearestMipMapNearestFilter=1004,nt.NearestMipMapLinearFilter=1005,nt.LinearFilter=1006,nt.LinearMipMapNearestFilter=1007,nt.LinearMipMapLinearFilter=1008,nt.UnsignedByteType=1009,nt.ByteType=1010,nt.ShortType=1011,nt.UnsignedShortType=1012,nt.IntType=1013,nt.UnsignedIntType=1014,nt.FloatType=1015,nt.UnsignedShort4444Type=1016,nt.UnsignedShort5551Type=1017,nt.UnsignedShort565Type=1018,nt.AlphaFormat=1019,nt.RGBFormat=1020,nt.RGBAFormat=1021,nt.LuminanceFormat=1022,nt.LuminanceAlphaFormat=1023,nt.RGB_S3TC_DXT1_Format=2001,nt.RGBA_S3TC_DXT1_Format=2002,nt.RGBA_S3TC_DXT3_Format=2003,nt.RGBA_S3TC_DXT5_Format=2004,nt.RGB_PVRTC_4BPPV1_Format=2100,nt.RGB_PVRTC_2BPPV1_Format=2101,nt.RGBA_PVRTC_4BPPV1_Format=2102,nt.RGBA_PVRTC_2BPPV1_Format=2103,nt.Color=function(t){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(t)},nt.Color.prototype={constructor:nt.Color,r:1,g:1,b:1,set:function(t){return t instanceof nt.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){if(0===e)this.r=this.g=this.b=n;else{var r=function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t},i=n<=.5?n*(1+e):n+e-n*e,o=2*n-i;this.r=r(o,i,t+1/3),this.g=r(o,i,t),this.b=r(o,i,t-1/3)}return this},setStyle:function(t){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(t)){var e=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(t);return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(t)){e=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(t);return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(t)){e=/^\#([0-9a-f]{6})$/i.exec(t);return this.setHex(parseInt(e[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)){e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t);return this.setHex(parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3],16)),this}if(/^(\w+)$/i.test(t))return this.setHex(nt.ColorKeywords[t]),this},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t){return this.r=t.r*t.r,this.g=t.g*t.g,this.b=t.b*t.b,this},copyLinearToGamma:function(t){return this.r=Math.sqrt(t.r),this.g=Math.sqrt(t.g),this.b=Math.sqrt(t.b),this},convertGammaToLinear:function(){var t=this.r,e=this.g,n=this.b;return this.r=t*t,this.g=e*e,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,n,r=t||{h:0,s:0,l:0},i=this.r,o=this.g,a=this.b,s=Math.max(i,o,a),h=Math.min(i,o,a),u=(h+s)/2;if(h===s)e=0,n=0;else{var c=s-h;switch(n=u<=.5?c/(s+h):c/(2-s-h),s){case i:e=(o-a)/c+(o<a?6:0);break;case o:e=(a-i)/c+2;break;case a:e=(i-o)/c+4}e/=6}return r.h=e,r.s=n,r.l=u,r},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){var r=this.getHSL();return r.h+=t,r.s+=e,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t){return this.r=t[0],this.g=t[1],this.b=t[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new nt.Color).setRGB(this.r,this.g,this.b)}},nt.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},nt.Quaternion=function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1},nt.Quaternion.prototype={constructor:nt.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this.onChangeCallback(),this},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(t instanceof nt.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(t._x/2),r=Math.cos(t._y/2),i=Math.cos(t._z/2),o=Math.sin(t._x/2),a=Math.sin(t._y/2),s=Math.sin(t._z/2);return"XYZ"===t.order?(this._x=o*r*i+n*a*s,this._y=n*a*i-o*r*s,this._z=n*r*s+o*a*i,this._w=n*r*i-o*a*s):"YXZ"===t.order?(this._x=o*r*i+n*a*s,this._y=n*a*i-o*r*s,this._z=n*r*s-o*a*i,this._w=n*r*i+o*a*s):"ZXY"===t.order?(this._x=o*r*i-n*a*s,this._y=n*a*i+o*r*s,this._z=n*r*s+o*a*i,this._w=n*r*i-o*a*s):"ZYX"===t.order?(this._x=o*r*i-n*a*s,this._y=n*a*i+o*r*s,this._z=n*r*s-o*a*i,this._w=n*r*i+o*a*s):"YZX"===t.order?(this._x=o*r*i+n*a*s,this._y=n*a*i+o*r*s,this._z=n*r*s-o*a*i,this._w=n*r*i-o*a*s):"XZY"===t.order&&(this._x=o*r*i-n*a*s,this._y=n*a*i-o*r*s,this._z=n*r*s+o*a*i,this._w=n*r*i+o*a*s),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,r=n[0],i=n[4],o=n[8],a=n[1],s=n[5],h=n[9],u=n[2],c=n[6],l=n[10],f=r+s+l;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(c-h)*e,this._y=(o-u)*e,this._z=(a-i)*e):r>s&&r>l?(e=2*Math.sqrt(1+r-s-l),this._w=(c-h)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(o+u)/e):s>l?(e=2*Math.sqrt(1+s-r-l),this._w=(o-u)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(h+c)/e):(e=2*Math.sqrt(1+l-r-s),this._w=(a-i)/e,this._x=(o+u)/e,this._y=(h+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(t,e){return void 0===r&&(r=new nt.Vector3),(i=t.dot(e)+1)<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?r.set(-t.y,t.x,0):r.set(0,-t.z,t.y)):r.crossVectors(t,e),this._x=r.x,this._y=r.y,this._z=r.z,this._w=i,this.normalize(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,h=e._z,u=e._w;return this._x=n*u+o*a+r*h-i*s,this._y=r*u+o*s+i*a-n*h,this._z=i*u+o*h+n*s-r*a,this._w=o*u-n*a-r*s-i*h,this.onChangeCallback(),this},multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=Math.acos(a),h=Math.sqrt(1-a*a);if(Math.abs(h)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this;var u=Math.sin((1-e)*s)/h,c=Math.sin(e*s)/h;return this._w=o*u+this._w*c,this._x=n*u+this._x*c,this._y=r*u+this._y*c,this._z=i*u+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new nt.Quaternion(this._x,this._y,this._z,this._w)}},nt.Quaternion.slerp=function(t,e,n,r){return n.copy(t).slerp(e,r)},nt.Vector2=function(t,e){this.x=t||0,this.y=e||0},nt.Vector2.prototype={constructor:nt.Vector2,set:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){if(0!==t){var e=1/t;this.x*=e,this.y*=e}else this.x=0,this.y=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this},clampScalar:function(t,e){return void 0===o&&(o=new nt.Vector2,a=new nt.Vector2),o.set(t,t),a.set(e,e),this.clamp(o,a)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},clone:function(){return new nt.Vector2(this.x,this.y)}},nt.Vector3=function(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0},nt.Vector3.prototype={constructor:nt.Vector3,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t instanceof nt.Euler==0&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===h&&(h=new nt.Quaternion),this.applyQuaternion(h.setFromEuler(t)),this},applyAxisAngle:function(){var t;return function(e,n){return void 0===t&&(t=new nt.Quaternion),this.applyQuaternion(t.setFromAxisAngle(e,n)),this}}(),applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r+i[12],this.y=i[1]*e+i[5]*n+i[9]*r+i[13],this.z=i[2]*e+i[6]*n+i[10]*r+i[14],this},applyProjection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,s=t.w,h=s*e+o*r-a*n,u=s*n+a*e-i*r,c=s*r+i*n-o*e,l=-i*e-o*n-a*r;return this.x=h*s+l*-i+u*-a-c*-o,this.y=u*s+l*-o+c*-i-h*-a,this.z=c*s+l*-a+h*-o-u*-i,this},project:function(t){return void 0===s&&(s=new nt.Matrix4),s.multiplyMatrices(t.projectionMatrix,s.getInverse(t.matrixWorld)),this.applyProjection(s)},unproject:function(){var t;return function(e){return void 0===t&&(t=new nt.Matrix4),t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyProjection(t)}}(),transformDirection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){if(0!==t){var e=1/t;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new nt.Vector3,e=new nt.Vector3),t.set(n,n,n),e.set(r,r,r),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var n=this.x,r=this.y,i=this.z;return this.x=r*t.z-i*t.y,this.y=i*t.x-n*t.z,this.z=n*t.y-r*t.x,this},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},projectOnVector:function(){var t,e;return function(n){return void 0===t&&(t=new nt.Vector3),t.copy(n).normalize(),e=this.dot(t),this.copy(t).multiplyScalar(e)}}(),projectOnPlane:function(){var t;return function(e){return void 0===t&&(t=new nt.Vector3),t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t;return function(e){return void 0===t&&(t=new nt.Vector3),this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/(this.length()*t.length());return Math.acos(nt.Math.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},setEulerFromRotationMatrix:function(t,e){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(t,e){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setFromMatrixScale:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),n=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),r=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){var n=4*t,r=e.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},clone:function(){return new nt.Vector3(this.x,this.y,this.z)}},nt.Vector4=function(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==r?r:1},nt.Vector4.prototype={constructor:nt.Vector4,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this},divideScalar:function(t){if(0!==t){var e=1/t;this.x*=e,this.y*=e,this.z*=e,this.w*=e}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,r,i,o=t.elements,a=o[0],s=o[4],h=o[8],u=o[1],c=o[5],l=o[9],f=o[2],p=o[6],d=o[10];if(Math.abs(s-u)<.01&&Math.abs(h-f)<.01&&Math.abs(l-p)<.01){if(Math.abs(s+u)<.1&&Math.abs(h+f)<.1&&Math.abs(l+p)<.1&&Math.abs(a+c+d-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(a+1)/2,g=(c+1)/2,v=(d+1)/2,y=(s+u)/4,x=(h+f)/4,_=(l+p)/4;return m>g&&m>v?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=x/n):g>v?g<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(g)),i=_/r):v<.01?(n=.707106781,r=.707106781,i=0):(n=x/(i=Math.sqrt(v)),r=_/i),this.set(n,r,i,e),this}var b=Math.sqrt((p-l)*(p-l)+(h-f)*(h-f)+(u-s)*(u-s));return Math.abs(b)<.001&&(b=1),this.x=(p-l)/b,this.y=(h-f)/b,this.z=(u-s)/b,this.w=Math.acos((a+c+d-1)/2),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this.w>t.w&&(this.w=t.w),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this.w<t.w&&(this.w=t.w),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this.w<t.w?this.w=t.w:this.w>e.w&&(this.w=e.w),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new nt.Vector4,e=new nt.Vector4),t.set(n,n,n,n),e.set(r,r,r,r),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},clone:function(){return new nt.Vector4(this.x,this.y,this.z,this.w)}},nt.Euler=function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||nt.Euler.DefaultOrder},nt.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],nt.Euler.DefaultOrder="XYZ",nt.Euler.prototype={constructor:nt.Euler,_x:0,_y:0,_z:0,_order:nt.Euler.DefaultOrder,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e){var n=nt.Math.clamp,r=t.elements,i=r[0],o=r[4],a=r[8],s=r[1],h=r[5],u=r[9],c=r[2],l=r[6],f=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(l,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(s,h)):(this._y=Math.atan2(-c,i),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(s,i))):"ZYX"===e?(this._y=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(l,f),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,h))):"YZX"===e?(this._z=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===e?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(l,h),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-u,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,this.onChangeCallback(),this},setFromQuaternion:function(t,e,n){var r=nt.Math.clamp,i=t.x*t.x,o=t.y*t.y,a=t.z*t.z,s=t.w*t.w;return"XYZ"===(e=e||this._order)?(this._x=Math.atan2(2*(t.x*t.w-t.y*t.z),s-i-o+a),this._y=Math.asin(r(2*(t.x*t.z+t.y*t.w),-1,1)),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),s+i-o-a)):"YXZ"===e?(this._x=Math.asin(r(2*(t.x*t.w-t.y*t.z),-1,1)),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),s-i-o+a),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),s-i+o-a)):"ZXY"===e?(this._x=Math.asin(r(2*(t.x*t.w+t.y*t.z),-1,1)),this._y=Math.atan2(2*(t.y*t.w-t.z*t.x),s-i-o+a),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),s-i+o-a)):"ZYX"===e?(this._x=Math.atan2(2*(t.x*t.w+t.z*t.y),s-i-o+a),this._y=Math.asin(r(2*(t.y*t.w-t.x*t.z),-1,1)),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),s+i-o-a)):"YZX"===e?(this._x=Math.atan2(2*(t.x*t.w-t.z*t.y),s-i+o-a),this._y=Math.atan2(2*(t.y*t.w-t.x*t.z),s+i-o-a),this._z=Math.asin(r(2*(t.x*t.y+t.z*t.w),-1,1))):"XZY"===e?(this._x=Math.atan2(2*(t.x*t.w+t.y*t.z),s-i+o-a),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),s+i-o-a),this._z=Math.asin(r(2*(t.z*t.w-t.x*t.y),-1,1))):console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+e),this._order=e,!1!==n&&this.onChangeCallback(),this},reorder:(u=new nt.Quaternion,function(t){u.setFromEuler(this),this.setFromQuaternion(u,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new nt.Euler(this._x,this._y,this._z,this._order)}},nt.Line3=function(t,e){this.start=void 0!==t?t:new nt.Vector3,this.end=void 0!==e?e:new nt.Vector3},nt.Line3.prototype={constructor:nt.Line3,set:function(t,e){return this.start.copy(t),this.end.copy(e),this},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},center:function(t){return(t||new nt.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new nt.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var n=e||new nt.Vector3;return this.delta(n).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(c=new nt.Vector3,l=new nt.Vector3,function(t,e){c.subVectors(t,this.start),l.subVectors(this.end,this.start);var n=l.dot(l),r=l.dot(c)/n;return e&&(r=nt.Math.clamp(r,0,1)),r}),closestPointToPoint:function(t,e,n){var r=this.closestPointToPointParameter(t,e),i=n||new nt.Vector3;return this.delta(i).multiplyScalar(r).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)},clone:function(){return(new nt.Line3).copy(this)}},nt.Box2=function(t,e){this.min=void 0!==t?t:new nt.Vector2(1/0,1/0),this.max=void 0!==e?e:new nt.Vector2(-1/0,-1/0)},nt.Box2.prototype={constructor:nt.Box2,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new nt.Vector2;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){return(t||new nt.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new nt.Vector2).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return(e||new nt.Vector2).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return(e||new nt.Vector2).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new nt.Vector2;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new nt.Box2).copy(this)}},nt.Box3=function(t,e){this.min=void 0!==t?t:new nt.Vector3(1/0,1/0,1/0),this.max=void 0!==e?e:new nt.Vector3(-1/0,-1/0,-1/0)},nt.Box3.prototype={constructor:nt.Box3,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new nt.Vector3;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(){var t=new nt.Vector3;return function(e){var n=this;return e.updateMatrixWorld(!0),this.makeEmpty(),e.traverse(function(e){var r=e.geometry;if(void 0!==r)if(r instanceof nt.Geometry)for(var i=r.vertices,o=0,a=i.length;o<a;o++)t.copy(i[o]),t.applyMatrix4(e.matrixWorld),n.expandByPoint(t);else if(r instanceof nt.BufferGeometry&&void 0!==r.attributes.position){var s=r.attributes.position.array;for(o=0,a=s.length;o<a;o+=3)t.set(s[o],s[o+1],s[o+2]),t.applyMatrix4(e.matrixWorld),n.expandByPoint(t)}}),this}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new nt.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new nt.Vector3).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new nt.Vector3).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},clampPoint:function(t,e){return(e||new nt.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new nt.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new nt.Vector3;return function(e){var n=e||new nt.Sphere;return n.center=this.center(),n.radius=.5*this.size(t).length(),n}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(f=[new nt.Vector3,new nt.Vector3,new nt.Vector3,new nt.Vector3,new nt.Vector3,new nt.Vector3,new nt.Vector3,new nt.Vector3],function(t){return f[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),f[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),f[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),f[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),f[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),f[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),f[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),f[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(f),this}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},clone:function(){return(new nt.Box3).copy(this)}},nt.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},nt.Matrix3.prototype={constructor:nt.Matrix3,set:function(t,e,n,r,i,o,a,s,h){var u=this.elements;return u[0]=t,u[3]=e,u[6]=n,u[1]=r,u[4]=i,u[7]=o,u[2]=a,u[5]=s,u[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToVector3Array:function(){var t=new nt.Vector3;return function(e,n,r){void 0===n&&(n=0),void 0===r&&(r=e.length);for(var i=0,o=n;i<r;i+=3,o+=3)t.x=e[o],t.y=e[o+1],t.z=e[o+2],t.applyMatrix3(this),e[o]=t.x,e[o+1]=t.y,e[o+2]=t.z;return e}}(),multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],h=t[7],u=t[8];return e*o*u-e*a*h-n*i*u+n*a*s+r*i*h-r*o*s},getInverse:function(t,e){var n=t.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4];var i=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(0===i){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},flattenToArrayOffset:function(t,e){var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t},getNormalMatrix:function(t){return this.getInverse(t).transpose(),this},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},clone:function(){return(new nt.Matrix3).fromArray(this.elements)}},nt.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},nt.Matrix4.prototype={constructor:nt.Matrix4,set:function(t,e,n,r,i,o,a,s,h,u,c,l,f,p,d,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=h,g[6]=u,g[10]=c,g[14]=l,g[3]=f,g[7]=p,g[11]=d,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){return this.elements.set(t.elements),this},extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractRotation:function(){var t=new nt.Vector3;return function(e){var n=this.elements,r=e.elements,i=1/t.set(r[0],r[1],r[2]).length(),o=1/t.set(r[4],r[5],r[6]).length(),a=1/t.set(r[8],r[9],r[10]).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[4]=r[4]*o,n[5]=r[5]*o,n[6]=r[6]*o,n[8]=r[8]*a,n[9]=r[9]*a,n[10]=r[10]*a,this}}(),makeRotationFromEuler:function(t){t instanceof nt.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),h=Math.sin(r),u=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){var l=o*u,f=o*c,p=a*u,d=a*c;e[0]=s*u,e[4]=-s*c,e[8]=h,e[1]=f+p*h,e[5]=l-d*h,e[9]=-a*s,e[2]=d-l*h,e[6]=p+f*h,e[10]=o*s}else if("YXZ"===t.order){var m=s*u,g=s*c,v=h*u,y=h*c;e[0]=m+y*a,e[4]=v*a-g,e[8]=o*h,e[1]=o*c,e[5]=o*u,e[9]=-a,e[2]=g*a-v,e[6]=y+m*a,e[10]=o*s}else if("ZXY"===t.order){m=s*u,g=s*c,v=h*u,y=h*c;e[0]=m-y*a,e[4]=-o*c,e[8]=v+g*a,e[1]=g+v*a,e[5]=o*u,e[9]=y-m*a,e[2]=-o*h,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){l=o*u,f=o*c,p=a*u,d=a*c;e[0]=s*u,e[4]=p*h-f,e[8]=l*h+d,e[1]=s*c,e[5]=d*h+l,e[9]=f*h-p,e[2]=-h,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var x=o*s,_=o*h,b=a*s,w=a*h;e[0]=s*u,e[4]=w-x*c,e[8]=b*c+_,e[1]=c,e[5]=o*u,e[9]=-a*u,e[2]=-h*u,e[6]=_*c+b,e[10]=x-w*c}else if("XZY"===t.order){x=o*s,_=o*h,b=a*s,w=a*h;e[0]=s*u,e[4]=-c,e[8]=h*u,e[1]=x*c+w,e[5]=o*u,e[9]=_*c-b,e[2]=b*c-_,e[6]=a*u,e[10]=w*c+x}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},makeRotationFromQuaternion:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z,o=t.w,a=n+n,s=r+r,h=i+i,u=n*a,c=n*s,l=n*h,f=r*s,p=r*h,d=i*h,m=o*a,g=o*s,v=o*h;return e[0]=1-(f+d),e[4]=c-v,e[8]=l+g,e[1]=c+v,e[5]=1-(u+d),e[9]=p-m,e[2]=l-g,e[6]=p+m,e[10]=1-(u+f),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:(p=new nt.Vector3,d=new nt.Vector3,m=new nt.Vector3,function(t,e,n){var r=this.elements;return m.subVectors(t,e).normalize(),0===m.length()&&(m.z=1),p.crossVectors(n,m).normalize(),0===p.length()&&(m.x+=1e-4,p.crossVectors(n,m).normalize()),d.crossVectors(m,p),r[0]=p.x,r[4]=d.x,r[8]=m.x,r[1]=p.y,r[5]=d.y,r[9]=m.y,r[2]=p.z,r[6]=d.z,r[10]=m.z,this}),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],s=n[8],h=n[12],u=n[1],c=n[5],l=n[9],f=n[13],p=n[2],d=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],_=n[15],b=r[0],w=r[4],M=r[8],A=r[12],S=r[1],C=r[5],T=r[9],E=r[13],L=r[2],P=r[6],D=r[10],R=r[14],F=r[3],k=r[7],B=r[11],z=r[15];return i[0]=o*b+a*S+s*L+h*F,i[4]=o*w+a*C+s*P+h*k,i[8]=o*M+a*T+s*D+h*B,i[12]=o*A+a*E+s*R+h*z,i[1]=u*b+c*S+l*L+f*F,i[5]=u*w+c*C+l*P+f*k,i[9]=u*M+c*T+l*D+f*B,i[13]=u*A+c*E+l*R+f*z,i[2]=p*b+d*S+m*L+g*F,i[6]=p*w+d*C+m*P+g*k,i[10]=p*M+d*T+m*D+g*B,i[14]=p*A+d*E+m*R+g*z,i[3]=v*b+y*S+x*L+_*F,i[7]=v*w+y*C+x*P+_*k,i[11]=v*M+y*T+x*D+_*B,i[15]=v*A+y*E+x*R+_*z,this},multiplyToArray:function(t,e,n){var r=this.elements;return this.multiplyMatrices(t,e),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),t.applyProjection(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToVector3Array:function(){var t=new nt.Vector3;return function(e,n,r){void 0===n&&(n=0),void 0===r&&(r=e.length);for(var i=0,o=n;i<r;i+=3,o+=3)t.x=e[o],t.y=e[o+1],t.z=e[o+2],t.applyMatrix4(this),e[o]=t.x,e[o+1]=t.y,e[o+2]=t.z;return e}}(),rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],h=t[13],u=t[2],c=t[6],l=t[10],f=t[14];return t[3]*(+i*s*c-r*h*c-i*a*l+n*h*l+r*a*f-n*s*f)+t[7]*(+e*s*f-e*h*l+i*o*l-r*o*f+r*h*u-i*s*u)+t[11]*(+e*h*c-e*a*f-i*o*c+n*o*f+i*a*u-n*h*u)+t[15]*(-r*a*u-e*s*c+e*a*l+r*o*c-n*o*l+n*s*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(t,e){var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},getPosition:function(){var t=new nt.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var n=this.elements,r=t.elements,i=r[0],o=r[4],a=r[8],s=r[12],h=r[1],u=r[5],c=r[9],l=r[13],f=r[2],p=r[6],d=r[10],m=r[14],g=r[3],v=r[7],y=r[11],x=r[15];n[0]=c*m*v-l*d*v+l*p*y-u*m*y-c*p*x+u*d*x,n[4]=s*d*v-a*m*v-s*p*y+o*m*y+a*p*x-o*d*x,n[8]=a*l*v-s*c*v+s*u*y-o*l*y-a*u*x+o*c*x,n[12]=s*c*p-a*l*p-s*u*d+o*l*d+a*u*m-o*c*m,n[1]=l*d*g-c*m*g-l*f*y+h*m*y+c*f*x-h*d*x,n[5]=a*m*g-s*d*g+s*f*y-i*m*y-a*f*x+i*d*x,n[9]=s*c*g-a*l*g-s*h*y+i*l*y+a*h*x-i*c*x,n[13]=a*l*f-s*c*f+s*h*d-i*l*d-a*h*m+i*c*m,n[2]=u*m*g-l*p*g+l*f*v-h*m*v-u*f*x+h*p*x,n[6]=s*p*g-o*m*g-s*f*v+i*m*v+o*f*x-i*p*x,n[10]=o*l*g-s*u*g+s*h*v-i*l*v-o*h*x+i*u*x,n[14]=s*u*f-o*l*f-s*h*p+i*l*p+o*h*m-i*u*m,n[3]=c*p*g-u*d*g-c*f*v+h*d*v+u*f*y-h*p*y,n[7]=o*d*g-a*p*g+a*f*v-i*d*v-o*f*y+i*p*y,n[11]=a*u*g-o*c*g-a*h*v+i*c*v+o*h*y-i*u*y,n[15]=o*c*f-a*u*f+a*h*p-i*c*p-o*h*d+i*u*d;var _=i*n[0]+h*n[4]+f*n[8]+g*n[12];if(0==_){var b="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(b);return console.warn(b),this.identity(),this}return this.multiplyScalar(1/_),this},translate:function(t){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(t){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(t){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(t){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(t,e){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,Math.max(n,r)))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,s=t.z,h=i*o,u=i*a;return this.set(h*o+n,h*a-r*s,h*s+r*a,0,h*a+r*s,u*a+n,u*s-r*o,0,h*s-r*a,u*s+r*o,i*s*s+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},compose:function(t,e,n){return this.makeRotationFromQuaternion(e),this.scale(n),this.setPosition(t),this},decompose:function(){var t=new nt.Vector3,e=new nt.Matrix4;return function(n,r,i){var o=this.elements,a=t.set(o[0],o[1],o[2]).length(),s=t.set(o[4],o[5],o[6]).length(),h=t.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),n.x=o[12],n.y=o[13],n.z=o[14],e.elements.set(this.elements);var u=1/a,c=1/s,l=1/h;return e.elements[0]*=u,e.elements[1]*=u,e.elements[2]*=u,e.elements[4]*=c,e.elements[5]*=c,e.elements[6]*=c,e.elements[8]*=l,e.elements[9]*=l,e.elements[10]*=l,r.setFromRotationMatrix(e),i.x=a,i.y=s,i.z=h,this}}(),makeFrustum:function(t,e,n,r,i,o){var a=this.elements,s=2*i/(e-t),h=2*i/(r-n),u=(e+t)/(e-t),c=(r+n)/(r-n),l=-(o+i)/(o-i),f=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=h,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=l,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(t,e,n,r){var i=n*Math.tan(nt.Math.degToRad(.5*t)),o=-i,a=o*e,s=i*e;return this.makeFrustum(a,s,o,i,n,r)},makeOrthographic:function(t,e,n,r,i,o){var a=this.elements,s=e-t,h=n-r,u=o-i,c=(e+t)/s,l=(n+r)/h,f=(o+i)/u;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-l,a[2]=0,a[6]=0,a[10]=-2/u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},clone:function(){return(new nt.Matrix4).fromArray(this.elements)}},nt.Ray=function(t,e){this.origin=void 0!==t?t:new nt.Vector3,this.direction=void 0!==e?e:new nt.Vector3},nt.Ray.prototype={constructor:nt.Ray,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new nt.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new nt.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var n=e||new nt.Vector3;n.subVectors(t,this.origin);var r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var t=new nt.Vector3;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceTo(e):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceTo(e))}}(),distanceSqToSegment:function(t,e,n,r){var i,o,a,s,h=t.clone().add(e).multiplyScalar(.5),u=e.clone().sub(t).normalize(),c=.5*t.distanceTo(e),l=this.origin.clone().sub(h),f=-this.direction.dot(u),p=l.dot(this.direction),d=-l.dot(u),m=l.lengthSq(),g=Math.abs(1-f*f);if(g>=0)if(o=f*p-d,s=c*g,(i=f*d-p)>=0)if(o>=-s)if(o<=s){var v=1/g;a=(i*=v)*(i+f*(o*=v)+2*p)+o*(f*i+o+2*d)+m}else o=c,a=-(i=Math.max(0,-(f*o+p)))*i+o*(o+2*d)+m;else o=-c,a=-(i=Math.max(0,-(f*o+p)))*i+o*(o+2*d)+m;else o<=-s?a=-(i=Math.max(0,-(-f*c+p)))*i+(o=i>0?-c:Math.min(Math.max(-c,-d),c))*(o+2*d)+m:o<=s?(i=0,a=(o=Math.min(Math.max(-c,-d),c))*(o+2*d)+m):a=-(i=Math.max(0,-(f*c+p)))*i+(o=i>0?c:Math.min(Math.max(-c,-d),c))*(o+2*d)+m;else o=f>0?-c:c,a=-(i=Math.max(0,-(f*o+p)))*i+o*(o+2*d)+m;return n&&n.copy(this.direction.clone().multiplyScalar(i).add(this.origin)),r&&r.copy(u.clone().multiplyScalar(o).add(h)),a},isIntersectionSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},intersectSphere:function(){var t=new nt.Vector3;return function(e,n){t.subVectors(e.center,this.origin);var r=t.dot(this.direction),i=t.dot(t)-r*r,o=e.radius*e.radius;if(i>o)return null;var a=Math.sqrt(o-i),s=r-a,h=r+a;return s<0&&h<0?null:s<0?this.at(h,n):this.at(s,n)}}(),isIntersectionPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0==e)return 0==t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},isIntersectionBox:(_=new nt.Vector3,function(t){return null!==this.intersectBox(t,_)}),intersectBox:function(t,e){var n,r,i,o,a,s,h=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,l=this.origin;return h>=0?(n=(t.min.x-l.x)*h,r=(t.max.x-l.x)*h):(n=(t.max.x-l.x)*h,r=(t.min.x-l.x)*h),u>=0?(i=(t.min.y-l.y)*u,o=(t.max.y-l.y)*u):(i=(t.max.y-l.y)*u,o=(t.min.y-l.y)*u),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),c>=0?(a=(t.min.z-l.z)*c,s=(t.max.z-l.z)*c):(a=(t.max.z-l.z)*c,s=(t.min.z-l.z)*c),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))},intersectTriangle:(g=new nt.Vector3,v=new nt.Vector3,y=new nt.Vector3,x=new nt.Vector3,function(t,e,n,r,i){v.subVectors(e,t),y.subVectors(n,t),x.crossVectors(v,y);var o,a=this.direction.dot(x);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}g.subVectors(this.origin,t);var s=o*this.direction.dot(y.crossVectors(g,y));if(s<0)return null;var h=o*this.direction.dot(v.cross(g));if(h<0)return null;if(s+h>a)return null;var u=-o*g.dot(x);return u<0?null:this.at(u/a,i)}),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},clone:function(){return(new nt.Ray).copy(this)}},nt.Sphere=function(t,e){this.center=void 0!==t?t:new nt.Vector3,this.radius=void 0!==e?e:0},nt.Sphere.prototype={constructor:nt.Sphere,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:(b=new nt.Box3,function(t,e){var n=this.center;void 0!==e?n.copy(e):b.setFromPoints(t).center(n);for(var r=0,i=0,o=t.length;i<o;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this}),copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},clampPoint:function(t,e){var n=this.center.distanceToSquared(t),r=e||new nt.Vector3;return r.copy(t),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){var e=t||new nt.Box3;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius},clone:function(){return(new nt.Sphere).copy(this)}},nt.Frustum=function(t,e,n,r,i,o){this.planes=[void 0!==t?t:new nt.Plane,void 0!==e?e:new nt.Plane,void 0!==n?n:new nt.Plane,void 0!==r?r:new nt.Plane,void 0!==i?i:new nt.Plane,void 0!==o?o:new nt.Plane]},nt.Frustum.prototype={constructor:nt.Frustum,set:function(t,e,n,r,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},copy:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromMatrix:function(t){var e=this.planes,n=t.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],h=n[5],u=n[6],c=n[7],l=n[8],f=n[9],p=n[10],d=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(a-r,c-s,d-l,y-m).normalize(),e[1].setComponents(a+r,c+s,d+l,y+m).normalize(),e[2].setComponents(a+i,c+h,d+f,y+g).normalize(),e[3].setComponents(a-i,c-h,d-f,y-g).normalize(),e[4].setComponents(a-o,c-u,d-p,y-v).normalize(),e[5].setComponents(a+o,c+u,d+p,y+v).normalize(),this},intersectsObject:(A=new nt.Sphere,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),A.copy(e.boundingSphere),A.applyMatrix4(t.matrixWorld),this.intersectsSphere(A)}),intersectsSphere:function(t){for(var e=this.planes,n=t.center,r=-t.radius,i=0;i<6;i++){if(e[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:(w=new nt.Vector3,M=new nt.Vector3,function(t){for(var e=this.planes,n=0;n<6;n++){var r=e[n];w.x=r.normal.x>0?t.min.x:t.max.x,M.x=r.normal.x>0?t.max.x:t.min.x,w.y=r.normal.y>0?t.min.y:t.max.y,M.y=r.normal.y>0?t.max.y:t.min.y,w.z=r.normal.z>0?t.min.z:t.max.z,M.z=r.normal.z>0?t.max.z:t.min.z;var i=r.distanceToPoint(w),o=r.distanceToPoint(M);if(i<0&&o<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0},clone:function(){return(new nt.Frustum).copy(this)}},nt.Plane=function(t,e){this.normal=void 0!==t?t:new nt.Vector3(1,0,0),this.constant=void 0!==e?e:0},nt.Plane.prototype={constructor:nt.Plane,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new nt.Vector3,e=new nt.Vector3;return function(n,r,i){var o=t.subVectors(i,r).cross(e.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var n=this.distanceToPoint(t);return(e||new nt.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectLine:function(){var t=new nt.Vector3;return function(e,n){var r=n||new nt.Vector3,i=e.delta(t),o=this.normal.dot(i);if(0==o)return 0==this.distanceToPoint(e.start)?r.copy(e.start):void 0;var a=-(e.start.dot(this.normal)+this.constant)/o;return a<0||a>1?void 0:r.copy(i).multiplyScalar(a).add(e.start)}}(),coplanarPoint:function(t){return(t||new nt.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new nt.Vector3,e=new nt.Vector3,n=new nt.Matrix3;return function(r,i){var o=i||n.getNormalMatrix(r),a=t.copy(this.normal).applyMatrix3(o),s=this.coplanarPoint(e);return s.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(a,s),this}}(),translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant==this.constant},clone:function(){return(new nt.Plane).copy(this)}},nt.Math={generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),r=0;return function(){for(var i=0;i<36;i++)8==i||13==i||18==i||23==i?n[i]="-":14==i?n[i]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),t=15&r,r>>=4,n[i]=e[19==i?3&t|8:t]);return n.join("")}}(),clamp:function(t,e,n){return t<e?e:t>n?n:t},clampBottom:function(t,e){return t<e?e:t},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:(C=Math.PI/180,function(t){return t*C}),radToDeg:(S=180/Math.PI,function(t){return t*S}),isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t}},nt.Spline=function(t){this.points=t;var e,n,r,i,o,a,s,h,u,c=[],l={x:0,y:0,z:0};function f(t,e,n,r,i,o,a){var s=.5*(n-t),h=.5*(r-e);return(2*(e-n)+s+h)*a+(-3*(e-n)-2*s-h)*o+s*i+e}this.initFromArray=function(t){this.points=[];for(var e=0;e<t.length;e++)this.points[e]={x:t[e][0],y:t[e][1],z:t[e][2]}},this.getPoint=function(t){return e=(this.points.length-1)*t,n=Math.floor(e),r=e-n,c[0]=0===n?n:n-1,c[1]=n,c[2]=n>this.points.length-2?this.points.length-1:n+1,c[3]=n>this.points.length-3?this.points.length-1:n+2,a=this.points[c[0]],s=this.points[c[1]],h=this.points[c[2]],u=this.points[c[3]],o=r*(i=r*r),l.x=f(a.x,s.x,h.x,u.x,r,i,o),l.y=f(a.y,s.y,h.y,u.y,r,i,o),l.z=f(a.z,s.z,h.z,u.z,r,i,o),l},this.getControlPointsArray=function(){var t,e,n=this.points.length,r=[];for(t=0;t<n;t++)e=this.points[t],r[t]=[e.x,e.y,e.z];return r},this.getLength=function(t){var e,n,r,i,o=0,a=0,s=0,h=new nt.Vector3,u=new nt.Vector3,c=[],l=0;for(c[0]=0,t||(t=100),r=this.points.length*t,h.copy(this.points[0]),e=1;e<r;e++)n=e/r,i=this.getPoint(n),u.copy(i),l+=u.distanceTo(h),h.copy(i),o=(this.points.length-1)*n,(a=Math.floor(o))!=s&&(c[a]=l,s=a);return c[c.length]=l,{chunks:c,total:l}},this.reparametrizeByArcLength=function(t){var e,n,r,i,o,a,s,h,u=[],c=new nt.Vector3,l=this.getLength();for(u.push(c.copy(this.points[0]).clone()),e=1;e<this.points.length;e++){for(a=l.chunks[e]-l.chunks[e-1],s=Math.ceil(t*a/l.total),i=(e-1)/(this.points.length-1),o=e/(this.points.length-1),n=1;n<s-1;n++)r=i+n*(1/s)*(o-i),h=this.getPoint(r),u.push(c.copy(h).clone());u.push(c.copy(this.points[e]).clone())}this.points=u}},nt.Triangle=function(t,e,n){this.a=void 0!==t?t:new nt.Vector3,this.b=void 0!==e?e:new nt.Vector3,this.c=void 0!==n?n:new nt.Vector3},nt.Triangle.normal=(T=new nt.Vector3,function(t,e,n,r){var i=r||new nt.Vector3;i.subVectors(n,e),T.subVectors(t,e),i.cross(T);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}),nt.Triangle.barycoordFromPoint=function(){var t=new nt.Vector3,e=new nt.Vector3,n=new nt.Vector3;return function(r,i,o,a,s){t.subVectors(a,i),e.subVectors(o,i),n.subVectors(r,i);var h=t.dot(t),u=t.dot(e),c=t.dot(n),l=e.dot(e),f=e.dot(n),p=h*l-u*u,d=s||new nt.Vector3;if(0==p)return d.set(-2,-1,-1);var m=1/p,g=(l*c-u*f)*m,v=(h*f-u*c)*m;return d.set(1-g-v,v,g)}}(),nt.Triangle.containsPoint=function(){var t=new nt.Vector3;return function(e,n,r,i){var o=nt.Triangle.barycoordFromPoint(e,n,r,i,t);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),nt.Triangle.prototype={constructor:nt.Triangle,set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new nt.Vector3,e=new nt.Vector3;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){return(t||new nt.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return nt.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new nt.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return nt.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return nt.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)},clone:function(){return(new nt.Triangle).copy(this)}},nt.Clock=function(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},nt.Clock.prototype={constructor:nt.Clock,start:function(){this.startTime=void 0!==et.performance&&void 0!==et.performance.now?et.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running&&this.start(),this.running){var e=void 0!==et.performance&&void 0!==et.performance.now?et.performance.now():Date.now();t=.001*(e-this.oldTime),this.oldTime=e,this.elapsedTime+=t}return t}},nt.EventDispatcher=function(){},nt.EventDispatcher.prototype={constructor:nt.EventDispatcher,apply:function(t){t.addEventListener=nt.EventDispatcher.prototype.addEventListener,t.hasEventListener=nt.EventDispatcher.prototype.hasEventListener,t.removeEventListener=nt.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=nt.EventDispatcher.prototype.dispatchEvent},addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=[],r=e.length,i=0;i<r;i++)n[i]=e[i];for(i=0;i<r;i++)n[i].call(this,t)}}}},function(t){t.Raycaster=function(e,n,r,i){this.ray=new t.Ray(e,n),this.near=r||0,this.far=i||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var e=function(t,e){return t.distance-e.distance},n=function(t,e,r,i){if(t.raycast(e,r),!0===i)for(var o=t.children,a=0,s=o.length;a<s;a++)n(o[a],e,r,!0)};t.Raycaster.prototype={constructor:t.Raycaster,precision:1e-4,linePrecision:1,set:function(t,e){this.ray.set(t,e)},intersectObject:function(t,r){var i=[];return n(t,this,i,r),i.sort(e),i},intersectObjects:function(t,r){var i=[];if(t instanceof Array==!1)return console.log("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var o=0,a=t.length;o<a;o++)n(t[o],this,i,r);return i.sort(e),i}}}(nt),nt.Object3D=function(){Object.defineProperty(this,"id",{value:nt.Object3DIdCount++}),this.uuid=nt.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=nt.Object3D.DefaultUp.clone();var t=new nt.Vector3,e=new nt.Euler,n=new nt.Quaternion,r=new nt.Vector3(1,1,1);e.onChange(function(){n.setFromEuler(e,!1)}),n.onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r}}),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new nt.Matrix4,this.matrixWorld=new nt.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},nt.Object3D.DefaultUp=new nt.Vector3(0,1,0),nt.Object3D.prototype={constructor:nt.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(t){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=t},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(t){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(D=new nt.Quaternion,function(t,e){return D.setFromAxisAngle(t,e),this.quaternion.multiply(D),this}),rotateX:function(){var t=new nt.Vector3(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new nt.Vector3(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new nt.Vector3(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new nt.Vector3;return function(e,n){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},translateX:function(){var t=new nt.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new nt.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new nt.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(P=new nt.Matrix4,function(t){return t.applyMatrix4(P.getInverse(this.matrixWorld))}),lookAt:function(){var t=new nt.Matrix4;return function(e){t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add:",t,"can't be added as a child of itself."),this):(t instanceof nt.Object3D?(void 0!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add:",t,"is not an instance of THREE.Object3D."),this)},remove:function(t){if(arguments.length>1)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);var n=this.children.indexOf(t);-1!==n&&(t.parent=void 0,t.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getChildByName:function(t,e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t,e)},getObjectById:function(t,e){if(this.id===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectById(t,e);if(void 0!==i)return i}},getObjectByName:function(t,e){if(this.name===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByName(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){var e=t||new nt.Vector3;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(E=new nt.Vector3,L=new nt.Vector3,function(t){var e=t||new nt.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(E,e,L),e}),getWorldRotation:function(){var t=new nt.Quaternion;return function(e){var n=e||new nt.Euler;return this.getWorldQuaternion(t),n.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new nt.Vector3,e=new nt.Quaternion;return function(n){var r=n||new nt.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,r),r}}(),getWorldDirection:function(){var t=new nt.Quaternion;return function(e){var n=e||new nt.Vector3;return this.getWorldQuaternion(t),n.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=0,n=this.children.length;e<n;e++)this.children[e].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=0,n=this.children.length;e<n;e++)this.children[e].traverseVisible(t)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==t||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,n=this.children.length;e<n;e++)this.children[e].updateMatrixWorld(t)},toJSON:function(){var t={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},e={},n=function(n){if(void 0===t.geometries&&(t.geometries=[]),void 0===e[n.uuid]){var r=n.toJSON();delete r.metadata,e[n.uuid]=r,t.geometries.push(r)}return n.uuid},r={},i=function(e){if(void 0===t.materials&&(t.materials=[]),void 0===r[e.uuid]){var n=e.toJSON();delete n.metadata,r[e.uuid]=n,t.materials.push(n)}return e.uuid},o=function(t){var e={};if(e.uuid=t.uuid,e.type=t.type,""!==t.name&&(e.name=t.name),"{}"!==JSON.stringify(t.userData)&&(e.userData=t.userData),!0!==t.visible&&(e.visible=t.visible),t instanceof nt.PerspectiveCamera?(e.fov=t.fov,e.aspect=t.aspect,e.near=t.near,e.far=t.far):t instanceof nt.OrthographicCamera?(e.left=t.left,e.right=t.right,e.top=t.top,e.bottom=t.bottom,e.near=t.near,e.far=t.far):t instanceof nt.AmbientLight?e.color=t.color.getHex():t instanceof nt.DirectionalLight?(e.color=t.color.getHex(),e.intensity=t.intensity):t instanceof nt.PointLight?(e.color=t.color.getHex(),e.intensity=t.intensity,e.distance=t.distance):t instanceof nt.SpotLight?(e.color=t.color.getHex(),e.intensity=t.intensity,e.distance=t.distance,e.angle=t.angle,e.exponent=t.exponent):t instanceof nt.HemisphereLight?(e.color=t.color.getHex(),e.groundColor=t.groundColor.getHex()):t instanceof nt.Mesh?(e.geometry=n(t.geometry),e.material=i(t.material)):t instanceof nt.Line?(e.geometry=n(t.geometry),e.material=i(t.material)):t instanceof nt.Sprite&&(e.material=i(t.material)),e.matrix=t.matrix.toArray(),t.children.length>0){e.children=[];for(var r=0;r<t.children.length;r++)e.children.push(o(t.children[r]))}return e};return t.object=o(this),t},clone:function(t,e){if(void 0===t&&(t=new nt.Object3D),void 0===e&&(e=!0),t.name=this.name,t.up.copy(this.up),t.position.copy(this.position),t.quaternion.copy(this.quaternion),t.scale.copy(this.scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.matrixWorld.copy(this.matrixWorld),t.matrixAutoUpdate=this.matrixAutoUpdate,t.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,t.visible=this.visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.userData=JSON.parse(JSON.stringify(this.userData)),!0===e)for(var n=0;n<this.children.length;n++){var r=this.children[n];t.add(r.clone())}return t}},nt.EventDispatcher.prototype.apply(nt.Object3D.prototype),nt.Object3DIdCount=0,nt.Projector=function(){console.warn("THREE.Projector has been moved to /examples/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(t,e){console.error("THREE.Projector: .pickingRay() has been removed.")}},nt.Face3=function(t,e,n,r,i,o){this.a=t,this.b=e,this.c=n,this.normal=r instanceof nt.Vector3?r:new nt.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof nt.Color?i:new nt.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},nt.Face3.prototype={constructor:nt.Face3,clone:function(){var t=new nt.Face3(this.a,this.b,this.c);t.normal.copy(this.normal),t.color.copy(this.color),t.materialIndex=this.materialIndex;for(var e=0,n=this.vertexNormals.length;e<n;e++)t.vertexNormals[e]=this.vertexNormals[e].clone();for(e=0,n=this.vertexColors.length;e<n;e++)t.vertexColors[e]=this.vertexColors[e].clone();for(e=0,n=this.vertexTangents.length;e<n;e++)t.vertexTangents[e]=this.vertexTangents[e].clone();return t}},nt.Face4=function(t,e,n,r,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new nt.Face3(t,e,n,i,o,a)},nt.BufferAttribute=function(t,e){this.array=t,this.itemSize=e,this.needsUpdate=!1},nt.BufferAttribute.prototype={constructor:nt.BufferAttribute,get length(){return this.array.length},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r]},set:function(t){return this.array.set(t),this},setX:function(t,e){return this.array[t*this.itemSize]=e,this},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},clone:function(){return new nt.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},nt.Int8Attribute=function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new nt.BufferAttribute(t,e)},nt.Uint8Attribute=function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new nt.BufferAttribute(t,e)},nt.Uint8ClampedAttribute=function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new nt.BufferAttribute(t,e)},nt.Int16Attribute=function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new nt.BufferAttribute(t,e)},nt.Uint16Attribute=function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new nt.BufferAttribute(t,e)},nt.Int32Attribute=function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new nt.BufferAttribute(t,e)},nt.Uint32Attribute=function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new nt.BufferAttribute(t,e)},nt.Float32Attribute=function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new nt.BufferAttribute(t,e)},nt.Float64Attribute=function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new nt.BufferAttribute(t,e)},nt.BufferGeometry=function(){Object.defineProperty(this,"id",{value:nt.GeometryIdCount++}),this.uuid=nt.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},nt.BufferGeometry.prototype={constructor:nt.BufferGeometry,addAttribute:function(t,e){if(e instanceof nt.BufferAttribute==!1)return console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[t]={array:arguments[1],itemSize:arguments[2]});this.attributes[t]=e,this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(t){return this.attributes[t]},addDrawCall:function(t,e,n){this.drawcalls.push({start:t,count:e,index:void 0!==n?n:0})},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToVector3Array(e.array),e.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&((new nt.Matrix3).getNormalMatrix(t).applyToVector3Array(n.array),n.needsUpdate=!0)},center:function(){},fromGeometry:function(t,e){e=e||{vertexColors:nt.NoColors};var n=t.vertices,r=t.faces,i=t.faceVertexUvs,o=e.vertexColors,a=i[0].length>0,s=3==r[0].vertexNormals.length,h=new Float32Array(3*r.length*3);this.addAttribute("position",new nt.BufferAttribute(h,3));var u=new Float32Array(3*r.length*3);if(this.addAttribute("normal",new nt.BufferAttribute(u,3)),o!==nt.NoColors){var c=new Float32Array(3*r.length*3);this.addAttribute("color",new nt.BufferAttribute(c,3))}if(!0===a){var l=new Float32Array(3*r.length*2);this.addAttribute("uv",new nt.BufferAttribute(l,2))}for(var f=0,p=0,d=0;f<r.length;f++,p+=6,d+=9){var m=r[f],g=n[m.a],v=n[m.b],y=n[m.c];if(h[d]=g.x,h[d+1]=g.y,h[d+2]=g.z,h[d+3]=v.x,h[d+4]=v.y,h[d+5]=v.z,h[d+6]=y.x,h[d+7]=y.y,h[d+8]=y.z,!0===s){var x=m.vertexNormals[0],_=m.vertexNormals[1],b=m.vertexNormals[2];u[d]=x.x,u[d+1]=x.y,u[d+2]=x.z,u[d+3]=_.x,u[d+4]=_.y,u[d+5]=_.z,u[d+6]=b.x,u[d+7]=b.y,u[d+8]=b.z}else{var w=m.normal;u[d]=w.x,u[d+1]=w.y,u[d+2]=w.z,u[d+3]=w.x,u[d+4]=w.y,u[d+5]=w.z,u[d+6]=w.x,u[d+7]=w.y,u[d+8]=w.z}if(o===nt.FaceColors){var M=m.color;c[d]=M.r,c[d+1]=M.g,c[d+2]=M.b,c[d+3]=M.r,c[d+4]=M.g,c[d+5]=M.b,c[d+6]=M.r,c[d+7]=M.g,c[d+8]=M.b}else if(o===nt.VertexColors){var A=m.vertexColors[0],S=m.vertexColors[1],C=m.vertexColors[2];c[d]=A.r,c[d+1]=A.g,c[d+2]=A.b,c[d+3]=S.r,c[d+4]=S.g,c[d+5]=S.b,c[d+6]=C.r,c[d+7]=C.g,c[d+8]=C.b}if(!0===a){var T=i[0][f][0],E=i[0][f][1],L=i[0][f][2];l[p]=T.x,l[p+1]=T.y,l[p+2]=E.x,l[p+3]=E.y,l[p+4]=L.x,l[p+5]=L.y}}return this.computeBoundingSphere(),this},computeBoundingBox:(R=new nt.Vector3,function(){null===this.boundingBox&&(this.boundingBox=new nt.Box3);var t=this.attributes.position.array;if(t){var e=this.boundingBox;e.makeEmpty();for(var n=0,r=t.length;n<r;n+=3)R.set(t[n],t[n+1],t[n+2]),e.expandByPoint(R)}void 0!==t&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}),computeBoundingSphere:function(){var t=new nt.Box3,e=new nt.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new nt.Sphere);var n=this.attributes.position.array;if(n){t.makeEmpty();for(var r=this.boundingSphere.center,i=0,o=n.length;i<o;i+=3)e.set(n[i],n[i+1],n[i+2]),t.expandByPoint(e);t.center(r);var a=0;for(i=0,o=n.length;i<o;i+=3)e.set(n[i],n[i+1],n[i+2]),a=Math.max(a,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.attributes;if(t.position){var e=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new nt.BufferAttribute(new Float32Array(e.length),3));else for(var n=0,r=(s=t.normal.array).length;n<r;n++)s[n]=0;var i,o,a,s=t.normal.array,h=new nt.Vector3,u=new nt.Vector3,c=new nt.Vector3,l=new nt.Vector3,f=new nt.Vector3;if(t.index)for(var p=t.index.array,d=this.offsets.length>0?this.offsets:[{start:0,count:p.length,index:0}],m=0,g=d.length;m<g;++m){var v=d[m].start,y=d[m].count,x=d[m].index;for(n=v,r=v+y;n<r;n+=3)i=3*(x+p[n]),o=3*(x+p[n+1]),a=3*(x+p[n+2]),h.fromArray(e,i),u.fromArray(e,o),c.fromArray(e,a),l.subVectors(c,u),f.subVectors(h,u),l.cross(f),s[i]+=l.x,s[i+1]+=l.y,s[i+2]+=l.z,s[o]+=l.x,s[o+1]+=l.y,s[o+2]+=l.z,s[a]+=l.x,s[a+1]+=l.y,s[a+2]+=l.z}else for(n=0,r=e.length;n<r;n+=9)h.fromArray(e,n),u.fromArray(e,n+3),c.fromArray(e,n+6),l.subVectors(c,u),f.subVectors(h,u),l.cross(f),s[n]=l.x,s[n+1]=l.y,s[n+2]=l.z,s[n+3]=l.x,s[n+4]=l.y,s[n+5]=l.z,s[n+6]=l.x,s[n+7]=l.y,s[n+8]=l.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var t=this.attributes.index.array,e=this.attributes.position.array,n=this.attributes.normal.array,r=this.attributes.uv.array,i=e.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new nt.BufferAttribute(new Float32Array(4*i),4));for(var o=this.attributes.tangent.array,a=[],s=[],h=0;h<i;h++)a[h]=new nt.Vector3,s[h]=new nt.Vector3;var u,c,l,f,p,d,m,g,v,y,x,_,b,w,M,A,S,C,T=new nt.Vector3,E=new nt.Vector3,L=new nt.Vector3,P=new nt.Vector2,D=new nt.Vector2,R=new nt.Vector2,F=new nt.Vector3,k=new nt.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,t.length,0);var B,z,N,U=this.drawcalls;for(w=0,M=U.length;w<M;++w){var I=U[w].start,O=U[w].count,V=U[w].index;for(_=I,b=I+O;_<b;_+=3)A=V+t[_],S=V+t[_+1],C=V+t[_+2],B=A,z=S,N=C,T.fromArray(e,3*B),E.fromArray(e,3*z),L.fromArray(e,3*N),P.fromArray(r,2*B),D.fromArray(r,2*z),R.fromArray(r,2*N),u=E.x-T.x,c=L.x-T.x,l=E.y-T.y,f=L.y-T.y,p=E.z-T.z,d=L.z-T.z,m=D.x-P.x,g=R.x-P.x,v=D.y-P.y,y=R.y-P.y,x=1/(m*y-g*v),F.set((y*u-v*c)*x,(y*l-v*f)*x,(y*p-v*d)*x),k.set((m*c-g*u)*x,(m*f-g*l)*x,(m*d-g*p)*x),a[B].add(F),a[z].add(F),a[N].add(F),s[B].add(k),s[z].add(k),s[N].add(k)}var H,G,j,W=new nt.Vector3,X=new nt.Vector3,q=new nt.Vector3,Q=new nt.Vector3;for(w=0,M=U.length;w<M;++w){I=U[w].start,O=U[w].count,V=U[w].index;for(_=I,b=I+O;_<b;_+=3)A=V+t[_],S=V+t[_+1],C=V+t[_+2],Y(A),Y(S),Y(C)}}else console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function Y(t){q.fromArray(n,3*t),Q.copy(q),G=a[t],W.copy(G),W.sub(q.multiplyScalar(q.dot(G))).normalize(),X.crossVectors(Q,G),j=X.dot(s[t]),H=j<0?-1:1,o[4*t]=W.x,o[4*t+1]=W.y,o[4*t+2]=W.z,o[4*t+3]=H}},computeOffsets:function(t){var e=t;void 0===t&&(e=65535);Date.now();for(var n=this.attributes.index.array,r=this.attributes.position.array,i=(r.length,n.length/3),o=new Uint16Array(n.length),a=0,s=0,h=[{start:0,count:0,index:0}],u=h[0],c=0,l=new Int32Array(6),f=new Int32Array(r.length),p=new Int32Array(r.length),d=0;d<r.length;d++)f[d]=-1,p[d]=-1;for(var m=0;m<i;m++){c=0;for(var g=0;g<3;g++){-1==f[_=n[3*m+g]]?(l[2*g]=_,l[2*g+1]=-1,c++):f[_]<u.index?(l[2*g]=_,l[2*g+1]=-1,0):(l[2*g]=_,l[2*g+1]=f[_])}if(s+c>u.index+e){var v={start:a,count:0,index:s};h.push(v),u=v;for(var y=0;y<6;y+=2){(x=l[y+1])>-1&&x<u.index&&(l[y+1]=-1)}}for(y=0;y<6;y+=2){var x,_=l[y];-1===(x=l[y+1])&&(x=s++),f[_]=x,p[x]=_,o[a++]=x-u.index,u.count++}}return this.reorderBuffers(o,p,s),this.offsets=h,h},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var t,e,n,r,i=this.attributes.normal.array,o=0,a=i.length;o<a;o+=3)t=i[o],e=i[o+1],n=i[o+2],r=1/Math.sqrt(t*t+e*e+n*n),i[o]*=r,i[o+1]*=r,i[o+2]*=r},reorderBuffers:function(t,e,n){var r={};for(var i in this.attributes)if("index"!=i){var o=this.attributes[i].array;r[i]=new o.constructor(this.attributes[i].itemSize*n)}for(var a=0;a<n;a++){var s=e[a];for(var i in this.attributes)if("index"!=i)for(var h=this.attributes[i].array,u=this.attributes[i].itemSize,c=r[i],l=0;l<u;l++)c[a*u+l]=h[s*u+l]}for(var i in this.attributes.index.array=t,this.attributes)"index"!=i&&(this.attributes[i].array=r[i],this.attributes[i].numItems=this.attributes[i].itemSize*n)},toJSON:function(){var t={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},e=this.attributes,n=this.offsets,r=this.boundingSphere;for(var i in e){for(var o=e[i],a=[],s=o.array,h=0,u=s.length;h<u;h++)a[h]=s[h];t.data.attributes[i]={itemSize:o.itemSize,type:o.array.constructor.name,array:a}}return n.length>0&&(t.data.offsets=JSON.parse(JSON.stringify(n))),null!==r&&(t.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),t},clone:function(){var t=new nt.BufferGeometry;for(var e in this.attributes){var n=this.attributes[e];t.addAttribute(e,n.clone())}for(var r=0,i=this.offsets.length;r<i;r++){var o=this.offsets[r];t.offsets.push({start:o.start,index:o.index,count:o.count})}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},nt.EventDispatcher.prototype.apply(nt.BufferGeometry.prototype),nt.Geometry=function(){Object.defineProperty(this,"id",{value:nt.GeometryIdCount++}),this.uuid=nt.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},nt.Geometry.prototype={constructor:nt.Geometry,applyMatrix:function(t){for(var e=(new nt.Matrix3).getNormalMatrix(t),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applyMatrix4(t)}for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(e).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(e).normalize()}this.boundingBox instanceof nt.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof nt.Sphere&&this.computeBoundingSphere()},fromBufferGeometry:function(t){for(var e=this,n=t.attributes,r=n.position.array,i=void 0!==n.index?n.index.array:void 0,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,h=[],u=[],c=0,l=0;c<r.length;c+=3,l+=2)e.vertices.push(new nt.Vector3(r[c],r[c+1],r[c+2])),void 0!==o&&h.push(new nt.Vector3(o[c],o[c+1],o[c+2])),void 0!==a&&e.colors.push(new nt.Color(a[c],a[c+1],a[c+2])),void 0!==s&&u.push(new nt.Vector2(s[l],s[l+1]));var f=function(t,n,r){var i=void 0!==o?[h[t].clone(),h[n].clone(),h[r].clone()]:[],s=void 0!==a?[e.colors[t].clone(),e.colors[n].clone(),e.colors[r].clone()]:[];e.faces.push(new nt.Face3(t,n,r,i,s)),e.faceVertexUvs[0].push([u[t],u[n],u[r]])};if(void 0!==i)for(c=0;c<i.length;c+=3)f(i[c],i[c+1],i[c+2]);else for(c=0;c<r.length/3;c+=3)f(c,c+1,c+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=new nt.Vector3;return t.addVectors(this.boundingBox.min,this.boundingBox.max),t.multiplyScalar(-.5),this.applyMatrix((new nt.Matrix4).makeTranslation(t.x,t.y,t.z)),this.computeBoundingBox(),t},computeFaceNormals:function(){for(var t=new nt.Vector3,e=new nt.Vector3,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];t.subVectors(s,a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,n,r,i,o,a;for(a=new Array(this.vertices.length),e=0,n=this.vertices.length;e<n;e++)a[e]=new nt.Vector3;if(t){var s,h,u,c=new nt.Vector3,l=new nt.Vector3;new nt.Vector3,new nt.Vector3,new nt.Vector3;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],s=this.vertices[o.a],h=this.vertices[o.b],u=this.vertices[o.c],c.subVectors(u,h),l.subVectors(s,h),c.cross(l),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(r=0,i=this.faces.length;r<i;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,n=this.vertices.length;e<n;e++)a[e].normalize();for(r=0,i=this.faces.length;r<i;r++)(o=this.faces[r]).vertexNormals[0]=a[o.a].clone(),o.vertexNormals[1]=a[o.b].clone(),o.vertexNormals[2]=a[o.c].clone()},computeMorphNormals:function(){var t,e,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new nt.Geometry;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)h=new nt.Vector3,u={a:new nt.Vector3,b:new nt.Vector3,c:new nt.Vector3},a.push(h),s.push(u)}var h,u,c=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],h=c.faceNormals[n],u=c.vertexNormals[n],h.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){var t,e,n,r,i,o,a,s,h,u,c,l,f,p,d,m,g,v,y,x,_,b,w,M,A,S,C,T,E,L,P,D,R,F,k=[],B=[],z=new nt.Vector3,N=new nt.Vector3,U=new nt.Vector3,I=new nt.Vector3,O=new nt.Vector3;for(n=0,r=this.vertices.length;n<r;n++)k[n]=new nt.Vector3,B[n]=new nt.Vector3;for(t=0,e=this.faces.length;t<e;t++)a=this.faces[t],s=this.faceVertexUvs[0][t],T=this,E=a.a,L=a.b,P=a.c,D=0,R=1,F=2,h=T.vertices[E],u=T.vertices[L],c=T.vertices[P],l=s[D],f=s[R],p=s[F],d=u.x-h.x,m=c.x-h.x,g=u.y-h.y,v=c.y-h.y,y=u.z-h.z,x=c.z-h.z,_=f.x-l.x,b=p.x-l.x,w=f.y-l.y,M=p.y-l.y,A=1/(_*M-b*w),z.set((M*d-w*m)*A,(M*g-w*v)*A,(M*y-w*x)*A),N.set((_*m-b*d)*A,(_*v-b*g)*A,(_*x-b*y)*A),k[E].add(z),k[L].add(z),k[P].add(z),B[E].add(N),B[L].add(N),B[P].add(N);var V=["a","b","c","d"];for(t=0,e=this.faces.length;t<e;t++)for(a=this.faces[t],i=0;i<Math.min(a.vertexNormals.length,3);i++)O.copy(a.vertexNormals[i]),o=a[V[i]],S=k[o],U.copy(S),U.sub(O.multiplyScalar(O.dot(S))).normalize(),I.crossVectors(a.vertexNormals[i],S),C=I.dot(B[o])<0?-1:1,a.vertexTangents[i]=new nt.Vector4(U.x,U.y,U.z,C);this.hasTangents=!0},computeLineDistances:function(){for(var t=0,e=this.vertices,n=0,r=e.length;n<r;n++)n>0&&(t+=e[n].distanceTo(e[n-1])),this.lineDistances[n]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new nt.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new nt.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(t instanceof nt.Geometry!=!1){var r,i=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,h=t.faces,u=this.faceVertexUvs[0],c=t.faceVertexUvs[0];void 0===n&&(n=0),void 0!==e&&(r=(new nt.Matrix3).getNormalMatrix(e));for(var l=0,f=a.length;l<f;l++){var p=a[l].clone();void 0!==e&&p.applyMatrix4(e),o.push(p)}for(l=0,f=h.length;l<f;l++){var d,m,g,v=h[l],y=v.vertexNormals,x=v.vertexColors;(d=new nt.Face3(v.a+i,v.b+i,v.c+i)).normal.copy(v.normal),void 0!==r&&d.normal.applyMatrix3(r).normalize();for(var _=0,b=y.length;_<b;_++)m=y[_].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),d.vertexNormals.push(m);d.color.copy(v.color);for(_=0,b=x.length;_<b;_++)g=x[_],d.vertexColors.push(g.clone());d.materialIndex=v.materialIndex+n,s.push(d)}for(l=0,f=c.length;l<f;l++){var w=c[l],M=[];if(void 0!==w){for(_=0,b=w.length;_<b;_++)M.push(new nt.Vector2(w[_].x,w[_].y));u.push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeVertices:function(){var t,e,n,r,i,o,a,s,h={},u=[],c=[],l=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)t=this.vertices[n],void 0===h[e=Math.round(t.x*l)+"_"+Math.round(t.y*l)+"_"+Math.round(t.z*l)]?(h[e]=n,u.push(this.vertices[n]),c[n]=u.length-1):c[n]=c[h[e]];var f=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],o=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(o[p]==o[(p+1)%3]){p,f.push(n);break}}for(n=f.length-1;n>=0;n--){var d=f[n];for(this.faces.splice(d,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(d,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},toJSON:function(){var t={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}var a=[],s=[],h={},u=[],c={},l=[],f={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],d=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,g=p.vertexNormals.length>0,v=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,x=0;if(x=M(x,0,0),x=M(x,1,!1),x=M(x,2,!1),x=M(x,3,d),x=M(x,4,m),x=M(x,5,g),x=M(x,6,v),x=M(x,7,y),a.push(x),a.push(p.a,p.b,p.c),d){var _=this.faceVertexUvs[0][i];a.push(C(_[0]),C(_[1]),C(_[2]))}if(m&&a.push(A(p.normal)),g){var b=p.vertexNormals;a.push(A(b[0]),A(b[1]),A(b[2]))}if(v&&a.push(S(p.color)),y){var w=p.vertexColors;a.push(S(w[0]),S(w[1]),S(w[2]))}}function M(t,e,n){return n?t|1<<e:t&~(1<<e)}function A(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==h[e]?h[e]:(h[e]=s.length/3,s.push(t.x,t.y,t.z),h[e])}function S(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]?c[e]:(c[e]=u.length,u.push(t.getHex()),c[e])}function C(t){var e=t.x.toString()+t.y.toString();return void 0!==f[e]?f[e]:(f[e]=l.length/2,l.push(t.x,t.y),f[e])}return t.data={},t.data.vertices=r,t.data.normals=s,u.length>0&&(t.data.colors=u),l.length>0&&(t.data.uvs=[l]),t.data.faces=a,t},clone:function(){for(var t=new nt.Geometry,e=this.vertices,n=0,r=e.length;n<r;n++)t.vertices.push(e[n].clone());var i=this.faces;for(n=0,r=i.length;n<r;n++)t.faces.push(i[n].clone());var o=this.faceVertexUvs[0];for(n=0,r=o.length;n<r;n++){for(var a=o[n],s=[],h=0,u=a.length;h<u;h++)s.push(new nt.Vector2(a[h].x,a[h].y));t.faceVertexUvs[0].push(s)}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},nt.EventDispatcher.prototype.apply(nt.Geometry.prototype),nt.GeometryIdCount=0,nt.Camera=function(){nt.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new nt.Matrix4,this.projectionMatrix=new nt.Matrix4},nt.Camera.prototype=Object.create(nt.Object3D.prototype),nt.Camera.prototype.getWorldDirection=function(){var t=new nt.Quaternion;return function(e){var n=e||new nt.Vector3;return this.getWorldQuaternion(t),n.set(0,0,-1).applyQuaternion(t)}}(),nt.Camera.prototype.lookAt=function(){var t=new nt.Matrix4;return function(e){t.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(t)}}(),nt.Camera.prototype.clone=function(t){return void 0===t&&(t=new nt.Camera),nt.Object3D.prototype.clone.call(this,t),t.matrixWorldInverse.copy(this.matrixWorldInverse),t.projectionMatrix.copy(this.projectionMatrix),t},nt.CubeCamera=function(t,e,n){nt.Object3D.call(this),this.type="CubeCamera";var r=new nt.PerspectiveCamera(90,1,t,e);r.up.set(0,-1,0),r.lookAt(new nt.Vector3(1,0,0)),this.add(r);var i=new nt.PerspectiveCamera(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new nt.Vector3(-1,0,0)),this.add(i);var o=new nt.PerspectiveCamera(90,1,t,e);o.up.set(0,0,1),o.lookAt(new nt.Vector3(0,1,0)),this.add(o);var a=new nt.PerspectiveCamera(90,1,t,e);a.up.set(0,0,-1),a.lookAt(new nt.Vector3(0,-1,0)),this.add(a);var s=new nt.PerspectiveCamera(90,1,t,e);s.up.set(0,-1,0),s.lookAt(new nt.Vector3(0,0,1)),this.add(s);var h=new nt.PerspectiveCamera(90,1,t,e);h.up.set(0,-1,0),h.lookAt(new nt.Vector3(0,0,-1)),this.add(h),this.renderTarget=new nt.WebGLRenderTargetCube(n,n,{format:nt.RGBFormat,magFilter:nt.LinearFilter,minFilter:nt.LinearFilter}),this.updateCubeMap=function(t,e){var n=this.renderTarget,u=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,t.render(e,r,n),n.activeCubeFace=1,t.render(e,i,n),n.activeCubeFace=2,t.render(e,o,n),n.activeCubeFace=3,t.render(e,a,n),n.activeCubeFace=4,t.render(e,s,n),n.generateMipmaps=u,n.activeCubeFace=5,t.render(e,h,n)}},nt.CubeCamera.prototype=Object.create(nt.Object3D.prototype),nt.OrthographicCamera=function(t,e,n,r,i,o){nt.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},nt.OrthographicCamera.prototype=Object.create(nt.Camera.prototype),nt.OrthographicCamera.prototype.updateProjectionMatrix=function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(n-t,n+t,r+e,r-e,this.near,this.far)},nt.OrthographicCamera.prototype.clone=function(){var t=new nt.OrthographicCamera;return nt.Camera.prototype.clone.call(this,t),t.zoom=this.zoom,t.left=this.left,t.right=this.right,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,t.projectionMatrix.copy(this.projectionMatrix),t},nt.PerspectiveCamera=function(t,e,n,r){nt.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==t?t:50,this.aspect=void 0!==e?e:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},nt.PerspectiveCamera.prototype=Object.create(nt.Camera.prototype),nt.PerspectiveCamera.prototype.setLens=function(t,e){void 0===e&&(e=24),this.fov=2*nt.Math.radToDeg(Math.atan(e/(2*t))),this.updateProjectionMatrix()},nt.PerspectiveCamera.prototype.setViewOffset=function(t,e,n,r,i,o){this.fullWidth=t,this.fullHeight=e,this.x=n,this.y=r,this.width=i,this.height=o,this.updateProjectionMatrix()},nt.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var t=nt.Math.radToDeg(2*Math.atan(Math.tan(.5*nt.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var e=this.fullWidth/this.fullHeight,n=Math.tan(nt.Math.degToRad(.5*t))*this.near,r=-n,i=e*r,o=e*n,a=Math.abs(o-i),s=Math.abs(n-r);this.projectionMatrix.makeFrustum(i+this.x*a/this.fullWidth,i+(this.x+this.width)*a/this.fullWidth,n-(this.y+this.height)*s/this.fullHeight,n-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(t,this.aspect,this.near,this.far)},nt.PerspectiveCamera.prototype.clone=function(){var t=new nt.PerspectiveCamera;return nt.Camera.prototype.clone.call(this,t),t.zoom=this.zoom,t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t.projectionMatrix.copy(this.projectionMatrix),t},nt.Light=function(t){nt.Object3D.call(this),this.type="Light",this.color=new nt.Color(t)},nt.Light.prototype=Object.create(nt.Object3D.prototype),nt.Light.prototype.clone=function(t){return void 0===t&&(t=new nt.Light),nt.Object3D.prototype.clone.call(this,t),t.color.copy(this.color),t},nt.AmbientLight=function(t){nt.Light.call(this,t),this.type="AmbientLight"},nt.AmbientLight.prototype=Object.create(nt.Light.prototype),nt.AmbientLight.prototype.clone=function(){var t=new nt.AmbientLight;return nt.Light.prototype.clone.call(this,t),t},nt.AreaLight=function(t,e){nt.Light.call(this,t),this.type="AreaLight",this.normal=new nt.Vector3(0,-1,0),this.right=new nt.Vector3(1,0,0),this.intensity=void 0!==e?e:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},nt.AreaLight.prototype=Object.create(nt.Light.prototype),nt.DirectionalLight=function(t,e){nt.Light.call(this,t),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new nt.Object3D,this.intensity=void 0!==e?e:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new nt.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},nt.DirectionalLight.prototype=Object.create(nt.Light.prototype),nt.DirectionalLight.prototype.clone=function(){var t=new nt.DirectionalLight;return nt.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t.shadowCameraNear=this.shadowCameraNear,t.shadowCameraFar=this.shadowCameraFar,t.shadowCameraLeft=this.shadowCameraLeft,t.shadowCameraRight=this.shadowCameraRight,t.shadowCameraTop=this.shadowCameraTop,t.shadowCameraBottom=this.shadowCameraBottom,t.shadowCameraVisible=this.shadowCameraVisible,t.shadowBias=this.shadowBias,t.shadowDarkness=this.shadowDarkness,t.shadowMapWidth=this.shadowMapWidth,t.shadowMapHeight=this.shadowMapHeight,t.shadowCascade=this.shadowCascade,t.shadowCascadeOffset.copy(this.shadowCascadeOffset),t.shadowCascadeCount=this.shadowCascadeCount,t.shadowCascadeBias=this.shadowCascadeBias.slice(0),t.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),t.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),t.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),t.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),t},nt.HemisphereLight=function(t,e,n){nt.Light.call(this,t),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new nt.Color(e),this.intensity=void 0!==n?n:1},nt.HemisphereLight.prototype=Object.create(nt.Light.prototype),nt.HemisphereLight.prototype.clone=function(){var t=new nt.HemisphereLight;return nt.Light.prototype.clone.call(this,t),t.groundColor.copy(this.groundColor),t.intensity=this.intensity,t},nt.PointLight=function(t,e,n){nt.Light.call(this,t),this.type="PointLight",this.intensity=void 0!==e?e:1,this.distance=void 0!==n?n:0},nt.PointLight.prototype=Object.create(nt.Light.prototype),nt.PointLight.prototype.clone=function(){var t=new nt.PointLight;return nt.Light.prototype.clone.call(this,t),t.intensity=this.intensity,t.distance=this.distance,t},nt.SpotLight=function(t,e,n,r,i){nt.Light.call(this,t),this.type="SpotLight",this.position.set(0,1,0),this.target=new nt.Object3D,this.intensity=void 0!==e?e:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==i?i:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},nt.SpotLight.prototype=Object.create(nt.Light.prototype),nt.SpotLight.prototype.clone=function(){var t=new nt.SpotLight;return nt.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.distance=this.distance,t.angle=this.angle,t.exponent=this.exponent,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t.shadowCameraNear=this.shadowCameraNear,t.shadowCameraFar=this.shadowCameraFar,t.shadowCameraFov=this.shadowCameraFov,t.shadowCameraVisible=this.shadowCameraVisible,t.shadowBias=this.shadowBias,t.shadowDarkness=this.shadowDarkness,t.shadowMapWidth=this.shadowMapWidth,t.shadowMapHeight=this.shadowMapHeight,t},nt.Cache=function(){this.files={}},nt.Cache.prototype={constructor:nt.Cache,add:function(t,e){this.files[t]=e},get:function(t){return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},nt.Loader=function(t){this.showStatus=t,this.statusDomElement=t?nt.Loader.prototype.addStatusElement():null,this.imageLoader=new nt.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},nt.Loader.prototype={constructor:nt.Loader,crossOrigin:void 0,addStatusElement:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.right="0px",t.style.top="0px",t.style.fontSize="0.8em",t.style.textAlign="left",t.style.background="rgba(0,0,0,0.25)",t.style.color="#fff",t.style.width="120px",t.style.padding="0.5em 0.5em 0.5em 0.5em",t.style.zIndex=1e3,t.innerHTML="Loading ...",t},updateProgress:function(t){var e="Loaded ";t.total?e+=(100*t.loaded/t.total).toFixed(0)+"%":e+=(t.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=e},extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(t,e){for(var n=[],r=0;r<t.length;++r)n[r]=this.createMaterial(t[r],e);return n},needsTangents:function(t){for(var e=0,n=t.length;e<n;e++){if(t[e]instanceof nt.ShaderMaterial)return!0}return!1},createMaterial:function(t,e){var n=this;function r(t){var e=Math.log(t)/Math.LN2;return Math.pow(2,Math.round(e))}function i(t,i,o,a,s,h,u){var c,l=e+o,f=nt.Loader.Handlers.get(l);if(null!==f?c=f.load(l):(c=new nt.Texture,(f=n.imageLoader).crossOrigin=n.crossOrigin,f.load(l,function(t){if(!1===nt.Math.isPowerOfTwo(t.width)||!1===nt.Math.isPowerOfTwo(t.height)){var e=r(t.width),n=r(t.height),i=document.createElement("canvas");i.width=e,i.height=n,i.getContext("2d").drawImage(t,0,0,e,n),c.image=i}else c.image=t;c.needsUpdate=!0})),c.sourceFile=o,a&&(c.repeat.set(a[0],a[1]),1!==a[0]&&(c.wrapS=nt.RepeatWrapping),1!==a[1]&&(c.wrapT=nt.RepeatWrapping)),s&&c.offset.set(s[0],s[1]),h){var p={repeat:nt.RepeatWrapping,mirror:nt.MirroredRepeatWrapping};void 0!==p[h[0]]&&(c.wrapS=p[h[0]]),void 0!==p[h[1]]&&(c.wrapT=p[h[1]])}u&&(c.anisotropy=u),t[i]=c}function o(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]}var a="MeshLambertMaterial",s={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(t.shading){var h=t.shading.toLowerCase();"phong"===h?a="MeshPhongMaterial":"basic"===h&&(a="MeshBasicMaterial")}if(void 0!==t.blending&&void 0!==nt[t.blending]&&(s.blending=nt[t.blending]),(void 0!==t.transparent||t.opacity<1)&&(s.transparent=t.transparent),void 0!==t.depthTest&&(s.depthTest=t.depthTest),void 0!==t.depthWrite&&(s.depthWrite=t.depthWrite),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.flipSided&&(s.side=nt.BackSide),void 0!==t.doubleSided&&(s.side=nt.DoubleSide),void 0!==t.wireframe&&(s.wireframe=t.wireframe),void 0!==t.vertexColors&&("face"===t.vertexColors?s.vertexColors=nt.FaceColors:t.vertexColors&&(s.vertexColors=nt.VertexColors)),t.colorDiffuse?s.color=o(t.colorDiffuse):t.DbgColor&&(s.color=t.DbgColor),t.colorSpecular&&(s.specular=o(t.colorSpecular)),t.colorAmbient&&(s.ambient=o(t.colorAmbient)),t.colorEmissive&&(s.emissive=o(t.colorEmissive)),t.transparency&&(s.opacity=t.transparency),t.specularCoef&&(s.shininess=t.specularCoef),t.mapDiffuse&&e&&i(s,"map",t.mapDiffuse,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy),t.mapLight&&e&&i(s,"lightMap",t.mapLight,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy),t.mapBump&&e&&i(s,"bumpMap",t.mapBump,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy),t.mapNormal&&e&&i(s,"normalMap",t.mapNormal,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy),t.mapSpecular&&e&&i(s,"specularMap",t.mapSpecular,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy),t.mapAlpha&&e&&i(s,"alphaMap",t.mapAlpha,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy),t.mapBumpScale&&(s.bumpScale=t.mapBumpScale),t.mapNormal){var u=nt.ShaderLib.normalmap,c=nt.UniformsUtils.clone(u.uniforms);c.tNormal.value=s.normalMap,t.mapNormalFactor&&c.uNormalScale.value.set(t.mapNormalFactor,t.mapNormalFactor),s.map&&(c.tDiffuse.value=s.map,c.enableDiffuse.value=!0),s.specularMap&&(c.tSpecular.value=s.specularMap,c.enableSpecular.value=!0),s.lightMap&&(c.tAO.value=s.lightMap,c.enableAO.value=!0),c.diffuse.value.setHex(s.color),c.specular.value.setHex(s.specular),c.ambient.value.setHex(s.ambient),c.shininess.value=s.shininess,void 0!==s.opacity&&(c.opacity.value=s.opacity);var l={fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:c,lights:!0,fog:!0},f=new nt.ShaderMaterial(l);s.transparent&&(f.transparent=!0)}else f=new nt[a](s);return void 0!==t.DbgName&&(f.name=t.DbgName),f}},nt.Loader.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=0,n=this.handlers.length;e<n;e+=2){var r=this.handlers[e],i=this.handlers[e+1];if(r.test(t))return i}return null}},nt.XHRLoader=function(t){this.cache=new nt.Cache,this.manager=void 0!==t?t:nt.DefaultLoadingManager},nt.XHRLoader.prototype={constructor:nt.XHRLoader,load:function(t,e,n,r){var i=this,o=i.cache.get(t);if(void 0===o){var a=new XMLHttpRequest;a.open("GET",t,!0),a.addEventListener("load",function(n){i.cache.add(t,this.response),e&&e(this.response),i.manager.itemEnd(t)},!1),void 0!==n&&a.addEventListener("progress",function(t){n(t)},!1),void 0!==r&&a.addEventListener("error",function(t){r(t)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),a.send(null),i.manager.itemStart(t)}else e&&e(o)},setResponseType:function(t){this.responseType=t},setCrossOrigin:function(t){this.crossOrigin=t}},nt.ImageLoader=function(t){this.cache=new nt.Cache,this.manager=void 0!==t?t:nt.DefaultLoadingManager},nt.ImageLoader.prototype={constructor:nt.ImageLoader,load:function(t,e,n,r){var i=this,o=i.cache.get(t);if(void 0===o){var a=document.createElement("img");return void 0!==e&&a.addEventListener("load",function(n){i.cache.add(t,this),e(this),i.manager.itemEnd(t)},!1),void 0!==n&&a.addEventListener("progress",function(t){n(t)},!1),void 0!==r&&a.addEventListener("error",function(t){r(t)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),a.src=t,i.manager.itemStart(t),a}e(o)},setCrossOrigin:function(t){this.crossOrigin=t}},nt.JSONLoader=function(t){nt.Loader.call(this,t),this.withCredentials=!1},nt.JSONLoader.prototype=Object.create(nt.Loader.prototype),nt.JSONLoader.prototype.load=function(t,e,n){n=n&&"string"==typeof n?n:this.extractUrlBase(t),this.onLoadStart(),this.loadAjaxJSON(this,t,e,n)},nt.JSONLoader.prototype.loadAjaxJSON=function(t,e,n,r,i){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);if(void 0!==s.metadata&&"scene"===s.metadata.type)return void console.error('THREE.JSONLoader: "'+e+'" seems to be a Scene. Use THREE.SceneLoader instead.');var h=t.parse(s,r);n(h.geometry,h.materials)}else console.error('THREE.JSONLoader: "'+e+'" seems to be unreachable or the file is empty.');t.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+e+'" ('+o.status+")");else o.readyState===o.LOADING?i&&(0===a&&(a=o.getResponseHeader("Content-Length")),i({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==i&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",e,!0),o.withCredentials=this.withCredentials,o.send(null)},nt.JSONLoader.prototype.parse=function(t,e){var n=new nt.Geometry,r=void 0!==t.scale?1/t.scale:1;if(function(e){function r(t,e){return t&1<<e}var i,o,a,s,h,u,c,l,f,p,d,m,g,v,y,x,_,b,w,M,A,S,C,T,E,L,P,D=t.faces,R=t.vertices,F=t.normals,k=t.colors,B=0;if(void 0!==t.uvs){for(i=0;i<t.uvs.length;i++)t.uvs[i].length&&B++;for(i=0;i<B;i++)n.faceVertexUvs[i]=[]}s=0,h=R.length;for(;s<h;)(b=new nt.Vector3).x=R[s++]*e,b.y=R[s++]*e,b.z=R[s++]*e,n.vertices.push(b);s=0,h=D.length;for(;s<h;)if(p=D[s++],d=r(p,0),m=r(p,1),g=r(p,3),v=r(p,4),y=r(p,5),x=r(p,6),_=r(p,7),d){if((M=new nt.Face3).a=D[s],M.b=D[s+1],M.c=D[s+3],(A=new nt.Face3).a=D[s+1],A.b=D[s+2],A.c=D[s+3],s+=4,m&&(f=D[s++],M.materialIndex=f,A.materialIndex=f),a=n.faces.length,g)for(i=0;i<B;i++)for(T=t.uvs[i],n.faceVertexUvs[i][a]=[],n.faceVertexUvs[i][a+1]=[],o=0;o<4;o++)l=D[s++],L=T[2*l],P=T[2*l+1],E=new nt.Vector2(L,P),2!==o&&n.faceVertexUvs[i][a].push(E),0!==o&&n.faceVertexUvs[i][a+1].push(E);if(v&&(c=3*D[s++],M.normal.set(F[c++],F[c++],F[c]),A.normal.copy(M.normal)),y)for(i=0;i<4;i++)c=3*D[s++],C=new nt.Vector3(F[c++],F[c++],F[c]),2!==i&&M.vertexNormals.push(C),0!==i&&A.vertexNormals.push(C);if(x&&(u=D[s++],S=k[u],M.color.setHex(S),A.color.setHex(S)),_)for(i=0;i<4;i++)u=D[s++],S=k[u],2!==i&&M.vertexColors.push(new nt.Color(S)),0!==i&&A.vertexColors.push(new nt.Color(S));n.faces.push(M),n.faces.push(A)}else{if((w=new nt.Face3).a=D[s++],w.b=D[s++],w.c=D[s++],m&&(f=D[s++],w.materialIndex=f),a=n.faces.length,g)for(i=0;i<B;i++)for(T=t.uvs[i],n.faceVertexUvs[i][a]=[],o=0;o<3;o++)l=D[s++],L=T[2*l],P=T[2*l+1],E=new nt.Vector2(L,P),n.faceVertexUvs[i][a].push(E);if(v&&(c=3*D[s++],w.normal.set(F[c++],F[c++],F[c])),y)for(i=0;i<3;i++)c=3*D[s++],C=new nt.Vector3(F[c++],F[c++],F[c]),w.vertexNormals.push(C);if(x&&(u=D[s++],w.color.setHex(k[u])),_)for(i=0;i<3;i++)u=D[s++],w.vertexColors.push(new nt.Color(k[u]));n.faces.push(w)}}(r),function(){var e=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var r=0,i=t.skinWeights.length;r<i;r+=e){var o=t.skinWeights[r],a=e>1?t.skinWeights[r+1]:0,s=e>2?t.skinWeights[r+2]:0,h=e>3?t.skinWeights[r+3]:0;n.skinWeights.push(new nt.Vector4(o,a,s,h))}if(t.skinIndices)for(var r=0,i=t.skinIndices.length;r<i;r+=e){var u=t.skinIndices[r],c=e>1?t.skinIndices[r+1]:0,l=e>2?t.skinIndices[r+2]:0,f=e>3?t.skinIndices[r+3]:0;n.skinIndices.push(new nt.Vector4(u,c,l,f))}n.bones=t.bones,n.bones&&n.bones.length>0&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&console.warn("When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match.");n.animation=t.animation,n.animations=t.animations}(),function(e){var r,i,o,a,s,h,u,c,l,f,p;if(void 0!==t.morphTargets)for(s=0,h=t.morphTargets.length;s<h;s++)for(n.morphTargets[s]={},n.morphTargets[s].name=t.morphTargets[s].name,n.morphTargets[s].vertices=[],o=n.morphTargets[s].vertices,a=t.morphTargets[s].vertices,r=0,i=a.length;r<i;r+=3){var d=new nt.Vector3;d.x=a[r]*e,d.y=a[r+1]*e,d.z=a[r+2]*e,o.push(d)}if(void 0!==t.morphColors)for(s=0,h=t.morphColors.length;s<h;s++)for(n.morphColors[s]={},n.morphColors[s].name=t.morphColors[s].name,n.morphColors[s].colors=[],l=n.morphColors[s].colors,f=t.morphColors[s].colors,u=0,c=f.length;u<c;u+=3)(p=new nt.Color(16755200)).setRGB(f[u],f[u+1],f[u+2]),l.push(p)}(r),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===t.materials||0===t.materials.length)return{geometry:n};var i=this.initMaterials(t.materials,e);return this.needsTangents(i)&&n.computeTangents(),{geometry:n,materials:i}},nt.LoadingManager=function(t,e,n){var r=this,i=0,o=0;this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++},this.itemEnd=function(t){i++,void 0!==r.onProgress&&r.onProgress(t,i,o),i===o&&void 0!==r.onLoad&&r.onLoad()}},nt.DefaultLoadingManager=new nt.LoadingManager,nt.BufferGeometryLoader=function(t){this.manager=void 0!==t?t:nt.DefaultLoadingManager},nt.BufferGeometryLoader.prototype={constructor:nt.BufferGeometryLoader,load:function(t,e,n,r){var i=this,o=new nt.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e=new nt.BufferGeometry,n=t.attributes;for(var r in n){var i=n[r],o=new et[i.type](i.array);e.addAttribute(r,new nt.BufferAttribute(o,i.itemSize))}var a=t.offsets;void 0!==a&&(e.offsets=JSON.parse(JSON.stringify(a)));var s=t.boundingSphere;if(void 0!==s){var h=new nt.Vector3;void 0!==s.center&&h.fromArray(s.center),e.boundingSphere=new nt.Sphere(h,s.radius)}return e}},nt.MaterialLoader=function(t){this.manager=void 0!==t?t:nt.DefaultLoadingManager},nt.MaterialLoader.prototype={constructor:nt.MaterialLoader,load:function(t,e,n,r){var i=this,o=new nt.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e=new nt[t.type];if(void 0!==t.color&&e.color.setHex(t.color),void 0!==t.ambient&&e.ambient.setHex(t.ambient),void 0!==t.emissive&&e.emissive.setHex(t.emissive),void 0!==t.specular&&e.specular.setHex(t.specular),void 0!==t.shininess&&(e.shininess=t.shininess),void 0!==t.uniforms&&(e.uniforms=t.uniforms),void 0!==t.vertexShader&&(e.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(e.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(e.vertexColors=t.vertexColors),void 0!==t.shading&&(e.shading=t.shading),void 0!==t.blending&&(e.blending=t.blending),void 0!==t.side&&(e.side=t.side),void 0!==t.opacity&&(e.opacity=t.opacity),void 0!==t.transparent&&(e.transparent=t.transparent),void 0!==t.wireframe&&(e.wireframe=t.wireframe),void 0!==t.materials)for(var n=0,r=t.materials.length;n<r;n++)e.materials.push(this.parse(t.materials[n]));return e}},nt.ObjectLoader=function(t){this.manager=void 0!==t?t:nt.DefaultLoadingManager},nt.ObjectLoader.prototype={constructor:nt.ObjectLoader,load:function(t,e,n,r){var i=this,o=new nt.XHRLoader(i.manager);o.setCrossOrigin(this.crossOrigin),o.load(t,function(t){e(i.parse(JSON.parse(t)))},n,r)},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t){var e=this.parseGeometries(t.geometries),n=this.parseMaterials(t.materials);return this.parseObject(t.object,e,n)},parseGeometries:function(t){var e={};if(void 0!==t)for(var n=new nt.JSONLoader,r=new nt.BufferGeometryLoader,i=0,o=t.length;i<o;i++){var a,s=t[i];switch(s.type){case"PlaneGeometry":a=new nt.PlaneGeometry(s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new nt.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":a=new nt.CircleGeometry(s.radius,s.segments);break;case"CylinderGeometry":a=new nt.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":a=new nt.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":a=new nt.IcosahedronGeometry(s.radius,s.detail);break;case"TorusGeometry":a=new nt.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new nt.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=r.parse(s.data);break;case"Geometry":a=n.parse(s.data).geometry}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),e[s.uuid]=a}return e},parseMaterials:function(t){var e={};if(void 0!==t)for(var n=new nt.MaterialLoader,r=0,i=t.length;r<i;r++){var o=t[r],a=n.parse(o);a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),e[o.uuid]=a}return e},parseObject:function(){var t=new nt.Matrix4;return function(e,n,r){var i;switch(e.type){case"Scene":i=new nt.Scene;break;case"PerspectiveCamera":i=new nt.PerspectiveCamera(e.fov,e.aspect,e.near,e.far);break;case"OrthographicCamera":i=new nt.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far);break;case"AmbientLight":i=new nt.AmbientLight(e.color);break;case"DirectionalLight":i=new nt.DirectionalLight(e.color,e.intensity);break;case"PointLight":i=new nt.PointLight(e.color,e.intensity,e.distance);break;case"SpotLight":i=new nt.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent);break;case"HemisphereLight":i=new nt.HemisphereLight(e.color,e.groundColor,e.intensity);break;case"Mesh":var o=n[e.geometry],a=r[e.material];void 0===o&&console.warn("THREE.ObjectLoader: Undefined geometry",e.geometry),void 0===a&&console.warn("THREE.ObjectLoader: Undefined material",e.material),i=new nt.Mesh(o,a);break;case"Line":o=n[e.geometry],a=r[e.material];void 0===o&&console.warn("THREE.ObjectLoader: Undefined geometry",e.geometry),void 0===a&&console.warn("THREE.ObjectLoader: Undefined material",e.material),i=new nt.Line(o,a);break;case"Sprite":void 0===(a=r[e.material])&&console.warn("THREE.ObjectLoader: Undefined material",e.material),i=new nt.Sprite(a);break;case"Group":i=new nt.Group;break;default:i=new nt.Object3D}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(t.fromArray(e.matrix),t.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.children)for(var s in e.children)i.add(this.parseObject(e.children[s],n,r));return i}}()},nt.TextureLoader=function(t){this.manager=void 0!==t?t:nt.DefaultLoadingManager},nt.TextureLoader.prototype={constructor:nt.TextureLoader,load:function(t,e,n,r){var i=new nt.ImageLoader(this.manager);i.setCrossOrigin(this.crossOrigin),i.load(t,function(t){var n=new nt.Texture(t);n.needsUpdate=!0,void 0!==e&&e(n)},n,r)},setCrossOrigin:function(t){this.crossOrigin=t}},nt.CompressedTextureLoader=function(){this._parser=null},nt.CompressedTextureLoader.prototype={constructor:nt.CompressedTextureLoader,load:function(t,e,n){var r=this,i=[],o=new nt.CompressedTexture;o.image=i;var a=new nt.XHRLoader;if(a.setResponseType("arraybuffer"),t instanceof Array)for(var s=0,h=function(n){a.load(t[n],function(t){var a=r._parser(t,!0);i[n]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps},6===(s+=1)&&(1==a.mipmapCount&&(o.minFilter=nt.LinearFilter),o.format=a.format,o.needsUpdate=!0,e&&e(o))})},u=0,c=t.length;u<c;++u)h(u);else a.load(t,function(t){var n=r._parser(t,!0);if(n.isCubemap)for(var a=n.mipmaps.length/n.mipmapCount,s=0;s<a;s++){i[s]={mipmaps:[]};for(var h=0;h<n.mipmapCount;h++)i[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+h]),i[s].format=n.format,i[s].width=n.width,i[s].height=n.height}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=nt.LinearFilter),o.format=n.format,o.needsUpdate=!0,e&&e(o)});return o}},nt.Material=function(){Object.defineProperty(this,"id",{value:nt.MaterialIdCount++}),this.uuid=nt.Math.generateUUID(),this.name="",this.type="Material",this.side=nt.FrontSide,this.opacity=1,this.transparent=!1,this.blending=nt.NormalBlending,this.blendSrc=nt.SrcAlphaFactor,this.blendDst=nt.OneMinusSrcAlphaFactor,this.blendEquation=nt.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},nt.Material.prototype={constructor:nt.Material,setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n){if(e in this){var r=this[e];r instanceof nt.Color?r.set(n):r instanceof nt.Vector3&&n instanceof nt.Vector3?r.copy(n):this[e]="overdraw"==e?Number(n):n}}else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(){var t={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(t.name=this.name),this instanceof nt.MeshBasicMaterial?(t.color=this.color.getHex(),this.vertexColors!==nt.NoColors&&(t.vertexColors=this.vertexColors),this.blending!==nt.NormalBlending&&(t.blending=this.blending),this.side!==nt.FrontSide&&(t.side=this.side)):this instanceof nt.MeshLambertMaterial?(t.color=this.color.getHex(),t.ambient=this.ambient.getHex(),t.emissive=this.emissive.getHex(),this.vertexColors!==nt.NoColors&&(t.vertexColors=this.vertexColors),this.blending!==nt.NormalBlending&&(t.blending=this.blending),this.side!==nt.FrontSide&&(t.side=this.side)):this instanceof nt.MeshPhongMaterial?(t.color=this.color.getHex(),t.ambient=this.ambient.getHex(),t.emissive=this.emissive.getHex(),t.specular=this.specular.getHex(),t.shininess=this.shininess,this.vertexColors!==nt.NoColors&&(t.vertexColors=this.vertexColors),this.blending!==nt.NormalBlending&&(t.blending=this.blending),this.side!==nt.FrontSide&&(t.side=this.side)):this instanceof nt.MeshNormalMaterial?(this.shading!==nt.FlatShading&&(t.shading=this.shading),this.blending!==nt.NormalBlending&&(t.blending=this.blending),this.side!==nt.FrontSide&&(t.side=this.side)):this instanceof nt.MeshDepthMaterial?(this.blending!==nt.NormalBlending&&(t.blending=this.blending),this.side!==nt.FrontSide&&(t.side=this.side)):this instanceof nt.ShaderMaterial?(t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader):this instanceof nt.SpriteMaterial&&(t.color=this.color.getHex()),this.opacity<1&&(t.opacity=this.opacity),!1!==this.transparent&&(t.transparent=this.transparent),!1!==this.wireframe&&(t.wireframe=this.wireframe),t},clone:function(t){return void 0===t&&(t=new nt.Material),t.name=this.name,t.side=this.side,t.opacity=this.opacity,t.transparent=this.transparent,t.blending=this.blending,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.overdraw=this.overdraw,t.visible=this.visible,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},nt.EventDispatcher.prototype.apply(nt.Material.prototype),nt.MaterialIdCount=0,nt.LineBasicMaterial=function(t){nt.Material.call(this),this.type="LineBasicMaterial",this.color=new nt.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=nt.NoColors,this.fog=!0,this.setValues(t)},nt.LineBasicMaterial.prototype=Object.create(nt.Material.prototype),nt.LineBasicMaterial.prototype.clone=function(){var t=new nt.LineBasicMaterial;return nt.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.linecap=this.linecap,t.linejoin=this.linejoin,t.vertexColors=this.vertexColors,t.fog=this.fog,t},nt.LineDashedMaterial=function(t){nt.Material.call(this),this.type="LineDashedMaterial",this.color=new nt.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},nt.LineDashedMaterial.prototype=Object.create(nt.Material.prototype),nt.LineDashedMaterial.prototype.clone=function(){var t=new nt.LineDashedMaterial;return nt.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.scale=this.scale,t.dashSize=this.dashSize,t.gapSize=this.gapSize,t.vertexColors=this.vertexColors,t.fog=this.fog,t},nt.MeshBasicMaterial=function(t){nt.Material.call(this),this.type="MeshBasicMaterial",this.color=new nt.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=nt.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=nt.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=nt.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(t)},nt.MeshBasicMaterial.prototype=Object.create(nt.Material.prototype),nt.MeshBasicMaterial.prototype.clone=function(){var t=new nt.MeshBasicMaterial;return nt.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.alphaMap=this.alphaMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t},nt.MeshLambertMaterial=function(t){nt.Material.call(this),this.type="MeshLambertMaterial",this.color=new nt.Color(16777215),this.ambient=new nt.Color(16777215),this.emissive=new nt.Color(0),this.wrapAround=!1,this.wrapRGB=new nt.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=nt.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=nt.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=nt.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},nt.MeshLambertMaterial.prototype=Object.create(nt.Material.prototype),nt.MeshLambertMaterial.prototype.clone=function(){var t=new nt.MeshLambertMaterial;return nt.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.alphaMap=this.alphaMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},nt.MeshPhongMaterial=function(t){nt.Material.call(this),this.type="MeshPhongMaterial",this.color=new nt.Color(16777215),this.ambient=new nt.Color(16777215),this.emissive=new nt.Color(0),this.specular=new nt.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new nt.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new nt.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=nt.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=nt.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=nt.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)},nt.MeshPhongMaterial.prototype=Object.create(nt.Material.prototype),nt.MeshPhongMaterial.prototype.clone=function(){var t=new nt.MeshPhongMaterial;return nt.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalMap=this.normalMap,t.normalScale.copy(this.normalScale),t.specularMap=this.specularMap,t.alphaMap=this.alphaMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},nt.MeshDepthMaterial=function(t){nt.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)},nt.MeshDepthMaterial.prototype=Object.create(nt.Material.prototype),nt.MeshDepthMaterial.prototype.clone=function(){var t=new nt.MeshDepthMaterial;return nt.Material.prototype.clone.call(this,t),t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},nt.MeshNormalMaterial=function(t){nt.Material.call(this,t),this.type="MeshNormalMaterial",this.shading=nt.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},nt.MeshNormalMaterial.prototype=Object.create(nt.Material.prototype),nt.MeshNormalMaterial.prototype.clone=function(){var t=new nt.MeshNormalMaterial;return nt.Material.prototype.clone.call(this,t),t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},nt.MeshFaceMaterial=function(t){this.uuid=nt.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=t instanceof Array?t:[]},nt.MeshFaceMaterial.prototype={constructor:nt.MeshFaceMaterial,toJSON:function(){for(var t={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},e=0,n=this.materials.length;e<n;e++)t.materials.push(this.materials[e].toJSON());return t},clone:function(){for(var t=new nt.MeshFaceMaterial,e=0;e<this.materials.length;e++)t.materials.push(this.materials[e].clone());return t}},nt.PointCloudMaterial=function(t){nt.Material.call(this),this.type="PointCloudMaterial",this.color=new nt.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=nt.NoColors,this.fog=!0,this.setValues(t)},nt.PointCloudMaterial.prototype=Object.create(nt.Material.prototype),nt.PointCloudMaterial.prototype.clone=function(){var t=new nt.PointCloudMaterial;return nt.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.vertexColors=this.vertexColors,t.fog=this.fog,t},nt.ParticleBasicMaterial=function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new nt.PointCloudMaterial(t)},nt.ParticleSystemMaterial=function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new nt.PointCloudMaterial(t)},nt.ShaderMaterial=function(t){nt.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=nt.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=nt.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(t)},nt.ShaderMaterial.prototype=Object.create(nt.Material.prototype),nt.ShaderMaterial.prototype.clone=function(){var t=new nt.ShaderMaterial;return nt.Material.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=nt.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},nt.RawShaderMaterial=function(t){nt.ShaderMaterial.call(this,t),this.type="RawShaderMaterial"},nt.RawShaderMaterial.prototype=Object.create(nt.ShaderMaterial.prototype),nt.RawShaderMaterial.prototype.clone=function(){var t=new nt.RawShaderMaterial;return nt.ShaderMaterial.prototype.clone.call(this,t),t},nt.SpriteMaterial=function(t){nt.Material.call(this),this.type="SpriteMaterial",this.color=new nt.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(t)},nt.SpriteMaterial.prototype=Object.create(nt.Material.prototype),nt.SpriteMaterial.prototype.clone=function(){var t=new nt.SpriteMaterial;return nt.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.rotation=this.rotation,t.fog=this.fog,t},nt.Texture=function(t,e,n,r,i,o,a,s,h){Object.defineProperty(this,"id",{value:nt.TextureIdCount++}),this.uuid=nt.Math.generateUUID(),this.name="",this.image=void 0!==t?t:nt.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:nt.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:nt.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:nt.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:nt.LinearFilter,this.minFilter=void 0!==o?o:nt.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==a?a:nt.RGBAFormat,this.type=void 0!==s?s:nt.UnsignedByteType,this.offset=new nt.Vector2(0,0),this.repeat=new nt.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},nt.Texture.DEFAULT_IMAGE=void 0,nt.Texture.DEFAULT_MAPPING=new nt.UVMapping,nt.Texture.prototype={constructor:nt.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){!0===t&&this.update(),this._needsUpdate=t},clone:function(t){return void 0===t&&(t=new nt.Texture),t.image=this.image,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.unpackAlignment=this.unpackAlignment,t},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},nt.EventDispatcher.prototype.apply(nt.Texture.prototype),nt.TextureIdCount=0,nt.CubeTexture=function(t,e,n,r,i,o,a,s,h){nt.Texture.call(this,t,e,n,r,i,o,a,s,h),this.images=t},nt.CubeTexture.prototype=Object.create(nt.Texture.prototype),nt.CubeTexture.clone=function(t){return void 0===t&&(t=new nt.CubeTexture),nt.Texture.prototype.clone.call(this,t),t.images=this.images,t},nt.CompressedTexture=function(t,e,n,r,i,o,a,s,h,u,c){nt.Texture.call(this,null,o,a,s,h,u,r,i,c),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1},nt.CompressedTexture.prototype=Object.create(nt.Texture.prototype),nt.CompressedTexture.prototype.clone=function(){var t=new nt.CompressedTexture;return nt.Texture.prototype.clone.call(this,t),t},nt.DataTexture=function(t,e,n,r,i,o,a,s,h,u,c){nt.Texture.call(this,null,o,a,s,h,u,r,i,c),this.image={data:t,width:e,height:n}},nt.DataTexture.prototype=Object.create(nt.Texture.prototype),nt.DataTexture.prototype.clone=function(){var t=new nt.DataTexture;return nt.Texture.prototype.clone.call(this,t),t},nt.VideoTexture=function(t,e,n,r,i,o,a,s,h){nt.Texture.call(this,t,e,n,r,i,o,a,s,h),this.generateMipmaps=!1;var u=this,c=function(){requestAnimationFrame(c),t.readyState===t.HAVE_ENOUGH_DATA&&(u.needsUpdate=!0)};c()},nt.VideoTexture.prototype=Object.create(nt.Texture.prototype),nt.Group=function(){nt.Object3D.call(this),this.type="Group"},nt.Group.prototype=Object.create(nt.Object3D.prototype),nt.PointCloud=function(t,e){nt.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==t?t:new nt.Geometry,this.material=void 0!==e?e:new nt.PointCloudMaterial({color:16777215*Math.random()}),this.sortParticles=!1},nt.PointCloud.prototype=Object.create(nt.Object3D.prototype),nt.PointCloud.prototype.raycast=(F=new nt.Matrix4,k=new nt.Ray,function(t,e){var n=this,r=n.geometry,i=t.params.PointCloud.threshold;if(F.getInverse(this.matrixWorld),k.copy(t.ray).applyMatrix4(F),null===r.boundingBox||!1!==k.isIntersectionBox(r.boundingBox)){var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=new nt.Vector3,s=function(r,i){var a=k.distanceToPoint(r);if(a<o){var s=k.closestPointToPoint(r);s.applyMatrix4(n.matrixWorld);var h=t.ray.origin.distanceTo(s);e.push({distance:h,distanceToRay:a,point:s.clone(),index:i,face:null,object:n})}};if(r instanceof nt.BufferGeometry){var h=r.attributes,u=h.position.array;if(void 0!==h.index){var c=h.index.array,l=r.offsets;0===l.length&&(l=[{start:0,count:c.length,index:0}]);for(var f=0,p=l.length;f<p;++f)for(var d=l[f].start,m=l[f].count,g=l[f].index,v=d,y=d+m;v<y;v++){var x=g+c[v];a.fromArray(u,3*x),s(a,x)}}else{var _=u.length/3;for(v=0;v<_;v++)a.set(u[3*v],u[3*v+1],u[3*v+2]),s(a,v)}}else{var b=this.geometry.vertices;for(v=0;v<b.length;v++)s(b[v],v)}}}),nt.PointCloud.prototype.clone=function(t){return void 0===t&&(t=new nt.PointCloud(this.geometry,this.material)),t.sortParticles=this.sortParticles,nt.Object3D.prototype.clone.call(this,t),t},nt.ParticleSystem=function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new nt.PointCloud(t,e)},nt.Line=function(t,e,n){nt.Object3D.call(this),this.type="Line",this.geometry=void 0!==t?t:new nt.Geometry,this.material=void 0!==e?e:new nt.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==n?n:nt.LineStrip},nt.LineStrip=0,nt.LinePieces=1,nt.Line.prototype=Object.create(nt.Object3D.prototype),nt.Line.prototype.raycast=function(){var t=new nt.Matrix4,e=new nt.Ray,n=new nt.Sphere;return function(r,i){var o=r.linePrecision,a=o*o,s=this.geometry;if(null===s.boundingSphere&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==r.ray.isIntersectionSphere(n)&&(t.getInverse(this.matrixWorld),e.copy(r.ray).applyMatrix4(t),s instanceof nt.Geometry))for(var h=s.vertices,u=h.length,c=new nt.Vector3,l=new nt.Vector3,f=this.mode===nt.LineStrip?1:2,p=0;p<u-1;p+=f){if(!(e.distanceSqToSegment(h[p],h[p+1],l,c)>a)){var d=e.origin.distanceTo(l);d<r.near||d>r.far||i.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}}(),nt.Line.prototype.clone=function(t){return void 0===t&&(t=new nt.Line(this.geometry,this.material,this.mode)),nt.Object3D.prototype.clone.call(this,t),t},nt.Mesh=function(t,e){nt.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new nt.Geometry,this.material=void 0!==e?e:new nt.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},nt.Mesh.prototype=Object.create(nt.Object3D.prototype),nt.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var t=0,e=this.geometry.morphTargets.length;t<e;t++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[t].name]=t}},nt.Mesh.prototype.getMorphTargetIndexByName=function(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0."),0)},nt.Mesh.prototype.raycast=function(){var t=new nt.Matrix4,e=new nt.Ray,n=new nt.Sphere,r=new nt.Vector3,i=new nt.Vector3,o=new nt.Vector3;return function(a,s){var h=this.geometry;if(null===h.boundingSphere&&h.computeBoundingSphere(),n.copy(h.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==a.ray.isIntersectionSphere(n)&&(t.getInverse(this.matrixWorld),e.copy(a.ray).applyMatrix4(t),null===h.boundingBox||!1!==e.isIntersectionBox(h.boundingBox)))if(h instanceof nt.BufferGeometry){if(void 0===(D=this.material))return;var u=h.attributes,c=a.precision;if(void 0!==u.index){var l=u.index.array,f=u.position.array,p=h.offsets;0===p.length&&(p=[{start:0,count:l.length,index:0}]);for(var d=0,m=p.length;d<m;++d)for(var g=p[d].start,v=p[d].count,y=p[d].index,x=g,_=g+v;x<_;x+=3){if(M=y+l[x],A=y+l[x+1],S=y+l[x+2],r.fromArray(f,3*M),i.fromArray(f,3*A),o.fromArray(f,3*S),D.side===nt.BackSide)var b=e.intersectTriangle(o,i,r,!0);else b=e.intersectTriangle(r,i,o,D.side!==nt.DoubleSide);if(null!==b)b.applyMatrix4(this.matrixWorld),(I=a.ray.origin.distanceTo(b))<c||I<a.near||I>a.far||s.push({distance:I,point:b,face:new nt.Face3(M,A,S,nt.Triangle.normal(r,i,o)),faceIndex:null,object:this})}}else{x=0;var w=0;for(_=(f=u.position.array).length;x<_;x+=3,w+=9){if(M=x,A=x+1,S=x+2,r.fromArray(f,w),i.fromArray(f,w+3),o.fromArray(f,w+6),D.side===nt.BackSide)b=e.intersectTriangle(o,i,r,!0);else b=e.intersectTriangle(r,i,o,D.side!==nt.DoubleSide);if(null!==b)b.applyMatrix4(this.matrixWorld),(I=a.ray.origin.distanceTo(b))<c||I<a.near||I>a.far||s.push({distance:I,point:b,face:new nt.Face3(M,A,S,nt.Triangle.normal(r,i,o)),faceIndex:null,object:this})}}}else if(h instanceof nt.Geometry)for(var M,A,S,C=this.material instanceof nt.MeshFaceMaterial,T=!0===C?this.material.materials:null,E=(c=a.precision,h.vertices),L=0,P=h.faces.length;L<P;L++){var D,R=h.faces[L];if(void 0!==(D=!0===C?T[R.materialIndex]:this.material)){if(M=E[R.a],A=E[R.b],S=E[R.c],!0===D.morphTargets){var F=h.morphTargets,k=this.morphTargetInfluences;r.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var B=0,z=F.length;B<z;B++){var N=k[B];if(0!==N){var U=F[B].vertices;r.x+=(U[R.a].x-M.x)*N,r.y+=(U[R.a].y-M.y)*N,r.z+=(U[R.a].z-M.z)*N,i.x+=(U[R.b].x-A.x)*N,i.y+=(U[R.b].y-A.y)*N,i.z+=(U[R.b].z-A.z)*N,o.x+=(U[R.c].x-S.x)*N,o.y+=(U[R.c].y-S.y)*N,o.z+=(U[R.c].z-S.z)*N}}r.add(M),i.add(A),o.add(S),M=r,A=i,S=o}if(D.side===nt.BackSide)b=e.intersectTriangle(S,A,M,!0);else b=e.intersectTriangle(M,A,S,D.side!==nt.DoubleSide);var I;if(null!==b)b.applyMatrix4(this.matrixWorld),(I=a.ray.origin.distanceTo(b))<c||I<a.near||I>a.far||s.push({distance:I,point:b,face:R,faceIndex:L,object:this})}}}}(),nt.Mesh.prototype.clone=function(t,e){return void 0===t&&(t=new nt.Mesh(this.geometry,this.material)),nt.Object3D.prototype.clone.call(this,t,e),t},nt.Bone=function(t){nt.Object3D.call(this),this.skin=t},nt.Bone.prototype=Object.create(nt.Object3D.prototype),nt.Skeleton=function(t,e,n){var r;(this.useVertexTexture=void 0===n||n,this.identityMatrix=new nt.Matrix4,t=t||[],this.bones=t.slice(0),this.useVertexTexture)?(r=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=r,this.boneTextureHeight=r,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new nt.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,nt.RGBAFormat,nt.FloatType),this.boneTexture.minFilter=nt.NearestFilter,this.boneTexture.magFilter=nt.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var i=0,o=this.bones.length;i<o;i++)this.boneInverses.push(new nt.Matrix4)}},nt.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var n=new nt.Matrix4;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},nt.Skeleton.prototype.pose=function(){for(var t,e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&(t.parent?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},nt.Skeleton.prototype.update=(B=new nt.Matrix4,function(){for(var t=0,e=this.bones.length;t<e;t++){var n=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;B.multiplyMatrices(n,this.boneInverses[t]),B.flattenToArrayOffset(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),nt.SkinnedMesh=function(t,e,n){nt.Mesh.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new nt.Matrix4,this.bindMatrixInverse=new nt.Matrix4;var r=[];if(this.geometry&&void 0!==this.geometry.bones){for(var i,o,a,s,h,u=0,c=this.geometry.bones.length;u<c;++u)a=(o=this.geometry.bones[u]).pos,s=o.rotq,h=o.scl,i=new nt.Bone(this),r.push(i),i.name=o.name,i.position.set(a[0],a[1],a[2]),i.quaternion.set(s[0],s[1],s[2],s[3]),void 0!==h?i.scale.set(h[0],h[1],h[2]):i.scale.set(1,1,1);for(u=0,c=this.geometry.bones.length;u<c;++u)-1!==(o=this.geometry.bones[u]).parent?r[o.parent].add(r[u]):this.add(r[u])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new nt.Skeleton(r,void 0,n))},nt.SkinnedMesh.prototype=Object.create(nt.Mesh.prototype),nt.SkinnedMesh.prototype.bind=function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},nt.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},nt.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof nt.Geometry)for(var t=0;t<this.geometry.skinIndices.length;t++){var e=this.geometry.skinWeights[t],n=1/e.lengthManhattan();n!==1/0?e.multiplyScalar(n):e.set(1)}},nt.SkinnedMesh.prototype.updateMatrixWorld=function(t){nt.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},nt.SkinnedMesh.prototype.clone=function(t){return void 0===t&&(t=new nt.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),nt.Mesh.prototype.clone.call(this,t),t},nt.MorphAnimMesh=function(t,e){nt.Mesh.call(this,t,e),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},nt.MorphAnimMesh.prototype=Object.create(nt.Mesh.prototype),nt.MorphAnimMesh.prototype.setFrameRange=function(t,e){this.startKeyframe=t,this.endKeyframe=e,this.length=this.endKeyframe-this.startKeyframe+1},nt.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},nt.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},nt.MorphAnimMesh.prototype.parseAnimations=function(){var t=this.geometry;t.animations||(t.animations={});for(var e,n=t.animations,r=/([a-z]+)_?(\d+)/,i=0,o=t.morphTargets.length;i<o;i++){var a=t.morphTargets[i].name.match(r);if(a&&a.length>1){var s=a[1];a[2];n[s]||(n[s]={start:1/0,end:-1/0});var h=n[s];i<h.start&&(h.start=i),i>h.end&&(h.end=i),e||(e=s)}}t.firstAnimation=e},nt.MorphAnimMesh.prototype.setAnimationLabel=function(t,e,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[t]={start:e,end:n}},nt.MorphAnimMesh.prototype.playAnimation=function(t,e){var n=this.geometry.animations[t];n?(this.setFrameRange(n.start,n.end),this.duration=(n.end-n.start)/e*1e3,this.time=0):console.warn("animation["+t+"] undefined")},nt.MorphAnimMesh.prototype.updateAnimation=function(t){var e=this.duration/this.length;this.time+=this.direction*t,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var n=this.startKeyframe+nt.Math.clamp(Math.floor(this.time/e),0,this.length-1);n!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[n]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=n);var r=this.time%e/e;this.directionBackwards&&(r=1-r),this.morphTargetInfluences[this.currentKeyframe]=r,this.morphTargetInfluences[this.lastKeyframe]=1-r},nt.MorphAnimMesh.prototype.interpolateTargets=function(t,e,n){for(var r=this.morphTargetInfluences,i=0,o=r.length;i<o;i++)r[i]=0;t>-1&&(r[t]=1-n),e>-1&&(r[e]=n)},nt.MorphAnimMesh.prototype.clone=function(t){return void 0===t&&(t=new nt.MorphAnimMesh(this.geometry,this.material)),t.duration=this.duration,t.mirroredLoop=this.mirroredLoop,t.time=this.time,t.lastKeyframe=this.lastKeyframe,t.currentKeyframe=this.currentKeyframe,t.direction=this.direction,t.directionBackwards=this.directionBackwards,nt.Mesh.prototype.clone.call(this,t),t},nt.LOD=function(){nt.Object3D.call(this),this.objects=[]},nt.LOD.prototype=Object.create(nt.Object3D.prototype),nt.LOD.prototype.addLevel=function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var n=0;n<this.objects.length&&!(e<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:e,object:t}),this.add(t)},nt.LOD.prototype.getObjectForDistance=function(t){for(var e=1,n=this.objects.length;e<n&&!(t<this.objects[e].distance);e++);return this.objects[e-1].object},nt.LOD.prototype.raycast=(z=new nt.Vector3,function(t,e){z.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(z);this.getObjectForDistance(n).raycast(t,e)}),nt.LOD.prototype.update=function(){var t=new nt.Vector3,e=new nt.Vector3;return function(n){if(this.objects.length>1){t.setFromMatrixPosition(n.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var r=t.distanceTo(e);this.objects[0].object.visible=!0;for(var i=1,o=this.objects.length;i<o&&r>=this.objects[i].distance;i++)this.objects[i-1].object.visible=!1,this.objects[i].object.visible=!0;for(;i<o;i++)this.objects[i].object.visible=!1}}}(),nt.LOD.prototype.clone=function(t){void 0===t&&(t=new nt.LOD),nt.Object3D.prototype.clone.call(this,t);for(var e=0,n=this.objects.length;e<n;e++){var r=this.objects[e].object.clone();r.visible=0===e,t.addLevel(r,this.objects[e].distance)}return t},nt.Sprite=(N=new Uint16Array([0,1,2,0,2,3]),U=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),I=new Float32Array([0,0,1,0,1,1,0,1]),(O=new nt.BufferGeometry).addAttribute("index",new nt.BufferAttribute(N,1)),O.addAttribute("position",new nt.BufferAttribute(U,3)),O.addAttribute("uv",new nt.BufferAttribute(I,2)),function(t){nt.Object3D.call(this),this.type="Sprite",this.geometry=O,this.material=void 0!==t?t:new nt.SpriteMaterial}),nt.Sprite.prototype=Object.create(nt.Object3D.prototype),nt.Sprite.prototype.raycast=function(){var t=new nt.Vector3;return function(e,n){t.setFromMatrixPosition(this.matrixWorld);var r=e.ray.distanceToPoint(t);r>this.scale.x||n.push({distance:r,point:this.position,face:null,object:this})}}(),nt.Sprite.prototype.clone=function(t){return void 0===t&&(t=new nt.Sprite(this.material)),nt.Object3D.prototype.clone.call(this,t),t},nt.Particle=nt.Sprite,nt.LensFlare=function(t,e,n,r,i){nt.Object3D.call(this),this.lensFlares=[],this.positionScreen=new nt.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,e,n,r,i)},nt.LensFlare.prototype=Object.create(nt.Object3D.prototype),nt.LensFlare.prototype.add=function(t,e,n,r,i,o){void 0===e&&(e=-1),void 0===n&&(n=0),void 0===o&&(o=1),void 0===i&&(i=new nt.Color(16777215)),void 0===r&&(r=nt.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:t,size:e,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:i,blending:r})},nt.LensFlare.prototype.updateLensFlares=function(){var t,e,n=this.lensFlares.length,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(t=0;t<n;t++)(e=this.lensFlares[t]).x=this.positionScreen.x+r*e.distance,e.y=this.positionScreen.y+i*e.distance,e.wantedRotation=e.x*Math.PI*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)},nt.Scene=function(){nt.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},nt.Scene.prototype=Object.create(nt.Object3D.prototype),nt.Scene.prototype.clone=function(t){return void 0===t&&(t=new nt.Scene),nt.Object3D.prototype.clone.call(this,t),null!==this.fog&&(t.fog=this.fog.clone()),null!==this.overrideMaterial&&(t.overrideMaterial=this.overrideMaterial.clone()),t.autoUpdate=this.autoUpdate,t.matrixAutoUpdate=this.matrixAutoUpdate,t},nt.Fog=function(t,e,n){this.name="",this.color=new nt.Color(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3},nt.Fog.prototype.clone=function(){return new nt.Fog(this.color.getHex(),this.near,this.far)},nt.FogExp2=function(t,e){this.name="",this.color=new nt.Color(t),this.density=void 0!==e?e:25e-5},nt.FogExp2.prototype.clone=function(){return new nt.FogExp2(this.color.getHex(),this.density)},nt.ShaderChunk={},nt.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n",nt.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\tvec3 dirVector = normalize( lDirection.xyz );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat lDistance = 1.0;\n\t\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif",nt.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",nt.ShaderChunk.default_vertex="vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n\tmvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n\tmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n\tmvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;",nt.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",nt.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n",nt.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",nt.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif",nt.ShaderChunk.lights_phong_fragment="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tvec3 pointDiffuse = vec3( 0.0 );\n\tvec3 pointSpecular = vec3( 0.0 );\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\n\t\t\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tvec3 spotDiffuse = vec3( 0.0 );\n\tvec3 spotSpecular = vec3( 0.0 );\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\tspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n\t\t\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\tspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tvec3 dirDiffuse = vec3( 0.0 );\n\tvec3 dirSpecular = vec3( 0.0 );\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\tvec3 dirVector = normalize( lDirection.xyz );\n\n\t\t\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tvec3 hemiDiffuse = vec3( 0.0 );\n\tvec3 hemiSpecular = vec3( 0.0 );\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\themiDiffuse += diffuse * hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\themiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n\ttotalDiffuse += dirDiffuse;\n\ttotalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\ttotalDiffuse += hemiDiffuse;\n\ttotalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\ttotalDiffuse += pointDiffuse;\n\ttotalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\ttotalDiffuse += spotDiffuse;\n\ttotalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif",nt.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",nt.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif",nt.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\tuniform samplerCube envMap;\n\tuniform float flipEnvMap;\n\tuniform int combine;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform bool useRefract;\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif",nt.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",nt.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t\t\t// Per-Pixel Tangent Space Normal Mapping\n\t\t\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",nt.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n",nt.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif",nt.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",nt.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif",nt.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\t#ifdef GAMMA_INPUT\n\n\t\ttexelColor.xyz *= texelColor.xyz;\n\n\t#endif\n\n\tgl_FragColor = gl_FragColor * texelColor;\n\n#endif",nt.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif",nt.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tgl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif",nt.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",nt.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\t#ifdef GAMMA_INPUT\n\n\t\tvColor = color * color;\n\n\t#else\n\n\t\tvColor = color;\n\n\t#endif\n\n#endif",nt.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",nt.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\tuniform bool useRefract;\n\n#endif\n",nt.ShaderChunk.linear_to_gamma_fragment="#ifdef GAMMA_OUTPUT\n\n\tgl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif",nt.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",nt.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n",nt.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",nt.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\tvec3 reflectVec;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\n\t\tvec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n\t\tif ( useRefract ) {\n\n\t\t\treflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t} else { \n\n\t\t\treflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t}\n\n\t#else\n\n\t\treflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t\tvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#else\n\n\t\tvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#endif\n\n\t#ifdef GAMMA_INPUT\n\n\t\tcubeColor.xyz *= cubeColor.xyz;\n\n\t#endif\n\n\tif ( combine == 1 ) {\n\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\n\t} else if ( combine == 2 ) {\n\n\t\tgl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\n\t} else {\n\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\n\t}\n\n#endif",nt.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",nt.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",nt.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",nt.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",nt.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tconst float LOG2 = 1.442695;\n\t\tfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\tgl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif",nt.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t\t\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t\t\t//\thttp://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t\t\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif",nt.ShaderChunk.defaultnormal_vertex="vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n\tobjectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n\tobjectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n\tobjectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;",nt.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",nt.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",nt.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",nt.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\tgl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif",nt.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",nt.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tgl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif",nt.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif",nt.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n\tworldNormal = normalize( worldNormal );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\tif ( useRefract ) {\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t} else {\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t}\n\n#endif",nt.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t#ifdef GAMMA_OUTPUT\n\n\t\tshadowColor *= shadowColor;\n\n\t#endif\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n",nt.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#endif\n\n\t#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#endif\n\n\t#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif",nt.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif",nt.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",nt.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif",nt.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tgl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",nt.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",nt.UniformsUtils={merge:function(t){for(var e={},n=0;n<t.length;n++){var r=this.clone(t[n]);for(var i in r)e[i]=r[i]}return e},clone:function(t){var e={};for(var n in t)for(var r in e[n]={},t[n]){var i=t[n][r];i instanceof nt.Color||i instanceof nt.Vector2||i instanceof nt.Vector3||i instanceof nt.Vector4||i instanceof nt.Matrix4||i instanceof nt.Texture?e[n][r]=i.clone():i instanceof Array?e[n][r]=i.slice():e[n][r]=i}return e}},nt.UniformsLib={common:{diffuse:{type:"c",value:new nt.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new nt.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new nt.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new nt.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new nt.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new nt.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},nt.ShaderLib={basic:{uniforms:nt.UniformsUtils.merge([nt.UniformsLib.common,nt.UniformsLib.fog,nt.UniformsLib.shadowmap]),vertexShader:[nt.ShaderChunk.map_pars_vertex,nt.ShaderChunk.lightmap_pars_vertex,nt.ShaderChunk.envmap_pars_vertex,nt.ShaderChunk.color_pars_vertex,nt.ShaderChunk.morphtarget_pars_vertex,nt.ShaderChunk.skinning_pars_vertex,nt.ShaderChunk.shadowmap_pars_vertex,nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",nt.ShaderChunk.map_vertex,nt.ShaderChunk.lightmap_vertex,nt.ShaderChunk.color_vertex,nt.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",nt.ShaderChunk.morphnormal_vertex,nt.ShaderChunk.skinnormal_vertex,nt.ShaderChunk.defaultnormal_vertex,"\t#endif",nt.ShaderChunk.morphtarget_vertex,nt.ShaderChunk.skinning_vertex,nt.ShaderChunk.default_vertex,nt.ShaderChunk.logdepthbuf_vertex,nt.ShaderChunk.worldpos_vertex,nt.ShaderChunk.envmap_vertex,nt.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",nt.ShaderChunk.color_pars_fragment,nt.ShaderChunk.map_pars_fragment,nt.ShaderChunk.alphamap_pars_fragment,nt.ShaderChunk.lightmap_pars_fragment,nt.ShaderChunk.envmap_pars_fragment,nt.ShaderChunk.fog_pars_fragment,nt.ShaderChunk.shadowmap_pars_fragment,nt.ShaderChunk.specularmap_pars_fragment,nt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( diffuse, opacity );",nt.ShaderChunk.logdepthbuf_fragment,nt.ShaderChunk.map_fragment,nt.ShaderChunk.alphamap_fragment,nt.ShaderChunk.alphatest_fragment,nt.ShaderChunk.specularmap_fragment,nt.ShaderChunk.lightmap_fragment,nt.ShaderChunk.color_fragment,nt.ShaderChunk.envmap_fragment,nt.ShaderChunk.shadowmap_fragment,nt.ShaderChunk.linear_to_gamma_fragment,nt.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:nt.UniformsUtils.merge([nt.UniformsLib.common,nt.UniformsLib.fog,nt.UniformsLib.lights,nt.UniformsLib.shadowmap,{ambient:{type:"c",value:new nt.Color(16777215)},emissive:{type:"c",value:new nt.Color(0)},wrapRGB:{type:"v3",value:new nt.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",nt.ShaderChunk.map_pars_vertex,nt.ShaderChunk.lightmap_pars_vertex,nt.ShaderChunk.envmap_pars_vertex,nt.ShaderChunk.lights_lambert_pars_vertex,nt.ShaderChunk.color_pars_vertex,nt.ShaderChunk.morphtarget_pars_vertex,nt.ShaderChunk.skinning_pars_vertex,nt.ShaderChunk.shadowmap_pars_vertex,nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",nt.ShaderChunk.map_vertex,nt.ShaderChunk.lightmap_vertex,nt.ShaderChunk.color_vertex,nt.ShaderChunk.morphnormal_vertex,nt.ShaderChunk.skinbase_vertex,nt.ShaderChunk.skinnormal_vertex,nt.ShaderChunk.defaultnormal_vertex,nt.ShaderChunk.morphtarget_vertex,nt.ShaderChunk.skinning_vertex,nt.ShaderChunk.default_vertex,nt.ShaderChunk.logdepthbuf_vertex,nt.ShaderChunk.worldpos_vertex,nt.ShaderChunk.envmap_vertex,nt.ShaderChunk.lights_lambert_vertex,nt.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",nt.ShaderChunk.color_pars_fragment,nt.ShaderChunk.map_pars_fragment,nt.ShaderChunk.alphamap_pars_fragment,nt.ShaderChunk.lightmap_pars_fragment,nt.ShaderChunk.envmap_pars_fragment,nt.ShaderChunk.fog_pars_fragment,nt.ShaderChunk.shadowmap_pars_fragment,nt.ShaderChunk.specularmap_pars_fragment,nt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",nt.ShaderChunk.logdepthbuf_fragment,nt.ShaderChunk.map_fragment,nt.ShaderChunk.alphamap_fragment,nt.ShaderChunk.alphatest_fragment,nt.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\tgl_FragColor.xyz *= vLightFront;","\t\telse","\t\t\tgl_FragColor.xyz *= vLightBack;","\t#else","\t\tgl_FragColor.xyz *= vLightFront;","\t#endif",nt.ShaderChunk.lightmap_fragment,nt.ShaderChunk.color_fragment,nt.ShaderChunk.envmap_fragment,nt.ShaderChunk.shadowmap_fragment,nt.ShaderChunk.linear_to_gamma_fragment,nt.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:nt.UniformsUtils.merge([nt.UniformsLib.common,nt.UniformsLib.bump,nt.UniformsLib.normalmap,nt.UniformsLib.fog,nt.UniformsLib.lights,nt.UniformsLib.shadowmap,{ambient:{type:"c",value:new nt.Color(16777215)},emissive:{type:"c",value:new nt.Color(0)},specular:{type:"c",value:new nt.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new nt.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",nt.ShaderChunk.map_pars_vertex,nt.ShaderChunk.lightmap_pars_vertex,nt.ShaderChunk.envmap_pars_vertex,nt.ShaderChunk.lights_phong_pars_vertex,nt.ShaderChunk.color_pars_vertex,nt.ShaderChunk.morphtarget_pars_vertex,nt.ShaderChunk.skinning_pars_vertex,nt.ShaderChunk.shadowmap_pars_vertex,nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",nt.ShaderChunk.map_vertex,nt.ShaderChunk.lightmap_vertex,nt.ShaderChunk.color_vertex,nt.ShaderChunk.morphnormal_vertex,nt.ShaderChunk.skinbase_vertex,nt.ShaderChunk.skinnormal_vertex,nt.ShaderChunk.defaultnormal_vertex,"\tvNormal = normalize( transformedNormal );",nt.ShaderChunk.morphtarget_vertex,nt.ShaderChunk.skinning_vertex,nt.ShaderChunk.default_vertex,nt.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",nt.ShaderChunk.worldpos_vertex,nt.ShaderChunk.envmap_vertex,nt.ShaderChunk.lights_phong_vertex,nt.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",nt.ShaderChunk.color_pars_fragment,nt.ShaderChunk.map_pars_fragment,nt.ShaderChunk.alphamap_pars_fragment,nt.ShaderChunk.lightmap_pars_fragment,nt.ShaderChunk.envmap_pars_fragment,nt.ShaderChunk.fog_pars_fragment,nt.ShaderChunk.lights_phong_pars_fragment,nt.ShaderChunk.shadowmap_pars_fragment,nt.ShaderChunk.bumpmap_pars_fragment,nt.ShaderChunk.normalmap_pars_fragment,nt.ShaderChunk.specularmap_pars_fragment,nt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",nt.ShaderChunk.logdepthbuf_fragment,nt.ShaderChunk.map_fragment,nt.ShaderChunk.alphamap_fragment,nt.ShaderChunk.alphatest_fragment,nt.ShaderChunk.specularmap_fragment,nt.ShaderChunk.lights_phong_fragment,nt.ShaderChunk.lightmap_fragment,nt.ShaderChunk.color_fragment,nt.ShaderChunk.envmap_fragment,nt.ShaderChunk.shadowmap_fragment,nt.ShaderChunk.linear_to_gamma_fragment,nt.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:nt.UniformsUtils.merge([nt.UniformsLib.particle,nt.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",nt.ShaderChunk.color_pars_vertex,nt.ShaderChunk.shadowmap_pars_vertex,nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",nt.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",nt.ShaderChunk.logdepthbuf_vertex,nt.ShaderChunk.worldpos_vertex,nt.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",nt.ShaderChunk.color_pars_fragment,nt.ShaderChunk.map_particle_pars_fragment,nt.ShaderChunk.fog_pars_fragment,nt.ShaderChunk.shadowmap_pars_fragment,nt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( psColor, opacity );",nt.ShaderChunk.logdepthbuf_fragment,nt.ShaderChunk.map_particle_fragment,nt.ShaderChunk.alphatest_fragment,nt.ShaderChunk.color_fragment,nt.ShaderChunk.shadowmap_fragment,nt.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:nt.UniformsUtils.merge([nt.UniformsLib.common,nt.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",nt.ShaderChunk.color_pars_vertex,nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",nt.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",nt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",nt.ShaderChunk.color_pars_fragment,nt.ShaderChunk.fog_pars_fragment,nt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tgl_FragColor = vec4( diffuse, opacity );",nt.ShaderChunk.logdepthbuf_fragment,nt.ShaderChunk.color_fragment,nt.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[nt.ShaderChunk.morphtarget_pars_vertex,nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",nt.ShaderChunk.morphtarget_vertex,nt.ShaderChunk.default_vertex,nt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",nt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",nt.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",nt.ShaderChunk.morphtarget_pars_vertex,nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",nt.ShaderChunk.morphtarget_vertex,nt.ShaderChunk.default_vertex,nt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",nt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",nt.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:nt.UniformsUtils.merge([nt.UniformsLib.fog,nt.UniformsLib.lights,nt.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new nt.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new nt.Color(16777215)},specular:{type:"c",value:new nt.Color(1118481)},ambient:{type:"c",value:new nt.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new nt.Vector2(0,0)},uRepeat:{type:"v2",value:new nt.Vector2(1,1)},wrapRGB:{type:"v3",value:new nt.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","\tuniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",nt.ShaderChunk.shadowmap_pars_fragment,nt.ShaderChunk.fog_pars_fragment,nt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",nt.ShaderChunk.logdepthbuf_fragment,"\tgl_FragColor = vec4( vec3( 1.0 ), opacity );","\tvec3 specularTex = vec3( 1.0 );","\tvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","\tnormalTex.xy *= uNormalScale;","\tnormalTex = normalize( normalTex );","\tif( enableDiffuse ) {","\t\t#ifdef GAMMA_INPUT","\t\t\tvec4 texelColor = texture2D( tDiffuse, vUv );","\t\t\ttexelColor.xyz *= texelColor.xyz;","\t\t\tgl_FragColor = gl_FragColor * texelColor;","\t\t#else","\t\t\tgl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","\t\t#endif","\t}","\tif( enableAO ) {","\t\t#ifdef GAMMA_INPUT","\t\t\tvec4 aoColor = texture2D( tAO, vUv );","\t\t\taoColor.xyz *= aoColor.xyz;","\t\t\tgl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","\t\t#else","\t\t\tgl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","\t\t#endif","\t}",nt.ShaderChunk.alphatest_fragment,"\tif( enableSpecular )","\t\tspecularTex = texture2D( tSpecular, vUv ).xyz;","\tmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","\tvec3 finalNormal = tsb * normalTex;","\t#ifdef FLIP_SIDED","\t\tfinalNormal = -finalNormal;","\t#endif","\tvec3 normal = normalize( finalNormal );","\tvec3 viewPosition = normalize( vViewPosition );","\t#if MAX_POINT_LIGHTS > 0","\t\tvec3 pointDiffuse = vec3( 0.0 );","\t\tvec3 pointSpecular = vec3( 0.0 );","\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","\t\t\tvec3 pointVector = lPosition.xyz + vViewPosition.xyz;","\t\t\tfloat pointDistance = 1.0;","\t\t\tif ( pointLightDistance[ i ] > 0.0 )","\t\t\t\tpointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","\t\t\tpointVector = normalize( pointVector );","\t\t\t#ifdef WRAP_AROUND","\t\t\t\tfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","\t\t\t#else","\t\t\t\tfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","\t\t\t#endif","\t\t\tpointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","\t\t\tvec3 pointHalfVector = normalize( pointVector + viewPosition );","\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","\t\t\tfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );","\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","\t\t}","\t#endif","\t#if MAX_SPOT_LIGHTS > 0","\t\tvec3 spotDiffuse = vec3( 0.0 );","\t\tvec3 spotSpecular = vec3( 0.0 );","\t\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","\t\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","\t\t\tvec3 spotVector = lPosition.xyz + vViewPosition.xyz;","\t\t\tfloat spotDistance = 1.0;","\t\t\tif ( spotLightDistance[ i ] > 0.0 )","\t\t\t\tspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","\t\t\tspotVector = normalize( spotVector );","\t\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","\t\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {","\t\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );","\t\t\t\t#ifdef WRAP_AROUND","\t\t\t\t\tfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","\t\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","\t\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","\t\t\t\t#else","\t\t\t\t\tfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","\t\t\t\t#endif","\t\t\t\tspotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","\t\t\t\tvec3 spotHalfVector = normalize( spotVector + viewPosition );","\t\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","\t\t\t\tfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );","\t\t\t\tspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","\t\t\t}","\t\t}","\t#endif","\t#if MAX_DIR_LIGHTS > 0","\t\tvec3 dirDiffuse = vec3( 0.0 );","\t\tvec3 dirSpecular = vec3( 0.0 );","\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","\t\t\tvec3 dirVector = normalize( lDirection.xyz );","\t\t\t#ifdef WRAP_AROUND","\t\t\t\tfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","\t\t\t\tfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","\t\t\t#else","\t\t\t\tfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","\t\t\t#endif","\t\t\tdirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );","\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","\t\t\tfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","\t\t}","\t#endif","\t#if MAX_HEMI_LIGHTS > 0","\t\tvec3 hemiDiffuse = vec3( 0.0 );","\t\tvec3 hemiSpecular = vec3( 0.0 );","\t\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","\t\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","\t\t\tvec3 lVector = normalize( lDirection.xyz );","\t\t\tfloat dotProduct = dot( normal, lVector );","\t\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","\t\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","\t\t\themiDiffuse += diffuse * hemiColor;","\t\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","\t\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","\t\t\tfloat hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );","\t\t\tvec3 lVectorGround = -lVector;","\t\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","\t\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","\t\t\tfloat hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );","\t\t\tfloat dotProductGround = dot( normal, lVectorGround );","\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","\t\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","\t\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","\t\t\themiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","\t\t}","\t#endif","\tvec3 totalDiffuse = vec3( 0.0 );","\tvec3 totalSpecular = vec3( 0.0 );","\t#if MAX_DIR_LIGHTS > 0","\t\ttotalDiffuse += dirDiffuse;","\t\ttotalSpecular += dirSpecular;","\t#endif","\t#if MAX_HEMI_LIGHTS > 0","\t\ttotalDiffuse += hemiDiffuse;","\t\ttotalSpecular += hemiSpecular;","\t#endif","\t#if MAX_POINT_LIGHTS > 0","\t\ttotalDiffuse += pointDiffuse;","\t\ttotalSpecular += pointSpecular;","\t#endif","\t#if MAX_SPOT_LIGHTS > 0","\t\ttotalDiffuse += spotDiffuse;","\t\ttotalSpecular += spotSpecular;","\t#endif","\t#ifdef METAL","\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","\t#else","\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","\t#endif","\tif ( enableReflection ) {","\t\tvec3 vReflect;","\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","\t\tif ( useRefract ) {","\t\t\tvReflect = refract( cameraToVertex, normal, refractionRatio );","\t\t} else {","\t\t\tvReflect = reflect( cameraToVertex, normal );","\t\t}","\t\tvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","\t\t#ifdef GAMMA_INPUT","\t\t\tcubeColor.xyz *= cubeColor.xyz;","\t\t#endif","\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","\t}",nt.ShaderChunk.shadowmap_fragment,nt.ShaderChunk.linear_to_gamma_fragment,nt.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","\tuniform sampler2D tDisplacement;","\tuniform float uDisplacementScale;","\tuniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",nt.ShaderChunk.skinning_pars_vertex,nt.ShaderChunk.shadowmap_pars_vertex,nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",nt.ShaderChunk.skinbase_vertex,nt.ShaderChunk.skinnormal_vertex,"\t#ifdef USE_SKINNING","\t\tvNormal = normalize( normalMatrix * skinnedNormal.xyz );","\t\tvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","\t\tvTangent = normalize( normalMatrix * skinnedTangent.xyz );","\t#else","\t\tvNormal = normalize( normalMatrix * normal );","\t\tvTangent = normalize( normalMatrix * tangent.xyz );","\t#endif","\tvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","\tvUv = uv * uRepeat + uOffset;","\tvec3 displacedPosition;","\t#ifdef VERTEX_TEXTURES","\t\tif ( enableDisplacement ) {","\t\t\tvec3 dv = texture2D( tDisplacement, uv ).xyz;","\t\t\tfloat df = uDisplacementScale * dv.x + uDisplacementBias;","\t\t\tdisplacedPosition = position + normalize( normal ) * df;","\t\t} else {","\t\t\t#ifdef USE_SKINNING","\t\t\t\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );","\t\t\t\tvec4 skinned = vec4( 0.0 );","\t\t\t\tskinned += boneMatX * skinVertex * skinWeight.x;","\t\t\t\tskinned += boneMatY * skinVertex * skinWeight.y;","\t\t\t\tskinned += boneMatZ * skinVertex * skinWeight.z;","\t\t\t\tskinned += boneMatW * skinVertex * skinWeight.w;","\t\t\t\tskinned  = bindMatrixInverse * skinned;","\t\t\t\tdisplacedPosition = skinned.xyz;","\t\t\t#else","\t\t\t\tdisplacedPosition = position;","\t\t\t#endif","\t\t}","\t#else","\t\t#ifdef USE_SKINNING","\t\t\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );","\t\t\tvec4 skinned = vec4( 0.0 );","\t\t\tskinned += boneMatX * skinVertex * skinWeight.x;","\t\t\tskinned += boneMatY * skinVertex * skinWeight.y;","\t\t\tskinned += boneMatZ * skinVertex * skinWeight.z;","\t\t\tskinned += boneMatW * skinVertex * skinWeight.w;","\t\t\tskinned  = bindMatrixInverse * skinned;","\t\t\tdisplacedPosition = skinned.xyz;","\t\t#else","\t\t\tdisplacedPosition = position;","\t\t#endif","\t#endif","\tvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",nt.ShaderChunk.logdepthbuf_vertex,"\tvWorldPosition = worldPosition.xyz;","\tvViewPosition = -mvPosition.xyz;","\t#ifdef USE_SHADOWMAP","\t\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {","\t\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","\t\t}","\t#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",nt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",nt.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",nt.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[nt.ShaderChunk.morphtarget_pars_vertex,nt.ShaderChunk.skinning_pars_vertex,nt.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",nt.ShaderChunk.skinbase_vertex,nt.ShaderChunk.morphtarget_vertex,nt.ShaderChunk.skinning_vertex,nt.ShaderChunk.default_vertex,nt.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[nt.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",nt.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}},nt.WebGLRenderer=function(t){console.log("THREE.WebGLRenderer",nt.REVISION);var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElement("canvas"),n=void 0!==t.context?t.context:null,r=void 0!==t.precision?t.precision:"highp",i=void 0!==t.alpha&&t.alpha,o=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,h=void 0===t.premultipliedAlpha||t.premultipliedAlpha,u=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.logarithmicDepthBuffer&&t.logarithmicDepthBuffer,l=new nt.Color(0),f=0,p=[],d={},m=[],g=[],v=[],y=[],x=[];this.domElement=e,this.context=null,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==et.devicePixelRatio?et.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=nt.PCFShadowMap,this.shadowMapCullFace=nt.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _,b=this,w=[],M=null,A=null,S=-1,C=-1,T=null,E=0,L=-1,P=-1,D=-1,R=-1,F=-1,k=-1,B=-1,z=-1,N=null,U=null,I=null,O=null,V=0,H=0,G=e.width,j=e.height,W=0,X=0,q=new Uint8Array(16),Q=new Uint8Array(16),Y=new nt.Frustum,K=new nt.Matrix4,J=new nt.Matrix4,Z=new nt.Vector3,$=new nt.Vector3,tt=!0,rt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var it={alpha:i,depth:o,stencil:a,antialias:s,premultipliedAlpha:h,preserveDrawingBuffer:u};if(null===(_=n||e.getContext("webgl",it)||e.getContext("experimental-webgl",it)))throw null!==e.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context."}catch(t){console.error(t)}void 0===_.getShaderPrecisionFormat&&(_.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var ot=new nt.WebGLExtensions(_);ot.get("OES_texture_float"),ot.get("OES_texture_float_linear"),ot.get("OES_standard_derivatives"),c&&ot.get("EXT_frag_depth"),_.clearColor(0,0,0,1),_.clearDepth(1),_.clearStencil(0),_.enable(_.DEPTH_TEST),_.depthFunc(_.LEQUAL),_.frontFace(_.CCW),_.cullFace(_.BACK),_.enable(_.CULL_FACE),_.enable(_.BLEND),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA),_.viewport(V,H,G,j),_.clearColor(l.r,l.g,l.b,f),this.context=_;var at,st=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS),ht=_.getParameter(_.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ut=_.getParameter(_.MAX_TEXTURE_SIZE),ct=_.getParameter(_.MAX_CUBE_MAP_TEXTURE_SIZE),lt=ht>0,ft=lt&&ot.get("OES_texture_float"),pt=_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.HIGH_FLOAT),dt=_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.MEDIUM_FLOAT),mt=(_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.LOW_FLOAT),_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.HIGH_FLOAT)),gt=_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.MEDIUM_FLOAT),vt=(_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.LOW_FLOAT),function(){if(void 0!==at)return at;if(at=[],ot.get("WEBGL_compressed_texture_pvrtc")||ot.get("WEBGL_compressed_texture_s3tc"))for(var t=_.getParameter(_.COMPRESSED_TEXTURE_FORMATS),e=0;e<t.length;e++)at.push(t[e]);return at}),yt=pt.precision>0&&mt.precision>0,xt=dt.precision>0&&gt.precision>0;"highp"!==r||yt||(xt?(r="mediump",console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(r="lowp",console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==r||xt||(r="lowp",console.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var _t,bt=new nt.ShadowMapPlugin(this,p,d,m),wt=new nt.SpritePlugin(this,y),Mt=new nt.LensFlarePlugin(this,x);function At(t){var e,n;if(t.__webglVertexBuffer=_.createBuffer(),t.__webglNormalBuffer=_.createBuffer(),t.__webglTangentBuffer=_.createBuffer(),t.__webglColorBuffer=_.createBuffer(),t.__webglUVBuffer=_.createBuffer(),t.__webglUV2Buffer=_.createBuffer(),t.__webglSkinIndicesBuffer=_.createBuffer(),t.__webglSkinWeightsBuffer=_.createBuffer(),t.__webglFaceBuffer=_.createBuffer(),t.__webglLineBuffer=_.createBuffer(),t.numMorphTargets)for(t.__webglMorphTargetsBuffers=[],e=0,n=t.numMorphTargets;e<n;e++)t.__webglMorphTargetsBuffers.push(_.createBuffer());if(t.numMorphNormals)for(t.__webglMorphNormalsBuffers=[],e=0,n=t.numMorphNormals;e<n;e++)t.__webglMorphNormalsBuffers.push(_.createBuffer());b.info.memory.geometries++}this.getContext=function(){return _},this.supportsVertexTextures=function(){return lt},this.supportsFloatTextures=function(){return ot.get("OES_texture_float")},this.supportsStandardDerivatives=function(){return ot.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return ot.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return ot.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return ot.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){if(void 0!==_t)return _t;var t=ot.get("EXT_texture_filter_anisotropic");return _t=null!==t?_.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPrecision=function(){return r},this.setSize=function(t,n,r){e.width=t*this.devicePixelRatio,e.height=n*this.devicePixelRatio,!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n)},this.setViewport=function(t,e,n,r){V=t*this.devicePixelRatio,H=e*this.devicePixelRatio,G=n*this.devicePixelRatio,j=r*this.devicePixelRatio,_.viewport(V,H,G,j)},this.setScissor=function(t,e,n,r){_.scissor(t*this.devicePixelRatio,e*this.devicePixelRatio,n*this.devicePixelRatio,r*this.devicePixelRatio)},this.enableScissorTest=function(t){t?_.enable(_.SCISSOR_TEST):_.disable(_.SCISSOR_TEST)},this.setClearColor=function(t,e){l.set(t),f=void 0!==e?e:1,_.clearColor(l.r,l.g,l.b,f)},this.setClearColorHex=function(t,e){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(t,e)},this.getClearColor=function(){return l},this.getClearAlpha=function(){return f},this.clear=function(t,e,n){var r=0;(void 0===t||t)&&(r|=_.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=_.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=_.STENCIL_BUFFER_BIT),_.clear(r)},this.clearColor=function(){_.clear(_.COLOR_BUFFER_BIT)},this.clearDepth=function(){_.clear(_.DEPTH_BUFFER_BIT)},this.clearStencil=function(){_.clear(_.STENCIL_BUFFER_BIT)},this.clearTarget=function(t,e,n,r){this.setRenderTarget(t),this.clear(e,n,r)},this.resetGLState=function(){M=null,T=null,D=-1,B=-1,z=-1,L=-1,P=-1,C=-1,S=-1,tt=!0};var St=function(t){t.target.traverse(function(t){t.removeEventListener("remove",St),function(t){t instanceof nt.Mesh||t instanceof nt.PointCloud||t instanceof nt.Line?delete d[t.id]:(t instanceof nt.ImmediateRenderObject||t.immediateRenderCallback)&&function(t,e){for(var n=t.length-1;n>=0;n--)t[n].object===e&&t.splice(n,1)}(m,t);delete t.__webglInit,delete t._modelViewMatrix,delete t._normalMatrix,delete t.__webglActive}(t)})},Ct=function(t){var e=t.target;e.removeEventListener("dispose",Ct),Dt(e)},Tt=function(t){var e=t.target;e.removeEventListener("dispose",Tt),Rt(e),b.info.memory.textures--},Et=function(t){var e=t.target;e.removeEventListener("dispose",Et),Ft(e),b.info.memory.textures--},Lt=function(t){var e=t.target;e.removeEventListener("dispose",Lt),kt(e)},Pt=function(t){for(var e=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],n=0,r=e.length;n<r;n++){void 0!==t[i=e[n]]&&(_.deleteBuffer(t[i]),delete t[i])}if(void 0!==t.__webglCustomAttributesList){for(var i in t.__webglCustomAttributesList)_.deleteBuffer(t.__webglCustomAttributesList[i].buffer);delete t.__webglCustomAttributesList}b.info.memory.geometries--},Dt=function(t){if(delete t.__webglInit,t instanceof nt.BufferGeometry){for(var e in t.attributes){var n=t.attributes[e];void 0!==n.buffer&&(_.deleteBuffer(n.buffer),delete n.buffer)}b.info.memory.geometries--}else{var r=Kt[t.id];if(void 0!==r){for(var i=0,o=r.length;i<o;i++){var a=r[i];if(void 0!==a.numMorphTargets){for(var s=0,h=a.numMorphTargets;s<h;s++)_.deleteBuffer(a.__webglMorphTargetsBuffers[s]);delete a.__webglMorphTargetsBuffers}if(void 0!==a.numMorphNormals){for(s=0,h=a.numMorphNormals;s<h;s++)_.deleteBuffer(a.__webglMorphNormalsBuffers[s]);delete a.__webglMorphNormalsBuffers}Pt(a)}delete Kt[t.id]}else Pt(t)}C=-1},Rt=function(t){if(t.image&&t.image.__webglTextureCube)_.deleteTexture(t.image.__webglTextureCube),delete t.image.__webglTextureCube;else{if(void 0===t.__webglInit)return;_.deleteTexture(t.__webglTexture),delete t.__webglTexture,delete t.__webglInit}},Ft=function(t){if(t&&void 0!==t.__webglTexture){if(_.deleteTexture(t.__webglTexture),delete t.__webglTexture,t instanceof nt.WebGLRenderTargetCube)for(var e=0;e<6;e++)_.deleteFramebuffer(t.__webglFramebuffer[e]),_.deleteRenderbuffer(t.__webglRenderbuffer[e]);else _.deleteFramebuffer(t.__webglFramebuffer),_.deleteRenderbuffer(t.__webglRenderbuffer);delete t.__webglFramebuffer,delete t.__webglRenderbuffer}},kt=function(t){var e=t.program.program;if(void 0!==e){var n,r,i;t.program=void 0;var o=!1;for(n=0,r=w.length;n<r;n++)if((i=w[n]).program===e){i.usedTimes--,0===i.usedTimes&&(o=!0);break}if(!0===o){var a=[];for(n=0,r=w.length;n<r;n++)(i=w[n]).program!==e&&a.push(i);w=a,_.deleteProgram(e),b.info.memory.programs--}}};function Bt(t){var e=t.geometry,n=t.material,r=e.vertices.length;if(n.attributes)for(var i in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),n.attributes){var o=n.attributes[i];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(r*a),o.buffer=_.createBuffer(),o.buffer.belongsToAttribute=i,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function zt(t,e){var n=e.geometry,r=t.faces3,i=3*r.length,o=1*r.length,a=3*r.length,s=Nt(e,t);t.__vertexArray=new Float32Array(3*i),t.__normalArray=new Float32Array(3*i),t.__colorArray=new Float32Array(3*i),t.__uvArray=new Float32Array(2*i),n.faceVertexUvs.length>1&&(t.__uv2Array=new Float32Array(2*i)),n.hasTangents&&(t.__tangentArray=new Float32Array(4*i)),e.geometry.skinWeights.length&&e.geometry.skinIndices.length&&(t.__skinIndexArray=new Float32Array(4*i),t.__skinWeightArray=new Float32Array(4*i));var h,u,c=null!==ot.get("OES_element_index_uint")&&o>21845?Uint32Array:Uint16Array;if(t.__typeArray=c,t.__faceArray=new c(3*o),t.__lineArray=new c(2*a),t.numMorphTargets)for(t.__morphTargetsArrays=[],h=0,u=t.numMorphTargets;h<u;h++)t.__morphTargetsArrays.push(new Float32Array(3*i));if(t.numMorphNormals)for(t.__morphNormalsArrays=[],h=0,u=t.numMorphNormals;h<u;h++)t.__morphNormalsArrays.push(new Float32Array(3*i));if(t.__webglFaceCount=3*o,t.__webglLineCount=2*a,s.attributes)for(var l in void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]),s.attributes){var f=s.attributes[l],p={};for(var d in f)p[d]=f[d];if(!p.__webglInitialized||p.createUniqueBuffers){p.__webglInitialized=!0;var m=1;"v2"===p.type?m=2:"v3"===p.type?m=3:"v4"===p.type?m=4:"c"===p.type&&(m=3),p.size=m,p.array=new Float32Array(i*m),p.buffer=_.createBuffer(),p.buffer.belongsToAttribute=l,f.needsUpdate=!0,p.__original=f}t.__webglCustomAttributesList.push(p)}t.__inittedArrays=!0}function Nt(t,e){return t.material instanceof nt.MeshFaceMaterial?t.material.materials[e.materialIndex]:t.material}function Ut(t,e,n,r,i){if(t.__inittedArrays){var o,a,s,h,u,c,l,f,p,d,m,g,v,y,x,b,w,M,A,S,C,T,E,L,P,D,R,F,k,B,z,N,U,I,O,V,H,G,j,W,X,q=function(t){return t&&void 0!==t.shading&&t.shading===nt.SmoothShading}(i),Q=0,Y=0,K=0,J=0,Z=0,$=0,tt=0,et=0,rt=0,it=0,ot=0,at=0,st=t.__vertexArray,ht=t.__uvArray,ut=t.__uv2Array,ct=t.__normalArray,lt=t.__tangentArray,ft=t.__colorArray,pt=t.__skinIndexArray,dt=t.__skinWeightArray,mt=t.__morphTargetsArrays,gt=t.__morphNormalsArrays,vt=t.__webglCustomAttributesList,yt=t.__faceArray,xt=t.__lineArray,_t=e.geometry,bt=_t.verticesNeedUpdate,wt=_t.elementsNeedUpdate,Mt=_t.uvsNeedUpdate,At=_t.normalsNeedUpdate,St=_t.tangentsNeedUpdate,Ct=_t.colorsNeedUpdate,Tt=_t.morphTargetsNeedUpdate,Et=_t.vertices,Lt=t.faces3,Pt=_t.faces,Dt=_t.faceVertexUvs[0],Rt=_t.faceVertexUvs[1],Ft=(_t.colors,_t.skinIndices),kt=_t.skinWeights,Bt=_t.morphTargets,zt=_t.morphNormals;if(bt){for(o=0,a=Lt.length;o<a;o++)m=Et[(s=Pt[Lt[o]]).a],g=Et[s.b],v=Et[s.c],st[Y]=m.x,st[Y+1]=m.y,st[Y+2]=m.z,st[Y+3]=g.x,st[Y+4]=g.y,st[Y+5]=g.z,st[Y+6]=v.x,st[Y+7]=v.y,st[Y+8]=v.z,Y+=9;_.bindBuffer(_.ARRAY_BUFFER,t.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,st,n)}if(Tt)for(I=0,O=Bt.length;I<O;I++){for(ot=0,o=0,a=Lt.length;o<a;o++)s=Pt[G=Lt[o]],m=Bt[I].vertices[s.a],g=Bt[I].vertices[s.b],v=Bt[I].vertices[s.c],(V=mt[I])[ot]=m.x,V[ot+1]=m.y,V[ot+2]=m.z,V[ot+3]=g.x,V[ot+4]=g.y,V[ot+5]=g.z,V[ot+6]=v.x,V[ot+7]=v.y,V[ot+8]=v.z,i.morphNormals&&(q?(w=(j=zt[I].vertexNormals[G]).a,M=j.b,A=j.c):(M=w=zt[I].faceNormals[G],A=w),(H=gt[I])[ot]=w.x,H[ot+1]=w.y,H[ot+2]=w.z,H[ot+3]=M.x,H[ot+4]=M.y,H[ot+5]=M.z,H[ot+6]=A.x,H[ot+7]=A.y,H[ot+8]=A.z),ot+=9;_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[I]),_.bufferData(_.ARRAY_BUFFER,mt[I],n),i.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[I]),_.bufferData(_.ARRAY_BUFFER,gt[I],n))}if(kt.length){for(o=0,a=Lt.length;o<a;o++)E=kt[(s=Pt[Lt[o]]).a],L=kt[s.b],P=kt[s.c],dt[it]=E.x,dt[it+1]=E.y,dt[it+2]=E.z,dt[it+3]=E.w,dt[it+4]=L.x,dt[it+5]=L.y,dt[it+6]=L.z,dt[it+7]=L.w,dt[it+8]=P.x,dt[it+9]=P.y,dt[it+10]=P.z,dt[it+11]=P.w,D=Ft[s.a],R=Ft[s.b],F=Ft[s.c],pt[it]=D.x,pt[it+1]=D.y,pt[it+2]=D.z,pt[it+3]=D.w,pt[it+4]=R.x,pt[it+5]=R.y,pt[it+6]=R.z,pt[it+7]=R.w,pt[it+8]=F.x,pt[it+9]=F.y,pt[it+10]=F.z,pt[it+11]=F.w,it+=12;it>0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglSkinIndicesBuffer),_.bufferData(_.ARRAY_BUFFER,pt,n),_.bindBuffer(_.ARRAY_BUFFER,t.__webglSkinWeightsBuffer),_.bufferData(_.ARRAY_BUFFER,dt,n))}if(Ct){for(o=0,a=Lt.length;o<a;o++)c=(s=Pt[Lt[o]]).vertexColors,l=s.color,3===c.length&&i.vertexColors===nt.VertexColors?(S=c[0],C=c[1],T=c[2]):(S=l,C=l,T=l),ft[rt]=S.r,ft[rt+1]=S.g,ft[rt+2]=S.b,ft[rt+3]=C.r,ft[rt+4]=C.g,ft[rt+5]=C.b,ft[rt+6]=T.r,ft[rt+7]=T.g,ft[rt+8]=T.b,rt+=9;rt>0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,ft,n))}if(St&&_t.hasTangents){for(o=0,a=Lt.length;o<a;o++)y=(f=(s=Pt[Lt[o]]).vertexTangents)[0],x=f[1],b=f[2],lt[tt]=y.x,lt[tt+1]=y.y,lt[tt+2]=y.z,lt[tt+3]=y.w,lt[tt+4]=x.x,lt[tt+5]=x.y,lt[tt+6]=x.z,lt[tt+7]=x.w,lt[tt+8]=b.x,lt[tt+9]=b.y,lt[tt+10]=b.z,lt[tt+11]=b.w,tt+=12;_.bindBuffer(_.ARRAY_BUFFER,t.__webglTangentBuffer),_.bufferData(_.ARRAY_BUFFER,lt,n)}if(At){for(o=0,a=Lt.length;o<a;o++)if(h=(s=Pt[Lt[o]]).vertexNormals,u=s.normal,3===h.length&&q)for(k=0;k<3;k++)z=h[k],ct[$]=z.x,ct[$+1]=z.y,ct[$+2]=z.z,$+=3;else for(k=0;k<3;k++)ct[$]=u.x,ct[$+1]=u.y,ct[$+2]=u.z,$+=3;_.bindBuffer(_.ARRAY_BUFFER,t.__webglNormalBuffer),_.bufferData(_.ARRAY_BUFFER,ct,n)}if(Mt&&Dt){for(o=0,a=Lt.length;o<a;o++)if(void 0!==(p=Dt[Lt[o]]))for(k=0;k<3;k++)N=p[k],ht[K]=N.x,ht[K+1]=N.y,K+=2;K>0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglUVBuffer),_.bufferData(_.ARRAY_BUFFER,ht,n))}if(Mt&&Rt){for(o=0,a=Lt.length;o<a;o++)if(void 0!==(d=Rt[Lt[o]]))for(k=0;k<3;k++)U=d[k],ut[J]=U.x,ut[J+1]=U.y,J+=2;J>0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglUV2Buffer),_.bufferData(_.ARRAY_BUFFER,ut,n))}if(wt){for(o=0,a=Lt.length;o<a;o++)yt[Z]=Q,yt[Z+1]=Q+1,yt[Z+2]=Q+2,Z+=3,xt[et]=Q,xt[et+1]=Q+1,xt[et+2]=Q,xt[et+3]=Q+2,xt[et+4]=Q+1,xt[et+5]=Q+2,et+=6,Q+=3;_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,yt,n),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,xt,n)}if(vt)for(k=0,B=vt.length;k<B;k++)if((X=vt[k]).__original.needsUpdate){if(at=0,0,1===X.size){if(void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)s=Pt[Lt[o]],X.array[at]=X.value[s.a],X.array[at+1]=X.value[s.b],X.array[at+2]=X.value[s.c],at+=3;else if("faces"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)W=X.value[Lt[o]],X.array[at]=W,X.array[at+1]=W,X.array[at+2]=W,at+=3}else if(2===X.size){if(void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)s=Pt[Lt[o]],m=X.value[s.a],g=X.value[s.b],v=X.value[s.c],X.array[at]=m.x,X.array[at+1]=m.y,X.array[at+2]=g.x,X.array[at+3]=g.y,X.array[at+4]=v.x,X.array[at+5]=v.y,at+=6;else if("faces"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)m=W=X.value[Lt[o]],g=W,v=W,X.array[at]=m.x,X.array[at+1]=m.y,X.array[at+2]=g.x,X.array[at+3]=g.y,X.array[at+4]=v.x,X.array[at+5]=v.y,at+=6}else if(3===X.size){var Nt;if(Nt="c"===X.type?["r","g","b"]:["x","y","z"],void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)s=Pt[Lt[o]],m=X.value[s.a],g=X.value[s.b],v=X.value[s.c],X.array[at]=m[Nt[0]],X.array[at+1]=m[Nt[1]],X.array[at+2]=m[Nt[2]],X.array[at+3]=g[Nt[0]],X.array[at+4]=g[Nt[1]],X.array[at+5]=g[Nt[2]],X.array[at+6]=v[Nt[0]],X.array[at+7]=v[Nt[1]],X.array[at+8]=v[Nt[2]],at+=9;else if("faces"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)m=W=X.value[Lt[o]],g=W,v=W,X.array[at]=m[Nt[0]],X.array[at+1]=m[Nt[1]],X.array[at+2]=m[Nt[2]],X.array[at+3]=g[Nt[0]],X.array[at+4]=g[Nt[1]],X.array[at+5]=g[Nt[2]],X.array[at+6]=v[Nt[0]],X.array[at+7]=v[Nt[1]],X.array[at+8]=v[Nt[2]],at+=9;else if("faceVertices"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)m=(W=X.value[Lt[o]])[0],g=W[1],v=W[2],X.array[at]=m[Nt[0]],X.array[at+1]=m[Nt[1]],X.array[at+2]=m[Nt[2]],X.array[at+3]=g[Nt[0]],X.array[at+4]=g[Nt[1]],X.array[at+5]=g[Nt[2]],X.array[at+6]=v[Nt[0]],X.array[at+7]=v[Nt[1]],X.array[at+8]=v[Nt[2]],at+=9}else if(4===X.size)if(void 0===X.boundTo||"vertices"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)s=Pt[Lt[o]],m=X.value[s.a],g=X.value[s.b],v=X.value[s.c],X.array[at]=m.x,X.array[at+1]=m.y,X.array[at+2]=m.z,X.array[at+3]=m.w,X.array[at+4]=g.x,X.array[at+5]=g.y,X.array[at+6]=g.z,X.array[at+7]=g.w,X.array[at+8]=v.x,X.array[at+9]=v.y,X.array[at+10]=v.z,X.array[at+11]=v.w,at+=12;else if("faces"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)m=W=X.value[Lt[o]],g=W,v=W,X.array[at]=m.x,X.array[at+1]=m.y,X.array[at+2]=m.z,X.array[at+3]=m.w,X.array[at+4]=g.x,X.array[at+5]=g.y,X.array[at+6]=g.z,X.array[at+7]=g.w,X.array[at+8]=v.x,X.array[at+9]=v.y,X.array[at+10]=v.z,X.array[at+11]=v.w,at+=12;else if("faceVertices"===X.boundTo)for(o=0,a=Lt.length;o<a;o++)m=(W=X.value[Lt[o]])[0],g=W[1],v=W[2],X.array[at]=m.x,X.array[at+1]=m.y,X.array[at+2]=m.z,X.array[at+3]=m.w,X.array[at+4]=g.x,X.array[at+5]=g.y,X.array[at+6]=g.z,X.array[at+7]=g.w,X.array[at+8]=v.x,X.array[at+9]=v.y,X.array[at+10]=v.z,X.array[at+11]=v.w,at+=12;_.bindBuffer(_.ARRAY_BUFFER,X.buffer),_.bufferData(_.ARRAY_BUFFER,X.array,n)}r&&(delete t.__inittedArrays,delete t.__colorArray,delete t.__normalArray,delete t.__tangentArray,delete t.__uvArray,delete t.__uv2Array,delete t.__faceArray,delete t.__vertexArray,delete t.__lineArray,delete t.__skinIndexArray,delete t.__skinWeightArray)}}function It(t,e,n,r){for(var i=n.attributes,o=e.attributes,a=e.attributesKeys,s=0,h=a.length;s<h;s++){var u=a[s],c=o[u];if(c>=0){var l=i[u];if(void 0!==l){var f=l.itemSize;_.bindBuffer(_.ARRAY_BUFFER,l.buffer),Vt(c),_.vertexAttribPointer(c,f,_.FLOAT,!1,0,r*f*4)}else void 0!==t.defaultAttributeValues&&(2===t.defaultAttributeValues[u].length?_.vertexAttrib2fv(c,t.defaultAttributeValues[u]):3===t.defaultAttributeValues[u].length&&_.vertexAttrib3fv(c,t.defaultAttributeValues[u]))}}Ht()}function Ot(){for(var t=0,e=q.length;t<e;t++)q[t]=0}function Vt(t){q[t]=1,0===Q[t]&&(_.enableVertexAttribArray(t),Q[t]=1)}function Ht(){for(var t=0,e=Q.length;t<e;t++)Q[t]!==q[t]&&(_.disableVertexAttribArray(t),Q[t]=0)}function Gt(t,e){return t.material.id!==e.material.id?e.material.id-t.material.id:t.z!==e.z?e.z-t.z:t.id-e.id}function jt(t,e){return t.z!==e.z?t.z-e.z:t.id-e.id}function Wt(t,e){return e[0]-t[0]}function Xt(t,e,n,r,i,o){for(var a,s=t.length-1;-1!==s;s--){var h=t[s],u=h.object,c=h.buffer;if(se(u,e),o)a=o;else{if(!(a=h.material))continue;i&&b.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),b.setDepthTest(a.depthTest),b.setDepthWrite(a.depthWrite),le(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}b.setMaterialFaces(a),c instanceof nt.BufferGeometry?b.renderBufferDirect(e,n,r,a,c,u):b.renderBuffer(e,n,r,a,c,u)}}function qt(t,e,n,r,i,o,a){for(var s,h=0,u=t.length;h<u;h++){var c=t[h],l=c.object;if(l.visible){if(a)s=a;else{if(!(s=c[e]))continue;o&&b.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),b.setDepthTest(s.depthTest),b.setDepthWrite(s.depthWrite),le(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}b.renderImmediateObject(n,r,i,s,l)}}}function Qt(t){var e=t.object.material;e.transparent?(t.transparent=e,t.opaque=null):(t.opaque=e,t.transparent=null)}function Yt(t){var e=t.object,n=t.buffer,r=e.geometry,i=e.material;if(i instanceof nt.MeshFaceMaterial){var o=r instanceof nt.BufferGeometry?0:n.materialIndex;i=i.materials[o],t.material=i,i.transparent?v.push(t):g.push(t)}else i&&(t.material=i,i.transparent?v.push(t):g.push(t))}this.renderBufferImmediate=function(t,e,n){if(Ot(),t.hasPositions&&!t.__webglVertexBuffer&&(t.__webglVertexBuffer=_.createBuffer()),t.hasNormals&&!t.__webglNormalBuffer&&(t.__webglNormalBuffer=_.createBuffer()),t.hasUvs&&!t.__webglUvBuffer&&(t.__webglUvBuffer=_.createBuffer()),t.hasColors&&!t.__webglColorBuffer&&(t.__webglColorBuffer=_.createBuffer()),t.hasPositions&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,t.positionArray,_.DYNAMIC_DRAW),Vt(e.attributes.position),_.vertexAttribPointer(e.attributes.position,3,_.FLOAT,!1,0,0)),t.hasNormals){if(_.bindBuffer(_.ARRAY_BUFFER,t.__webglNormalBuffer),n.shading===nt.FlatShading){var r,i,o,a,s,h,u,c,l,f,p,d=3*t.count;for(p=0;p<d;p+=9)a=(f=t.normalArray)[p],h=f[p+1],c=f[p+2],s=f[p+3],u=f[p+4],l=f[p+5],r=(a+s+f[p+6])/3,i=(h+u+f[p+7])/3,o=(c+l+f[p+8])/3,f[p]=r,f[p+1]=i,f[p+2]=o,f[p+3]=r,f[p+4]=i,f[p+5]=o,f[p+6]=r,f[p+7]=i,f[p+8]=o}_.bufferData(_.ARRAY_BUFFER,t.normalArray,_.DYNAMIC_DRAW),Vt(e.attributes.normal),_.vertexAttribPointer(e.attributes.normal,3,_.FLOAT,!1,0,0)}t.hasUvs&&n.map&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglUvBuffer),_.bufferData(_.ARRAY_BUFFER,t.uvArray,_.DYNAMIC_DRAW),Vt(e.attributes.uv),_.vertexAttribPointer(e.attributes.uv,2,_.FLOAT,!1,0,0)),t.hasColors&&n.vertexColors!==nt.NoColors&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,t.colorArray,_.DYNAMIC_DRAW),Vt(e.attributes.color),_.vertexAttribPointer(e.attributes.color,3,_.FLOAT,!1,0,0)),Ht(),_.drawArrays(_.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,o){if(!1!==r.visible){var a=re(t,e,n,r,o),s=!1,h=r.wireframe?1:0,u=16777215*i.id+2*a.id+h;if(u!==C&&(C=u,s=!0),s&&Ot(),o instanceof nt.Mesh){var c=!0===r.wireframe?_.LINES:_.TRIANGLES;if(m=i.attributes.index){if(m.array instanceof Uint32Array&&ot.get("OES_element_index_uint")?(g=_.UNSIGNED_INT,v=4):(g=_.UNSIGNED_SHORT,v=2),0===(y=i.offsets).length)s&&(It(r,a,i,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(c,m.array.length,g,0),b.info.render.calls++,b.info.render.vertices+=m.array.length,b.info.render.faces+=m.array.length/3;else{s=!0;for(var l=0,f=y.length;l<f;l++){var p=y[l].index;s&&(It(r,a,i,p),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(c,y[l].count,g,y[l].start*v),b.info.render.calls++,b.info.render.vertices+=y[l].count,b.info.render.faces+=y[l].count/3}}}else{s&&It(r,a,i,0);var d=i.attributes.position;_.drawArrays(c,0,d.array.length/3),b.info.render.calls++,b.info.render.vertices+=d.array.length/3,b.info.render.faces+=d.array.length/9}}else if(o instanceof nt.PointCloud){s&&It(r,a,i,0);d=i.attributes.position;_.drawArrays(_.POINTS,0,d.array.length/3),b.info.render.calls++,b.info.render.points+=d.array.length/3}else if(o instanceof nt.Line){var m;c=o.mode===nt.LineStrip?_.LINE_STRIP:_.LINES;if(ce(r.linewidth),m=i.attributes.index){var g,v,y;if(m.array instanceof Uint32Array?(g=_.UNSIGNED_INT,v=4):(g=_.UNSIGNED_SHORT,v=2),0===(y=i.offsets).length)s&&(It(r,a,i,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(c,m.array.length,g,0),b.info.render.calls++,b.info.render.vertices+=m.array.length;else{y.length>1&&(s=!0);for(l=0,f=y.length;l<f;l++){p=y[l].index;s&&(It(r,a,i,p),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,m.buffer)),_.drawElements(c,y[l].count,g,y[l].start*v),b.info.render.calls++,b.info.render.vertices+=y[l].count}}}else{s&&It(r,a,i,0);d=i.attributes.position;_.drawArrays(c,0,d.array.length/3),b.info.render.calls++,b.info.render.points+=d.array.length/3}}}},this.renderBuffer=function(t,e,n,r,i,o){if(!1!==r.visible){var a=re(t,e,n,r,o),s=a.attributes,h=!1,u=r.wireframe?1:0,c=16777215*i.id+2*a.id+u;if(c!==C&&(C=c,h=!0),h&&Ot(),!r.morphTargets&&s.position>=0?h&&(_.bindBuffer(_.ARRAY_BUFFER,i.__webglVertexBuffer),Vt(s.position),_.vertexAttribPointer(s.position,3,_.FLOAT,!1,0,0)):o.morphTargetBase&&function(t,e,n){var r=t.program.attributes;-1!==n.morphTargetBase&&r.position>=0?(_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[n.morphTargetBase]),Vt(r.position),_.vertexAttribPointer(r.position,3,_.FLOAT,!1,0,0)):r.position>=0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),Vt(r.position),_.vertexAttribPointer(r.position,3,_.FLOAT,!1,0,0));if(n.morphTargetForcedOrder.length)for(var i=0,o=n.morphTargetForcedOrder,a=n.morphTargetInfluences;i<t.numSupportedMorphTargets&&i<o.length;)r["morphTarget"+i]>=0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[o[i]]),Vt(r["morphTarget"+i]),_.vertexAttribPointer(r["morphTarget"+i],3,_.FLOAT,!1,0,0)),r["morphNormal"+i]>=0&&t.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[o[i]]),Vt(r["morphNormal"+i]),_.vertexAttribPointer(r["morphNormal"+i],3,_.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[i]=a[o[i]],i++;else{var s,h,u=[],a=n.morphTargetInfluences,c=a.length;for(h=0;h<c;h++)(s=a[h])>0&&u.push([s,h]);u.length>t.numSupportedMorphTargets?(u.sort(Wt),u.length=t.numSupportedMorphTargets):u.length>t.numSupportedMorphNormals?u.sort(Wt):0===u.length&&u.push([0,0]);for(var l,i=0;i<t.numSupportedMorphTargets;)u[i]?(l=u[i][1],r["morphTarget"+i]>=0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[l]),Vt(r["morphTarget"+i]),_.vertexAttribPointer(r["morphTarget"+i],3,_.FLOAT,!1,0,0)),r["morphNormal"+i]>=0&&t.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[l]),Vt(r["morphNormal"+i]),_.vertexAttribPointer(r["morphNormal"+i],3,_.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[i]=a[l]):n.__webglMorphTargetInfluences[i]=0,i++}null!==t.program.uniforms.morphTargetInfluences&&_.uniform1fv(t.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}(r,i,o),h){if(i.__webglCustomAttributesList)for(var l=0,f=i.__webglCustomAttributesList.length;l<f;l++){var p=i.__webglCustomAttributesList[l];s[p.buffer.belongsToAttribute]>=0&&(_.bindBuffer(_.ARRAY_BUFFER,p.buffer),Vt(s[p.buffer.belongsToAttribute]),_.vertexAttribPointer(s[p.buffer.belongsToAttribute],p.size,_.FLOAT,!1,0,0))}s.color>=0&&(o.geometry.colors.length>0||o.geometry.faces.length>0?(_.bindBuffer(_.ARRAY_BUFFER,i.__webglColorBuffer),Vt(s.color),_.vertexAttribPointer(s.color,3,_.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&_.vertexAttrib3fv(s.color,r.defaultAttributeValues.color)),s.normal>=0&&(_.bindBuffer(_.ARRAY_BUFFER,i.__webglNormalBuffer),Vt(s.normal),_.vertexAttribPointer(s.normal,3,_.FLOAT,!1,0,0)),s.tangent>=0&&(_.bindBuffer(_.ARRAY_BUFFER,i.__webglTangentBuffer),Vt(s.tangent),_.vertexAttribPointer(s.tangent,4,_.FLOAT,!1,0,0)),s.uv>=0&&(o.geometry.faceVertexUvs[0]?(_.bindBuffer(_.ARRAY_BUFFER,i.__webglUVBuffer),Vt(s.uv),_.vertexAttribPointer(s.uv,2,_.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&_.vertexAttrib2fv(s.uv,r.defaultAttributeValues.uv)),s.uv2>=0&&(o.geometry.faceVertexUvs[1]?(_.bindBuffer(_.ARRAY_BUFFER,i.__webglUV2Buffer),Vt(s.uv2),_.vertexAttribPointer(s.uv2,2,_.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&_.vertexAttrib2fv(s.uv2,r.defaultAttributeValues.uv2)),r.skinning&&s.skinIndex>=0&&s.skinWeight>=0&&(_.bindBuffer(_.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),Vt(s.skinIndex),_.vertexAttribPointer(s.skinIndex,4,_.FLOAT,!1,0,0),_.bindBuffer(_.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),Vt(s.skinWeight),_.vertexAttribPointer(s.skinWeight,4,_.FLOAT,!1,0,0)),s.lineDistance>=0&&(_.bindBuffer(_.ARRAY_BUFFER,i.__webglLineDistanceBuffer),Vt(s.lineDistance),_.vertexAttribPointer(s.lineDistance,1,_.FLOAT,!1,0,0))}if(Ht(),o instanceof nt.Mesh){var d=i.__typeArray===Uint32Array?_.UNSIGNED_INT:_.UNSIGNED_SHORT;r.wireframe?(ce(r.wireframeLinewidth),h&&_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),_.drawElements(_.LINES,i.__webglLineCount,d,0)):(h&&_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),_.drawElements(_.TRIANGLES,i.__webglFaceCount,d,0)),b.info.render.calls++,b.info.render.vertices+=i.__webglFaceCount,b.info.render.faces+=i.__webglFaceCount/3}else if(o instanceof nt.Line){var m=o.mode===nt.LineStrip?_.LINE_STRIP:_.LINES;ce(r.linewidth),_.drawArrays(m,0,i.__webglLineCount),b.info.render.calls++}else o instanceof nt.PointCloud&&(_.drawArrays(_.POINTS,0,i.__webglParticleCount),b.info.render.calls++,b.info.render.points+=i.__webglParticleCount)}},this.render=function(t,e,n,r){if(e instanceof nt.Camera!=!1){var i=t.fog;C=-1,S=-1,T=null,tt=!0,!0===t.autoUpdate&&t.updateMatrixWorld(),void 0===e.parent&&e.updateMatrixWorld(),t.traverse(function(t){t instanceof nt.SkinnedMesh&&t.skeleton.update()}),e.matrixWorldInverse.getInverse(e.matrixWorld),K.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Y.setFromMatrix(K),p.length=0,g.length=0,v.length=0,y.length=0,x.length=0,function t(e,n){if(!1===n.visible)return;if(n instanceof nt.Scene||n instanceof nt.Group);else if(function(t,e){void 0===t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new nt.Matrix4,t._normalMatrix=new nt.Matrix3,t.addEventListener("removed",St));var n=t.geometry;void 0===n||void 0===n.__webglInit&&(n.__webglInit=!0,n.addEventListener("dispose",Ct),n instanceof nt.BufferGeometry||(t instanceof nt.Mesh?Zt(e,t,n):t instanceof nt.Line?void 0===n.__webglVertexBuffer&&(!function(t){t.__webglVertexBuffer=_.createBuffer(),t.__webglColorBuffer=_.createBuffer(),t.__webglLineDistanceBuffer=_.createBuffer(),b.info.memory.geometries++}(n),function(t,e){var n=t.vertices.length;t.__vertexArray=new Float32Array(3*n),t.__colorArray=new Float32Array(3*n),t.__lineDistanceArray=new Float32Array(1*n),t.__webglLineCount=n,Bt(e)}(n,t),n.verticesNeedUpdate=!0,n.colorsNeedUpdate=!0,n.lineDistancesNeedUpdate=!0):t instanceof nt.PointCloud&&void 0===n.__webglVertexBuffer&&(!function(t){t.__webglVertexBuffer=_.createBuffer(),t.__webglColorBuffer=_.createBuffer(),b.info.memory.geometries++}(n),function(t,e){var n=t.vertices.length;t.__vertexArray=new Float32Array(3*n),t.__colorArray=new Float32Array(3*n),t.__sortArray=[],t.__webglParticleCount=n,Bt(e)}(n,t),n.verticesNeedUpdate=!0,n.colorsNeedUpdate=!0)));if(void 0===t.__webglActive)if(t.__webglActive=!0,t instanceof nt.Mesh){if(n instanceof nt.BufferGeometry)$t(d,n,t);else if(n instanceof nt.Geometry)for(var r=Kt[n.id],i=0,o=r.length;i<o;i++)$t(d,r[i],t)}else t instanceof nt.Line||t instanceof nt.PointCloud?$t(d,n,t):(t instanceof nt.ImmediateRenderObject||t.immediateRenderCallback)&&function(t,e){t.push({id:null,object:e,opaque:null,transparent:null,z:0})}(m,t)}(n,e),n instanceof nt.Light)p.push(n);else if(n instanceof nt.Sprite)y.push(n);else if(n instanceof nt.LensFlare)x.push(n);else{var r=d[n.id];if(r&&(!1===n.frustumCulled||!0===Y.intersectsObject(n))){!function(t,e){var n,r,i=t.geometry;if(i instanceof nt.BufferGeometry)!function(t){for(var e=t.attributes,n=t.attributesKeys,r=0,i=n.length;r<i;r++){var o=n[r],a=e[o];if(void 0===a.buffer&&(a.buffer=_.createBuffer(),a.needsUpdate=!0),!0===a.needsUpdate){var s="index"===o?_.ELEMENT_ARRAY_BUFFER:_.ARRAY_BUFFER;_.bindBuffer(s,a.buffer),_.bufferData(s,a.array,_.STATIC_DRAW),a.needsUpdate=!1}}}(i);else if(t instanceof nt.Mesh){!0===i.groupsNeedUpdate&&Zt(e,t,i);for(var o=Kt[i.id],a=0,s=o.length;a<s;a++){var h=o[a];r=Nt(t,h),!0===i.groupsNeedUpdate&&zt(h,t),n=r.attributes&&te(r),(i.verticesNeedUpdate||i.morphTargetsNeedUpdate||i.elementsNeedUpdate||i.uvsNeedUpdate||i.normalsNeedUpdate||i.colorsNeedUpdate||i.tangentsNeedUpdate||n)&&Ut(h,t,_.DYNAMIC_DRAW,!i.dynamic,r)}i.verticesNeedUpdate=!1,i.morphTargetsNeedUpdate=!1,i.elementsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.tangentsNeedUpdate=!1,r.attributes&&ee(r)}else t instanceof nt.Line?(r=Nt(t,i),n=r.attributes&&te(r),(i.verticesNeedUpdate||i.colorsNeedUpdate||i.lineDistancesNeedUpdate||n)&&function(t,e){var n,r,i,o,a,s,h,u,c,l,f,p,d=t.vertices,m=t.colors,g=t.lineDistances,v=d.length,y=m.length,x=g.length,b=t.__vertexArray,w=t.__colorArray,M=t.__lineDistanceArray,A=t.verticesNeedUpdate,S=t.colorsNeedUpdate,C=t.lineDistancesNeedUpdate,T=t.__webglCustomAttributesList;if(A){for(n=0;n<v;n++)o=d[n],b[a=3*n]=o.x,b[a+1]=o.y,b[a+2]=o.z;_.bindBuffer(_.ARRAY_BUFFER,t.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,b,e)}if(S){for(r=0;r<y;r++)s=m[r],w[a=3*r]=s.r,w[a+1]=s.g,w[a+2]=s.b;_.bindBuffer(_.ARRAY_BUFFER,t.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,w,e)}if(C){for(i=0;i<x;i++)M[i]=g[i];_.bindBuffer(_.ARRAY_BUFFER,t.__webglLineDistanceBuffer),_.bufferData(_.ARRAY_BUFFER,M,e)}if(T)for(h=0,u=T.length;h<u;h++)if((p=T[h]).needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(a=0,l=p.value.length,1===p.size)for(c=0;c<l;c++)p.array[c]=p.value[c];else if(2===p.size)for(c=0;c<l;c++)f=p.value[c],p.array[a]=f.x,p.array[a+1]=f.y,a+=2;else if(3===p.size)if("c"===p.type)for(c=0;c<l;c++)f=p.value[c],p.array[a]=f.r,p.array[a+1]=f.g,p.array[a+2]=f.b,a+=3;else for(c=0;c<l;c++)f=p.value[c],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,a+=3;else if(4===p.size)for(c=0;c<l;c++)f=p.value[c],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,p.array[a+3]=f.w,a+=4;_.bindBuffer(_.ARRAY_BUFFER,p.buffer),_.bufferData(_.ARRAY_BUFFER,p.array,e)}}(i,_.DYNAMIC_DRAW),i.verticesNeedUpdate=!1,i.colorsNeedUpdate=!1,i.lineDistancesNeedUpdate=!1,r.attributes&&ee(r)):t instanceof nt.PointCloud&&(r=Nt(t,i),n=r.attributes&&te(r),(i.verticesNeedUpdate||i.colorsNeedUpdate||t.sortParticles||n)&&function(t,e,n){var r,i,o,a,s,h,u,c,l,f,p,d,m=t.vertices,g=m.length,v=t.colors,y=v.length,x=t.__vertexArray,b=t.__colorArray,w=t.__sortArray,M=t.verticesNeedUpdate,A=(t.elementsNeedUpdate,t.colorsNeedUpdate),S=t.__webglCustomAttributesList;if(n.sortParticles){for(J.copy(K),J.multiply(n.matrixWorld),r=0;r<g;r++)o=m[r],Z.copy(o),Z.applyProjection(J),w[r]=[Z.z,r];for(w.sort(Wt),r=0;r<g;r++)o=m[w[r][1]],x[a=3*r]=o.x,x[a+1]=o.y,x[a+2]=o.z;for(i=0;i<y;i++)a=3*i,h=v[w[i][1]],b[a]=h.r,b[a+1]=h.g,b[a+2]=h.b;if(S)for(u=0,c=S.length;u<c;u++)if(void 0===(d=S[u]).boundTo||"vertices"===d.boundTo)if(a=0,f=d.value.length,1===d.size)for(l=0;l<f;l++)s=w[l][1],d.array[l]=d.value[s];else if(2===d.size)for(l=0;l<f;l++)s=w[l][1],p=d.value[s],d.array[a]=p.x,d.array[a+1]=p.y,a+=2;else if(3===d.size)if("c"===d.type)for(l=0;l<f;l++)s=w[l][1],p=d.value[s],d.array[a]=p.r,d.array[a+1]=p.g,d.array[a+2]=p.b,a+=3;else for(l=0;l<f;l++)s=w[l][1],p=d.value[s],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,a+=3;else if(4===d.size)for(l=0;l<f;l++)s=w[l][1],p=d.value[s],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,d.array[a+3]=p.w,a+=4}else{if(M)for(r=0;r<g;r++)o=m[r],x[a=3*r]=o.x,x[a+1]=o.y,x[a+2]=o.z;if(A)for(i=0;i<y;i++)h=v[i],b[a=3*i]=h.r,b[a+1]=h.g,b[a+2]=h.b;if(S)for(u=0,c=S.length;u<c;u++)if((d=S[u]).needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo))if(f=d.value.length,a=0,1===d.size)for(l=0;l<f;l++)d.array[l]=d.value[l];else if(2===d.size)for(l=0;l<f;l++)p=d.value[l],d.array[a]=p.x,d.array[a+1]=p.y,a+=2;else if(3===d.size)if("c"===d.type)for(l=0;l<f;l++)p=d.value[l],d.array[a]=p.r,d.array[a+1]=p.g,d.array[a+2]=p.b,a+=3;else for(l=0;l<f;l++)p=d.value[l],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,a+=3;else if(4===d.size)for(l=0;l<f;l++)p=d.value[l],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,d.array[a+3]=p.w,a+=4}if((M||n.sortParticles)&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,x,e)),(A||n.sortParticles)&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,b,e)),S)for(u=0,c=S.length;u<c;u++)((d=S[u]).needsUpdate||n.sortParticles)&&(_.bindBuffer(_.ARRAY_BUFFER,d.buffer),_.bufferData(_.ARRAY_BUFFER,d.array,e))}(i,_.DYNAMIC_DRAW,t),i.verticesNeedUpdate=!1,i.colorsNeedUpdate=!1,r.attributes&&ee(r))}(n,e);for(var i=0,o=r.length;i<o;i++){var a=r[i];Yt(a),a.render=!0,!0===b.sortObjects&&(null!==n.renderDepth?a.z=n.renderDepth:(Z.setFromMatrixPosition(n.matrixWorld),Z.applyProjection(K),a.z=Z.z))}}}for(var i=0,o=n.children.length;i<o;i++)t(e,n.children[i])}(t,t),!0===b.sortObjects&&(g.sort(Gt),v.sort(jt)),bt.render(t,e),b.info.render.calls=0,b.info.render.vertices=0,b.info.render.faces=0,b.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var o=0,a=m.length;o<a;o++){var s=m[o],h=s.object;h.visible&&(se(h,e),Qt(s))}if(t.overrideMaterial){var u=t.overrideMaterial;this.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),this.setDepthTest(u.depthTest),this.setDepthWrite(u.depthWrite),le(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits),Xt(g,e,p,i,!0,u),Xt(v,e,p,i,!0,u),qt(m,"",e,p,i,!1,u)}else{u=null;this.setBlending(nt.NoBlending),Xt(g,e,p,i,!1,u),qt(m,"opaque",e,p,i,!1,u),Xt(v,e,p,i,!0,u),qt(m,"transparent",e,p,i,!0,u)}wt.render(t,e),Mt.render(t,e,W,X),n&&n.generateMipmaps&&n.minFilter!==nt.NearestFilter&&n.minFilter!==nt.LinearFilter&&function(t){t instanceof nt.WebGLRenderTargetCube?(_.bindTexture(_.TEXTURE_CUBE_MAP,t.__webglTexture),_.generateMipmap(_.TEXTURE_CUBE_MAP),_.bindTexture(_.TEXTURE_CUBE_MAP,null)):(_.bindTexture(_.TEXTURE_2D,t.__webglTexture),_.generateMipmap(_.TEXTURE_2D),_.bindTexture(_.TEXTURE_2D,null))}(n),this.setDepthTest(!0),this.setDepthWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(t,e,n,r,i){var o=re(t,e,n,r,i);C=-1,b.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(o,_,Y):i.render(function(t){b.renderBufferImmediate(t,o,r)})};var Kt={},Jt=0;function Zt(t,e,n){var r=e.material,i=!1;void 0!==Kt[n.id]&&!0!==n.groupsNeedUpdate||(delete d[e.id],Kt[n.id]=function(t,e){for(var n,r,i=ot.get("OES_element_index_uint")?4294967296:65535,o={},a=t.morphTargets.length,s=t.morphNormals.length,h={},u=[],c=0,l=t.faces.length;c<l;c++){var f=t.faces[c],p=e?f.materialIndex:0;p in o||(o[p]={hash:p,counter:0}),(n=o[p].hash+"_"+o[p].counter)in h||(r={id:Jt++,faces3:[],materialIndex:p,vertices:0,numMorphTargets:a,numMorphNormals:s},h[n]=r,u.push(r)),h[n].vertices+3>i&&(o[p].counter+=1,(n=o[p].hash+"_"+o[p].counter)in h||(r={id:Jt++,faces3:[],materialIndex:p,vertices:0,numMorphTargets:a,numMorphNormals:s},h[n]=r,u.push(r))),h[n].faces3.push(c),h[n].vertices+=3}return u}(n,r instanceof nt.MeshFaceMaterial),n.groupsNeedUpdate=!1);for(var o=Kt[n.id],a=0,s=o.length;a<s;a++){var h=o[a];void 0===h.__webglVertexBuffer?(At(h),zt(h,e),n.verticesNeedUpdate=!0,n.morphTargetsNeedUpdate=!0,n.elementsNeedUpdate=!0,n.uvsNeedUpdate=!0,n.normalsNeedUpdate=!0,n.tangentsNeedUpdate=!0,n.colorsNeedUpdate=!0,i=!0):i=!1,(i||void 0===e.__webglActive)&&$t(d,h,e)}e.__webglActive=!0}function $t(t,e,n){var r=n.id;t[r]=t[r]||[],t[r].push({id:r,buffer:e,object:n,material:null,z:0})}function te(t){for(var e in t.attributes)if(t.attributes[e].needsUpdate)return!0;return!1}function ee(t){for(var e in t.attributes)t.attributes[e].needsUpdate=!1}function ne(t,e,n,i){var o;if(t.addEventListener("dispose",Lt),t instanceof nt.MeshDepthMaterial?o="depth":t instanceof nt.MeshNormalMaterial?o="normal":t instanceof nt.MeshBasicMaterial?o="basic":t instanceof nt.MeshLambertMaterial?o="lambert":t instanceof nt.MeshPhongMaterial?o="phong":t instanceof nt.LineBasicMaterial?o="basic":t instanceof nt.LineDashedMaterial?o="dashed":t instanceof nt.PointCloudMaterial&&(o="particle_basic"),o){var a=nt.ShaderLib[o];t.__webglShader={uniforms:nt.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}}else t.__webglShader={uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};var s=function(t){for(var e=0,n=0,r=0,i=0,o=0,a=t.length;o<a;o++){var s=t[o];s.onlyShadow||!1===s.visible||(s instanceof nt.DirectionalLight&&e++,s instanceof nt.PointLight&&n++,s instanceof nt.SpotLight&&r++,s instanceof nt.HemisphereLight&&i++)}return{directional:e,point:n,spot:r,hemi:i}}(e),h=function(t){for(var e=0,n=0,r=t.length;n<r;n++){var i=t[n];i.castShadow&&(i instanceof nt.SpotLight&&e++,i instanceof nt.DirectionalLight&&!i.shadowCascade&&e++)}return e}(e),u=function(t){if(ft&&t&&t.skeleton&&t.skeleton.useVertexTexture)return 1024;var e=_.getParameter(_.MAX_VERTEX_UNIFORM_VECTORS),n=Math.floor((e-20)/4),r=n;return void 0!==t&&t instanceof nt.SkinnedMesh&&(r=Math.min(t.skeleton.bones.length,r))<t.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+t.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)"),r}(i),l={precision:r,supportsVertexTextures:lt,map:!!t.map,envMap:!!t.envMap,lightMap:!!t.lightMap,bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,vertexColors:t.vertexColors,fog:n,useFog:t.fog,fogExp:n instanceof nt.FogExp2,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:c,skinning:t.skinning,maxBones:u,useVertexTexture:ft&&i&&i.skeleton&&i.skeleton.useVertexTexture,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:b.maxMorphTargets,maxMorphNormals:b.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:h,shadowMapEnabled:b.shadowMapEnabled&&i.receiveShadow&&h>0,shadowMapType:b.shadowMapType,shadowMapDebug:b.shadowMapDebug,shadowMapCascade:b.shadowMapCascade,alphaTest:t.alphaTest,metal:t.metal,wrapAround:t.wrapAround,doubleSided:t.side===nt.DoubleSide,flipSided:t.side===nt.BackSide},f=[];if(o?f.push(o):(f.push(t.fragmentShader),f.push(t.vertexShader)),void 0!==t.defines)for(var p in t.defines)f.push(p),f.push(t.defines[p]);for(var p in l)f.push(p),f.push(l[p]);for(var d,m=f.join(),g=0,v=w.length;g<v;g++){var y=w[g];if(y.code===m){(d=y).usedTimes++;break}}void 0===d&&(d=new nt.WebGLProgram(b,m,t,l),w.push(d),b.info.memory.programs=w.length),t.program=d;var x=d.attributes;if(t.morphTargets){t.numSupportedMorphTargets=0;for(var M="morphTarget",A=0;A<b.maxMorphTargets;A++)x[M+A]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;M="morphNormal";for(A=0;A<b.maxMorphNormals;A++)x[M+A]>=0&&t.numSupportedMorphNormals++}for(var S in t.uniformsList=[],t.__webglShader.uniforms){var C=t.program.uniforms[S];C&&t.uniformsList.push([t.__webglShader.uniforms[S],C])}}function re(t,n,r,i,o){E=0,i.needsUpdate&&(i.program&&kt(i),ne(i,n,r,o),i.needsUpdate=!1),i.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(b.maxMorphTargets)));var a=!1,s=!1,h=!1,u=i.program,l=u.uniforms,f=i.__webglShader.uniforms;if(u.id!==M&&(_.useProgram(u.program),M=u.id,a=!0,s=!0,h=!0),i.id!==S&&(-1===S&&(h=!0),S=i.id,s=!0),(a||t!==T)&&(_.uniformMatrix4fv(l.projectionMatrix,!1,t.projectionMatrix.elements),c&&_.uniform1f(l.logDepthBufFC,2/(Math.log(t.far+1)/Math.LN2)),t!==T&&(T=t),(i instanceof nt.ShaderMaterial||i instanceof nt.MeshPhongMaterial||i.envMap)&&null!==l.cameraPosition&&(Z.setFromMatrixPosition(t.matrixWorld),_.uniform3f(l.cameraPosition,Z.x,Z.y,Z.z)),(i instanceof nt.MeshPhongMaterial||i instanceof nt.MeshLambertMaterial||i instanceof nt.ShaderMaterial||i.skinning)&&null!==l.viewMatrix&&_.uniformMatrix4fv(l.viewMatrix,!1,t.matrixWorldInverse.elements)),i.skinning)if(o.bindMatrix&&null!==l.bindMatrix&&_.uniformMatrix4fv(l.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&null!==l.bindMatrixInverse&&_.uniformMatrix4fv(l.bindMatrixInverse,!1,o.bindMatrixInverse.elements),ft&&o.skeleton&&o.skeleton.useVertexTexture){if(null!==l.boneTexture){var p=ae();_.uniform1i(l.boneTexture,p),b.setTexture(o.skeleton.boneTexture,p)}null!==l.boneTextureWidth&&_.uniform1i(l.boneTextureWidth,o.skeleton.boneTextureWidth),null!==l.boneTextureHeight&&_.uniform1i(l.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&null!==l.boneGlobalMatrices&&_.uniformMatrix4fv(l.boneGlobalMatrices,!1,o.skeleton.boneMatrices);return s&&(r&&i.fog&&function(t,e){t.fogColor.value=e.color,e instanceof nt.Fog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e instanceof nt.FogExp2&&(t.fogDensity.value=e.density)}(f,r),(i instanceof nt.MeshPhongMaterial||i instanceof nt.MeshLambertMaterial||i.lights)&&(tt&&(h=!0,function(t){var e,n,r,i,o,a,s,h,u,c=0,l=0,f=0,p=rt,d=p.directional.colors,m=p.directional.positions,g=p.point.colors,v=p.point.positions,y=p.point.distances,x=p.spot.colors,_=p.spot.positions,w=p.spot.distances,M=p.spot.directions,A=p.spot.anglesCos,S=p.spot.exponents,C=p.hemi.skyColors,T=p.hemi.groundColors,E=p.hemi.positions,L=0,P=0,D=0,R=0,F=0,k=0,B=0,z=0,N=0,U=0,I=0,O=0;for(e=0,n=t.length;e<n;e++)if(!(r=t[e]).onlyShadow)if(i=r.color,s=r.intensity,u=r.distance,r instanceof nt.AmbientLight){if(!r.visible)continue;b.gammaInput?(c+=i.r*i.r,l+=i.g*i.g,f+=i.b*i.b):(c+=i.r,l+=i.g,f+=i.b)}else if(r instanceof nt.DirectionalLight){if(F+=1,!r.visible)continue;$.setFromMatrixPosition(r.matrixWorld),Z.setFromMatrixPosition(r.target.matrixWorld),$.sub(Z),$.normalize(),m[N=3*L]=$.x,m[N+1]=$.y,m[N+2]=$.z,b.gammaInput?he(d,N,i,s*s):ue(d,N,i,s),L+=1}else if(r instanceof nt.PointLight){if(k+=1,!r.visible)continue;U=3*P,b.gammaInput?he(g,U,i,s*s):ue(g,U,i,s),Z.setFromMatrixPosition(r.matrixWorld),v[U]=Z.x,v[U+1]=Z.y,v[U+2]=Z.z,y[P]=u,P+=1}else if(r instanceof nt.SpotLight){if(B+=1,!r.visible)continue;I=3*D,b.gammaInput?he(x,I,i,s*s):ue(x,I,i,s),$.setFromMatrixPosition(r.matrixWorld),_[I]=$.x,_[I+1]=$.y,_[I+2]=$.z,w[D]=u,Z.setFromMatrixPosition(r.target.matrixWorld),$.sub(Z),$.normalize(),M[I]=$.x,M[I+1]=$.y,M[I+2]=$.z,A[D]=Math.cos(r.angle),S[D]=r.exponent,D+=1}else if(r instanceof nt.HemisphereLight){if(z+=1,!r.visible)continue;$.setFromMatrixPosition(r.matrixWorld),$.normalize(),E[O=3*R]=$.x,E[O+1]=$.y,E[O+2]=$.z,o=r.color,a=r.groundColor,b.gammaInput?(he(C,O,o,h=s*s),he(T,O,a,h)):(ue(C,O,o,s),ue(T,O,a,s)),R+=1}for(e=3*L,n=Math.max(d.length,3*F);e<n;e++)d[e]=0;for(e=3*P,n=Math.max(g.length,3*k);e<n;e++)g[e]=0;for(e=3*D,n=Math.max(x.length,3*B);e<n;e++)x[e]=0;for(e=3*R,n=Math.max(C.length,3*z);e<n;e++)C[e]=0;for(e=3*R,n=Math.max(T.length,3*z);e<n;e++)T[e]=0;p.directional.length=L,p.point.length=P,p.spot.length=D,p.hemi.length=R,p.ambient[0]=c,p.ambient[1]=l,p.ambient[2]=f}(n),tt=!1),h?(!function(t,e){t.ambientLightColor.value=e.ambient,t.directionalLightColor.value=e.directional.colors,t.directionalLightDirection.value=e.directional.positions,t.pointLightColor.value=e.point.colors,t.pointLightPosition.value=e.point.positions,t.pointLightDistance.value=e.point.distances,t.spotLightColor.value=e.spot.colors,t.spotLightPosition.value=e.spot.positions,t.spotLightDistance.value=e.spot.distances,t.spotLightDirection.value=e.spot.directions,t.spotLightAngleCos.value=e.spot.anglesCos,t.spotLightExponent.value=e.spot.exponents,t.hemisphereLightSkyColor.value=e.hemi.skyColors,t.hemisphereLightGroundColor.value=e.hemi.groundColors,t.hemisphereLightDirection.value=e.hemi.positions}(f,rt),oe(f,!0)):oe(f,!1)),(i instanceof nt.MeshBasicMaterial||i instanceof nt.MeshLambertMaterial||i instanceof nt.MeshPhongMaterial)&&function(t,e){t.opacity.value=e.opacity,b.gammaInput?t.diffuse.value.copyGammaToLinear(e.color):t.diffuse.value=e.color;t.map.value=e.map,t.lightMap.value=e.lightMap,t.specularMap.value=e.specularMap,t.alphaMap.value=e.alphaMap,e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale);e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale));var n;e.map?n=e.map:e.specularMap?n=e.specularMap:e.normalMap?n=e.normalMap:e.bumpMap?n=e.bumpMap:e.alphaMap&&(n=e.alphaMap);if(void 0!==n){var r=n.offset,i=n.repeat;t.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap instanceof nt.WebGLRenderTargetCube?1:-1,b.gammaInput,t.reflectivity.value=e.reflectivity;t.refractionRatio.value=e.refractionRatio,t.combine.value=e.combine,t.useRefract.value=e.envMap&&e.envMap.mapping instanceof nt.CubeRefractionMapping}(f,i),i instanceof nt.LineBasicMaterial?ie(f,i):i instanceof nt.LineDashedMaterial?(ie(f,i),function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(f,i)):i instanceof nt.PointCloudMaterial?function(t,n){t.psColor.value=n.color,t.opacity.value=n.opacity,t.size.value=n.size,t.scale.value=e.height/2,t.map.value=n.map}(f,i):i instanceof nt.MeshPhongMaterial?function(t,e){t.shininess.value=e.shininess,b.gammaInput?(t.ambient.value.copyGammaToLinear(e.ambient),t.emissive.value.copyGammaToLinear(e.emissive),t.specular.value.copyGammaToLinear(e.specular)):(t.ambient.value=e.ambient,t.emissive.value=e.emissive,t.specular.value=e.specular);e.wrapAround&&t.wrapRGB.value.copy(e.wrapRGB)}(f,i):i instanceof nt.MeshLambertMaterial?function(t,e){b.gammaInput?(t.ambient.value.copyGammaToLinear(e.ambient),t.emissive.value.copyGammaToLinear(e.emissive)):(t.ambient.value=e.ambient,t.emissive.value=e.emissive);e.wrapAround&&t.wrapRGB.value.copy(e.wrapRGB)}(f,i):i instanceof nt.MeshDepthMaterial?(f.mNear.value=t.near,f.mFar.value=t.far,f.opacity.value=i.opacity):i instanceof nt.MeshNormalMaterial&&(f.opacity.value=i.opacity),o.receiveShadow&&!i._shadowPass&&function(t,e){if(t.shadowMatrix)for(var n=0,r=0,i=e.length;r<i;r++){var o=e[r];o.castShadow&&((o instanceof nt.SpotLight||o instanceof nt.DirectionalLight&&!o.shadowCascade)&&(t.shadowMap.value[n]=o.shadowMap,t.shadowMapSize.value[n]=o.shadowMapSize,t.shadowMatrix.value[n]=o.shadowMatrix,t.shadowDarkness.value[n]=o.shadowDarkness,t.shadowBias.value[n]=o.shadowBias,n++))}}(f,n),function(t){for(var e,n,r,i=0,o=t.length;i<o;i++){var a=t[i][0];if(!1!==a.needsUpdate){var s=a.type,h=a.value,u=t[i][1];switch(s){case"1i":_.uniform1i(u,h);break;case"1f":_.uniform1f(u,h);break;case"2f":_.uniform2f(u,h[0],h[1]);break;case"3f":_.uniform3f(u,h[0],h[1],h[2]);break;case"4f":_.uniform4f(u,h[0],h[1],h[2],h[3]);break;case"1iv":_.uniform1iv(u,h);break;case"3iv":_.uniform3iv(u,h);break;case"1fv":_.uniform1fv(u,h);break;case"2fv":_.uniform2fv(u,h);break;case"3fv":_.uniform3fv(u,h);break;case"4fv":_.uniform4fv(u,h);break;case"Matrix3fv":_.uniformMatrix3fv(u,!1,h);break;case"Matrix4fv":_.uniformMatrix4fv(u,!1,h);break;case"i":_.uniform1i(u,h);break;case"f":_.uniform1f(u,h);break;case"v2":_.uniform2f(u,h.x,h.y);break;case"v3":_.uniform3f(u,h.x,h.y,h.z);break;case"v4":_.uniform4f(u,h.x,h.y,h.z,h.w);break;case"c":_.uniform3f(u,h.r,h.g,h.b);break;case"iv1":_.uniform1iv(u,h);break;case"iv":_.uniform3iv(u,h);break;case"fv1":_.uniform1fv(u,h);break;case"fv":_.uniform3fv(u,h);break;case"v2v":void 0===a._array&&(a._array=new Float32Array(2*h.length));for(var c=0,l=h.length;c<l;c++)r=2*c,a._array[r]=h[c].x,a._array[r+1]=h[c].y;_.uniform2fv(u,a._array);break;case"v3v":void 0===a._array&&(a._array=new Float32Array(3*h.length));for(var c=0,l=h.length;c<l;c++)r=3*c,a._array[r]=h[c].x,a._array[r+1]=h[c].y,a._array[r+2]=h[c].z;_.uniform3fv(u,a._array);break;case"v4v":void 0===a._array&&(a._array=new Float32Array(4*h.length));for(var c=0,l=h.length;c<l;c++)r=4*c,a._array[r]=h[c].x,a._array[r+1]=h[c].y,a._array[r+2]=h[c].z,a._array[r+3]=h[c].w;_.uniform4fv(u,a._array);break;case"m3":_.uniformMatrix3fv(u,!1,h.elements);break;case"m3v":void 0===a._array&&(a._array=new Float32Array(9*h.length));for(var c=0,l=h.length;c<l;c++)h[c].flattenToArrayOffset(a._array,9*c);_.uniformMatrix3fv(u,!1,a._array);break;case"m4":_.uniformMatrix4fv(u,!1,h.elements);break;case"m4v":void 0===a._array&&(a._array=new Float32Array(16*h.length));for(var c=0,l=h.length;c<l;c++)h[c].flattenToArrayOffset(a._array,16*c);_.uniformMatrix4fv(u,!1,a._array);break;case"t":if(e=h,n=ae(),_.uniform1i(u,n),!e)continue;e instanceof nt.CubeTexture||e.image instanceof Array&&6===e.image.length?de(e,n):e instanceof nt.WebGLRenderTargetCube?me(e,n):b.setTexture(e,n);break;case"tv":void 0===a._array&&(a._array=[]);for(var c=0,l=a.value.length;c<l;c++)a._array[c]=ae();_.uniform1iv(u,a._array);for(var c=0,l=a.value.length;c<l;c++)e=a.value[c],n=a._array[c],e&&b.setTexture(e,n);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}}(i.uniformsList)),function(t,e){_.uniformMatrix4fv(t.modelViewMatrix,!1,e._modelViewMatrix.elements),t.normalMatrix&&_.uniformMatrix3fv(t.normalMatrix,!1,e._normalMatrix.elements)}(l,o),null!==l.modelMatrix&&_.uniformMatrix4fv(l.modelMatrix,!1,o.matrixWorld.elements),u}function ie(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function oe(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLightColor.needsUpdate=e,t.directionalLightDirection.needsUpdate=e,t.pointLightColor.needsUpdate=e,t.pointLightPosition.needsUpdate=e,t.pointLightDistance.needsUpdate=e,t.spotLightColor.needsUpdate=e,t.spotLightPosition.needsUpdate=e,t.spotLightDistance.needsUpdate=e,t.spotLightDirection.needsUpdate=e,t.spotLightAngleCos.needsUpdate=e,t.spotLightExponent.needsUpdate=e,t.hemisphereLightSkyColor.needsUpdate=e,t.hemisphereLightGroundColor.needsUpdate=e,t.hemisphereLightDirection.needsUpdate=e}function ae(){var t=E;return t>=st&&console.warn("WebGLRenderer: trying to use "+t+" texture units while this GPU supports only "+st),E+=1,t}function se(t,e){t._modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld),t._normalMatrix.getNormalMatrix(t._modelViewMatrix)}function he(t,e,n,r){t[e]=n.r*n.r*r,t[e+1]=n.g*n.g*r,t[e+2]=n.b*n.b*r}function ue(t,e,n,r){t[e]=n.r*r,t[e+1]=n.g*r,t[e+2]=n.b*r}function ce(t){t!==O&&(_.lineWidth(t),O=t)}function le(t,e,n){N!==t&&(t?_.enable(_.POLYGON_OFFSET_FILL):_.disable(_.POLYGON_OFFSET_FILL),N=t),!t||U===e&&I===n||(_.polygonOffset(e,n),U=e,I=n)}function fe(t,e,n){var r;n?(_.texParameteri(t,_.TEXTURE_WRAP_S,xe(e.wrapS)),_.texParameteri(t,_.TEXTURE_WRAP_T,xe(e.wrapT)),_.texParameteri(t,_.TEXTURE_MAG_FILTER,xe(e.magFilter)),_.texParameteri(t,_.TEXTURE_MIN_FILTER,xe(e.minFilter))):(_.texParameteri(t,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(t,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(t,_.TEXTURE_MAG_FILTER,ye(e.magFilter)),_.texParameteri(t,_.TEXTURE_MIN_FILTER,ye(e.minFilter))),(r=ot.get("EXT_texture_filter_anisotropic"))&&e.type!==nt.FloatType&&(e.anisotropy>1||e.__oldAnisotropy)&&(_.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,b.getMaxAnisotropy())),e.__oldAnisotropy=e.anisotropy)}function pe(t,e){if(t.width>e||t.height>e){var n=e/Math.max(t.width,t.height),r=document.createElement("canvas");return r.width=Math.floor(t.width*n),r.height=Math.floor(t.height*n),r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,r.width,r.height),console.log("THREE.WebGLRenderer:",t,"is too big ("+t.width+"x"+t.height+"). Resized to "+r.width+"x"+r.height+"."),r}return t}function de(t,e){if(6===t.image.length)if(t.needsUpdate){t.image.__webglTextureCube||(t.addEventListener("dispose",Tt),t.image.__webglTextureCube=_.createTexture(),b.info.memory.textures++),_.activeTexture(_.TEXTURE0+e),_.bindTexture(_.TEXTURE_CUBE_MAP,t.image.__webglTextureCube),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var n=t instanceof nt.CompressedTexture,r=t.image[0]instanceof nt.DataTexture,i=[],o=0;o<6;o++)!b.autoScaleCubemaps||n||r?i[o]=r?t.image[o].image:t.image[o]:i[o]=pe(t.image[o],ct);var a=i[0],s=nt.Math.isPowerOfTwo(a.width)&&nt.Math.isPowerOfTwo(a.height),h=xe(t.format),u=xe(t.type);fe(_.TEXTURE_CUBE_MAP,t,s);for(o=0;o<6;o++)if(n)for(var c,l=i[o].mipmaps,f=0,p=l.length;f<p;f++)c=l[f],t.format!==nt.RGBAFormat&&t.format!==nt.RGBFormat?vt().indexOf(h)>-1?_.compressedTexImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,h,c.width,c.height,0,c.data):console.warn("Attempt to load unsupported compressed texture format"):_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,h,c.width,c.height,0,h,u,c.data);else r?_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,h,i[o].width,i[o].height,0,h,u,i[o].data):_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,h,h,u,i[o]);t.generateMipmaps&&s&&_.generateMipmap(_.TEXTURE_CUBE_MAP),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else _.activeTexture(_.TEXTURE0+e),_.bindTexture(_.TEXTURE_CUBE_MAP,t.image.__webglTextureCube)}function me(t,e){_.activeTexture(_.TEXTURE0+e),_.bindTexture(_.TEXTURE_CUBE_MAP,t.__webglTexture)}function ge(t,e,n){_.bindFramebuffer(_.FRAMEBUFFER,t),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,n,e.__webglTexture,0)}function ve(t,e){_.bindRenderbuffer(_.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_COMPONENT16,e.width,e.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_STENCIL,e.width,e.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,t)):_.renderbufferStorage(_.RENDERBUFFER,_.RGBA4,e.width,e.height)}function ye(t){return t===nt.NearestFilter||t===nt.NearestMipMapNearestFilter||t===nt.NearestMipMapLinearFilter?_.NEAREST:_.LINEAR}function xe(t){var e;if(t===nt.RepeatWrapping)return _.REPEAT;if(t===nt.ClampToEdgeWrapping)return _.CLAMP_TO_EDGE;if(t===nt.MirroredRepeatWrapping)return _.MIRRORED_REPEAT;if(t===nt.NearestFilter)return _.NEAREST;if(t===nt.NearestMipMapNearestFilter)return _.NEAREST_MIPMAP_NEAREST;if(t===nt.NearestMipMapLinearFilter)return _.NEAREST_MIPMAP_LINEAR;if(t===nt.LinearFilter)return _.LINEAR;if(t===nt.LinearMipMapNearestFilter)return _.LINEAR_MIPMAP_NEAREST;if(t===nt.LinearMipMapLinearFilter)return _.LINEAR_MIPMAP_LINEAR;if(t===nt.UnsignedByteType)return _.UNSIGNED_BYTE;if(t===nt.UnsignedShort4444Type)return _.UNSIGNED_SHORT_4_4_4_4;if(t===nt.UnsignedShort5551Type)return _.UNSIGNED_SHORT_5_5_5_1;if(t===nt.UnsignedShort565Type)return _.UNSIGNED_SHORT_5_6_5;if(t===nt.ByteType)return _.BYTE;if(t===nt.ShortType)return _.SHORT;if(t===nt.UnsignedShortType)return _.UNSIGNED_SHORT;if(t===nt.IntType)return _.INT;if(t===nt.UnsignedIntType)return _.UNSIGNED_INT;if(t===nt.FloatType)return _.FLOAT;if(t===nt.AlphaFormat)return _.ALPHA;if(t===nt.RGBFormat)return _.RGB;if(t===nt.RGBAFormat)return _.RGBA;if(t===nt.LuminanceFormat)return _.LUMINANCE;if(t===nt.LuminanceAlphaFormat)return _.LUMINANCE_ALPHA;if(t===nt.AddEquation)return _.FUNC_ADD;if(t===nt.SubtractEquation)return _.FUNC_SUBTRACT;if(t===nt.ReverseSubtractEquation)return _.FUNC_REVERSE_SUBTRACT;if(t===nt.ZeroFactor)return _.ZERO;if(t===nt.OneFactor)return _.ONE;if(t===nt.SrcColorFactor)return _.SRC_COLOR;if(t===nt.OneMinusSrcColorFactor)return _.ONE_MINUS_SRC_COLOR;if(t===nt.SrcAlphaFactor)return _.SRC_ALPHA;if(t===nt.OneMinusSrcAlphaFactor)return _.ONE_MINUS_SRC_ALPHA;if(t===nt.DstAlphaFactor)return _.DST_ALPHA;if(t===nt.OneMinusDstAlphaFactor)return _.ONE_MINUS_DST_ALPHA;if(t===nt.DstColorFactor)return _.DST_COLOR;if(t===nt.OneMinusDstColorFactor)return _.ONE_MINUS_DST_COLOR;if(t===nt.SrcAlphaSaturateFactor)return _.SRC_ALPHA_SATURATE;if(null!==(e=ot.get("WEBGL_compressed_texture_s3tc"))){if(t===nt.RGB_S3TC_DXT1_Format)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===nt.RGBA_S3TC_DXT1_Format)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===nt.RGBA_S3TC_DXT3_Format)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===nt.RGBA_S3TC_DXT5_Format)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(e=ot.get("WEBGL_compressed_texture_pvrtc"))){if(t===nt.RGB_PVRTC_4BPPV1_Format)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===nt.RGB_PVRTC_2BPPV1_Format)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===nt.RGBA_PVRTC_4BPPV1_Format)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===nt.RGBA_PVRTC_2BPPV1_Format)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(e=ot.get("EXT_blend_minmax"))){if(t===nt.MinEquation)return e.MIN_EXT;if(t===nt.MaxEquation)return e.MAX_EXT}return 0}this.setFaceCulling=function(t,e){t===nt.CullFaceNone?_.disable(_.CULL_FACE):(e===nt.FrontFaceDirectionCW?_.frontFace(_.CW):_.frontFace(_.CCW),t===nt.CullFaceBack?_.cullFace(_.BACK):t===nt.CullFaceFront?_.cullFace(_.FRONT):_.cullFace(_.FRONT_AND_BACK),_.enable(_.CULL_FACE))},this.setMaterialFaces=function(t){var e=t.side===nt.DoubleSide,n=t.side===nt.BackSide;L!==e&&(e?_.disable(_.CULL_FACE):_.enable(_.CULL_FACE),L=e),P!==n&&(n?_.frontFace(_.CW):_.frontFace(_.CCW),P=n)},this.setDepthTest=function(t){B!==t&&(t?_.enable(_.DEPTH_TEST):_.disable(_.DEPTH_TEST),B=t)},this.setDepthWrite=function(t){z!==t&&(_.depthMask(t),z=t)},this.setBlending=function(t,e,n,r){t!==D&&(t===nt.NoBlending?_.disable(_.BLEND):t===nt.AdditiveBlending?(_.enable(_.BLEND),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.SRC_ALPHA,_.ONE)):t===nt.SubtractiveBlending?(_.enable(_.BLEND),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.ZERO,_.ONE_MINUS_SRC_COLOR)):t===nt.MultiplyBlending?(_.enable(_.BLEND),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.ZERO,_.SRC_COLOR)):t===nt.CustomBlending?_.enable(_.BLEND):(_.enable(_.BLEND),_.blendEquationSeparate(_.FUNC_ADD,_.FUNC_ADD),_.blendFuncSeparate(_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA,_.ONE,_.ONE_MINUS_SRC_ALPHA)),D=t),t===nt.CustomBlending?(e!==R&&(_.blendEquation(xe(e)),R=e),n===F&&r===k||(_.blendFunc(xe(n),xe(r)),F=n,k=r)):(R=null,F=null,k=null)},this.uploadTexture=function(t){void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",Tt),t.__webglTexture=_.createTexture(),b.info.memory.textures++),_.bindTexture(_.TEXTURE_2D,t.__webglTexture),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,t.flipY),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),_.pixelStorei(_.UNPACK_ALIGNMENT,t.unpackAlignment),t.image=pe(t.image,ut);var e=t.image,n=nt.Math.isPowerOfTwo(e.width)&&nt.Math.isPowerOfTwo(e.height),r=xe(t.format),i=xe(t.type);fe(_.TEXTURE_2D,t,n);var o,a=t.mipmaps;if(t instanceof nt.DataTexture)if(a.length>0&&n){for(var s=0,h=a.length;s<h;s++)o=a[s],_.texImage2D(_.TEXTURE_2D,s,r,o.width,o.height,0,r,i,o.data);t.generateMipmaps=!1}else _.texImage2D(_.TEXTURE_2D,0,r,e.width,e.height,0,r,i,e.data);else if(t instanceof nt.CompressedTexture)for(s=0,h=a.length;s<h;s++)o=a[s],t.format!==nt.RGBAFormat&&t.format!==nt.RGBFormat?vt().indexOf(r)>-1?_.compressedTexImage2D(_.TEXTURE_2D,s,r,o.width,o.height,0,o.data):console.warn("Attempt to load unsupported compressed texture format"):_.texImage2D(_.TEXTURE_2D,s,r,o.width,o.height,0,r,i,o.data);else if(a.length>0&&n){for(s=0,h=a.length;s<h;s++)o=a[s],_.texImage2D(_.TEXTURE_2D,s,r,r,i,o);t.generateMipmaps=!1}else _.texImage2D(_.TEXTURE_2D,0,r,r,i,t.image);t.generateMipmaps&&n&&_.generateMipmap(_.TEXTURE_2D),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()},this.setTexture=function(t,e){_.activeTexture(_.TEXTURE0+e),t.needsUpdate?b.uploadTexture(t):_.bindTexture(_.TEXTURE_2D,t.__webglTexture)},this.setRenderTarget=function(t){var e,n,r,i,o,a=t instanceof nt.WebGLRenderTargetCube;if(t&&void 0===t.__webglFramebuffer){void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.addEventListener("dispose",Et),t.__webglTexture=_.createTexture(),b.info.memory.textures++;var s=nt.Math.isPowerOfTwo(t.width)&&nt.Math.isPowerOfTwo(t.height),h=xe(t.format),u=xe(t.type);if(a){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],_.bindTexture(_.TEXTURE_CUBE_MAP,t.__webglTexture),fe(_.TEXTURE_CUBE_MAP,t,s);for(var c=0;c<6;c++)t.__webglFramebuffer[c]=_.createFramebuffer(),t.__webglRenderbuffer[c]=_.createRenderbuffer(),_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,h,t.width,t.height,0,h,u,null),ge(t.__webglFramebuffer[c],t,_.TEXTURE_CUBE_MAP_POSITIVE_X+c),ve(t.__webglRenderbuffer[c],t);s&&_.generateMipmap(_.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=_.createFramebuffer(),t.shareDepthFrom?t.__webglRenderbuffer=t.shareDepthFrom.__webglRenderbuffer:t.__webglRenderbuffer=_.createRenderbuffer(),_.bindTexture(_.TEXTURE_2D,t.__webglTexture),fe(_.TEXTURE_2D,t,s),_.texImage2D(_.TEXTURE_2D,0,h,t.width,t.height,0,h,u,null),ge(t.__webglFramebuffer,t,_.TEXTURE_2D),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,t.__webglRenderbuffer):ve(t.__webglRenderbuffer,t),s&&_.generateMipmap(_.TEXTURE_2D);a?_.bindTexture(_.TEXTURE_CUBE_MAP,null):_.bindTexture(_.TEXTURE_2D,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null)}t?(e=a?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,n=t.width,r=t.height,i=0,o=0):(e=null,n=G,r=j,i=V,o=H),e!==A&&(_.bindFramebuffer(_.FRAMEBUFFER,e),_.viewport(i,o,n,r),A=e),W=n,X=r},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},nt.WebGLRenderTarget=function(t,e,n){this.width=t,this.height=e,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:nt.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:nt.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:nt.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:nt.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new nt.Vector2(0,0),this.repeat=new nt.Vector2(1,1),this.format=void 0!==n.format?n.format:nt.RGBAFormat,this.type=void 0!==n.type?n.type:nt.UnsignedByteType,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null},nt.WebGLRenderTarget.prototype={constructor:nt.WebGLRenderTarget,setSize:function(t,e){this.width=t,this.height=e},clone:function(){var t=new nt.WebGLRenderTarget(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},nt.EventDispatcher.prototype.apply(nt.WebGLRenderTarget.prototype),nt.WebGLRenderTargetCube=function(t,e,n){nt.WebGLRenderTarget.call(this,t,e,n),this.activeCubeFace=0},nt.WebGLRenderTargetCube.prototype=Object.create(nt.WebGLRenderTarget.prototype),nt.WebGLExtensions=function(t){var e={};this.get=function(n){if(void 0!==e[n])return e[n];var r;switch(n){case"OES_texture_float":r=t.getExtension("OES_texture_float");break;case"OES_texture_float_linear":r=t.getExtension("OES_texture_float_linear");break;case"OES_standard_derivatives":r=t.getExtension("OES_standard_derivatives");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"OES_element_index_uint":r=t.getExtension("OES_element_index_uint");break;case"EXT_blend_minmax":r=t.getExtension("EXT_blend_minmax");break;case"EXT_frag_depth":r=t.getExtension("EXT_frag_depth")}return null===r&&console.log("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=r,r}},nt.WebGLProgram=(V=0,function(t,e,n,r){var i=t,o=i.context,a=n.defines,s=n.__webglShader.uniforms,h=n.attributes,u=n.__webglShader.vertexShader,c=n.__webglShader.fragmentShader,l=n.index0AttributeName;void 0===l&&!0===r.morphTargets&&(l="position");var f="SHADOWMAP_TYPE_BASIC";r.shadowMapType===nt.PCFShadowMap?f="SHADOWMAP_TYPE_PCF":r.shadowMapType===nt.PCFSoftShadowMap&&(f="SHADOWMAP_TYPE_PCF_SOFT");var p,d,m=function(t){var e,n,r=[];for(var i in t)!1!==(e=t[i])&&(n="#define "+i+" "+e,r.push(n));return r.join("\n")}(a),g=o.createProgram();n instanceof nt.RawShaderMaterial?(p="",d=""):(p=["precision "+r.precision+" float;","precision "+r.precision+" int;",m,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals?"#define USE_MORPHNORMALS":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+f:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n"),d=["precision "+r.precision+" float;","precision "+r.precision+" int;",r.bumpMap||r.normalMap?"#extension GL_OES_standard_derivatives : enable":"",m,"#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.metal?"#define METAL":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+f:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var v=new nt.WebGLShader(o,o.VERTEX_SHADER,p+u),y=new nt.WebGLShader(o,o.FRAGMENT_SHADER,d+c);o.attachShader(g,v),o.attachShader(g,y),void 0!==l&&o.bindAttribLocation(g,0,l),o.linkProgram(g),!1===o.getProgramParameter(g,o.LINK_STATUS)&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",o.getProgramParameter(g,o.VALIDATE_STATUS)),console.error("gl.getError()",o.getError())),""!==o.getProgramInfoLog(g)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",o.getProgramInfoLog(g)),o.deleteShader(v),o.deleteShader(y);var x=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];for(var _ in r.useVertexTexture?(x.push("boneTexture"),x.push("boneTextureWidth"),x.push("boneTextureHeight")):x.push("boneGlobalMatrices"),r.logarithmicDepthBuffer&&x.push("logDepthBufFC"),s)x.push(_);this.uniforms=function(t,e,n){for(var r={},i=0,o=n.length;i<o;i++){var a=n[i];r[a]=t.getUniformLocation(e,a)}return r}(o,g,x),x=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var b=0;b<r.maxMorphTargets;b++)x.push("morphTarget"+b);for(b=0;b<r.maxMorphNormals;b++)x.push("morphNormal"+b);for(var w in h)x.push(w);return this.attributes=function(t,e,n){for(var r={},i=0,o=n.length;i<o;i++){var a=n[i];r[a]=t.getAttribLocation(e,a)}return r}(o,g,x),this.attributesKeys=Object.keys(this.attributes),this.id=V++,this.code=e,this.usedTimes=1,this.program=g,this.vertexShader=v,this.fragmentShader=y,this}),nt.WebGLShader=function(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),!1===t.getShaderParameter(r,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(r)&&(console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(r)),console.warn(function(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(n))),r},nt.LensFlarePlugin=function(t,e){var n,r,i,o,a,s,h,u,c=t.context,l=function(){var e,l=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),f=new Uint16Array([0,1,2,0,2,3]);n=c.createBuffer(),r=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,n),c.bufferData(c.ARRAY_BUFFER,l,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),c.bufferData(c.ELEMENT_ARRAY_BUFFER,f,c.STATIC_DRAW),h=c.createTexture(),u=c.createTexture(),c.bindTexture(c.TEXTURE_2D,h),c.texImage2D(c.TEXTURE_2D,0,c.RGB,16,16,0,c.RGB,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.bindTexture(c.TEXTURE_2D,u),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,16,16,0,c.RGBA,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),e=(s=c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0)?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},i=function(e){var n=c.createProgram(),r=c.createShader(c.FRAGMENT_SHADER),i=c.createShader(c.VERTEX_SHADER),o="precision "+t.getPrecision()+" float;\n";return c.shaderSource(r,o+e.fragmentShader),c.shaderSource(i,o+e.vertexShader),c.compileShader(r),c.compileShader(i),c.attachShader(n,r),c.attachShader(n,i),c.linkProgram(n),n}(e),o={vertex:c.getAttribLocation(i,"position"),uv:c.getAttribLocation(i,"uv")},a={renderType:c.getUniformLocation(i,"renderType"),map:c.getUniformLocation(i,"map"),occlusionMap:c.getUniformLocation(i,"occlusionMap"),opacity:c.getUniformLocation(i,"opacity"),color:c.getUniformLocation(i,"color"),scale:c.getUniformLocation(i,"scale"),rotation:c.getUniformLocation(i,"rotation"),screenPosition:c.getUniformLocation(i,"screenPosition")}};this.render=function(f,p,d,m){if(0!==e.length){var g=new nt.Vector3,v=m/d,y=.5*d,x=.5*m,_=16/m,b=new nt.Vector2(_*v,_),w=new nt.Vector3(1,1,0),M=new nt.Vector2(1,1);void 0===i&&l(),c.useProgram(i),c.enableVertexAttribArray(o.vertex),c.enableVertexAttribArray(o.uv),c.uniform1i(a.occlusionMap,0),c.uniform1i(a.map,1),c.bindBuffer(c.ARRAY_BUFFER,n),c.vertexAttribPointer(o.vertex,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(o.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),c.disable(c.CULL_FACE),c.depthMask(!1);for(var A=0,S=e.length;A<S;A++){_=16/m,b.set(_*v,_);var C=e[A];if(g.set(C.matrixWorld.elements[12],C.matrixWorld.elements[13],C.matrixWorld.elements[14]),g.applyMatrix4(p.matrixWorldInverse),g.applyProjection(p.projectionMatrix),w.copy(g),M.x=w.x*y+y,M.y=w.y*x+x,s||M.x>0&&M.x<d&&M.y>0&&M.y<m){c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGB,M.x-8,M.y-8,16,16,0),c.uniform1i(a.renderType,0),c.uniform2f(a.scale,b.x,b.y),c.uniform3f(a.screenPosition,w.x,w.y,w.z),c.disable(c.BLEND),c.enable(c.DEPTH_TEST),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,M.x-8,M.y-8,16,16,0),c.uniform1i(a.renderType,1),c.disable(c.DEPTH_TEST),c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,h),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),C.positionScreen.copy(w),C.customUpdateCallback?C.customUpdateCallback(C):C.updateLensFlares(),c.uniform1i(a.renderType,2),c.enable(c.BLEND);for(var T=0,E=C.lensFlares.length;T<E;T++){var L=C.lensFlares[T];L.opacity>.001&&L.scale>.001&&(w.x=L.x,w.y=L.y,w.z=L.z,_=L.size*L.scale/m,b.x=_*v,b.y=_,c.uniform3f(a.screenPosition,w.x,w.y,w.z),c.uniform2f(a.scale,b.x,b.y),c.uniform1f(a.rotation,L.rotation),c.uniform1f(a.opacity,L.opacity),c.uniform3f(a.color,L.color.r,L.color.g,L.color.b),t.setBlending(L.blending,L.blendEquation,L.blendSrc,L.blendDst),t.setTexture(L.texture,1),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0))}}}c.enable(c.CULL_FACE),c.enable(c.DEPTH_TEST),c.depthMask(!0),t.resetGLState()}}},nt.ShadowMapPlugin=function(t,e,n,r){var i,o,a,s,h=t.context,u=new nt.Frustum,c=new nt.Matrix4,l=new nt.Vector3,f=new nt.Vector3,p=new nt.Vector3,d=[],m=nt.ShaderLib.depthRGBA,g=nt.UniformsUtils.clone(m.uniforms);function v(t,e,r){if(e.visible){var i=n[e.id];if(i&&e.castShadow&&(!1===e.frustumCulled||!0===u.intersectsObject(e)))for(var o=0,a=i.length;o<a;o++){var s=i[o];e._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),d.push(s)}for(o=0,a=e.children.length;o<a;o++)v(t,e.children[o],r)}}function y(t,e){var n=new nt.DirectionalLight;n.isVirtual=!0,n.onlyShadow=!0,n.castShadow=!0,n.shadowCameraNear=t.shadowCameraNear,n.shadowCameraFar=t.shadowCameraFar,n.shadowCameraLeft=t.shadowCameraLeft,n.shadowCameraRight=t.shadowCameraRight,n.shadowCameraBottom=t.shadowCameraBottom,n.shadowCameraTop=t.shadowCameraTop,n.shadowCameraVisible=t.shadowCameraVisible,n.shadowDarkness=t.shadowDarkness,n.shadowBias=t.shadowCascadeBias[e],n.shadowMapWidth=t.shadowCascadeWidth[e],n.shadowMapHeight=t.shadowCascadeHeight[e],n.pointsWorld=[],n.pointsFrustum=[];for(var r=n.pointsWorld,i=n.pointsFrustum,o=0;o<8;o++)r[o]=new nt.Vector3,i[o]=new nt.Vector3;var a=t.shadowCascadeNearZ[e],s=t.shadowCascadeFarZ[e];return i[0].set(-1,-1,a),i[1].set(1,-1,a),i[2].set(-1,1,a),i[3].set(1,1,a),i[4].set(-1,-1,s),i[5].set(1,-1,s),i[6].set(-1,1,s),i[7].set(1,1,s),n}function x(t,e){var n=t.shadowCascadeArray[e];n.position.copy(t.position),n.target.position.copy(t.target.position),n.lookAt(n.target),n.shadowCameraVisible=t.shadowCameraVisible,n.shadowDarkness=t.shadowDarkness,n.shadowBias=t.shadowCascadeBias[e];var r=t.shadowCascadeNearZ[e],i=t.shadowCascadeFarZ[e],o=n.pointsFrustum;o[0].z=r,o[1].z=r,o[2].z=r,o[3].z=r,o[4].z=i,o[5].z=i,o[6].z=i,o[7].z=i}function _(t,e){var n=e.shadowCamera,r=e.pointsFrustum,i=e.pointsWorld;l.set(1/0,1/0,1/0),f.set(-1/0,-1/0,-1/0);for(var o=0;o<8;o++){var a=i[o];a.copy(r[o]),a.unproject(t),a.applyMatrix4(n.matrixWorldInverse),a.x<l.x&&(l.x=a.x),a.x>f.x&&(f.x=a.x),a.y<l.y&&(l.y=a.y),a.y>f.y&&(f.y=a.y),a.z<l.z&&(l.z=a.z),a.z>f.z&&(f.z=a.z)}n.left=l.x,n.right=f.x,n.top=f.y,n.bottom=l.y,n.updateProjectionMatrix()}function b(t){return t.material instanceof nt.MeshFaceMaterial?t.material.materials[0]:t.material}i=new nt.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader}),o=new nt.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0}),a=new nt.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,skinning:!0}),s=new nt.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0,skinning:!0}),i._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0,s._shadowPass=!0,this.render=function(n,l){if(!1!==t.shadowMapEnabled){var f,m,g,w,M,A,S,C,T,E,L,P,D,R=[],F=0;for(h.clearColor(1,1,1,1),h.disable(h.BLEND),h.enable(h.CULL_FACE),h.frontFace(h.CCW),t.shadowMapCullFace===nt.CullFaceFront?h.cullFace(h.FRONT):h.cullFace(h.BACK),t.setDepthTest(!0),f=0,m=e.length;f<m;f++)if((D=e[f]).castShadow)if(D instanceof nt.DirectionalLight&&D.shadowCascade)for(M=0;M<D.shadowCascadeCount;M++){var k;if(D.shadowCascadeArray[M])k=D.shadowCascadeArray[M];else{(k=y(D,M)).originalCamera=l;var B=new nt.Gyroscope;B.position.copy(D.shadowCascadeOffset),B.add(k),B.add(k.target),l.add(B),D.shadowCascadeArray[M]=k,console.log("Created virtualLight",k)}x(D,M),R[F]=k,F++}else R[F]=D,F++;for(f=0,m=R.length;f<m;f++){if(!(D=R[f]).shadowMap){var z=nt.LinearFilter;t.shadowMapType===nt.PCFSoftShadowMap&&(z=nt.NearestFilter);var N={minFilter:z,magFilter:z,format:nt.RGBAFormat};D.shadowMap=new nt.WebGLRenderTarget(D.shadowMapWidth,D.shadowMapHeight,N),D.shadowMapSize=new nt.Vector2(D.shadowMapWidth,D.shadowMapHeight),D.shadowMatrix=new nt.Matrix4}if(!D.shadowCamera){if(D instanceof nt.SpotLight)D.shadowCamera=new nt.PerspectiveCamera(D.shadowCameraFov,D.shadowMapWidth/D.shadowMapHeight,D.shadowCameraNear,D.shadowCameraFar);else{if(!(D instanceof nt.DirectionalLight)){console.error("Unsupported light type for shadow");continue}D.shadowCamera=new nt.OrthographicCamera(D.shadowCameraLeft,D.shadowCameraRight,D.shadowCameraTop,D.shadowCameraBottom,D.shadowCameraNear,D.shadowCameraFar)}n.add(D.shadowCamera),!0===n.autoUpdate&&n.updateMatrixWorld()}var U,I,O;for(D.shadowCameraVisible&&!D.cameraHelper&&(D.cameraHelper=new nt.CameraHelper(D.shadowCamera),n.add(D.cameraHelper)),D.isVirtual&&k.originalCamera==l&&_(l,D),A=D.shadowMap,S=D.shadowMatrix,(C=D.shadowCamera).position.setFromMatrixPosition(D.matrixWorld),p.setFromMatrixPosition(D.target.matrixWorld),C.lookAt(p),C.updateMatrixWorld(),C.matrixWorldInverse.getInverse(C.matrixWorld),D.cameraHelper&&(D.cameraHelper.visible=D.shadowCameraVisible),D.shadowCameraVisible&&D.cameraHelper.update(),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(C.projectionMatrix),S.multiply(C.matrixWorldInverse),c.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse),u.setFromMatrix(c),t.setRenderTarget(A),t.clear(),d.length=0,v(n,n,C),g=0,w=d.length;g<w;g++)P=(L=d[g]).object,T=L.buffer,U=b(P),I=void 0!==P.geometry.morphTargets&&P.geometry.morphTargets.length>0&&U.morphTargets,O=P instanceof nt.SkinnedMesh&&U.skinning,E=P.customDepthMaterial?P.customDepthMaterial:O?I?s:a:I?o:i,t.setMaterialFaces(U),T instanceof nt.BufferGeometry?t.renderBufferDirect(C,e,null,E,T,P):t.renderBuffer(C,e,null,E,T,P);for(g=0,w=r.length;g<w;g++)(P=(L=r[g]).object).visible&&P.castShadow&&(P._modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,P.matrixWorld),t.renderImmediateObject(C,e,null,i,P))}var V=t.getClearColor(),H=t.getClearAlpha();h.clearColor(V.r,V.g,V.b,H),h.enable(h.BLEND),t.shadowMapCullFace===nt.CullFaceFront&&h.cullFace(h.BACK),t.resetGLState()}}},nt.SpritePlugin=function(t,e){var n,r,i,o,a,s,h=t.context,u=function(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),u=new Uint16Array([0,1,2,0,2,3]);n=h.createBuffer(),r=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,n),h.bufferData(h.ARRAY_BUFFER,e,h.STATIC_DRAW),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u,h.STATIC_DRAW),i=function(){var e=h.createProgram(),n=h.createShader(h.VERTEX_SHADER),r=h.createShader(h.FRAGMENT_SHADER);return h.shaderSource(n,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),h.shaderSource(r,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),h.compileShader(n),h.compileShader(r),h.attachShader(e,n),h.attachShader(e,r),h.linkProgram(e),e}(),o={position:h.getAttribLocation(i,"position"),uv:h.getAttribLocation(i,"uv")},a={uvOffset:h.getUniformLocation(i,"uvOffset"),uvScale:h.getUniformLocation(i,"uvScale"),rotation:h.getUniformLocation(i,"rotation"),scale:h.getUniformLocation(i,"scale"),color:h.getUniformLocation(i,"color"),map:h.getUniformLocation(i,"map"),opacity:h.getUniformLocation(i,"opacity"),modelViewMatrix:h.getUniformLocation(i,"modelViewMatrix"),projectionMatrix:h.getUniformLocation(i,"projectionMatrix"),fogType:h.getUniformLocation(i,"fogType"),fogDensity:h.getUniformLocation(i,"fogDensity"),fogNear:h.getUniformLocation(i,"fogNear"),fogFar:h.getUniformLocation(i,"fogFar"),fogColor:h.getUniformLocation(i,"fogColor"),alphaTest:h.getUniformLocation(i,"alphaTest")};var c=document.createElement("canvas");c.width=8,c.height=8;var l=c.getContext("2d");l.fillStyle="white",l.fillRect(0,0,8,8),(s=new nt.Texture(c)).needsUpdate=!0};function c(t,e){return t.z!==e.z?e.z-t.z:e.id-t.id}this.render=function(l,f){if(0!==e.length){void 0===i&&u(),h.useProgram(i),h.enableVertexAttribArray(o.position),h.enableVertexAttribArray(o.uv),h.disable(h.CULL_FACE),h.enable(h.BLEND),h.bindBuffer(h.ARRAY_BUFFER,n),h.vertexAttribPointer(o.position,2,h.FLOAT,!1,16,0),h.vertexAttribPointer(o.uv,2,h.FLOAT,!1,16,8),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),h.uniformMatrix4fv(a.projectionMatrix,!1,f.projectionMatrix.elements),h.activeTexture(h.TEXTURE0),h.uniform1i(a.map,0);var p=0,d=0,m=l.fog;m?(h.uniform3f(a.fogColor,m.color.r,m.color.g,m.color.b),m instanceof nt.Fog?(h.uniform1f(a.fogNear,m.near),h.uniform1f(a.fogFar,m.far),h.uniform1i(a.fogType,1),p=1,d=1):m instanceof nt.FogExp2&&(h.uniform1f(a.fogDensity,m.density),h.uniform1i(a.fogType,2),p=2,d=2)):(h.uniform1i(a.fogType,0),p=0,d=0);for(var g=0,v=e.length;g<v;g++){(x=e[g])._modelViewMatrix.multiplyMatrices(f.matrixWorldInverse,x.matrixWorld),null===x.renderDepth?x.z=-x._modelViewMatrix.elements[14]:x.z=x.renderDepth}e.sort(c);var y=[];for(g=0,v=e.length;g<v;g++){var x,_=(x=e[g]).material;h.uniform1f(a.alphaTest,_.alphaTest),h.uniformMatrix4fv(a.modelViewMatrix,!1,x._modelViewMatrix.elements),y[0]=x.scale.x,y[1]=x.scale.y;var b=0;l.fog&&_.fog&&(b=d),p!==b&&(h.uniform1i(a.fogType,b),p=b),null!==_.map?(h.uniform2f(a.uvOffset,_.map.offset.x,_.map.offset.y),h.uniform2f(a.uvScale,_.map.repeat.x,_.map.repeat.y)):(h.uniform2f(a.uvOffset,0,0),h.uniform2f(a.uvScale,1,1)),h.uniform1f(a.opacity,_.opacity),h.uniform3f(a.color,_.color.r,_.color.g,_.color.b),h.uniform1f(a.rotation,_.rotation),h.uniform2fv(a.scale,y),t.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),t.setDepthTest(_.depthTest),t.setDepthWrite(_.depthWrite),_.map&&_.map.image&&_.map.image.width?t.setTexture(_.map,0):t.setTexture(s,0),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0)}h.enable(h.CULL_FACE),t.resetGLState()}}},nt.GeometryUtils={merge:function(t,e,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e instanceof nt.Mesh&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},nt.ImageUtils={crossOrigin:void 0,loadTexture:function(t,e,n,r){var i=new nt.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new nt.Texture(void 0,e);return i.load(t,function(t){o.image=t,o.needsUpdate=!0,n&&n(o)},void 0,function(t){r&&r(t)}),o.sourceFile=t,o},loadTextureCube:function(t,e,n,r){var i=new nt.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new nt.CubeTexture([],e);o.flipY=!1;for(var a=0,s=function(e){i.load(t[e],function(t){o.images[e]=t,6===(a+=1)&&(o.needsUpdate=!0,n&&n(o))})},h=0,u=t.length;h<u;++h)s(h);return o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(t,e){var n=function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},r=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return[t[0]/e,t[1]/e,t[2]/e]};e|=1;var i=t.width,o=t.height,a=document.createElement("canvas");a.width=i,a.height=o;var s=a.getContext("2d");s.drawImage(t,0,0);for(var h,u,c=s.getImageData(0,0,i,o).data,l=s.createImageData(i,o),f=l.data,p=0;p<i;p++)for(var d=0;d<o;d++){var m=d-1<0?0:d-1,g=d+1>o-1?o-1:d+1,v=p-1<0?0:p-1,y=p+1>i-1?i-1:p+1,x=[],_=[0,0,c[4*(d*i+p)]/255*e];x.push([-1,0,c[4*(d*i+v)]/255*e]),x.push([-1,-1,c[4*(m*i+v)]/255*e]),x.push([0,-1,c[4*(m*i+p)]/255*e]),x.push([1,-1,c[4*(m*i+y)]/255*e]),x.push([1,0,c[4*(d*i+y)]/255*e]),x.push([1,1,c[4*(g*i+y)]/255*e]),x.push([0,1,c[4*(g*i+p)]/255*e]),x.push([-1,1,c[4*(g*i+v)]/255*e]);for(var b=[],w=x.length,M=0;M<w;M++){var A=x[M],S=x[(M+1)%w];A=n(A,_),S=n(S,_),b.push(r((u=S,[(h=A)[1]*u[2]-h[2]*u[1],h[2]*u[0]-h[0]*u[2],h[0]*u[1]-h[1]*u[0]])))}var C=[0,0,0];for(M=0;M<b.length;M++)C[0]+=b[M][0],C[1]+=b[M][1],C[2]+=b[M][2];C[0]/=b.length,C[1]/=b.length,C[2]/=b.length;var T=4*(d*i+p);f[T]=(C[0]+1)/2*255|0,f[T+1]=(C[1]+1)/2*255|0,f[T+2]=255*C[2]|0,f[T+3]=255}return s.putImageData(l,0,0),a},generateDataTexture:function(t,e,n){for(var r=t*e,i=new Uint8Array(3*r),o=Math.floor(255*n.r),a=Math.floor(255*n.g),s=Math.floor(255*n.b),h=0;h<r;h++)i[3*h]=o,i[3*h+1]=a,i[3*h+2]=s;var u=new nt.DataTexture(i,t,e,nt.RGBFormat);return u.needsUpdate=!0,u}},nt.SceneUtils={createMultiMaterialObject:function(t,e){for(var n=new nt.Object3D,r=0,i=e.length;r<i;r++)n.add(new nt.Mesh(t,e[r]));return n},detach:function(t,e,n){t.applyMatrix(e.matrixWorld),e.remove(t),n.add(t)},attach:function(t,e,n){var r=new nt.Matrix4;r.getInverse(n.matrixWorld),t.applyMatrix(r),e.remove(t),n.add(t)}},nt.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(t){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(t){var e=t.familyName.toLowerCase();this.faces[e]=this.faces[e]||{},this.faces[e][t.cssFontWeight]=this.faces[e][t.cssFontWeight]||{},this.faces[e][t.cssFontWeight][t.cssFontStyle]=t;this.faces[e][t.cssFontWeight][t.cssFontStyle]=t;return t},drawText:function(t){var e,n=this.getFace(),r=this.size/n.resolution,i=0,o=String(t).split(""),a=o.length,s=[];for(e=0;e<a;e++){var h=new nt.Path,u=this.extractGlyphPoints(o[e],n,r,i,h);i+=u.offset,s.push(u.path)}return{paths:s,offset:i/2}},extractGlyphPoints:function(t,e,n,r,i){var o,a,s,h,u,c,l,f,p,d,m,g,v,y,x,_,b,w,M=[],A=e.glyphs[t]||e.glyphs["?"];if(A){if(A.o)for(u=(h=A._cachedOutline||(A._cachedOutline=A.o.split(" "))).length,c=n,l=n,o=0;o<u;)switch(h[o++]){case"m":f=h[o++]*c+r,p=h[o++]*l,i.moveTo(f,p);break;case"l":f=h[o++]*c+r,p=h[o++]*l,i.lineTo(f,p);break;case"q":if(d=h[o++]*c+r,m=h[o++]*l,y=h[o++]*c+r,x=h[o++]*l,i.quadraticCurveTo(y,x,d,m),w=M[M.length-1])for(g=w.x,v=w.y,a=1,s=this.divisions;a<=s;a++){var S=a/s;nt.Shape.Utils.b2(S,g,y,d),nt.Shape.Utils.b2(S,v,x,m)}break;case"b":if(d=h[o++]*c+r,m=h[o++]*l,y=h[o++]*c+r,x=h[o++]*l,_=h[o++]*c+r,b=h[o++]*l,i.bezierCurveTo(y,x,_,b,d,m),w=M[M.length-1])for(g=w.x,v=w.y,a=1,s=this.divisions;a<=s;a++)S=a/s,nt.Shape.Utils.b3(S,g,y,_,d),nt.Shape.Utils.b3(S,v,x,b,m)}return{offset:A.ha*n,path:i}}}},nt.FontUtils.generateShapes=function(t,e){var n=void 0!==(e=e||{}).size?e.size:100,r=void 0!==e.curveSegments?e.curveSegments:4,i=void 0!==e.font?e.font:"helvetiker",o=void 0!==e.weight?e.weight:"normal",a=void 0!==e.style?e.style:"normal";nt.FontUtils.size=n,nt.FontUtils.divisions=r,nt.FontUtils.face=i,nt.FontUtils.weight=o,nt.FontUtils.style=a;for(var s=nt.FontUtils.drawText(t).paths,h=[],u=0,c=s.length;u<c;u++)Array.prototype.push.apply(h,s[u].toShapes());return h},H=nt.FontUtils,G=function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},j=function(t,e,n,r,i,o){var a,s,h,u,c,l,f,p,d,m,g,v,y,x,_;if(s=t[o[e]].x,h=t[o[e]].y,u=t[o[n]].x,c=t[o[n]].y,l=t[o[r]].x,1e-10>(u-s)*((f=t[o[r]].y)-h)-(c-h)*(l-s))return!1;for(m=l-u,g=f-c,v=s-l,y=h-f,x=u-s,_=c-h,a=0;a<i;a++)if(p=t[o[a]].x,d=t[o[a]].y,!(p===s&&d===h||p===u&&d===c||p===l&&d===f)&&m*(d-c)-g*(p-u)>=-1e-10&&v*(d-f)-y*(p-l)>=-1e-10&&x*(d-h)-_*(p-s)>=-1e-10)return!1;return!0},H.Triangulate=function(t,e){var n=t.length;if(n<3)return null;var r,i,o,a=[],s=[],h=[];if(G(t)>0)for(i=0;i<n;i++)s[i]=i;else for(i=0;i<n;i++)s[i]=n-1-i;var u=n,c=2*u;for(i=u-1;u>2;){if(c--<=0)return console.log("Warning, unable to triangulate polygon!"),e?h:a;if(u<=(r=i)&&(r=0),u<=(i=r+1)&&(i=0),u<=(o=i+1)&&(o=0),j(t,r,i,o,u,s)){var l,f,p,d,m;for(l=s[r],f=s[i],p=s[o],a.push([t[l],t[f],t[p]]),h.push([s[r],s[i],s[o]]),d=i,m=i+1;m<u;d++,m++)s[d]=s[m];c=2*--u}}return e?h:a},H.Triangulate.area=G,et._typeface_js={faces:nt.FontUtils.faces,loadFace:nt.FontUtils.loadFace},nt.typeface_js=et._typeface_js,nt.Audio=function(t){nt.Object3D.call(this),this.type="Audio",this.context=t.context,this.source=this.context.createBufferSource(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain)},nt.Audio.prototype=Object.create(nt.Object3D.prototype),nt.Audio.prototype.load=function(t){var e=this,n=new XMLHttpRequest;return n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(t){e.context.decodeAudioData(this.response,function(t){e.source.buffer=t,e.source.connect(e.panner),e.source.start(0)})},n.send(),this},nt.Audio.prototype.setLoop=function(t){this.source.loop=t},nt.Audio.prototype.setRefDistance=function(t){this.panner.refDistance=t},nt.Audio.prototype.setRolloffFactor=function(t){this.panner.rolloffFactor=t},nt.Audio.prototype.updateMatrixWorld=function(){var t=new nt.Vector3;return function(e){nt.Object3D.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}(),nt.AudioListener=function(){nt.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},nt.AudioListener.prototype=Object.create(nt.Object3D.prototype),nt.AudioListener.prototype.updateMatrixWorld=function(){var t=new nt.Vector3,e=new nt.Quaternion,n=new nt.Vector3,r=new nt.Vector3,i=new nt.Vector3,o=new nt.Vector3;return function(a){nt.Object3D.prototype.updateMatrixWorld.call(this,a);var s=this.context.listener;this.matrixWorld.decompose(t,e,n),r.set(0,0,-1).applyQuaternion(e),i.subVectors(t,o),s.setPosition(t.x,t.y,t.z),s.setOrientation(r.x,r.y,r.z,this.up.x,this.up.y,this.up.z),s.setVelocity(i.x,i.y,i.z),o.copy(t)}}(),nt.Curve=function(){},nt.Curve.prototype.getPoint=function(t){return console.log("Warning, getPoint() not implemented!"),null},nt.Curve.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},nt.Curve.prototype.getPoints=function(t){t||(t=5);var e,n=[];for(e=0;e<=t;e++)n.push(this.getPoint(e/t));return n},nt.Curve.prototype.getSpacedPoints=function(t){t||(t=5);var e,n=[];for(e=0;e<=t;e++)n.push(this.getPointAt(e/t));return n},nt.Curve.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},nt.Curve.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=t;n++)o+=(e=this.getPoint(n/t)).distanceTo(i),r.push(o),i=e;return this.cacheArcLengths=r,r},nt.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},nt.Curve.prototype.getUtoTmapping=function(t,e){var n,r=this.getLengths(),i=0,o=r.length;n=e||t*r[o-1];for(var a,s=0,h=o-1;s<=h;)if((a=r[i=Math.floor(s+(h-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){h=i;break}h=i-1}if(r[i=h]==n)return i/(o-1);var u=r[i];return(i+(n-u)/(r[i+1]-u))/(o-1)},nt.Curve.prototype.getTangent=function(t){var e=t-1e-4,n=t+1e-4;e<0&&(e=0),n>1&&(n=1);var r=this.getPoint(e);return this.getPoint(n).clone().sub(r).normalize()},nt.Curve.prototype.getTangentAt=function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},nt.Curve.Utils={tangentQuadraticBezier:function(t,e,n,r){return 2*(1-t)*(n-e)+2*t*(r-n)},tangentCubicBezier:function(t,e,n,r,i){return-3*e*(1-t)*(1-t)+3*n*(1-t)*(1-t)-6*t*n*(1-t)+6*t*r*(1-t)-3*t*t*r+3*t*t*i},tangentSpline:function(t,e,n,r,i){return 6*t*t-6*t+(3*t*t-4*t+1)+(-6*t*t+6*t)+(3*t*t-2*t)},interpolate:function(t,e,n,r,i){var o=.5*(n-t),a=.5*(r-e),s=i*i;return(2*e-2*n+o+a)*(i*s)+(-3*e+3*n-2*o-a)*s+o*i+e}},nt.Curve.create=function(t,e){return t.prototype=Object.create(nt.Curve.prototype),t.prototype.getPoint=e,t},nt.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},nt.CurvePath.prototype=Object.create(nt.Curve.prototype),nt.CurvePath.prototype.add=function(t){this.curves.push(t)},nt.CurvePath.prototype.checkConnection=function(){},nt.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new nt.LineCurve(e,t))},nt.CurvePath.prototype.getPoint=function(t){for(var e,n=t*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=n){var o=1-(r[i]-n)/(e=this.curves[i]).getLength();return e.getPointAt(o)}i++}return null},nt.CurvePath.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},nt.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var t,e=[],n=0,r=this.curves.length;for(t=0;t<r;t++)n+=this.curves[t].getLength(),e.push(n);return this.cacheLengths=e,e},nt.CurvePath.prototype.getBoundingBox=function(){var t,e,n,r,i,o,a,s,h,u,c=this.getPoints();t=e=Number.NEGATIVE_INFINITY,r=i=Number.POSITIVE_INFINITY;var l=c[0]instanceof nt.Vector3;for(u=l?new nt.Vector3:new nt.Vector2,s=0,h=c.length;s<h;s++)(a=c[s]).x>t?t=a.x:a.x<r&&(r=a.x),a.y>e?e=a.y:a.y<i&&(i=a.y),l&&(a.z>n?n=a.z:a.z<o&&(o=a.z)),u.add(a);var f={minX:r,minY:i,maxX:t,maxY:e};return l&&(f.maxZ=n,f.minZ=o),f},nt.CurvePath.prototype.createPointsGeometry=function(t){var e=this.getPoints(t,!0);return this.createGeometry(e)},nt.CurvePath.prototype.createSpacedPointsGeometry=function(t){var e=this.getSpacedPoints(t,!0);return this.createGeometry(e)},nt.CurvePath.prototype.createGeometry=function(t){for(var e=new nt.Geometry,n=0;n<t.length;n++)e.vertices.push(new nt.Vector3(t[n].x,t[n].y,t[n].z||0));return e},nt.CurvePath.prototype.addWrapPath=function(t){this.bends.push(t)},nt.CurvePath.prototype.getTransformedPoints=function(t,e){var n,r,i=this.getPoints(t);for(e||(e=this.bends),n=0,r=e.length;n<r;n++)i=this.getWrapPoints(i,e[n]);return i},nt.CurvePath.prototype.getTransformedSpacedPoints=function(t,e){var n,r,i=this.getSpacedPoints(t);for(e||(e=this.bends),n=0,r=e.length;n<r;n++)i=this.getWrapPoints(i,e[n]);return i},nt.CurvePath.prototype.getWrapPoints=function(t,e){var n,r,i,o,a,s,h=this.getBoundingBox();for(n=0,r=t.length;n<r;n++){o=(i=t[n]).x,a=i.y,s=o/h.maxX,s=e.getUtoTmapping(s,o);var u=e.getPoint(s),c=e.getTangent(s);c.set(-c.y,c.x).multiplyScalar(a),i.x=u.x+c.x,i.y=u.y+c.y}return t},nt.Gyroscope=function(){nt.Object3D.call(this)},nt.Gyroscope.prototype=Object.create(nt.Object3D.prototype),nt.Gyroscope.prototype.updateMatrixWorld=(W=new nt.Vector3,X=new nt.Quaternion,q=new nt.Vector3,Q=new nt.Vector3,Y=new nt.Quaternion,K=new nt.Vector3,function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(Q,Y,K),this.matrix.decompose(W,X,q),this.matrixWorld.compose(Q,X,K)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,n=this.children.length;e<n;e++)this.children[e].updateMatrixWorld(t)}),nt.Path=function(t){nt.CurvePath.call(this),this.actions=[],t&&this.fromPoints(t)},nt.Path.prototype=Object.create(nt.CurvePath.prototype),nt.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},nt.Path.prototype.fromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y)},nt.Path.prototype.moveTo=function(t,e){var n=Array.prototype.slice.call(arguments);this.actions.push({action:nt.PathActions.MOVE_TO,args:n})},nt.Path.prototype.lineTo=function(t,e){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],o=r[r.length-1],a=new nt.LineCurve(new nt.Vector2(i,o),new nt.Vector2(t,e));this.curves.push(a),this.actions.push({action:nt.PathActions.LINE_TO,args:n})},nt.Path.prototype.quadraticCurveTo=function(t,e,n,r){var i=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,a=o[o.length-2],s=o[o.length-1],h=new nt.QuadraticBezierCurve(new nt.Vector2(a,s),new nt.Vector2(t,e),new nt.Vector2(n,r));this.curves.push(h),this.actions.push({action:nt.PathActions.QUADRATIC_CURVE_TO,args:i})},nt.Path.prototype.bezierCurveTo=function(t,e,n,r,i,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,h=s[s.length-2],u=s[s.length-1],c=new nt.CubicBezierCurve(new nt.Vector2(h,u),new nt.Vector2(t,e),new nt.Vector2(n,r),new nt.Vector2(i,o));this.curves.push(c),this.actions.push({action:nt.PathActions.BEZIER_CURVE_TO,args:a})},nt.Path.prototype.splineThru=function(t){var e=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,r=n[n.length-2],i=n[n.length-1],o=[new nt.Vector2(r,i)];Array.prototype.push.apply(o,t);var a=new nt.SplineCurve(o);this.curves.push(a),this.actions.push({action:nt.PathActions.CSPLINE_THRU,args:e})},nt.Path.prototype.arc=function(t,e,n,r,i,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],h=a[a.length-1];this.absarc(t+s,e+h,n,r,i,o)},nt.Path.prototype.absarc=function(t,e,n,r,i,o){this.absellipse(t,e,n,n,r,i,o)},nt.Path.prototype.ellipse=function(t,e,n,r,i,o,a){var s=this.actions[this.actions.length-1].args,h=s[s.length-2],u=s[s.length-1];this.absellipse(t+h,e+u,n,r,i,o,a)},nt.Path.prototype.absellipse=function(t,e,n,r,i,o,a){var s=Array.prototype.slice.call(arguments),h=new nt.EllipseCurve(t,e,n,r,i,o,a);this.curves.push(h);var u=h.getPoint(1);s.push(u.x),s.push(u.y),this.actions.push({action:nt.PathActions.ELLIPSE,args:s})},nt.Path.prototype.getSpacedPoints=function(t,e){t||(t=40);for(var n=[],r=0;r<t;r++)n.push(this.getPoint(r/t));return n},nt.Path.prototype.getPoints=function(t,e){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(t,e);t=t||12;var n,r,i,o,a,s,h,u,c,l,f,p,d,m,g,v,y,x,_=[];for(n=0,r=this.actions.length;n<r;n++)switch(o=(i=this.actions[n]).action,a=i.args,o){case nt.PathActions.MOVE_TO:case nt.PathActions.LINE_TO:_.push(new nt.Vector2(a[0],a[1]));break;case nt.PathActions.QUADRATIC_CURVE_TO:for(s=a[2],h=a[3],l=a[0],f=a[1],_.length>0?(p=(m=_[_.length-1]).x,d=m.y):(p=(m=this.actions[n-1].args)[m.length-2],d=m[m.length-1]),g=1;g<=t;g++)v=g/t,y=nt.Shape.Utils.b2(v,p,l,s),x=nt.Shape.Utils.b2(v,d,f,h),_.push(new nt.Vector2(y,x));break;case nt.PathActions.BEZIER_CURVE_TO:for(s=a[4],h=a[5],l=a[0],f=a[1],u=a[2],c=a[3],_.length>0?(p=(m=_[_.length-1]).x,d=m.y):(p=(m=this.actions[n-1].args)[m.length-2],d=m[m.length-1]),g=1;g<=t;g++)v=g/t,y=nt.Shape.Utils.b3(v,p,l,u,s),x=nt.Shape.Utils.b3(v,d,f,c,h),_.push(new nt.Vector2(y,x));break;case nt.PathActions.CSPLINE_THRU:m=this.actions[n-1].args;var b=[new nt.Vector2(m[m.length-2],m[m.length-1])],w=t*a[0].length;b=b.concat(a[0]);var M=new nt.SplineCurve(b);for(g=1;g<=w;g++)_.push(M.getPointAt(g/w));break;case nt.PathActions.ARC:var A=a[0],S=a[1],C=a[2],T=a[3],E=a[4],L=!!a[5],P=E-T,D=2*t;for(g=1;g<=D;g++)v=g/D,L||(v=1-v),R=T+v*P,y=A+C*Math.cos(R),x=S+C*Math.sin(R),_.push(new nt.Vector2(y,x));break;case nt.PathActions.ELLIPSE:A=a[0],S=a[1];var R,F=a[2],k=a[3];T=a[4],E=a[5],L=!!a[6],P=E-T,D=2*t;for(g=1;g<=D;g++)v=g/D,L||(v=1-v),R=T+v*P,y=A+F*Math.cos(R),x=S+k*Math.sin(R),_.push(new nt.Vector2(y,x))}var B=_[_.length-1];return Math.abs(B.x-_[0].x)<1e-10&&Math.abs(B.y-_[0].y)<1e-10&&_.splice(_.length-1,1),e&&_.push(_[0]),_},nt.Path.prototype.toShapes=function(t,e){function n(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],o=new nt.Shape;o.actions=i.actions,o.curves=i.curves,e.push(o)}return e}function r(t,e){for(var n=e.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=e[i],s=e[o],h=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>1e-10){if(u<0&&(a=e[o],h=-h,s=e[i],u=-u),t.y<a.y||t.y>s.y)continue;if(t.y==a.y){if(t.x==a.x)return!0}else{var c=u*(t.x-a.x)-h*(t.y-a.y);if(0==c)return!0;if(c<0)continue;r=!r}}else{if(t.y!=a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return r}var i=function(t){var e,n,r,i,o,a=[],s=new nt.Path;for(e=0,n=t.length;e<n;e++)o=(r=t[e]).args,(i=r.action)==nt.PathActions.MOVE_TO&&0!=s.actions.length&&(a.push(s),s=new nt.Path),s[i].apply(s,o);return 0!=s.actions.length&&a.push(s),a}(this.actions);if(0==i.length)return[];if(!0===e)return n(i);var o,a,s,h=[];if(1==i.length)return a=i[0],(s=new nt.Shape).actions=a.actions,s.curves=a.curves,h.push(s),h;var u=!nt.Shape.Utils.isClockWise(i[0].getPoints());u=t?!u:u;var c,l,f,p,d,m,g=[],v=[],y=[],x=0;for(v[x]=void 0,y[x]=[],l=0,f=i.length;l<f;l++)c=(a=i[l]).getPoints(),o=nt.Shape.Utils.isClockWise(c),(o=t?!o:o)?(!u&&v[x]&&x++,v[x]={s:new nt.Shape,p:c},v[x].s.actions=a.actions,v[x].s.curves=a.curves,u&&x++,y[x]=[]):y[x].push({h:a,p:c[0]});if(!v[0])return n(i);if(v.length>1){for(var _=!1,b=[],w=0,M=v.length;w<M;w++)g[w]=[];for(w=0,M=v.length;w<M;w++){v[w];for(var A=y[w],S=0;S<A.length;S++){for(var C=A[S],T=!0,E=0;E<v.length;E++)r(C.p,v[E].p)&&(w!=E&&b.push({froms:w,tos:E,hole:S}),T?(T=!1,g[E].push(C)):_=!0);T&&g[w].push(C)}}b.length>0&&(_||(y=g))}for(l=0,f=v.length;l<f;l++)for(s=v[l].s,h.push(s),d=0,m=(p=y[l]).length;d<m;d++)s.holes.push(p[d].h);return h},nt.Shape=function(){nt.Path.apply(this,arguments),this.holes=[]},nt.Shape.prototype=Object.create(nt.Path.prototype),nt.Shape.prototype.extrude=function(t){return new nt.ExtrudeGeometry(this,t)},nt.Shape.prototype.makeGeometry=function(t){return new nt.ShapeGeometry(this,t)},nt.Shape.prototype.getPointsHoles=function(t){var e,n=this.holes.length,r=[];for(e=0;e<n;e++)r[e]=this.holes[e].getTransformedPoints(t,this.bends);return r},nt.Shape.prototype.getSpacedPointsHoles=function(t){var e,n=this.holes.length,r=[];for(e=0;e<n;e++)r[e]=this.holes[e].getTransformedSpacedPoints(t,this.bends);return r},nt.Shape.prototype.extractAllPoints=function(t){return{shape:this.getTransformedPoints(t),holes:this.getPointsHoles(t)}},nt.Shape.prototype.extractPoints=function(t){return this.useSpacedPoints?this.extractAllSpacedPoints(t):this.extractAllPoints(t)},nt.Shape.prototype.extractAllSpacedPoints=function(t){return{shape:this.getTransformedSpacedPoints(t),holes:this.getSpacedPointsHoles(t)}},nt.Shape.Utils={triangulateShape:function(t,e){function n(t,e,n){return t.x!=e.x?t.x<e.x?t.x<=n.x&&n.x<=e.x:e.x<=n.x&&n.x<=t.x:t.y<e.y?t.y<=n.y&&n.y<=e.y:e.y<=n.y&&n.y<=t.y}function r(t,e,r,i,o){var a=e.x-t.x,s=e.y-t.y,h=i.x-r.x,u=i.y-r.y,c=t.x-r.x,l=t.y-r.y,f=s*h-a*u,p=s*c-a*l;if(Math.abs(f)>1e-10){var d;if(f>0){if(p<0||p>f)return[];if((d=u*c-h*l)<0||d>f)return[]}else{if(p>0||p<f)return[];if((d=u*c-h*l)>0||d<f)return[]}if(0==d)return!o||0!=p&&p!=f?[t]:[];if(d==f)return!o||0!=p&&p!=f?[e]:[];if(0==p)return[r];if(p==f)return[i];var m=d/f;return[{x:t.x+m*a,y:t.y+m*s}]}if(0!=p||u*c!=h*l)return[];var g,v,y,x,_,b,w,M,A=0==a&&0==s,S=0==h&&0==u;return A&&S?t.x!=r.x||t.y!=r.y?[]:[t]:A?n(r,i,t)?[t]:[]:S?n(t,e,r)?[r]:[]:(0!=a?(t.x<e.x?(g=t,y=t.x,v=e,x=e.x):(g=e,y=e.x,v=t,x=t.x),r.x<i.x?(_=r,w=r.x,b=i,M=i.x):(_=i,w=i.x,b=r,M=r.x)):(t.y<e.y?(g=t,y=t.y,v=e,x=e.y):(g=e,y=e.y,v=t,x=t.y),r.y<i.y?(_=r,w=r.y,b=i,M=i.y):(_=i,w=i.y,b=r,M=r.y)),y<=w?x<w?[]:x==w?o?[]:[_]:x<=M?[_,v]:[_,b]:y>M?[]:y==M?o?[]:[g]:x<=M?[g,v]:[g,b])}function i(t,e,n,r){var i=e.x-t.x,o=e.y-t.y,a=n.x-t.x,s=n.y-t.y,h=r.x-t.x,u=r.y-t.y,c=i*s-o*a,l=i*u-o*h;if(Math.abs(c)>1e-10){var f=h*s-u*a;return c>0?l>=0&&f>=0:l>=0||f>=0}return l>0}for(var o,a,s,h,u,c,l={},f=t.concat(),p=0,d=e.length;p<d;p++)Array.prototype.push.apply(f,e[p]);for(o=0,a=f.length;o<a;o++)void 0!==l[u=f[o].x+":"+f[o].y]&&console.log("Duplicate point",u),l[u]=o;var m=function(t,e){var n,o=t.concat();function a(t,e){var r=o.length-1,a=t-1;a<0&&(a=r);var s=t+1;s>r&&(s=0);var h=i(o[t],o[a],o[s],n[e]);if(!h)return!1;var u=n.length-1,c=e-1;c<0&&(c=u);var l=e+1;return l>u&&(l=0),!!(h=i(n[e],n[c],n[l],o[t]))}function s(t,e){var n,i;for(n=0;n<o.length;n++)if(i=n+1,i%=o.length,r(t,e,o[n],o[i],!0).length>0)return!0;return!1}var h=[];function u(t,n){var i,o,a,s;for(i=0;i<h.length;i++)for(o=e[h[i]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,r(t,n,o[a],o[s],!0).length>0)return!0;return!1}for(var c,l,f,p,d,m,g,v,y,x,_=[],b=0,w=e.length;b<w;b++)h.push(b);for(var M=0,A=2*h.length;h.length>0;){if(--A<0){console.log("Infinite Loop! Holes left:"+h.length+", Probably Hole outside Shape!");break}for(l=M;l<o.length;l++){for(f=o[l],c=-1,b=0;b<h.length;b++)if(d=h[b],void 0===_[m=f.x+":"+f.y+":"+d]){n=e[d];for(var S=0;S<n.length;S++)if(p=n[S],a(l,S)&&!s(f,p)&&!u(f,p)){c=S,h.splice(b,1),g=o.slice(0,l+1),v=o.slice(l),y=n.slice(c),x=n.slice(0,c+1),o=g.concat(y).concat(x).concat(v),M=l;break}if(c>=0)break;_[m]=!0}if(c>=0)break}}return o}(t,e),g=nt.FontUtils.Triangulate(m,!1);for(o=0,a=g.length;o<a;o++)for(h=g[o],s=0;s<3;s++)void 0!==(c=l[u=h[s].x+":"+h[s].y])&&(h[s]=c);return g.concat()},isClockWise:function(t){return nt.FontUtils.Triangulate.area(t)<0},b2p0:function(t,e){var n=1-t;return n*n*e},b2p1:function(t,e){return 2*(1-t)*t*e},b2p2:function(t,e){return t*t*e},b2:function(t,e,n,r){return this.b2p0(t,e)+this.b2p1(t,n)+this.b2p2(t,r)},b3p0:function(t,e){var n=1-t;return n*n*n*e},b3p1:function(t,e){var n=1-t;return 3*n*n*t*e},b3p2:function(t,e){return 3*(1-t)*t*t*e},b3p3:function(t,e){return t*t*t*e},b3:function(t,e,n,r,i){return this.b3p0(t,e)+this.b3p1(t,n)+this.b3p2(t,r)+this.b3p3(t,i)}},nt.LineCurve=function(t,e){this.v1=t,this.v2=e},nt.LineCurve.prototype=Object.create(nt.Curve.prototype),nt.LineCurve.prototype.getPoint=function(t){var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},nt.LineCurve.prototype.getPointAt=function(t){return this.getPoint(t)},nt.LineCurve.prototype.getTangent=function(t){return this.v2.clone().sub(this.v1).normalize()},nt.QuadraticBezierCurve=function(t,e,n){this.v0=t,this.v1=e,this.v2=n},nt.QuadraticBezierCurve.prototype=Object.create(nt.Curve.prototype),nt.QuadraticBezierCurve.prototype.getPoint=function(t){var e=new nt.Vector2;return e.x=nt.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),e.y=nt.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),e},nt.QuadraticBezierCurve.prototype.getTangent=function(t){var e=new nt.Vector2;return e.x=nt.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x),e.y=nt.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y),e.normalize()},nt.CubicBezierCurve=function(t,e,n,r){this.v0=t,this.v1=e,this.v2=n,this.v3=r},nt.CubicBezierCurve.prototype=Object.create(nt.Curve.prototype),nt.CubicBezierCurve.prototype.getPoint=function(t){var e,n;return e=nt.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=nt.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new nt.Vector2(e,n)},nt.CubicBezierCurve.prototype.getTangent=function(t){var e,n;e=nt.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=nt.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new nt.Vector2(e,n);return r.normalize(),r},nt.SplineCurve=function(t){this.points=null==t?[]:t},nt.SplineCurve.prototype=Object.create(nt.Curve.prototype),nt.SplineCurve.prototype.getPoint=function(t){var e=this.points,n=(e.length-1)*t,r=Math.floor(n),i=n-r,o=e[0==r?r:r-1],a=e[r],s=e[r>e.length-2?e.length-1:r+1],h=e[r>e.length-3?e.length-1:r+2],u=new nt.Vector2;return u.x=nt.Curve.Utils.interpolate(o.x,a.x,s.x,h.x,i),u.y=nt.Curve.Utils.interpolate(o.y,a.y,s.y,h.y,i),u},nt.EllipseCurve=function(t,e,n,r,i,o,a){this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a},nt.EllipseCurve.prototype=Object.create(nt.Curve.prototype),nt.EllipseCurve.prototype.getPoint=function(t){var e,n=this.aEndAngle-this.aStartAngle;n<0&&(n+=2*Math.PI),n>2*Math.PI&&(n-=2*Math.PI),e=!0===this.aClockwise?this.aEndAngle+(1-t)*(2*Math.PI-n):this.aStartAngle+t*n;var r=new nt.Vector2;return r.x=this.aX+this.xRadius*Math.cos(e),r.y=this.aY+this.yRadius*Math.sin(e),r},nt.ArcCurve=function(t,e,n,r,i,o){nt.EllipseCurve.call(this,t,e,n,n,r,i,o)},nt.ArcCurve.prototype=Object.create(nt.EllipseCurve.prototype),nt.LineCurve3=nt.Curve.create(function(t,e){this.v1=t,this.v2=e},function(t){var e=new nt.Vector3;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e}),nt.QuadraticBezierCurve3=nt.Curve.create(function(t,e,n){this.v0=t,this.v1=e,this.v2=n},function(t){var e=new nt.Vector3;return e.x=nt.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),e.y=nt.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),e.z=nt.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),e}),nt.CubicBezierCurve3=nt.Curve.create(function(t,e,n,r){this.v0=t,this.v1=e,this.v2=n,this.v3=r},function(t){var e=new nt.Vector3;return e.x=nt.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e.y=nt.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e.z=nt.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),e}),nt.SplineCurve3=nt.Curve.create(function(t){this.points=null==t?[]:t},function(t){var e=this.points,n=(e.length-1)*t,r=Math.floor(n),i=n-r,o=e[0==r?r:r-1],a=e[r],s=e[r>e.length-2?e.length-1:r+1],h=e[r>e.length-3?e.length-1:r+2],u=new nt.Vector3;return u.x=nt.Curve.Utils.interpolate(o.x,a.x,s.x,h.x,i),u.y=nt.Curve.Utils.interpolate(o.y,a.y,s.y,h.y,i),u.z=nt.Curve.Utils.interpolate(o.z,a.z,s.z,h.z,i),u}),nt.ClosedSplineCurve3=nt.Curve.create(function(t){this.points=null==t?[]:t},function(t){var e=this.points,n=(e.length-0)*t,r=Math.floor(n),i=n-r,o=e[((r+=r>0?0:(Math.floor(Math.abs(r)/e.length)+1)*e.length)-1)%e.length],a=e[r%e.length],s=e[(r+1)%e.length],h=e[(r+2)%e.length],u=new nt.Vector3;return u.x=nt.Curve.Utils.interpolate(o.x,a.x,s.x,h.x,i),u.y=nt.Curve.Utils.interpolate(o.y,a.y,s.y,h.y,i),u.z=nt.Curve.Utils.interpolate(o.z,a.z,s.z,h.z,i),u}),nt.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(t){if(!0!==t.initialized){for(var e=0;e<t.hierarchy.length;e++){for(var n=0;n<t.hierarchy[e].keys.length;n++)if(t.hierarchy[e].keys[n].time<0&&(t.hierarchy[e].keys[n].time=0),void 0!==t.hierarchy[e].keys[n].rot&&!(t.hierarchy[e].keys[n].rot instanceof nt.Quaternion)){var r=t.hierarchy[e].keys[n].rot;t.hierarchy[e].keys[n].rot=(new nt.Quaternion).fromArray(r)}if(t.hierarchy[e].keys.length&&void 0!==t.hierarchy[e].keys[0].morphTargets){var i={};for(n=0;n<t.hierarchy[e].keys.length;n++)for(var o=0;o<t.hierarchy[e].keys[n].morphTargets.length;o++){i[s=t.hierarchy[e].keys[n].morphTargets[o]]=-1}t.hierarchy[e].usedMorphTargets=i;for(n=0;n<t.hierarchy[e].keys.length;n++){var a={};for(var s in i){for(o=0;o<t.hierarchy[e].keys[n].morphTargets.length;o++)if(t.hierarchy[e].keys[n].morphTargets[o]===s){a[s]=t.hierarchy[e].keys[n].morphTargetsInfluences[o];break}o===t.hierarchy[e].keys[n].morphTargets.length&&(a[s]=0)}t.hierarchy[e].keys[n].morphTargetsInfluences=a}}for(n=1;n<t.hierarchy[e].keys.length;n++)t.hierarchy[e].keys[n].time===t.hierarchy[e].keys[n-1].time&&(t.hierarchy[e].keys.splice(n,1),n--);for(n=0;n<t.hierarchy[e].keys.length;n++)t.hierarchy[e].keys[n].index=n}return t.initialized=!0,t}},parse:function(t){var e=function(t,n){n.push(t);for(var r=0;r<t.children.length;r++)e(t.children[r],n)},n=[];if(t instanceof nt.SkinnedMesh)for(var r=0;r<t.skeleton.bones.length;r++)n.push(t.skeleton.bones[r]);else e(t,n);return n},play:function(t){-1===this.animations.indexOf(t)&&this.animations.push(t)},stop:function(t){var e=this.animations.indexOf(t);-1!==e&&this.animations.splice(e,1)},update:function(t){for(var e=0;e<this.animations.length;e++)this.animations[e].resetBlendWeights();for(e=0;e<this.animations.length;e++)this.animations[e].update(t)}},nt.Animation=function(t,e){this.root=t,this.data=nt.AnimationHandler.init(e),this.hierarchy=nt.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=nt.AnimationHandler.LINEAR},nt.Animation.prototype.keyTypes=["pos","rot","scl"],nt.Animation.prototype.play=function(t,e){this.currentTime=void 0!==t?t:0,this.weight=void 0!==e?e:1,this.isPlaying=!0,this.reset(),nt.AnimationHandler.play(this)},nt.Animation.prototype.stop=function(){this.isPlaying=!1,nt.AnimationHandler.stop(this)},nt.Animation.prototype.reset=function(){for(var t=0,e=this.hierarchy.length;t<e;t++){var n=this.hierarchy[t];n.matrixAutoUpdate=!0,void 0===n.animationCache&&(n.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}),void 0===n.animationCache.animations[this.data.name]&&(n.animationCache.animations[this.data.name]={},n.animationCache.animations[this.data.name].prevKey={pos:0,rot:0,scl:0},n.animationCache.animations[this.data.name].nextKey={pos:0,rot:0,scl:0},n.animationCache.animations[this.data.name].originalMatrix=n.matrix);for(var r=n.animationCache.animations[this.data.name],i=0;i<3;i++){for(var o=this.keyTypes[i],a=this.data.hierarchy[t].keys[0],s=this.getNextKeyWith(o,t,1);s.time<this.currentTime&&s.index>a.index;)a=s,s=this.getNextKeyWith(o,t,s.index+1);r.prevKey[o]=a,r.nextKey[o]=s}}},nt.Animation.prototype.resetBlendWeights=function(){for(var t=0,e=this.hierarchy.length;t<e;t++){var n=this.hierarchy[t];void 0!==n.animationCache&&(n.animationCache.blending.positionWeight=0,n.animationCache.blending.quaternionWeight=0,n.animationCache.blending.scaleWeight=0)}},nt.Animation.prototype.update=function(){var t=[],e=new nt.Vector3,n=new nt.Vector3,r=new nt.Quaternion,i=function(t,e){var n,r,i,a,s,h,u,c,l,f=[],p=[];return i=(n=(t.length-1)*e)-(r=Math.floor(n)),f[0]=0===r?r:r-1,f[1]=r,f[2]=r>t.length-2?r:r+1,f[3]=r>t.length-3?r:r+2,h=t[f[0]],u=t[f[1]],c=t[f[2]],l=t[f[3]],s=i*(a=i*i),p[0]=o(h[0],u[0],c[0],l[0],i,a,s),p[1]=o(h[1],u[1],c[1],l[1],i,a,s),p[2]=o(h[2],u[2],c[2],l[2],i,a,s),p},o=function(t,e,n,r,i,o,a){var s=.5*(n-t),h=.5*(r-e);return(2*(e-n)+s+h)*a+(-3*(e-n)-2*s-h)*o+s*i+e};return function(o){if(!1!==this.isPlaying&&(this.currentTime+=o*this.timeScale,0!==this.weight)){var a=this.data.length;if(this.currentTime>a||this.currentTime<0){if(!this.loop)return void this.stop();this.currentTime%=a,this.currentTime<0&&(this.currentTime+=a),this.reset()}for(var s=0,h=this.hierarchy.length;s<h;s++)for(var u=this.hierarchy[s],c=u.animationCache.animations[this.data.name],l=u.animationCache.blending,f=0;f<3;f++){var p=this.keyTypes[f],d=c.prevKey[p],m=c.nextKey[p];if(this.timeScale>0&&m.time<=this.currentTime||this.timeScale<0&&d.time>=this.currentTime){for(d=this.data.hierarchy[s].keys[0],m=this.getNextKeyWith(p,s,1);m.time<this.currentTime&&m.index>d.index;)d=m,m=this.getNextKeyWith(p,s,m.index+1);c.prevKey[p]=d,c.nextKey[p]=m}u.matrixAutoUpdate=!0,u.matrixWorldNeedsUpdate=!0;var g=(this.currentTime-d.time)/(m.time-d.time),v=d[p],y=m[p];if(g<0&&(g=0),g>1&&(g=1),"pos"===p){if(this.interpolationType===nt.AnimationHandler.LINEAR){n.x=v[0]+(y[0]-v[0])*g,n.y=v[1]+(y[1]-v[1])*g,n.z=v[2]+(y[2]-v[2])*g;var x=this.weight/(this.weight+l.positionWeight);u.position.lerp(n,x),l.positionWeight+=this.weight}else if(this.interpolationType===nt.AnimationHandler.CATMULLROM||this.interpolationType===nt.AnimationHandler.CATMULLROM_FORWARD){t[0]=this.getPrevKeyWith("pos",s,d.index-1).pos,t[1]=v,t[2]=y,t[3]=this.getNextKeyWith("pos",s,m.index+1).pos;var _=i(t,g=.33*g+.33);x=this.weight/(this.weight+l.positionWeight);l.positionWeight+=this.weight;var b=u.position;if(b.x=b.x+(_[0]-b.x)*x,b.y=b.y+(_[1]-b.y)*x,b.z=b.z+(_[2]-b.z)*x,this.interpolationType===nt.AnimationHandler.CATMULLROM_FORWARD){var w=i(t,1.01*g);e.set(w[0],w[1],w[2]),e.sub(b),e.y=0,e.normalize();var M=Math.atan2(e.x,e.z);u.rotation.set(0,M,0)}}}else if("rot"===p)if(nt.Quaternion.slerp(v,y,r,g),0===l.quaternionWeight)u.quaternion.copy(r),l.quaternionWeight=this.weight;else{x=this.weight/(this.weight+l.quaternionWeight);nt.Quaternion.slerp(u.quaternion,r,u.quaternion,x),l.quaternionWeight+=this.weight}else if("scl"===p){n.x=v[0]+(y[0]-v[0])*g,n.y=v[1]+(y[1]-v[1])*g,n.z=v[2]+(y[2]-v[2])*g;x=this.weight/(this.weight+l.scaleWeight);u.scale.lerp(n,x),l.scaleWeight+=this.weight}}return!0}}}(),nt.Animation.prototype.getNextKeyWith=function(t,e,n){var r=this.data.hierarchy[e].keys;for(this.interpolationType===nt.AnimationHandler.CATMULLROM||this.interpolationType===nt.AnimationHandler.CATMULLROM_FORWARD?n=n<r.length-1?n:r.length-1:n%=r.length;n<r.length;n++)if(void 0!==r[n][t])return r[n];return this.data.hierarchy[e].keys[0]},nt.Animation.prototype.getPrevKeyWith=function(t,e,n){var r=this.data.hierarchy[e].keys;for(n=this.interpolationType===nt.AnimationHandler.CATMULLROM||this.interpolationType===nt.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(void 0!==r[n][t])return r[n];return this.data.hierarchy[e].keys[r.length-1]},nt.KeyFrameAnimation=function(t){this.root=t.node,this.data=nt.AnimationHandler.init(t),this.hierarchy=nt.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var e=0,n=this.hierarchy.length;e<n;e++){var r=this.data.hierarchy[e].keys,i=this.data.hierarchy[e].sids,o=this.hierarchy[e];if(r.length&&i){for(var a=0;a<i.length;a++){var s=i[a],h=this.getNextKeyWith(s,e,0);h&&h.apply(s)}o.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},nt.KeyFrameAnimation.prototype.play=function(t){if(this.currentTime=void 0!==t?t:0,!1===this.isPlaying){this.isPlaying=!0;var e,n,r,i=this.hierarchy.length;for(e=0;e<i;e++){n=this.hierarchy[e],void 0===(r=this.data.hierarchy[e]).animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=n.matrix);var o=this.data.hierarchy[e].keys;o.length&&(r.animationCache.prevKey=o[0],r.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,nt.AnimationHandler.play(this)},nt.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,nt.AnimationHandler.stop(this);for(var t=0;t<this.data.hierarchy.length;t++){var e=this.hierarchy[t],n=this.data.hierarchy[t];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;r.copy(e.matrix),e.matrix=r,delete n.animationCache}}},nt.KeyFrameAnimation.prototype.update=function(t){if(!1!==this.isPlaying){this.currentTime+=t*this.timeScale;var e=this.data.length;!0===this.loop&&this.currentTime>e&&(this.currentTime%=e),this.currentTime=Math.min(this.currentTime,e);for(var n=0,r=this.hierarchy.length;n<r;n++){var i=this.hierarchy[n],o=this.data.hierarchy[n],a=o.keys,s=o.animationCache;if(a.length){var h=s.prevKey,u=s.nextKey;if(u.time<=this.currentTime){for(;u.time<this.currentTime&&u.index>h.index;)u=a[(h=u).index+1];s.prevKey=h,s.nextKey=u}u.time>=this.currentTime?h.interpolate(u,this.currentTime):h.interpolate(u,u.time),this.data.hierarchy[n].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}}},nt.KeyFrameAnimation.prototype.getNextKeyWith=function(t,e,n){var r=this.data.hierarchy[e].keys;for(n%=r.length;n<r.length;n++)if(r[n].hasTarget(t))return r[n];return r[0]},nt.KeyFrameAnimation.prototype.getPrevKeyWith=function(t,e,n){var r=this.data.hierarchy[e].keys;for(n=n>=0?n:n+r.length;n>=0;n--)if(r[n].hasTarget(t))return r[n];return r[r.length-1]},nt.MorphAnimation=function(t){this.mesh=t,this.frames=t.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},nt.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:(J=0,Z=0,function(t){if(!1!==this.isPlaying){this.currentTime+=t,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var e=this.duration/this.frames,n=Math.floor(this.currentTime/e);n!=Z&&(this.mesh.morphTargetInfluences[J]=0,this.mesh.morphTargetInfluences[Z]=1,this.mesh.morphTargetInfluences[n]=0,J=Z,Z=n),this.mesh.morphTargetInfluences[n]=this.currentTime%e/e,this.mesh.morphTargetInfluences[J]=1-this.mesh.morphTargetInfluences[n]}})},nt.BoxGeometry=function(t,e,n,r,i,o){nt.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.widthSegments=r||1,this.heightSegments=i||1,this.depthSegments=o||1;var a=this,s=t/2,h=e/2,u=n/2;function c(t,e,n,r,i,o,s,h){var u,c,l,f=a.widthSegments,p=a.heightSegments,d=i/2,m=o/2,g=a.vertices.length;"x"===t&&"y"===e||"y"===t&&"x"===e?u="z":"x"===t&&"z"===e||"z"===t&&"x"===e?(u="y",p=a.depthSegments):("z"===t&&"y"===e||"y"===t&&"z"===e)&&(u="x",f=a.depthSegments);var v=f+1,y=p+1,x=i/f,_=o/p,b=new nt.Vector3;for(b[u]=s>0?1:-1,l=0;l<y;l++)for(c=0;c<v;c++){var w=new nt.Vector3;w[t]=(c*x-d)*n,w[e]=(l*_-m)*r,w[u]=s,a.vertices.push(w)}for(l=0;l<p;l++)for(c=0;c<f;c++){var M=c+v*l,A=c+v*(l+1),S=c+1+v*(l+1),C=c+1+v*l,T=new nt.Vector2(c/f,1-l/p),E=new nt.Vector2(c/f,1-(l+1)/p),L=new nt.Vector2((c+1)/f,1-(l+1)/p),P=new nt.Vector2((c+1)/f,1-l/p),D=new nt.Face3(M+g,A+g,C+g);D.normal.copy(b),D.vertexNormals.push(b.clone(),b.clone(),b.clone()),D.materialIndex=h,a.faces.push(D),a.faceVertexUvs[0].push([T,E,P]),(D=new nt.Face3(A+g,S+g,C+g)).normal.copy(b),D.vertexNormals.push(b.clone(),b.clone(),b.clone()),D.materialIndex=h,a.faces.push(D),a.faceVertexUvs[0].push([E.clone(),L,P.clone()])}}c("z","y",-1,-1,n,e,s,0),c("z","y",1,-1,n,e,-s,1),c("x","z",1,1,t,n,h,2),c("x","z",1,-1,t,n,-h,3),c("x","y",1,-1,t,e,u,4),c("x","y",-1,-1,t,e,-u,5),this.mergeVertices()},nt.BoxGeometry.prototype=Object.create(nt.Geometry.prototype),nt.CircleGeometry=function(t,e,n,r){nt.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},t=t||50,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,o=[],a=new nt.Vector3,s=new nt.Vector2(.5,.5);for(this.vertices.push(a),o.push(s),i=0;i<=e;i++){var h=new nt.Vector3,u=n+i/e*r;h.x=t*Math.cos(u),h.y=t*Math.sin(u),this.vertices.push(h),o.push(new nt.Vector2((h.x/t+1)/2,(h.y/t+1)/2))}var c=new nt.Vector3(0,0,1);for(i=1;i<=e;i++)this.faces.push(new nt.Face3(i,i+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([o[i].clone(),o[i+1].clone(),s.clone()]);this.computeFaceNormals(),this.boundingSphere=new nt.Sphere(new nt.Vector3,t)},nt.CircleGeometry.prototype=Object.create(nt.Geometry.prototype),nt.CubeGeometry=function(t,e,n,r,i,o){return console.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new nt.BoxGeometry(t,e,n,r,i,o)},nt.CylinderGeometry=function(t,e,n,r,i,o){nt.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o},t=void 0!==t?t:20,e=void 0!==e?e:20,r=r||8,i=i||1,o=void 0!==o&&o;var a,s,h=(n=void 0!==n?n:100)/2,u=[],c=[];for(s=0;s<=i;s++){var l=[],f=[],p=s/i,d=p*(e-t)+t;for(a=0;a<=r;a++){var m=a/r,g=new nt.Vector3;g.x=d*Math.sin(m*Math.PI*2),g.y=-p*n+h,g.z=d*Math.cos(m*Math.PI*2),this.vertices.push(g),l.push(this.vertices.length-1),f.push(new nt.Vector2(m,1-p))}u.push(l),c.push(f)}var v,y,x=(e-t)/n;for(a=0;a<r;a++)for(0!==t?(v=this.vertices[u[0][a]].clone(),y=this.vertices[u[0][a+1]].clone()):(v=this.vertices[u[1][a]].clone(),y=this.vertices[u[1][a+1]].clone()),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*x).normalize(),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*x).normalize(),s=0;s<i;s++){var _=u[s][a],b=u[s+1][a],w=u[s+1][a+1],M=u[s][a+1],A=v.clone(),S=v.clone(),C=y.clone(),T=y.clone(),E=c[s][a].clone(),L=c[s+1][a].clone(),P=c[s+1][a+1].clone(),D=c[s][a+1].clone();this.faces.push(new nt.Face3(_,b,M,[A,S,T])),this.faceVertexUvs[0].push([E,L,D]),this.faces.push(new nt.Face3(b,w,M,[S.clone(),C,T.clone()])),this.faceVertexUvs[0].push([L.clone(),P,D.clone()])}if(!1===o&&t>0)for(this.vertices.push(new nt.Vector3(0,h,0)),a=0;a<r;a++){_=u[0][a],b=u[0][a+1],w=this.vertices.length-1,A=new nt.Vector3(0,1,0),S=new nt.Vector3(0,1,0),C=new nt.Vector3(0,1,0),E=c[0][a].clone(),L=c[0][a+1].clone(),P=new nt.Vector2(L.x,0);this.faces.push(new nt.Face3(_,b,w,[A,S,C])),this.faceVertexUvs[0].push([E,L,P])}if(!1===o&&e>0)for(this.vertices.push(new nt.Vector3(0,-h,0)),a=0;a<r;a++){_=u[s][a+1],b=u[s][a],w=this.vertices.length-1,A=new nt.Vector3(0,-1,0),S=new nt.Vector3(0,-1,0),C=new nt.Vector3(0,-1,0),E=c[s][a+1].clone(),L=c[s][a].clone(),P=new nt.Vector2(L.x,1);this.faces.push(new nt.Face3(_,b,w,[A,S,C])),this.faceVertexUvs[0].push([E,L,P])}this.computeFaceNormals()},nt.CylinderGeometry.prototype=Object.create(nt.Geometry.prototype),nt.ExtrudeGeometry=function(t,e){void 0!==t?(nt.Geometry.call(this),this.type="ExtrudeGeometry",t=t instanceof Array?t:[t],this.addShapeList(t,e),this.computeFaceNormals()):t=[]},nt.ExtrudeGeometry.prototype=Object.create(nt.Geometry.prototype),nt.ExtrudeGeometry.prototype.addShapeList=function(t,e){for(var n=t.length,r=0;r<n;r++){var i=t[r];this.addShape(i,e)}},nt.ExtrudeGeometry.prototype.addShape=function(t,e){var n,r,i,o,a,s,h,u,c=void 0!==e.amount?e.amount:100,l=void 0!==e.bevelThickness?e.bevelThickness:6,f=void 0!==e.bevelSize?e.bevelSize:l-2,p=void 0!==e.bevelSegments?e.bevelSegments:3,d=void 0===e.bevelEnabled||e.bevelEnabled,m=void 0!==e.curveSegments?e.curveSegments:12,g=void 0!==e.steps?e.steps:1,v=e.extrudePath,y=!1,x=e.material,_=e.extrudeMaterial,b=void 0!==e.UVGenerator?e.UVGenerator:nt.ExtrudeGeometry.WorldUVGenerator;v&&(n=v.getSpacedPoints(g),y=!0,d=!1,r=void 0!==e.frames?e.frames:new nt.TubeGeometry.FrenetFrames(v,g,!1),i=new nt.Vector3,o=new nt.Vector3,a=new nt.Vector3),d||(p=0,l=0,f=0);var w=this,M=this.vertices.length,A=t.extractPoints(m),S=A.shape,C=A.holes,T=!nt.Shape.Utils.isClockWise(S);if(T){for(S=S.reverse(),h=0,u=C.length;h<u;h++)s=C[h],nt.Shape.Utils.isClockWise(s)&&(C[h]=s.reverse());T=!1}var E=nt.Shape.Utils.triangulateShape(S,C),L=S;for(h=0,u=C.length;h<u;h++)s=C[h],S=S.concat(s);function P(t,e,n){return e||console.log("die"),e.clone().multiplyScalar(n).add(t)}var D,R,F,k,B,z,N=S.length,U=E.length;L.length,Math.PI;function I(t,e,n){var r,i,o=1,a=t.x-e.x,s=t.y-e.y,h=n.x-t.x,u=n.y-t.y,c=a*a+s*s,l=a*u-s*h;if(Math.abs(l)>1e-10){var f=Math.sqrt(c),p=Math.sqrt(h*h+u*u),d=e.x-s/f,m=e.y+a/f,g=((n.x-u/p-d)*u-(n.y+h/p-m)*h)/(a*u-s*h),v=(r=d+a*g-t.x)*r+(i=m+s*g-t.y)*i;if(v<=2)return new nt.Vector2(r,i);o=Math.sqrt(v/2)}else{var y=!1;a>1e-10?h>1e-10&&(y=!0):a<-1e-10?h<-1e-10&&(y=!0):Math.sign(s)==Math.sign(u)&&(y=!0),y?(r=-s,i=a,o=Math.sqrt(c)):(r=a,i=s,o=Math.sqrt(c/2))}return new nt.Vector2(r/o,i/o)}for(var O=[],V=0,H=L.length,G=H-1,j=V+1;V<H;V++,G++,j++){G===H&&(G=0),j===H&&(j=0);L[V],L[G],L[j];O[V]=I(L[V],L[G],L[j])}var W,X,q=[],Q=O.concat();for(h=0,u=C.length;h<u;h++){for(s=C[h],W=[],V=0,G=(H=s.length)-1,j=V+1;V<H;V++,G++,j++)G===H&&(G=0),j===H&&(j=0),W[V]=I(s[V],s[G],s[j]);q.push(W),Q=Q.concat(W)}for(D=0;D<p;D++){for(k=l*(1-(F=D/p)),R=f*Math.sin(F*Math.PI/2),V=0,H=L.length;V<H;V++)K((B=P(L[V],O[V],R)).x,B.y,-k);for(h=0,u=C.length;h<u;h++)for(s=C[h],W=q[h],V=0,H=s.length;V<H;V++)K((B=P(s[V],W[V],R)).x,B.y,-k)}for(R=f,V=0;V<N;V++)B=d?P(S[V],Q[V],R):S[V],y?(o.copy(r.normals[0]).multiplyScalar(B.x),i.copy(r.binormals[0]).multiplyScalar(B.y),a.copy(n[0]).add(o).add(i),K(a.x,a.y,a.z)):K(B.x,B.y,0);for(X=1;X<=g;X++)for(V=0;V<N;V++)B=d?P(S[V],Q[V],R):S[V],y?(o.copy(r.normals[X]).multiplyScalar(B.x),i.copy(r.binormals[X]).multiplyScalar(B.y),a.copy(n[X]).add(o).add(i),K(a.x,a.y,a.z)):K(B.x,B.y,c/g*X);for(D=p-1;D>=0;D--){for(k=l*(1-(F=D/p)),R=f*Math.sin(F*Math.PI/2),V=0,H=L.length;V<H;V++)K((B=P(L[V],O[V],R)).x,B.y,c+k);for(h=0,u=C.length;h<u;h++)for(s=C[h],W=q[h],V=0,H=s.length;V<H;V++)B=P(s[V],W[V],R),y?K(B.x,B.y+n[g-1].y,n[g-1].x+k):K(B.x,B.y,c+k)}function Y(t,e){var n,r;for(V=t.length;--V>=0;){n=V,(r=V-1)<0&&(r=t.length-1);var i=0,o=g+2*p;for(i=0;i<o;i++){var a=N*i,s=N*(i+1);Z(e+n+a,e+r+a,e+r+s,e+n+s,t,i,o,n,r)}}}function K(t,e,n){w.vertices.push(new nt.Vector3(t,e,n))}function J(t,e,n){t+=M,e+=M,n+=M,w.faces.push(new nt.Face3(t,e,n,null,null,x));var r=b.generateTopUV(w,t,e,n);w.faceVertexUvs[0].push(r)}function Z(t,e,n,r,i,o,a,s,h){t+=M,e+=M,n+=M,r+=M,w.faces.push(new nt.Face3(t,e,r,null,null,_)),w.faces.push(new nt.Face3(e,n,r,null,null,_));var u=b.generateSideWallUV(w,t,e,n,r);w.faceVertexUvs[0].push([u[0],u[1],u[3]]),w.faceVertexUvs[0].push([u[1],u[2],u[3]])}!function(){if(d){var t=0,e=N*t;for(V=0;V<U;V++)J((z=E[V])[2]+e,z[1]+e,z[0]+e);for(e=N*(t=g+2*p),V=0;V<U;V++)J((z=E[V])[0]+e,z[1]+e,z[2]+e)}else{for(V=0;V<U;V++)J((z=E[V])[2],z[1],z[0]);for(V=0;V<U;V++)J((z=E[V])[0]+N*g,z[1]+N*g,z[2]+N*g)}}(),function(){var t=0;for(Y(L,t),t+=L.length,h=0,u=C.length;h<u;h++)Y(s=C[h],t),t+=s.length}()},nt.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(t,e,n,r){var i=t.vertices,o=i[e],a=i[n],s=i[r];return[new nt.Vector2(o.x,o.y),new nt.Vector2(a.x,a.y),new nt.Vector2(s.x,s.y)]},generateSideWallUV:function(t,e,n,r,i){var o=t.vertices,a=o[e],s=o[n],h=o[r],u=o[i];return Math.abs(a.y-s.y)<.01?[new nt.Vector2(a.x,1-a.z),new nt.Vector2(s.x,1-s.z),new nt.Vector2(h.x,1-h.z),new nt.Vector2(u.x,1-u.z)]:[new nt.Vector2(a.y,1-a.z),new nt.Vector2(s.y,1-s.z),new nt.Vector2(h.y,1-h.z),new nt.Vector2(u.y,1-u.z)]}},nt.ShapeGeometry=function(t,e){nt.Geometry.call(this),this.type="ShapeGeometry",t instanceof Array==!1&&(t=[t]),this.addShapeList(t,e),this.computeFaceNormals()},nt.ShapeGeometry.prototype=Object.create(nt.Geometry.prototype),nt.ShapeGeometry.prototype.addShapeList=function(t,e){for(var n=0,r=t.length;n<r;n++)this.addShape(t[n],e);return this},nt.ShapeGeometry.prototype.addShape=function(t,e){void 0===e&&(e={});var n,r,i,o=void 0!==e.curveSegments?e.curveSegments:12,a=e.material,s=void 0===e.UVGenerator?nt.ExtrudeGeometry.WorldUVGenerator:e.UVGenerator,h=this.vertices.length,u=t.extractPoints(o),c=u.shape,l=u.holes,f=!nt.Shape.Utils.isClockWise(c);if(f){for(c=c.reverse(),n=0,r=l.length;n<r;n++)i=l[n],nt.Shape.Utils.isClockWise(i)&&(l[n]=i.reverse());f=!1}var p=nt.Shape.Utils.triangulateShape(c,l),d=c;for(n=0,r=l.length;n<r;n++)i=l[n],c=c.concat(i);var m,g,v=c.length,y=p.length;d.length;for(n=0;n<v;n++)m=c[n],this.vertices.push(new nt.Vector3(m.x,m.y,0));for(n=0;n<y;n++){var x=(g=p[n])[0]+h,_=g[1]+h,b=g[2]+h;this.faces.push(new nt.Face3(x,_,b,null,null,a)),this.faceVertexUvs[0].push(s.generateTopUV(this,x,_,b))}},nt.LatheGeometry=function(t,e,n,r){nt.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=e||12,n=n||0,r=r||2*Math.PI;for(var i=1/(t.length-1),o=1/e,a=0,s=e;a<=s;a++)for(var h=n+a*o*r,u=Math.cos(h),c=Math.sin(h),l=0,f=t.length;l<f;l++){var p=t[l],d=new nt.Vector3;d.x=u*p.x-c*p.y,d.y=c*p.x+u*p.y,d.z=p.z,this.vertices.push(d)}var m=t.length;for(a=0,s=e;a<s;a++)for(l=0,f=t.length-1;l<f;l++){var g=l+m*a,v=g,y=g+m,x=(u=g+1+m,g+1),_=a*o,b=l*i,w=_+o,M=b+i;this.faces.push(new nt.Face3(v,y,x)),this.faceVertexUvs[0].push([new nt.Vector2(_,b),new nt.Vector2(w,b),new nt.Vector2(_,M)]),this.faces.push(new nt.Face3(y,u,x)),this.faceVertexUvs[0].push([new nt.Vector2(w,b),new nt.Vector2(w,M),new nt.Vector2(_,M)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},nt.LatheGeometry.prototype=Object.create(nt.Geometry.prototype),nt.PlaneGeometry=function(t,e,n,r){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),nt.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new nt.PlaneBufferGeometry(t,e,n,r))},nt.PlaneGeometry.prototype=Object.create(nt.Geometry.prototype),nt.PlaneBufferGeometry=function(t,e,n,r){nt.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};for(var i=t/2,o=e/2,a=n||1,s=r||1,h=a+1,u=s+1,c=t/a,l=e/s,f=new Float32Array(h*u*3),p=new Float32Array(h*u*3),d=new Float32Array(h*u*2),m=0,g=0,v=0;v<u;v++)for(var y=v*l-o,x=0;x<h;x++){var _=x*c-i;f[m]=_,f[m+1]=-y,p[m+2]=1,d[g]=x/a,d[g+1]=1-v/s,m+=3,g+=2}m=0;var b=new(f.length/3>65535?Uint32Array:Uint16Array)(a*s*6);for(v=0;v<s;v++)for(x=0;x<a;x++){var w=x+h*v,M=x+h*(v+1),A=x+1+h*(v+1),S=x+1+h*v;b[m]=w,b[m+1]=M,b[m+2]=S,b[m+3]=M,b[m+4]=A,b[m+5]=S,m+=6}this.addAttribute("index",new nt.BufferAttribute(b,1)),this.addAttribute("position",new nt.BufferAttribute(f,3)),this.addAttribute("normal",new nt.BufferAttribute(p,3)),this.addAttribute("uv",new nt.BufferAttribute(d,2))},nt.PlaneBufferGeometry.prototype=Object.create(nt.BufferGeometry.prototype),nt.RingGeometry=function(t,e,n,r,i,o){nt.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},t=t||0,e=e||50,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var a,s,h=[],u=t,c=(e-t)/(r=void 0!==r?Math.max(1,r):8);for(a=0;a<r+1;a++){for(s=0;s<n+1;s++){var l=new nt.Vector3,f=i+s/n*o;l.x=u*Math.cos(f),l.y=u*Math.sin(f),this.vertices.push(l),h.push(new nt.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}u+=c}var p=new nt.Vector3(0,0,1);for(a=0;a<r;a++){var d=a*(n+1);for(s=0;s<n;s++){var m=f=s+d,g=f+n+1,v=f+n+2;this.faces.push(new nt.Face3(m,g,v,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([h[m].clone(),h[g].clone(),h[v].clone()]),m=f,g=f+n+2,v=f+1,this.faces.push(new nt.Face3(m,g,v,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([h[m].clone(),h[g].clone(),h[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new nt.Sphere(new nt.Vector3,u)},nt.RingGeometry.prototype=Object.create(nt.Geometry.prototype),nt.SphereGeometry=function(t,e,n,r,i,o,a){nt.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},t=t||50,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,h,u=[],c=[];for(h=0;h<=n;h++){var l=[],f=[];for(s=0;s<=e;s++){var p=s/e,d=h/n,m=new nt.Vector3;m.x=-t*Math.cos(r+p*i)*Math.sin(o+d*a),m.y=t*Math.cos(o+d*a),m.z=t*Math.sin(r+p*i)*Math.sin(o+d*a),this.vertices.push(m),l.push(this.vertices.length-1),f.push(new nt.Vector2(p,1-d))}u.push(l),c.push(f)}for(h=0;h<n;h++)for(s=0;s<e;s++){var g=u[h][s+1],v=u[h][s],y=u[h+1][s],x=u[h+1][s+1],_=this.vertices[g].clone().normalize(),b=this.vertices[v].clone().normalize(),w=this.vertices[y].clone().normalize(),M=this.vertices[x].clone().normalize(),A=c[h][s+1].clone(),S=c[h][s].clone(),C=c[h+1][s].clone(),T=c[h+1][s+1].clone();Math.abs(this.vertices[g].y)===t?(A.x=(A.x+S.x)/2,this.faces.push(new nt.Face3(g,y,x,[_,w,M])),this.faceVertexUvs[0].push([A,C,T])):Math.abs(this.vertices[y].y)===t?(C.x=(C.x+T.x)/2,this.faces.push(new nt.Face3(g,v,y,[_,b,w])),this.faceVertexUvs[0].push([A,S,C])):(this.faces.push(new nt.Face3(g,v,x,[_,b,M])),this.faceVertexUvs[0].push([A,S,T]),this.faces.push(new nt.Face3(v,y,x,[b.clone(),w,M.clone()])),this.faceVertexUvs[0].push([S.clone(),C,T.clone()]))}this.computeFaceNormals(),this.boundingSphere=new nt.Sphere(new nt.Vector3,t)},nt.SphereGeometry.prototype=Object.create(nt.Geometry.prototype),nt.TextGeometry=function(t,e){e=e||{};var n=nt.FontUtils.generateShapes(t,e);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),nt.ExtrudeGeometry.call(this,n,e),this.type="TextGeometry"},nt.TextGeometry.prototype=Object.create(nt.ExtrudeGeometry.prototype),nt.TorusGeometry=function(t,e,n,r,i){nt.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},t=t||100,e=e||40,n=n||8,r=r||6,i=i||2*Math.PI;for(var o=new nt.Vector3,a=[],s=[],h=0;h<=n;h++)for(var u=0;u<=r;u++){var c=u/r*i,l=h/n*Math.PI*2;o.x=t*Math.cos(c),o.y=t*Math.sin(c);var f=new nt.Vector3;f.x=(t+e*Math.cos(l))*Math.cos(c),f.y=(t+e*Math.cos(l))*Math.sin(c),f.z=e*Math.sin(l),this.vertices.push(f),a.push(new nt.Vector2(u/r,h/n)),s.push(f.clone().sub(o).normalize())}for(h=1;h<=n;h++)for(u=1;u<=r;u++){var p=(r+1)*h+u-1,d=(r+1)*(h-1)+u-1,m=(r+1)*(h-1)+u,g=(r+1)*h+u,v=new nt.Face3(p,d,g,[s[p].clone(),s[d].clone(),s[g].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([a[p].clone(),a[d].clone(),a[g].clone()]),v=new nt.Face3(d,m,g,[s[d].clone(),s[m].clone(),s[g].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([a[d].clone(),a[m].clone(),a[g].clone()])}this.computeFaceNormals()},nt.TorusGeometry.prototype=Object.create(nt.Geometry.prototype),nt.TorusKnotGeometry=function(t,e,n,r,i,o,a){nt.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,p:i,q:o,heightScale:a},t=t||100,e=e||40,n=n||64,r=r||8,i=i||2,o=o||3,a=a||1;for(var s=new Array(n),h=new nt.Vector3,u=new nt.Vector3,c=new nt.Vector3,l=0;l<n;++l){s[l]=new Array(r);var f=l/n*2*i*Math.PI,p=P(f,o,i,t,a),d=P(f+.01,o,i,t,a);h.subVectors(d,p),u.addVectors(d,p),c.crossVectors(h,u),u.crossVectors(c,h),c.normalize(),u.normalize();for(var m=0;m<r;++m){var g=m/r*2*Math.PI,v=-e*Math.cos(g),y=e*Math.sin(g),x=new nt.Vector3;x.x=p.x+v*u.x+y*c.x,x.y=p.y+v*u.y+y*c.y,x.z=p.z+v*u.z+y*c.z,s[l][m]=this.vertices.push(x)-1}}for(l=0;l<n;++l)for(m=0;m<r;++m){var _=(l+1)%n,b=(m+1)%r,w=s[l][m],M=s[_][m],A=s[_][b],S=s[l][b],C=new nt.Vector2(l/n,m/r),T=new nt.Vector2((l+1)/n,m/r),E=new nt.Vector2((l+1)/n,(m+1)/r),L=new nt.Vector2(l/n,(m+1)/r);this.faces.push(new nt.Face3(w,M,S)),this.faceVertexUvs[0].push([C,T,L]),this.faces.push(new nt.Face3(M,A,S)),this.faceVertexUvs[0].push([T.clone(),E,L.clone()])}function P(t,e,n,r,i){var o=Math.cos(t),a=Math.sin(t),s=e/n*t,h=Math.cos(s),u=r*(2+h)*.5*o,c=r*(2+h)*a*.5,l=i*r*Math.sin(s)*.5;return new nt.Vector3(u,c,l)}this.computeFaceNormals(),this.computeVertexNormals()},nt.TorusKnotGeometry.prototype=Object.create(nt.Geometry.prototype),nt.TubeGeometry=function(t,e,n,r,i){nt.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:t,segments:e,radius:n,radialSegments:r,closed:i},n=n||1,r=r||8,i=i||!1;var o,a,s,h,u,c,l,f,p,d,m,g,v,y,x,_,b,w,M,A=[],S=this,C=(e=e||64)+1,T=new nt.Vector3,E=new nt.TubeGeometry.FrenetFrames(t,e,i),L=E.tangents,P=E.normals,D=E.binormals;function R(t,e,n){return S.vertices.push(new nt.Vector3(t,e,n))-1}for(this.tangents=L,this.normals=P,this.binormals=D,f=0;f<C;f++)for(A[f]=[],s=f/(C-1),l=t.getPointAt(s),L[f],o=P[f],a=D[f],p=0;p<r;p++)h=p/r*2*Math.PI,u=-n*Math.cos(h),c=n*Math.sin(h),T.copy(l),T.x+=u*o.x+c*a.x,T.y+=u*o.y+c*a.y,T.z+=u*o.z+c*a.z,A[f][p]=R(T.x,T.y,T.z);for(f=0;f<e;f++)for(p=0;p<r;p++)d=i?(f+1)%e:f+1,m=(p+1)%r,g=A[f][p],v=A[d][p],y=A[d][m],x=A[f][m],_=new nt.Vector2(f/e,p/r),b=new nt.Vector2((f+1)/e,p/r),w=new nt.Vector2((f+1)/e,(p+1)/r),M=new nt.Vector2(f/e,(p+1)/r),this.faces.push(new nt.Face3(g,v,x)),this.faceVertexUvs[0].push([_,b,M]),this.faces.push(new nt.Face3(v,y,x)),this.faceVertexUvs[0].push([b.clone(),w,M.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},nt.TubeGeometry.prototype=Object.create(nt.Geometry.prototype),nt.TubeGeometry.FrenetFrames=function(t,e,n){new nt.Vector3;var r,i,o,a,s,h,u,c=new nt.Vector3,l=(new nt.Vector3,[]),f=[],p=[],d=new nt.Vector3,m=new nt.Matrix4,g=e+1;for(this.tangents=l,this.normals=f,this.binormals=p,h=0;h<g;h++)u=h/(g-1),l[h]=t.getTangentAt(u),l[h].normalize();for(function(){f[0]=new nt.Vector3,p[0]=new nt.Vector3,i=Number.MAX_VALUE,o=Math.abs(l[0].x),a=Math.abs(l[0].y),s=Math.abs(l[0].z),o<=i&&(i=o,c.set(1,0,0));a<=i&&(i=a,c.set(0,1,0));s<=i&&c.set(0,0,1);d.crossVectors(l[0],c).normalize(),f[0].crossVectors(l[0],d),p[0].crossVectors(l[0],f[0])}(),h=1;h<g;h++)f[h]=f[h-1].clone(),p[h]=p[h-1].clone(),d.crossVectors(l[h-1],l[h]),d.length()>1e-4&&(d.normalize(),r=Math.acos(nt.Math.clamp(l[h-1].dot(l[h]),-1,1)),f[h].applyMatrix4(m.makeRotationAxis(d,r))),p[h].crossVectors(l[h],f[h]);if(n)for(r=Math.acos(nt.Math.clamp(f[0].dot(f[g-1]),-1,1)),r/=g-1,l[0].dot(d.crossVectors(f[0],f[g-1]))>0&&(r=-r),h=1;h<g;h++)f[h].applyMatrix4(m.makeRotationAxis(l[h],r*h)),p[h].crossVectors(l[h],f[h])},nt.PolyhedronGeometry=function(t,e,n,r){nt.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},n=n||1,r=r||0;for(var i=this,o=0,a=t.length;o<a;o+=3)_(new nt.Vector3(t[o],t[o+1],t[o+2]));var s=this.vertices,h=[],u=(o=0,0);for(a=e.length;o<a;o+=3,u++){var c=s[e[o]],l=s[e[o+1]],f=s[e[o+2]];h[u]=new nt.Face3(c.index,l.index,f.index,[c.clone(),l.clone(),f.clone()])}var p=new nt.Vector3;for(o=0,a=h.length;o<a;o++)w(h[o],r);for(o=0,a=this.faceVertexUvs[0].length;o<a;o++){var d=this.faceVertexUvs[0][o],m=d[0].x,g=d[1].x,v=d[2].x,y=Math.max(m,Math.max(g,v)),x=Math.min(m,Math.min(g,v));y>.9&&x<.1&&(m<.2&&(d[0].x+=1),g<.2&&(d[1].x+=1),v<.2&&(d[2].x+=1))}for(o=0,a=this.vertices.length;o<a;o++)this.vertices[o].multiplyScalar(n);function _(t){var e=t.normalize().clone();e.index=i.vertices.push(e)-1;var n=M(t)/2/Math.PI+.5,r=function(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}(t)/Math.PI+.5;return e.uv=new nt.Vector2(n,1-r),e}function b(t,e,n){var r=new nt.Face3(t.index,e.index,n.index,[t.clone(),e.clone(),n.clone()]);i.faces.push(r),p.copy(t).add(e).add(n).divideScalar(3);var o=M(p);i.faceVertexUvs[0].push([A(t.uv,t,o),A(e.uv,e,o),A(n.uv,n,o)])}function w(t,e){for(var n=Math.pow(2,e),r=(Math.pow(4,e),_(i.vertices[t.a])),o=_(i.vertices[t.b]),a=_(i.vertices[t.c]),s=[],h=0;h<=n;h++){s[h]=[];for(var u=_(r.clone().lerp(a,h/n)),c=_(o.clone().lerp(a,h/n)),l=n-h,f=0;f<=l;f++)s[h][f]=0==f&&h==n?u:_(u.clone().lerp(c,f/l))}for(h=0;h<n;h++)for(f=0;f<2*(n-h)-1;f++){var p=Math.floor(f/2);f%2==0?b(s[h][p+1],s[h+1][p],s[h][p]):b(s[h][p+1],s[h+1][p+1],s[h+1][p])}}function M(t){return Math.atan2(t.z,-t.x)}function A(t,e,n){return n<0&&1===t.x&&(t=new nt.Vector2(t.x-1,t.y)),0===e.x&&0===e.z&&(t=new nt.Vector2(n/2/Math.PI+.5,t.y)),t.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new nt.Sphere(new nt.Vector3,n)},nt.PolyhedronGeometry.prototype=Object.create(nt.Geometry.prototype),nt.DodecahedronGeometry=function(t,e){this.parameters={radius:t,detail:e};var n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r];nt.PolyhedronGeometry.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e)},nt.DodecahedronGeometry.prototype=Object.create(nt.Geometry.prototype),nt.IcosahedronGeometry=function(t,e){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];nt.PolyhedronGeometry.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}},nt.IcosahedronGeometry.prototype=Object.create(nt.Geometry.prototype),nt.OctahedronGeometry=function(t,e){this.parameters={radius:t,detail:e};nt.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}},nt.OctahedronGeometry.prototype=Object.create(nt.Geometry.prototype),nt.TetrahedronGeometry=function(t,e){nt.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}},nt.TetrahedronGeometry.prototype=Object.create(nt.Geometry.prototype),nt.ParametricGeometry=function(t,e,n){nt.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n};var r,i,o,a,s,h,u,c,l,f,p,d,m=this.vertices,g=this.faces,v=this.faceVertexUvs[0],y=e+1;for(r=0;r<=n;r++)for(a=r/n,i=0;i<=e;i++)o=t(i/e,a),m.push(o);for(r=0;r<n;r++)for(i=0;i<e;i++)s=r*y+i,h=r*y+i+1,u=(r+1)*y+i+1,c=(r+1)*y+i,l=new nt.Vector2(i/e,r/n),f=new nt.Vector2((i+1)/e,r/n),p=new nt.Vector2((i+1)/e,(r+1)/n),d=new nt.Vector2(i/e,(r+1)/n),g.push(new nt.Face3(s,h,c)),v.push([l,f,d]),g.push(new nt.Face3(h,u,c)),v.push([f.clone(),p,d.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},nt.ParametricGeometry.prototype=Object.create(nt.Geometry.prototype),nt.AxisHelper=function(t){t=t||1;var e=new Float32Array([0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t]),n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),r=new nt.BufferGeometry;r.addAttribute("position",new nt.BufferAttribute(e,3)),r.addAttribute("color",new nt.BufferAttribute(n,3));var i=new nt.LineBasicMaterial({vertexColors:nt.VertexColors});nt.Line.call(this,r,i,nt.LinePieces)},nt.AxisHelper.prototype=Object.create(nt.Line.prototype),nt.ArrowHelper=function(){var t=new nt.Geometry;t.vertices.push(new nt.Vector3(0,0,0),new nt.Vector3(0,1,0));var e=new nt.CylinderGeometry(0,.5,1,5,1);return e.applyMatrix((new nt.Matrix4).makeTranslation(0,-.5,0)),function(n,r,i,o,a,s){nt.Object3D.call(this),void 0===o&&(o=16776960),void 0===i&&(i=1),void 0===a&&(a=.2*i),void 0===s&&(s=.2*a),this.position.copy(r),this.line=new nt.Line(t,new nt.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new nt.Mesh(e,new nt.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(i,a,s)}}(),nt.ArrowHelper.prototype=Object.create(nt.Object3D.prototype),nt.ArrowHelper.prototype.setDirection=(tt=new nt.Vector3,function(t){t.y>.99999?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):(tt.set(t.z,0,-t.x).normalize(),$=Math.acos(t.y),this.quaternion.setFromAxisAngle(tt,$))}),nt.ArrowHelper.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,t,1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},nt.ArrowHelper.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},nt.BoxHelper=function(t){var e=new nt.BufferGeometry;e.addAttribute("position",new nt.BufferAttribute(new Float32Array(72),3)),nt.Line.call(this,e,new nt.LineBasicMaterial({color:16776960}),nt.LinePieces),void 0!==t&&this.update(t)},nt.BoxHelper.prototype=Object.create(nt.Line.prototype),nt.BoxHelper.prototype.update=function(t){var e=t.geometry;null===e.boundingBox&&e.computeBoundingBox();var n=e.boundingBox.min,r=e.boundingBox.max,i=this.geometry.attributes.position.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=n.x,i[4]=r.y,i[5]=r.z,i[6]=n.x,i[7]=r.y,i[8]=r.z,i[9]=n.x,i[10]=n.y,i[11]=r.z,i[12]=n.x,i[13]=n.y,i[14]=r.z,i[15]=r.x,i[16]=n.y,i[17]=r.z,i[18]=r.x,i[19]=n.y,i[20]=r.z,i[21]=r.x,i[22]=r.y,i[23]=r.z,i[24]=r.x,i[25]=r.y,i[26]=n.z,i[27]=n.x,i[28]=r.y,i[29]=n.z,i[30]=n.x,i[31]=r.y,i[32]=n.z,i[33]=n.x,i[34]=n.y,i[35]=n.z,i[36]=n.x,i[37]=n.y,i[38]=n.z,i[39]=r.x,i[40]=n.y,i[41]=n.z,i[42]=r.x,i[43]=n.y,i[44]=n.z,i[45]=r.x,i[46]=r.y,i[47]=n.z,i[48]=r.x,i[49]=r.y,i[50]=r.z,i[51]=r.x,i[52]=r.y,i[53]=n.z,i[54]=n.x,i[55]=r.y,i[56]=r.z,i[57]=n.x,i[58]=r.y,i[59]=n.z,i[60]=n.x,i[61]=n.y,i[62]=r.z,i[63]=n.x,i[64]=n.y,i[65]=n.z,i[66]=r.x,i[67]=n.y,i[68]=r.z,i[69]=r.x,i[70]=n.y,i[71]=n.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1},nt.BoundingBoxHelper=function(t,e){var n=void 0!==e?e:8947848;this.object=t,this.box=new nt.Box3,nt.Mesh.call(this,new nt.BoxGeometry(1,1,1),new nt.MeshBasicMaterial({color:n,wireframe:!0}))},nt.BoundingBoxHelper.prototype=Object.create(nt.Mesh.prototype),nt.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},nt.CameraHelper=function(t){var e=new nt.Geometry,n=new nt.LineBasicMaterial({color:16777215,vertexColors:nt.FaceColors}),r={};function i(t,e,n){o(t,n),o(e,n)}function o(t,n){e.vertices.push(new nt.Vector3),e.colors.push(new nt.Color(n)),void 0===r[t]&&(r[t]=[]),r[t].push(e.vertices.length-1)}i("n1","n2",16755200),i("n2","n4",16755200),i("n4","n3",16755200),i("n3","n1",16755200),i("f1","f2",16755200),i("f2","f4",16755200),i("f4","f3",16755200),i("f3","f1",16755200),i("n1","f1",16755200),i("n2","f2",16755200),i("n3","f3",16755200),i("n4","f4",16755200),i("p","n1",16711680),i("p","n2",16711680),i("p","n3",16711680),i("p","n4",16711680),i("u1","u2",43775),i("u2","u3",43775),i("u3","u1",43775),i("c","t",16777215),i("p","c",3355443),i("cn1","cn2",3355443),i("cn3","cn4",3355443),i("cf1","cf2",3355443),i("cf3","cf4",3355443),nt.Line.call(this,e,n,nt.LinePieces),this.camera=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()},nt.CameraHelper.prototype=Object.create(nt.Line.prototype),nt.CameraHelper.prototype.update=function(){var t,e,n=new nt.Vector3,r=new nt.Camera,i=function(i,o,a,s){n.set(o,a,s).unproject(r);var h=e[i];if(void 0!==h)for(var u=0,c=h.length;u<c;u++)t.vertices[h[u]].copy(n)};return function(){t=this.geometry,e=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),t.verticesNeedUpdate=!0}}(),nt.DirectionalLightHelper=function(t,e){nt.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,e=e||1;var n=new nt.Geometry;n.vertices.push(new nt.Vector3(-e,e,0),new nt.Vector3(e,e,0),new nt.Vector3(e,-e,0),new nt.Vector3(-e,-e,0),new nt.Vector3(-e,e,0));var r=new nt.LineBasicMaterial({fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new nt.Line(n,r),this.add(this.lightPlane),(n=new nt.Geometry).vertices.push(new nt.Vector3,new nt.Vector3),(r=new nt.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new nt.Line(n,r),this.add(this.targetLine),this.update()},nt.DirectionalLightHelper.prototype=Object.create(nt.Object3D.prototype),nt.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},nt.DirectionalLightHelper.prototype.update=function(){var t=new nt.Vector3,e=new nt.Vector3,n=new nt.Vector3;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(e,t),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),nt.EdgesHelper=function(t,e){var n=void 0!==e?e:16777215,r=[0,0],i={},o=function(t,e){return t-e},a=["a","b","c"],s=new nt.BufferGeometry,h=t.geometry.clone();h.mergeVertices(),h.computeFaceNormals();for(var u=h.vertices,c=h.faces,l=0,f=0,p=c.length;f<p;f++)for(var d=c[f],m=0;m<3;m++){r[0]=d[a[m]],r[1]=d[a[(m+1)%3]],r.sort(o),void 0===i[y=r.toString()]?(i[y]={vert1:r[0],vert2:r[1],face1:f,face2:void 0},l++):i[y].face2=f}var g=new Float32Array(2*l*3),v=0;for(var y in i){var x=i[y];if(void 0===x.face2||c[x.face1].normal.dot(c[x.face2].normal)<.9999){var _=u[x.vert1];g[v++]=_.x,g[v++]=_.y,g[v++]=_.z,_=u[x.vert2],g[v++]=_.x,g[v++]=_.y,g[v++]=_.z}}s.addAttribute("position",new nt.BufferAttribute(g,3)),nt.Line.call(this,s,new nt.LineBasicMaterial({color:n}),nt.LinePieces),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1},nt.EdgesHelper.prototype=Object.create(nt.Line.prototype),nt.FaceNormalsHelper=function(t,e,n,r){this.object=t,this.size=void 0!==e?e:1;for(var i=void 0!==n?n:16776960,o=void 0!==r?r:1,a=new nt.Geometry,s=0,h=this.object.geometry.faces.length;s<h;s++)a.vertices.push(new nt.Vector3,new nt.Vector3);nt.Line.call(this,a,new nt.LineBasicMaterial({color:i,linewidth:o}),nt.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new nt.Matrix3,this.update()},nt.FaceNormalsHelper.prototype=Object.create(nt.Line.prototype),nt.FaceNormalsHelper.prototype.update=function(){var t=this.geometry.vertices,e=this.object,n=e.geometry.vertices,r=e.geometry.faces,i=e.matrixWorld;e.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(i);for(var o=0,a=0,s=r.length;o<s;o++,a+=2){var h=r[o];t[a].copy(n[h.a]).add(n[h.b]).add(n[h.c]).divideScalar(3).applyMatrix4(i),t[a+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(t[a])}return this.geometry.verticesNeedUpdate=!0,this},nt.GridHelper=function(t,e){var n=new nt.Geometry,r=new nt.LineBasicMaterial({vertexColors:nt.VertexColors});this.color1=new nt.Color(4473924),this.color2=new nt.Color(8947848);for(var i=-t;i<=t;i+=e){n.vertices.push(new nt.Vector3(-t,0,i),new nt.Vector3(t,0,i),new nt.Vector3(i,0,-t),new nt.Vector3(i,0,t));var o=0===i?this.color1:this.color2;n.colors.push(o,o,o,o)}nt.Line.call(this,n,r,nt.LinePieces)},nt.GridHelper.prototype=Object.create(nt.Line.prototype),nt.GridHelper.prototype.setColors=function(t,e){this.color1.set(t),this.color2.set(e),this.geometry.colorsNeedUpdate=!0},nt.HemisphereLightHelper=function(t,e,n,r){nt.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new nt.Color,new nt.Color];var i=new nt.SphereGeometry(e,4,2);i.applyMatrix((new nt.Matrix4).makeRotationX(-Math.PI/2));for(var o=0;o<8;o++)i.faces[o].color=this.colors[o<4?0:1];var a=new nt.MeshBasicMaterial({vertexColors:nt.FaceColors,wireframe:!0});this.lightSphere=new nt.Mesh(i,a),this.add(this.lightSphere),this.update()},nt.HemisphereLightHelper.prototype=Object.create(nt.Object3D.prototype),nt.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},nt.HemisphereLightHelper.prototype.update=function(){var t=new nt.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),nt.PointLightHelper=function(t,e){this.light=t,this.light.updateMatrixWorld();var n=new nt.SphereGeometry(e,4,2),r=new nt.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),nt.Mesh.call(this,n,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},nt.PointLightHelper.prototype=Object.create(nt.Mesh.prototype),nt.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},nt.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},nt.SkeletonHelper=function(t){this.bones=this.getBoneList(t);for(var e=new nt.Geometry,n=0;n<this.bones.length;n++){this.bones[n].parent instanceof nt.Bone&&(e.vertices.push(new nt.Vector3),e.vertices.push(new nt.Vector3),e.colors.push(new nt.Color(0,0,1)),e.colors.push(new nt.Color(0,1,0)))}var r=new nt.LineBasicMaterial({vertexColors:nt.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});nt.Line.call(this,e,r,nt.LinePieces),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.update()},nt.SkeletonHelper.prototype=Object.create(nt.Line.prototype),nt.SkeletonHelper.prototype.getBoneList=function(t){var e=[];t instanceof nt.Bone&&e.push(t);for(var n=0;n<t.children.length;n++)e.push.apply(e,this.getBoneList(t.children[n]));return e},nt.SkeletonHelper.prototype.update=function(){for(var t=this.geometry,e=(new nt.Matrix4).getInverse(this.root.matrixWorld),n=new nt.Matrix4,r=0,i=0;i<this.bones.length;i++){var o=this.bones[i];o.parent instanceof nt.Bone&&(n.multiplyMatrices(e,o.matrixWorld),t.vertices[r].setFromMatrixPosition(n),n.multiplyMatrices(e,o.parent.matrixWorld),t.vertices[r+1].setFromMatrixPosition(n),r+=2)}t.verticesNeedUpdate=!0,t.computeBoundingSphere()},nt.SpotLightHelper=function(t){nt.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;var e=new nt.CylinderGeometry(0,1,1,8,1,!0);e.applyMatrix((new nt.Matrix4).makeTranslation(0,-.5,0)),e.applyMatrix((new nt.Matrix4).makeRotationX(-Math.PI/2));var n=new nt.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new nt.Mesh(e,n),this.add(this.cone),this.update()},nt.SpotLightHelper.prototype=Object.create(nt.Object3D.prototype),nt.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},nt.SpotLightHelper.prototype.update=function(){var t=new nt.Vector3,e=new nt.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),nt.VertexNormalsHelper=function(t,e,n,r){this.object=t,this.size=void 0!==e?e:1;for(var i=void 0!==n?n:16711680,o=void 0!==r?r:1,a=new nt.Geometry,s=(t.geometry.vertices,t.geometry.faces),h=0,u=s.length;h<u;h++)for(var c=0,l=s[h].vertexNormals.length;c<l;c++)a.vertices.push(new nt.Vector3,new nt.Vector3);nt.Line.call(this,a,new nt.LineBasicMaterial({color:i,linewidth:o}),nt.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new nt.Matrix3,this.update()},nt.VertexNormalsHelper.prototype=Object.create(nt.Line.prototype),nt.VertexNormalsHelper.prototype.update=function(t){var e=new nt.Vector3;return function(t){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,i=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,h=0,u=o.length;h<u;h++)for(var c=o[h],l=0,f=c.vertexNormals.length;l<f;l++){var p=i[c[n[l]]],d=c.vertexNormals[l];r[s].copy(p).applyMatrix4(a),e.copy(d).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),e.add(r[s]),r[s+=1].copy(e),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),nt.VertexTangentsHelper=function(t,e,n,r){this.object=t,this.size=void 0!==e?e:1;for(var i=void 0!==n?n:255,o=void 0!==r?r:1,a=new nt.Geometry,s=(t.geometry.vertices,t.geometry.faces),h=0,u=s.length;h<u;h++)for(var c=0,l=s[h].vertexTangents.length;c<l;c++)a.vertices.push(new nt.Vector3),a.vertices.push(new nt.Vector3);nt.Line.call(this,a,new nt.LineBasicMaterial({color:i,linewidth:o}),nt.LinePieces),this.matrixAutoUpdate=!1,this.update()},nt.VertexTangentsHelper.prototype=Object.create(nt.Line.prototype),nt.VertexTangentsHelper.prototype.update=function(t){var e=new nt.Vector3;return function(t){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var r=this.geometry.vertices,i=this.object.geometry.vertices,o=this.object.geometry.faces,a=this.object.matrixWorld,s=0,h=0,u=o.length;h<u;h++)for(var c=o[h],l=0,f=c.vertexTangents.length;l<f;l++){var p=i[c[n[l]]],d=c.vertexTangents[l];r[s].copy(p).applyMatrix4(a),e.copy(d).transformDirection(a).multiplyScalar(this.size),e.add(r[s]),r[s+=1].copy(e),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),nt.WireframeHelper=function(t,e){var n=void 0!==e?e:16777215,r=[0,0],i={},o=function(t,e){return t-e},a=["a","b","c"],s=new nt.BufferGeometry;if(t.geometry instanceof nt.Geometry){for(var h=t.geometry.vertices,u=t.geometry.faces,c=0,l=new Uint32Array(6*u.length),f=0,p=u.length;f<p;f++)for(var d=u[f],m=0;m<3;m++){r[0]=d[a[m]],r[1]=d[a[(m+1)%3]],r.sort(o),void 0===i[C=r.toString()]&&(l[2*c]=r[0],l[2*c+1]=r[1],i[C]=!0,c++)}var g=new Float32Array(2*c*3);for(f=0,p=c;f<p;f++)for(m=0;m<2;m++){var v=h[l[2*f+m]];g[(A=6*f+3*m)+0]=v.x,g[A+1]=v.y,g[A+2]=v.z}s.addAttribute("position",new nt.BufferAttribute(g,3))}else if(t.geometry instanceof nt.BufferGeometry)if(void 0!==t.geometry.attributes.index){h=t.geometry.attributes.position.array;var y=t.geometry.attributes.index.array,x=t.geometry.drawcalls;c=0;0===x.length&&(x=[{count:y.length,index:0,start:0}]);l=new Uint32Array(2*y.length);for(var _=0,b=x.length;_<b;++_)for(var w=x[_].start,M=x[_].count,A=x[_].index,S=(f=w,w+M);f<S;f+=3)for(m=0;m<3;m++){var C;r[0]=A+y[f+m],r[1]=A+y[f+(m+1)%3],r.sort(o),void 0===i[C=r.toString()]&&(l[2*c]=r[0],l[2*c+1]=r[1],i[C]=!0,c++)}for(g=new Float32Array(2*c*3),f=0,p=c;f<p;f++)for(m=0;m<2;m++){A=6*f+3*m;var T=3*l[2*f+m];g[A+0]=h[T],g[A+1]=h[T+1],g[A+2]=h[T+2]}s.addAttribute("position",new nt.BufferAttribute(g,3))}else{var E=(c=(h=t.geometry.attributes.position.array).length/3)/3;for(g=new Float32Array(2*c*3),f=0,p=E;f<p;f++)for(m=0;m<3;m++){var L=9*f+3*m;g[(A=18*f+6*m)+0]=h[L],g[A+1]=h[L+1],g[A+2]=h[L+2];T=9*f+(m+1)%3*3;g[A+3]=h[T],g[A+4]=h[T+1],g[A+5]=h[T+2]}s.addAttribute("position",new nt.BufferAttribute(g,3))}nt.Line.call(this,s,new nt.LineBasicMaterial({color:n}),nt.LinePieces),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1},nt.WireframeHelper.prototype=Object.create(nt.Line.prototype),nt.ImmediateRenderObject=function(){nt.Object3D.call(this),this.render=function(t){}},nt.ImmediateRenderObject.prototype=Object.create(nt.Object3D.prototype),nt.MorphBlendMesh=function(t,e){nt.Mesh.call(this,t,e),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length,r=n-1,i=n/1;this.createAnimation("__default",0,r,i),this.setAnimationWeight("__default",1)},nt.MorphBlendMesh.prototype=Object.create(nt.Mesh.prototype),nt.MorphBlendMesh.prototype.createAnimation=function(t,e,n,r){var i={startFrame:e,endFrame:n,length:n-e+1,fps:r,duration:(n-e)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=i,this.animationsList.push(i)},nt.MorphBlendMesh.prototype.autoCreateAnimations=function(t){for(var e,n=/([a-z]+)_?(\d+)/,r={},i=this.geometry,o=0,a=i.morphTargets.length;o<a;o++){var s=i.morphTargets[o].name.match(n);if(s&&s.length>1){var h=s[1];s[2];r[h]||(r[h]={start:1/0,end:-1/0}),o<(u=r[h]).start&&(u.start=o),o>u.end&&(u.end=o),e||(e=h)}}for(var h in r){var u=r[h];this.createAnimation(h,u.start,u.end,t)}this.firstAnimation=e},nt.MorphBlendMesh.prototype.setAnimationDirectionForward=function(t){var e=this.animationsMap[t];e&&(e.direction=1,e.directionBackwards=!1)},nt.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(t){var e=this.animationsMap[t];e&&(e.direction=-1,e.directionBackwards=!0)},nt.MorphBlendMesh.prototype.setAnimationFPS=function(t,e){var n=this.animationsMap[t];n&&(n.fps=e,n.duration=(n.end-n.start)/n.fps)},nt.MorphBlendMesh.prototype.setAnimationDuration=function(t,e){var n=this.animationsMap[t];n&&(n.duration=e,n.fps=(n.end-n.start)/n.duration)},nt.MorphBlendMesh.prototype.setAnimationWeight=function(t,e){var n=this.animationsMap[t];n&&(n.weight=e)},nt.MorphBlendMesh.prototype.setAnimationTime=function(t,e){var n=this.animationsMap[t];n&&(n.time=e)},nt.MorphBlendMesh.prototype.getAnimationTime=function(t){var e=0,n=this.animationsMap[t];return n&&(e=n.time),e},nt.MorphBlendMesh.prototype.getAnimationDuration=function(t){var e=-1,n=this.animationsMap[t];return n&&(e=n.duration),e},nt.MorphBlendMesh.prototype.playAnimation=function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("animation["+t+"] undefined")},nt.MorphBlendMesh.prototype.stopAnimation=function(t){var e=this.animationsMap[t];e&&(e.active=!1)},nt.MorphBlendMesh.prototype.update=function(t){for(var e=0,n=this.animationsList.length;e<n;e++){var r=this.animationsList[e];if(r.active){var i=r.duration/r.length;r.time+=r.direction*t,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.startFrame+nt.Math.clamp(Math.floor(r.time/i),0,r.length-1),a=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var s=r.time%i/i;r.directionBackwards&&(s=1-s),this.morphTargetInfluences[r.currentFrame]=s*a,this.morphTargetInfluences[r.lastFrame]=(1-s)*a}}},t.exports&&(e=t.exports=nt),e.THREE=nt},function(t,e,n){(function(t){!function(e,n){"use strict";var r={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(t){if(null==t)return"";var e,n,i,o,a,s,h,u="",c=0;for(t=r.compress(t);c<2*t.length;)c%2==0?(e=t.charCodeAt(c/2)>>8,n=255&t.charCodeAt(c/2),i=c/2+1<t.length?t.charCodeAt(c/2+1)>>8:NaN):(e=255&t.charCodeAt((c-1)/2),(c+1)/2<t.length?(n=t.charCodeAt((c+1)/2)>>8,i=255&t.charCodeAt((c+1)/2)):n=i=NaN),c+=3,o=e>>2,a=(3&e)<<4|n>>4,s=(15&n)<<2|i>>6,h=63&i,isNaN(n)?s=h=64:isNaN(i)&&(h=64),u=u+r._keyStr.charAt(o)+r._keyStr.charAt(a)+r._keyStr.charAt(s)+r._keyStr.charAt(h);return u},decompressFromBase64:function(t){if(null==t)return"";var e,n,i,o,a,s,h,u="",c=0,l=0,f=r._f;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)n=r._keyStr.indexOf(t.charAt(l++))<<2|(a=r._keyStr.indexOf(t.charAt(l++)))>>4,i=(15&a)<<4|(s=r._keyStr.indexOf(t.charAt(l++)))>>2,o=(3&s)<<6|(h=r._keyStr.indexOf(t.charAt(l++))),c%2==0?(e=n<<8,64!=s&&(u+=f(e|i)),64!=h&&(e=o<<8)):(u+=f(e|n),64!=s&&(e=i<<8),64!=h&&(u+=f(e|o))),c+=3;return r.decompress(u)},compressToUTF16:function(t){if(null==t)return"";var e,n,i,o="",a=0,s=r._f;for(t=r.compress(t),e=0;e<t.length;e++)switch(n=t.charCodeAt(e),a++){case 0:o+=s(32+(n>>1)),i=(1&n)<<14;break;case 1:o+=s(i+(n>>2)+32),i=(3&n)<<13;break;case 2:o+=s(i+(n>>3)+32),i=(7&n)<<12;break;case 3:o+=s(i+(n>>4)+32),i=(15&n)<<11;break;case 4:o+=s(i+(n>>5)+32),i=(31&n)<<10;break;case 5:o+=s(i+(n>>6)+32),i=(63&n)<<9;break;case 6:o+=s(i+(n>>7)+32),i=(127&n)<<8;break;case 7:o+=s(i+(n>>8)+32),i=(255&n)<<7;break;case 8:o+=s(i+(n>>9)+32),i=(511&n)<<6;break;case 9:o+=s(i+(n>>10)+32),i=(1023&n)<<5;break;case 10:o+=s(i+(n>>11)+32),i=(2047&n)<<4;break;case 11:o+=s(i+(n>>12)+32),i=(4095&n)<<3;break;case 12:o+=s(i+(n>>13)+32),i=(8191&n)<<2;break;case 13:o+=s(i+(n>>14)+32),i=(16383&n)<<1;break;case 14:o+=s(i+(n>>15)+32,32+(32767&n)),a=0}return o+s(i+32)},decompressFromUTF16:function(t){if(null==t)return"";for(var e,n,i="",o=0,a=0,s=r._f;a<t.length;){switch(n=t.charCodeAt(a)-32,o++){case 0:e=n<<1;break;case 1:i+=s(e|n>>14),e=(16383&n)<<2;break;case 2:i+=s(e|n>>13),e=(8191&n)<<3;break;case 3:i+=s(e|n>>12),e=(4095&n)<<4;break;case 4:i+=s(e|n>>11),e=(2047&n)<<5;break;case 5:i+=s(e|n>>10),e=(1023&n)<<6;break;case 6:i+=s(e|n>>9),e=(511&n)<<7;break;case 7:i+=s(e|n>>8),e=(255&n)<<8;break;case 8:i+=s(e|n>>7),e=(127&n)<<9;break;case 9:i+=s(e|n>>6),e=(63&n)<<10;break;case 10:i+=s(e|n>>5),e=(31&n)<<11;break;case 11:i+=s(e|n>>4),e=(15&n)<<12;break;case 12:i+=s(e|n>>3),e=(7&n)<<13;break;case 13:i+=s(e|n>>2),e=(3&n)<<14;break;case 14:i+=s(e|n>>1),e=(1&n)<<15;break;case 15:i+=s(e|n),o=0}a++}return r.decompress(i)},compress:function(t){if(null==t)return"";var e,n,i,o={},a={},s="",h="",u="",c=2,l=3,f=2,p="",d=0,m=0,g=r._f;for(i=0;i<t.length;i+=1)if(s=t.charAt(i),Object.prototype.hasOwnProperty.call(o,s)||(o[s]=l++,a[s]=!0),h=u+s,Object.prototype.hasOwnProperty.call(o,h))u=h;else{if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(e=0;e<f;e++)d<<=1,15==m?(m=0,p+=g(d),d=0):m++;for(n=u.charCodeAt(0),e=0;e<8;e++)d=d<<1|1&n,15==m?(m=0,p+=g(d),d=0):m++,n>>=1}else{for(n=1,e=0;e<f;e++)d=d<<1|n,15==m?(m=0,p+=g(d),d=0):m++,n=0;for(n=u.charCodeAt(0),e=0;e<16;e++)d=d<<1|1&n,15==m?(m=0,p+=g(d),d=0):m++,n>>=1}0==--c&&(c=Math.pow(2,f),f++),delete a[u]}else for(n=o[u],e=0;e<f;e++)d=d<<1|1&n,15==m?(m=0,p+=g(d),d=0):m++,n>>=1;0==--c&&(c=Math.pow(2,f),f++),o[h]=l++,u=String(s)}if(""!==u){if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(e=0;e<f;e++)d<<=1,15==m?(m=0,p+=g(d),d=0):m++;for(n=u.charCodeAt(0),e=0;e<8;e++)d=d<<1|1&n,15==m?(m=0,p+=g(d),d=0):m++,n>>=1}else{for(n=1,e=0;e<f;e++)d=d<<1|n,15==m?(m=0,p+=g(d),d=0):m++,n=0;for(n=u.charCodeAt(0),e=0;e<16;e++)d=d<<1|1&n,15==m?(m=0,p+=g(d),d=0):m++,n>>=1}0==--c&&(c=Math.pow(2,f),f++),delete a[u]}else for(n=o[u],e=0;e<f;e++)d=d<<1|1&n,15==m?(m=0,p+=g(d),d=0):m++,n>>=1;0==--c&&(c=Math.pow(2,f),f++)}for(n=2,e=0;e<f;e++)d=d<<1|1&n,15==m?(m=0,p+=g(d),d=0):m++,n>>=1;for(;;){if(d<<=1,15==m){p+=g(d);break}m++}return p},decompress:function(t){if(null==t)return"";if(""==t)return null;var e,n,i,o,a,s,h,u=[],c=4,l=4,f=3,p="",d="",m=r._f,g={string:t,val:t.charCodeAt(0),position:32768,index:1};for(e=0;e<3;e+=1)u[e]=e;for(i=0,a=Math.pow(2,2),s=1;s!=a;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),i|=(o>0?1:0)*s,s<<=1;switch(i){case 0:for(i=0,a=Math.pow(2,8),s=1;s!=a;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),i|=(o>0?1:0)*s,s<<=1;h=m(i);break;case 1:for(i=0,a=Math.pow(2,16),s=1;s!=a;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),i|=(o>0?1:0)*s,s<<=1;h=m(i);break;case 2:return""}for(u[3]=h,n=d=h;;){if(g.index>g.string.length)return"";for(i=0,a=Math.pow(2,f),s=1;s!=a;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),i|=(o>0?1:0)*s,s<<=1;switch(h=i){case 0:for(i=0,a=Math.pow(2,8),s=1;s!=a;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),i|=(o>0?1:0)*s,s<<=1;u[l++]=m(i),h=l-1,c--;break;case 1:for(i=0,a=Math.pow(2,16),s=1;s!=a;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),i|=(o>0?1:0)*s,s<<=1;u[l++]=m(i),h=l-1,c--;break;case 2:return d}if(0==c&&(c=Math.pow(2,f),f++),u[h])p=u[h];else{if(h!==l)return null;p=n+n.charAt(0)}d+=p,u[l++]=n+p.charAt(0),n=p,0==--c&&(c=Math.pow(2,f),f++)}}};function i(t){this.options=t||(t={}),this.loading=!1,this.timeBetweenLoops=t.timeBetweenLoops||50,this.packingStructure=["id","timestamp",{hands:[["id","type","direction","palmNormal","palmPosition","palmVelocity","stabilizedPalmPosition","pinchStrength","grabStrength","confidence","armBasis","armWidth","elbow","wrist"]]},{pointables:[["id","direction","handId","length","stabilizedTipPosition","tipPosition","tipVelocity","tool","carpPosition","mcpPosition","pipPosition","dipPosition","btipPosition","bases","type"]]},{interactionBox:["center","size"]}],this.setFrames(t.frames||[])}null!=t&&(t.exports=r),function(){if(void 0===e.performance&&(e.performance={}),!e.performance.now){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),e.performance.now=function(){return Date.now()-t}}}(),i.prototype={setFrames:function(t){this.frameData=t,this.frameIndex=0,this.frameCount=t.length,this.leftCropPosition=0,this.rightCropPosition=this.frameCount,this.setMetaData()},addFrame:function(t){this.frameData.push(t)},currentFrame:function(){return this.frameData[this.frameIndex]},nextFrame:function(){var t=this.frameIndex+1;return(t%=this.rightCropPosition||1)<this.leftCropPosition&&(t=this.leftCropPosition),this.frameData[t]},advanceFrame:function(){return this.frameIndex++,this.frameIndex>=this.rightCropPosition&&!this.options.loop?(this.frameIndex--,!1):(this.frameIndex=this.frameIndex%(this.rightCropPosition||1),this.frameIndex<this.leftCropPosition&&(this.frameIndex=this.leftCropPosition),!0)},readyPlay:function(){this.frameIndex++,this.frameIndex>=this.rightCropPosition?(this.frameIndex=this.frameIndex%(this.rightCropPosition||1),this.frameIndex<this.leftCropPosition&&(this.frameIndex=this.leftCropPosition)):this.frameIndex--},cloneCurrentFrame:function(){return JSON.parse(JSON.stringify(this.currentFrame()))},createLerpFrameData:function(t){for(var e,n,r,i=this.currentFrame(),o=this.nextFrame(),a=["palmPosition","stabilizedPalmPosition","sphereCenter","direction","palmNormal","palmVelocity"],s=["mcpPosition","pipPosition","dipPosition","tipPosition","direction"],h=this.cloneCurrentFrame(),u=h.hands.length,c=h.pointables.length,l=a.length,f=s.length,p=0;p<u;p++){n=h.hands[p];for(var d=0;d<l;d++)e=a[d],i.hands[p][e]&&o.hands[p]&&Leap.vec3.lerp(n[e],i.hands[p][e],o.hands[p][e],t)}for(p=0;p<c;p++)for(r=h.pointables[p],d=0;d<f;d++)e=s[d],i.pointables[p][e]&&o.hands[p]&&Leap.vec3.lerp(r[e],i.pointables[p][e],o.pointables[p][e],0);return h},timeToNextFrame:function(){var t=(this.nextFrame().timestamp-this.currentFrame().timestamp)/1e3;return t<0&&(t=this.timeBetweenLoops),t},blank:function(){return 0===this.frameData.length},leftCrop:function(){this.leftCropPosition=this.frameIndex},rightCrop:function(){this.rightCropPosition=this.frameIndex},cullFrames:function(t){console.log("cull frames",t),t||(t=1);for(var e=0;e<this.frameData.length;e++)this.frameData.splice(e,t);this.setMetaData()},frameRate:function(){return 0==this.frameData.length?0:this.frameData.length/(this.frameData[this.frameData.length-1].timestamp-this.frameData[0].timestamp)*1e6},croppedFrameData:function(){return this.frameData.slice(this.leftCropPosition,this.rightCropPosition)},setMetaData:function(){var t={formatVersion:2,generatedBy:"LeapJS Playback 0.2.0",frames:this.rightCropPosition-this.leftCropPosition,protocolVersion:this.options.requestProtocolVersion,serviceVersion:this.options.serviceVersion,frameRate:this.frameRate().toPrecision(2),modified:(new Date).toString()};for(var e in this.metadata||(this.metadata={}),t)this.metadata[e]=t[e]},packedFrameData:function(){var t,e=this.croppedFrameData(),n=[];n.push(this.packingStructure);for(var r=0,i=e.length;r<i;r++)t=e[r],n.push(this.packArray(this.packingStructure,t));return n},packArray:function(t,e){for(var n,r=[],i=0,o=t.length;i<o;i++)if("string"==typeof(n=t[i]))r.push(e[n]);else if("[object Array]"==Object.prototype.toString.call(n))for(var a=0,s=e.length;a<s;a++)r.push(this.packArray(n,e[a]));else{for(var h in n)break;r.push(this.packArray(n[h],e[h]))}return r},unPackFrameData:function(t){for(var e,n=t[0],r=[],i=1,o=t.length;i<o;i++)e=t[i],r.push(this.unPackArray(n,e));return r},unPackArray:function(t,e){for(var n,r={},i=0,o=t.length;i<o;i++)if("string"==typeof(n=t[i]))r[n]=e[i];else{if("[object Array]"==Object.prototype.toString.call(n)){for(var a=[],s=0,h=e.length;s<h;s++)a.push(this.unPackArray(n,e[s]));return a}for(var u in n)break;r[u]=this.unPackArray(n[u],e[i])}return r},toHash:function(){return this.setMetaData(),{metadata:this.metadata,frames:this.packedFrameData()}},export:function(t){var e=JSON.stringify(this.toHash());return"json"==t?e:r.compressToBase64(e)},save:function(t){var e;e=this.metadata.title?this.metadata.title.replace(/\s/g,""):"leap-playback-recording",this.metadata.frameRate&&(e+="-"+Math.round(this.metadata.frameRate)+"fps"),"json"===t?saveAs(new Blob([this.export("json")],{type:"text/JSON;charset=utf-8"}),e+".json"):saveAs(new Blob([this.export("lz")],{type:"application/x-gzip;charset=utf-8"}),e+".json.lz")},decompress:function(t){return r.decompressFromBase64(t)},loaded:function(){return!(!this.frameData||!this.frameData.length)},loadFrameData:function(t){var e=new XMLHttpRequest,n=this.url,r=this;e.onreadystatechange=function(){e.readyState===e.DONE&&(200===e.status||0===e.status?e.responseText?r.finishLoad(e.responseText,t):console.error('Leap Playback: "'+n+'" seems to be unreachable or the file is empty.'):console.error("Leap Playback: Couldn't load \""+n+'" ('+e.status+")"))},e.addEventListener("progress",function(t){if(r.options.loadProgress&&t.lengthComputable){var e=t.loaded/t.total;r.options.loadProgress(r,e,t)}}),this.loading=!0,e.open("GET",n,!0),e.send(null)},finishLoad:function(t,e){var n=this.url;"lz"==n.split(".")[n.split(".").length-1]&&(t=this.decompress(t)),2==(t=JSON.parse(t)).metadata.formatVersion&&(t.frames=this.unPackFrameData(t.frames)),this.metadata=t.metadata,console.log("Recording loaded:",this.metadata),this.loading=!1,e&&e.call(this,t.frames)},loadCompressedRecording:function(t,e){var n=this.decompress(t);2==(n=JSON.parse(n)).metadata.formatVersion&&(n.frames=this.unPackFrameData(n.frames)),this.metadata=n.metadata,console.log("Recording loaded:",this.metadata),this.loading=!1,e&&e.call(this,n.frames)}},function(){function n(t,e){var n=this;e||(e={}),this.options=e,this.recording=e.recording,this.controller=t,this.resetTimers(),this.setupLoops(),this.controller.connection.on("ready",function(){n.setupProtocols()}),this.userHasControl=!1,e.recording&&("[object String]"==Object.prototype.toString.call(e.recording)&&(e.recording={url:e.recording}),this.setRecording(e.recording)),document.addEventListener("DOMContentLoaded",function(t){document.body.addEventListener("keydown",function(t){t.which===n.options.pauseHotkey&&n.toggle()},!1)})}n.prototype={resetTimers:function(){this.timeSinceLastFrame=0,this.lastFrameTime=null},setupLoops:function(){var t=this;this.stepFrameLoop=function(e){"playing"==t.state&&(t.sendFrameAt(e||performance.now()),requestAnimationFrame(t.stepFrameLoop))}},setupProtocols:function(){var t=this;for(var e in this.stopProtocol=this.controller.connection.protocol,this.playbackProtocol=function(e){var n=t.stopProtocol(e);return n instanceof Leap.Frame?(t.pauseOnHand&&(e.hands.length>0?(t.userHasControl=!0,t.controller.emit("playback.userTakeControl"),t.setGraphic(),t.idle()):0==e.hands.length&&t.userHasControl&&t.resumeOnHandLost&&(t.userHasControl=!1,t.controller.emit("playback.userReleaseControl"),t.setGraphic("wave"))),{type:"playback"}):n},this.recordProtocol=function(e){var n=t.stopProtocol(e);return n instanceof Leap.Frame&&t.recordFrameHandler(e),n},this.stopProtocol)this.stopProtocol.hasOwnProperty(e)&&(this.playbackProtocol[e]=this.stopProtocol[e],this.recordProtocol[e]=this.stopProtocol[e]);"playing"==this.state&&(this.controller.connection.protocol=this.playbackProtocol)},sendFrameAt:function(t){var e;for(this.lastFrameTime&&(t<this.lastFrameTime?this.lastFrameTime=t:this.timeSinceLastFrame+=t-this.lastFrameTime),this.lastFrameTime=t;this.timeSinceLastFrame>(e=this.recording.timeToNextFrame());)if(this.timeSinceLastFrame-=e,!this.recording.advanceFrame())return this.pause(),void this.controller.emit("playback.playbackFinished",this);this.sendFrame(this.recording.createLerpFrameData(this.timeSinceLastFrame/e))},sendFrame:function(t){if(!t)throw"Frame data not provided";var e=new Leap.Frame(t);return this.controller.processFrame(e),!0},sendImmediateFrame:function(t){if(!t)throw"Frame data not provided";var e=new Leap.Frame(t);return this.controller.processFinishedFrame(e),!0},setFrameIndex:function(t){t!=this.recording.frameIndex&&(this.recording.frameIndex=t%this.recording.frameCount,this.sendFrame(this.recording.currentFrame()))},stop:function(){this.idle(),delete this.recording,this.recording=new i({timeBetweenLoops:this.options.timeBetweenLoops,loop:this.options.loop,requestProtocolVersion:this.controller.connection.opts.requestProtocolVersion,serviceVersion:this.controller.connection.protocol.serviceVersion}),this.controller.emit("playback.stop",this)},pause:function(){this.state="idle",this.hideOverlay(),this.controller.emit("playback.pause",this)},idle:function(){this.state="idle",this.controller.connection.protocol=this.stopProtocol},toggle:function(){"idle"==this.state?this.play():"playing"==this.state&&this.pause()},record:function(){this.clear(),this.stop(),this.state="recording",this.controller.connection.protocol=this.recordProtocol,this.setGraphic("connect"),this.controller.emit("playback.record",this)},clear:function(){if(this.recording&&!this.recording.blank()){var t=this.recording.cloneCurrentFrame();t.hands=[],t.fingers=[],t.pointables=[],t.tools=[],this.sendImmediateFrame(t)}},recordPending:function(){return"recording"==this.state&&this.recording.blank()},isRecording:function(){return"recording"==this.state&&!this.recording.blank()},finishRecording:function(){this.controller.connection.protocol=this.playbackProtocol,this.recording.setFrames(this.recording.frameData),this.controller.emit("playback.recordingFinished",this)},loaded:function(){return this.recording.loaded()},loading:function(){return this.recording.loading},play:function(){if("playing"!==this.state&&!this.loading()&&!this.recording.blank()){this.state="playing",this.controller.connection.protocol=this.playbackProtocol;var t=this;this.controller.connection.removeAllListeners("frame"),this.controller.connection.on("frame",function(e){t.resumeOnHandLost&&t.autoPlay&&"idle"==t.state&&0==e.hands.length&&t.play(),t.controller.processFrame(e)}),this.resetTimers(),this.recording.readyPlay(),this.stepFrameLoop(),this.controller.emit("playback.play",this)}},recordFrameHandler:function(t){this.setGraphic("wave"),t.hands.length>0?(this.recording.addFrame(t),this.hideOverlay()):this.recording.blank()||this.finishRecording()},setRecording:function(t){var e=this;this.pause();var n=function(t){this.setFrames(t),e.recording==this?(e.autoPlay&&(e.play(),e.pauseOnHand&&!e.controller.streaming()&&e.setGraphic("connect")),e.controller.emit("playback.recordingSet",this)):console.log("recordings changed during load")};return this.recording=t,t instanceof i||(this.recording.__proto__=i.prototype,i.call(this.recording,{timeBetweenLoops:this.options.timeBetweenLoops,loop:this.options.loop,loadProgress:function(t,n,r){e.controller.emit("playback.ajax:progress",t,n,r)}})),this.recording.loaded()?n.call(this.recording,this.recording.frameData):t.url?(this.controller.emit("playback.ajax:begin",this,this.recording),this.recording.loadFrameData(function(t){n.call(this,t),e.controller.emit("playback.ajax:complete",e,this)})):t.compressedRecording&&this.recording.loadCompressedRecording(t.compressedRecording,function(t){n.call(this,t)}),this},hideOverlay:function(){this.overlay&&(this.overlay.style.display="none")},setGraphic:function(t){if(this.overlay&&this.graphicName!=t)switch(this.graphicName=t,t){case"connect":this.overlay.style.display="block",this.overlay.innerHTML='<img class="playback-connect-leap" style="margin: 0px 2px -2px 0px; max-width: 100%;" src="data:image/gif;base64,R0lGODlh9AHmAPf/AOnxtbS0tc3eVTMzNM3NztvnhtbX1/Hy86ioqezs7Z6entzd3r7UJdHhZcnKzOjo6sXZO319fkJCQurq6xMTFPj65q2treHh4vT42uXl5/Lz9JCQkfP09FxcXebm54yMjsvMzSgoKdfleLGxsUtLTPDx8cHCwlNTVSIiI6CgoYSEhAUFBpmZmtHS1Li5ucHDxNHR0err7HZ2duDrl8XFxvP09vv98/Dx8trb3MjIyN7e3x4eHmZmZj4+PrzTHtDQ0uvs7dra2uzt7ZWVldfY2cPExtbX2AsLDImJiff4+MbHysjIyoCBgsXGyHp6er6+vsDVKm5ucOTk5XFxc83O0MbGx2FhYm1tbsDWLKWlpu70xRkZGkVFRtPU1pydoM/Q0bKztKamqCQkJeLi5O/w8Glpab/AwtjY2f7+/WtrbcfIytjZ26qrrDc4OdHS0nBxc7/VJ5KTlI6Oj9LS0/v8/b7UI3JzdMPDxIqKi5aWl7y9vi4uL8fHx3BwcNvc3pKSk62usCsrLN/f4Ly8vZydnp2dndXV1snJycXGym5vcefn6IuMjYWFhYODhiMjJCYmJ+fo6UhISR8fH/7+/hsbHP39/ejo6cHWLu/v8Lq7vPv7++nq6+3u7q+wsby9wL6/wvj4+Pz8/Pr6+vLy8+bn6O7u7vj4+e3u7/f3+PT19fn5+ff39/T09Pb29+jo6MHWL/b29vLy8vT09e7v8L2+v/Pz9O7u7/39/vHy9L2+wbi6ve/v7+no6fz9/fn6+vj5+fv7/Pr7+////v7//8XGx/X19vX29vb39+7v7/z8/enp6uPk5fr6+/n5+g8PENTU1Hh4eYeHh05OT+fo6JGSk0BAQOTl6CAgIS8vML+/wHNzc5eYmLa3t+Xm54OEhfn4+Y+PkFdXV1hZWv3++IiIiJGRkZubm3t8ff7+/35/gOjp6ru8vmRkZMTFyLO0tWJiY6eoqycnKGxsbkNDQ77TIl5eX6Kjo+Xm6QcHBwgICZSUlvLz8y0tLv///wAAAP///yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4zLWMwMTEgNjYuMTQ1NjYxLCAyMDEyLzAyLzA2LTE0OjU2OjI3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjQyMUExNDAzQjE2NzExRTNBMUE1RTA3Qjc0NDg0NDMxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQyMUExNDA0QjE2NzExRTNBMUE1RTA3Qjc0NDg0NDMxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NDIxQTE0MDFCMTY3MTFFM0ExQTVFMDdCNzQ0ODQ0MzEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NDIxQTE0MDJCMTY3MTFFM0ExQTVFMDdCNzQ0ODQ0MzEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4B//79/Pv6+fj39vX08/Lx8O/u7ezr6uno5+bl5OPi4eDf3t3c29rZ2NfW1dTT0tHQz87NzMvKycjHxsXEw8LBwL++vby7urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLiomIh4aFhIOCgYB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDs6OTg3NjU0MzIxMC8uLSwrKikoJyYlJCMiISAfHh0cGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAAAh+QQBAAD/ACwAAAAA9AHmAAAI/wD/CRxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDihxJsqTJkyhTqlzJsqXLlzBjypxJs6bNmzhz6tzJs6fPn0CDCh1KtKjRo0iTKl3KtKnTp1CjSp1KtarVq1izat3KtavXr2DDih1LtqzZs2jTql3Ltq3bt3Djyp1Lt67du3jz6t3Lt6/fv4ADCx5MuLDhw4gTK17MuLHjx5AjS55MubLly5gza97MubPnz6BDix5NurTp06hTq17NurXr17Bjy55Nu7bt27hz697Nu7fv38CDCx9OvLjx48iTK1/OvLnz59CjS59Ovbr169iza9/Ovbv37+DDi/8fT768+fPo06tfz769+/fw48ufT7++/fv48+vfz7+///8ABijggAQWaOCBCCao4IIMNujggxBGKOGEFFZIYD+gZKDDMzB06OGHIIYo4ogklmjiiSimqOKKLK54hg4TVGJhSqEYEscAR6zgz4489ujjj0AGKeSQRBZp5JFIJqnkkjuusIUELEgxyYwi7WLODv6s4Eg9TLCgwJdghinmmGSWaeaZaKap5ppstunmm3mccwIlOu7RiSZUdqQJHkf4MwAeMATTz6CEFmrooYgmquiijDbq6KOQRirppIdyUIU2lPhzzQhT5onRGVi20QkwlJZq6qmopqrqqoSOQogY/pD/kICnFfUzhD8UEEIHq7z26uuvwC5Khh0rOEMArRJN4oQ/PayBKBpCqKEHLdRWa60eL4Cg7bbcduvtt+CGK+645JZr7rnoptvtArAkOkimKSD7UD8y+NPBMYZOAkI0J7TBTwgABywwwPHkuMLBCCes8MIMN+zwwxBHLPHEFFdsMcL5oHDCNtMcisMA/pgjb0NI+FMPqYVmU08IkjwSQiAwxyxzzPxsweTNOOes8848A0lBGhcYqkgb/mQzskJ3+CONoIROIMMjYgTCz9RUV2311Hs40/PWXHftdc65GroACkdkcPRBuziDghSFrhHJNVJfLbfV2Dyi49d456033lbI/1KoCSsM0OnZA5XhjwuFztGDI3M3TrfNe0cu+eRKSuM3oUz4EwDhAxlgcqEXVMO446Tzswc/fVKu+uqs+yNOobEEQkExnP8jDT5zEKqJFSiU7js2KLQu/PB5b1BoGP7ow3kMK3RQaArX+C49NhQQb/31Oh9hAKGrBHKNjGfn4Q8thCZQTTzS+75HIPhg7/77R5ZRKB7+6HBaJZrkr//+/Pfv//8ADCD/QtGPnQwgBO0alD16l77fYQl+EIxgj5xxBkJ1wR9MMM0qBkCBDnrwgyAMoQhHSMISgnALZ9AJK/LBg0KJQwwNnJ7WJEhD+CFBd20IRAFJowh/RGIRKgiiEP+HSMQiGvGISEyiCshhOAvohAD+sAehcICNuMWQdNiIx91qyEXi9aBQVnAGK0rjCn8cQoX+cGJOkJcDQnEDhlf8HeS6SEfWUaJjgxJfDMjojxygUY04kYM/gjYoOYwujr5LXR0XOTkQEGoE/pgDH/2YE1akUSeMoIAtCBUBBiISi7BipCj3FgBCFcEfnZgkGs0xiQAObiXaoIAQCHUOT37ScdQbpS6/FgZCEcMfI1BlTkqQjxWU8AjQcEksZzmoTt6ydOvLxy6n2TMEEIoG/mCDMHEiBH/sIBLzCKc4w8kFZ8QDfLCUJSdt+cy5YeMa1Ixnzqw5KGwu4pWgKSMlcVL/Cn/0YVFcCAE6E9IPDAjDI8tcZztLh40ZyvOhSKJnP+y5CtLoUyf9TEM/asHRjnK0HxIQaEMEIIIdbiShzWTnQq+2hxBsEaIwFZJEsfmBG9xiNBfNST950AoP+PSnPr1BD0TKkAb4QARo4AhK++HMleIyUzGNKpBm6o+aVlQ0OeWnP3iACkV49atercVQB5qQBsCBAQ0Yx0nVmVKnOm4Pe1CkVOdK1Q+MwhY47SNGt9pVsH5VrERdiFkvAQcIVEAjS22qW935iLk61h91HYUlTPqZrN5kp331qyIAS1aEDPYSWIACBjKSWJUutmrYmONjYRrZDISCMV+wwAhmS9va/9q2ti6Ihhn3ylXNhnWsDfksaOugBYyU9rSNi+ZqY9paUSwGBjszAW8z61fOBhcOl8hudn0wA8pK5LjIdWfwlgvR1qpiMdzwxwYuEIT2uve97fXDM9iQhTCEARBT8McTEMIM7w5EFK0IsICT4N9JOPcgqhBwK1bRWYHs9Bu8iLCEIywL4BYVu9rNLgNEcFCKgDe8cssleeXZWlAsxgX+qMJDWrEGHODAGizQ70GGwYcDF6QSTQABDL7A4y8YAZ//EIQZ8FSQJLyACj/4wg9A0A51HKSf78CEIKZM5SlPoAfnvG6Gs/sKtNrAw2xlqmlBbLpAvHTEuizxYgLgjztAZP8ZP2jBAuIgY4NMQg02JkgoilBRQxlEEw4AwRgMkoomyIhQtjADGQzSzxOAIBeQjjSklXDABhtEuBl+RWEP+90wK5bMdHsgmnep5q/AIgaCMAAITOACC9iDBRtgxDmmUIZ6nEAa86iGrnfN6177ugfzIEEI/CHdh2giznOuc0EmsYQ8D2TPSWDIMogwinaQtdA3JcgFjMBof5ygCboIt7jD/YJKa3nLWx5tRD4MaqtlbdSkvmZVR5EBE3+FFa4IwhfuwA02pCAO0ThHH9ghDlz7yxGSSLjCF87whl/jGiGoHjciAudk79fOzT4ItBfC7Bv8AwRCKAi2CwIEKnS7A2P/6ILKV65yQbQhsArBNLpBC4B1e3rMoK7bmeFNx1KHhVCTCLrQhV6Johv96EhP+tH/oQgcvEFzEZHFFyx+EGY7WyAbV4gQHDClBIDglSMfSD9aMOiC9POfigqopQsi85lz178JYXe7Uatanvdc3natd2Jg4Qc7QB0ilfgB1TF+9X+Eoh2gqIQpTKEK7/YDBBMQyCSaUAKCpEIJlQgFKJpxgBY0IRndRnui1H7umWv3FXUoQIcZIve5Yw11dl+kzw1jDBzkd3MQmYQRBr/sjBvk8EnoBggI8IXXEqQVRTD+Py4AA8urIRQXAAEVqCAIIpvdH/LDhPa3r31ghHTtBGn7/8w1LQC1sv7mrg+xI2Jfx9kXpva3j0g/1sB7glhd40VAxT8IZRAjVN8WQsAKoFAEpjAQI8d/CLFTPQVUPyVUMFdWGGZ6mXYJr/BlC9F66ccPIsZ+NeR+hAF/f/cQuld/A3F/v1cE0YYQqvACzCAKa0AEHvAPLmaATZBtC4FZvrVZFiZYESiBXEYPBQB3BYGB6bc+7cOBNOSBg2EK9wANIegQlSBndHZxvVd4WXcQOtACBrEKL0BkYXeDfJWD1nVhPqhdWOADACCEQ4h+GXg12CAJSJiEeEdv9uYVoFACysBecwACNKAH3NAJCJACLBAHi8AI6QANMpCIiriIjNiITv/QAT0AT7j3EMUwdVNYdb5XEHtWhzfWDgdgEI9nCQLxhQqBg741hjxYhqB1CcXlEESYgQ0VhxGkhFnBCooQBARgAgGAAIVQDioADVdgBeFAAj1wQDuwBciYjMq4jMy4BZIgO8QWERkgeJeIcaOQeaGQjVNyeCWAjdkIPg/wdQdhC0owJbJADOA3EKaoWagYcz04c1jwCpzmimzYhnTjUrIIP7SYFUA3dEOndAAZkEj3D5DEB4DXAlKobATRD0agBg7wkA7QBGZzC1QAkQ+5BF8wJYawCwgxCVRAO6LQAkD2ZGF4ijvojhLYZRBggQ/xirAIVfmIPfsYGP0ACP6QCf3/4I86OXSkYARGMAbiQ4UFkZP+uENE6Y8CMSgEZZQOsY7VdZIQKIF1IALmBxEuWYRxFZMyOYd6lxiTAA7+sA0LMAdkiZBm2QI7xmMw4AB60JZK4A0KaRNOCVbtGJXohnqqNxFXmX7YEEpaSTwzCRiToA87YzQ6VZLsCJWe9Y7ZRQ8zUBF76XqBwEF/CZhcyYmGIQqCwAiJ8Aae+QaJEJqJEAWkWZpXUJpRYAcnoFeH2Vsm+YCLuWWhVXOQWY/2yFKBIE2V2TqB+RemAATFEJw1MJzEyQEchQvImZzJSQfrwJpa5ZqJCZsHgWlYcAnzCGbMJGa32TjvtJu8eZlgkS///2h02ZiNwAAM+RMMorCeouALqqAKv/ALiwcKSYAK9mmfq3ADMQAE/BkDE7AJABqgm6AOBFqgkHCgB8BmBtma1EWXijmdGKZphmVctrmddFM93qk6vTkVhUJ0ldALoZA/66kKpgAKqNAKwSkLHMAB+xALB1ACJUAGu4AMp3AKnCAE/Nmfm5Cj/fmfAgqgBWqgCKqgvGUKlnCkSHqkFSadl4ZdXZZWpFWhFko1LbVzGZo3GyoVHRp0RQeiIaoJI1qiq7AKsFAMqZAKK1oLLgqjMYoJszALNWqjOMqjQOCfPwqkQaoOBwoJCeoPC/qcC8iAHuCA6SgQZoWXSRWl2flpU/+KWjB5pXuTpVGxpZPQpdkooqJAoqAwpmV6pmm6pjBKBm4KpzV6o3Rapz76o3mqp0Pqp3slDmtgkRbZBS9XqP9gVm+3VouKc1OKDXIFqXgjqVBBqZb6pWG6qWRqpmhqnKDapm8ap6ZKp3Z6p6u6p336pzfRTVwAD17Qrd7arVkQCI9gq0bVirqqUI0aYo0FrHojrE9BrB96qWCaqWKarJ7KrC8aqqMKrXPKo9OqqnlqrUSqU1bqI9gwkkPZAOqmVFKarlOTWuyKpeDpFfDqpZiqqZyqrJ+ar85KqnJ6qv8qoNXaqvt0E6zgDG2AB0ywsizLBI2wDfYgCA3RDyzJsLv/6rBysz6/GrHVNLFdUbHG+p4mmqyyoKJqegD5OqM0eqP9GgMxsKP+mqoiG7AI6g761Q8CmbVau7UCOQkJ4AzyowFiO7YacAAIixJLVUs4G2LjxbNc00uD8kt5h5lbcSjD4I9HlwzJUJ7yuj/q2Z6+ELjN8J7v6QuxsJ89eqcDSrV8CgYrkA5q8AmSO7mUW7mWe7mYm7ma+wlFAAgrYAVJsKeiSwq2OhKZxAmEkg68mq4b6LY8ww2E8gL+sAh0qBi/ALWoqrgj27grEAGI4AnAG7zCO7zEW7zGe7zI6wkmwAb+8A6hK7oHSrowUQ7+IAiEQg2HtLZVsz4F67pL8gWE/9IJ/sACtdCViHG7ORqyAbq7B+C4jdACShC/8ju/9Fu/9nu/+Ju/SgACjgu60Bu9pSsSCNBmhJINcKS9oea9O3MN2QmWAUAG5nsY6Ju41Mq4BzAC+DAPU5AGHNzBHvzBIBzCIjzCJJwGwegP7PC80Cu9L7EAIUMogjAAVoTAVBOLCowzXOBC+dACCRDBhgEKkLC+BPq/pFDERmzEp6AGj1pDcpAK/wsJLOwSxeAM71Ao7JC9NGw6WnTDN/MH3OMI8aAOluDDhXGUO3nGQ5cKQJADgDACnfDGcBzHcjzHdFzHdnzHbwwILkAKrLrCASwSbeAItUAogIDFWQyxXKwkFP9gvYNCBf5UC4pAxpvxC6QwC2WLtJicyZq8yZzcyZ78yZl8A33sxzGhAJpDKLVAAo+QxdsLe4mMJFFQKOcATDcQyXS7GaZACk+8y7zcy778y8AMxX8cErtwBCdQKJ3gCDN8yOv3ykYiCWNAKDewAyGQAcpgy6GRy8G8zdzczbwcxS+RXw5QKFEgCayMWhjqzEMiRYSyDf4gB5CMzaChzd5cz/YMzODsEsqwAtJQKAkgDaubrsqlzkHiBIWiDDvgCDoQA14lyZpBz/cc0RK9p/nsEhHgD1kAOpEQ0I3anQT9I++ADoUiD/4wBLLwVQ6dGRA90SxdzxXdEqxwjBVEKFL/0AHPeM4a6FAfjUGGYgH+wAUxcM0NfcsPrcstfdTd/NIt4TltkACFcgzgADzLvLZVutOBAAaGQgUUsAUtYAtglQHnNc9GjdRkHSNmrJNquBL9QGcn0AqGQgR2MAAogAIvMzN2fdd4ndd6jdd7UHdcHAJ4QAaG4gZ0wgbxjNKFV9RkvdgxkNY3UQzawCxs06FjkALywAVtIMMI7AwrgA+e/dmgHdqiPdqkXdqmfdqondqqTdpHsANcoA0ugC+GQgA2Qwgn7VceoHyesdKLzdKNHRSmgAl+dw00kCiwEAt+EGjqstznAgNEYADQHd3SPd3UXd3Wfd3Ynd3avd3cbd2K/8AKipICnK0AsmAJmjVZ2TzWve3bjm0TmmAJozAEfQINJRAs9n3f+J3fjaID4aApYFDevsWR6b3eR/3bQNEPSmoCRLMD+lAK+v3gEB7hqqIDTtAn4hAEh43bRK3YBM7eQlELHqAIZGAJcmAzFCAPLjABkyDhLN7iLo61YxAGt+MPbYAANyAEOehVZ5sZogAEcfrjnBDkQj7kRF7kRn7kSF7kQiDYQhEKIa4IylALc0Y0/nAEe8ADEQAOG7DlXN7lXv7lYB7mYj7mZF7mZn7maJ7mao7m5bAI0LAy7ZMPXIAAExAL5p3ji1Y7/+DVXxUDtTABL8AIkRACurnT2OMMgf+wMQRwA7Eg1DnuWnpueBngV8qACbJwA1JgCC+QCZze6Z7+6aAe6qI+6qRe6qZ+6qie6qq+6qzOB0FAChwlBHee44rgAZUX6f8A4r5lCROQANz368Ae7MI+7MRe7MZ+7Mie7Mq+7Mwe7Lbgn7NO615lCTsuL/0gBE8u7dq+7dze7d7+7eAe7uI+7uOeAYlNOJUQ7eS+7uze7u7+7vAe7h4wRriuZ+oe7/ie7/q+7/zuVR4wCu19NqFw7/1e8AZ/8Aj/Vf8e8OieANme8BAf8RJP7h4AC/WuEP3ACj418Rzf8R7vVxmQALp98QhRCTeQAQ//8Sq/8vnuARkwAY1H8lDdyAoxAFQsf/M4/+0/pQiYEPMyDxH9EAqwUAu2MAHKkKRIn/RKv/RM3/RO//RQH/VSP/VUX/VJqgwxEAusIArV/vMMMShoHPZiP/ZkX/Zmf/Zon/Zqf/ZK6fVu//ZwH/dyP/d0X/d2f/d4n/d6v/d83/d+//eAH/iCP/iEX/iGf/iIn/iKv/iM3/iO//iQH/mSP/mUX/mWf/mYn/mav/mc3/me//mgH/qiP/qkX/qmf/qon/qqv/qs3/qu//qwH/uyP/u0X/u2f/u4n/u6v/u83/u+//vAH/zCP/zXERAAOw==">';break;case"wave":this.overlay.style.display="block",this.overlay.innerHTML='<img class="playback-move-hand" style="margin: 0px 2px -2px 0px; max-width: 100%;" src="data:image/gif;base64,R0lGODlh9AHtAPf/AJ2dnfT09KWlpZWVlejo6bGxsRwcHHl5eYmJiRMTFOrq66GhoYWFhcHCxObm54GBgdjY2GFhYcXGydPT0+Dg4OPj4319fQsLC0ZGRuTk5GlpaVVVVV5eXpGRkXFxcd7e3kFBQXV1ddbW1lJSUsDAwNvb221tbk1OTgMDAykpKaurqzw9PdTU1FlZWdzc3JiYmMjKzLu7u8jIyJubnPLy9M7Ozr2/wUlJSTo6OsLCwmRkZDY2NtDQ0DIyMr29vaytsKysrC4uLra2ttHS1CUlJtXX2MrKy6+vr5qamiEhIczMzM3O0LS0tMTExMbGxsbIyt7e4I2Njby8vOTl5qioqMPEx+rr7KqqrOjo6np6fNTV17i4uMzNzo+Pj3Z3ePHx8rm7veDh4uzt7r/AwoeHh8PDxM/Q0sTFx42OkMDBw+fo6bW3utjZ2vHy8tHR0sjJyru8v+Xl5d3d3dzc3mNjZJ+fn2pra+np6t/f4OLj5NPT1V9fYFdXV8HCxsDBxbO0tq6vsqqsrk9PT0tLS5KTlGdnZ4uMjn1+gHd4e1JTUzs7PEJCQzMzMysrK+fn6P7+/v////39/fPz8+7u7/z8/Pv7+/f39/b29vr6+vj4+Pn5+e7u7vLy8u/v7+3t7ezs7PDw8Ozs7fHx8fDw8fb29/Ly8/X19fr6+/z8/fn5+tvc3e/v8HNzdKmpqvf3+CMjJPDx8fP09OPk5ZmZmvj5+Xt8flBQUP39/mtsbvLz8+/w8Nra3NXW15+govr7+x8fH7m5uicnJ+fn6ezt7Zqcn7Kzs7S0s1hYWLe4uvz9/aanqq2trf3+/ouLi2NkZqOjo5aXmqKkppeYmmBgYPv7/JSVl4ODg4eHihcXFw8PD/7//9HS0kBAQOHh4mhoa0RERDAwMPf4+AcHB+vr7NfX11xcXKenp5manJqameXm6ExMTcjHyfv8/G9vb/j4+UdHRywsLHN0dj4+PsrLzTQ0NObm6Obn6efm6Ly9v39/fzc4OL2+v+3s7fb39wAAAP///yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS4zLWMwMTEgNjYuMTQ1NjYxLCAyMDEyLzAyLzA2LTE0OjU2OjI3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjQyMUExNDA3QjE2NzExRTNBMUE1RTA3Qjc0NDg0NDMxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQyMUExNDA4QjE2NzExRTNBMUE1RTA3Qjc0NDg0NDMxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NDIxQTE0MDVCMTY3MTFFM0ExQTVFMDdCNzQ0ODQ0MzEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NDIxQTE0MDZCMTY3MTFFM0ExQTVFMDdCNzQ0ODQ0MzEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4B//79/Pv6+fj39vX08/Lx8O/u7ezr6uno5+bl5OPi4eDf3t3c29rZ2NfW1dTT0tHQz87NzMvKycjHxsXEw8LBwL++vby7urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLiomIh4aFhIOCgYB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDs6OTg3NjU0MzIxMC8uLSwrKikoJyYlJCMiISAfHh0cGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAAAh+QQBAAD/ACwAAAAA9AHtAAAI/wD/CRxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDihxJsqTJkyhTqlzJsqXLlzBjypxJs6bNmzhz6tzJs6fPn0CDCh1KtKjRo0iTKl3KtKnTp1CjSp1KtarVq1izat3KtavXr2DDih1LtqzZs2jTql3Ltq3bt3Djyp1Lt67du3jz6t1LMtInOUwOeBBgia/hw3TrpPDHuPErB4gjS07LgPEKDz5YiPDgL0WlyaBDe92EIgEESAQh7fHXRLTr11UF+BtwUIi/BbBz62b6wh+Jg3H8WdhNvPjQGP6oHMyEIsgj49Cj59zkj85BSr8ufJbOvfvLAOLgPf83GMEfKO/o05+klOQCpYNdWKufT/9j+QwHr/hTUb+/f4sI+OPEQSL4k8V/CCbYkH4FHGQKCjuMp+CEFP4T3DQHaWJAAu9V6CGCnKDAiIQECeLPJh+m2F8lG5I4kDX+vKHijPPx4U8nBwHgzxY09ujdAf7UcBAb/njh45HR6SfFQZz4gwNqSEapWwb+HLBcAthEIuWWr33iDzdQFjSIP5dwaSZomBhggIsCeeHPBGfGGZmJnhw0i29y5skXZyIctIs/HegpKF4DyGeQl98MqihdEFR5kCXZvMLmopSmpYA/NyCEgT+mVOrpWplkQ8SkdvgDwaeoosWNeQcFaESqsJL/VR4eBxnhTxSx5gpWoWUcdIc/J+gqLFcFHmiQJOIEEeawzFLVjT8tHAQJPeJ02uy1UllyQQ/LDrQaBdiG+xQk+ogTwEGVCSnuuktt4E8FtfqDALv0ItUbCwc9y0G9/BLFw60HiYLCk/0W/JMc/mBoECSNZKOJwRDvlIk4OCBkIrwRZ2wTJClcUKZB+fjDhsYk0zSmAvE+U/LKMD3w5kEu+KMDyzSz1ASgB3mJQc08o1SgBwdF8gs2mPRs9EgCL4LQO/6gfPTTHj2SRDaFGWSCPx9ArfVGkKxap0HA+FPH1mRj5HI3B7HgD9Bltz3RPrf56o8tbtcNUQ2OGhQJNkTb/+33Qk1uIO0KJ/5teNBYbleQBv44cvjjA5GLAie1+SME5JhXhrZBSgiHOeRM+CPAQQT4s+/nh8sgb9AXBKMl6n+XHq1BjwQhDuWw+01JNgYoTtDVTude9yM9oPBxQQX4U4zwfpcKrkFl+NMM83a34s8yB+HhjwbU103CbAdVIg4Rr3dP9qV8HPRIMOIcb77WmFxA/kEj+DPO+2RHkoI4mRy0gOX4IxtnPnEQ5LwggFurAwANoj07IFBrtsGNQTCBghSU74E9G8fagja1/mHQaBOz4EFa4A9JfNBokSDCBYpmECT4o1cn7NnV7meQI8QthjybAZ4MQgF/PACHNIsEOf844I8rLAcF9JgUEAvGhUY0xoEGwU42WLjEiKmgMRfwR4QOsgh/4K6KBusGChozRmx0qCDNiFFaHqEJTWCiEm1soyUs4YAJeBCMXIlEEBrDmDHe4SDWw55YTKGAJjgBGF2wnTgukABxOFIcfPzSMyBARTxaBW6RzKIMDuIGH4YlEkSMpD+IkIIUBKOUKZCHCUyQhRC8ojHYMMEyzmPJqTxiB6LMIhMOEgAndWsroTNACAbQASQ0QRKReEQklrnMglACD+YYQTYawwdy/LKWStFeJMvROTJkiG9n7Eoi/IGfimBCBF34BWNusA0lYrMoAeIjChzAHH1cc1Nf7Mo3/BH/B2lFohLUcCdBKEECXPpDEQIYh+/eSRTiRTJTlMBGAi44kMq86ivL8Ic+KvBGX7hCDWFgwxP60AAJDEEOklgo7WSwKsZgQwMsCCdDgfKJMfLRiP8YZz4HosPLfYUS8mAMOPjgjAdcAxeFyAIaiBEIODSgChLQwzBkWhBIuKAZi8iiP5IggDvO1CdSiCQKvuYmHhxkAv6YxSeRsBhRMmaR4HjHMbIAjR9UgaLSqkQZTuDSOljrqzwhIR9dJ5D//cYgTUqUWCLhgG3UYAAR6IFb+5gAeXTgaw0hAGf8cYED/BGwObFEAiJprH8864cGCZUB8PoVSKigrRcIgi00wIFF/4yWj+LARfAYMg4LQNIfhcAYaGsSs0huYyCe+NIvIbFPr4KFBOpMmBM2QSJTdAMJ5cBGY8SBood0ggG3LUcJrjlcllggkti4I6QkdRBW+IMcYpHEavwRAQIuxBJ4iEIPDDCyiFziCElgzAg2949IWOISVC3vSCixRz5GoCCLmNxBOrBDr1ACANP8xUUfAgmVPqQSW9ijOFTwAVakYIxEyEefFFySHkayQQTh00HIkdavsEER/kABA9x3kkgs4Lf+MMAiVqBdfxyBxSSJDx8vgCOCUHhABknuO7oSiUL54x1Zi2IlKkGJSJBXI3fY1EHdAIk71GG05UTyRxzKx0wVBP+tqC1IAC6QAoFGxRPuugAQXAQJWJjhDH3wgwSesARV5OELp1gzCRYjDjt8ABJo8AcD1AwSB9i0McopyK+CRbse8C8rkYCRPxhBq9R8YQhpAMQh9sCHQlyjDldYgw1scK6PUKIA2r2AB7iQnapRmiM6lKd9CXIJOpPKH7vAyiN04I8E1KGS/zAFL9aAhhOM9tIXyAY2cHACOpzBBc7ViCQ6kOFXAuDXHIGEifhoz4PIAwWiQJcar9K5RtByIJTgRTWmEQyXLmIHQHZraT3SiQdoFRv9RHdGOBFwf6jsINPwR6kLEr0DXgVIG/7HLT5wCCf6IxsgUIc+bouCX3CDAyb/QAIJSPACE/Q3JJvIRxZR0I6EK7wiNowkgQsSBX+4QW4jwAoZZoOaR3wgBP32xyBU8IJvjDEbhSCBA7zckk0wYJoye/TNJ+IuPoowbf6weEEYzq2rgCKL3CgHN2yaiG5QwhxZ7ME+fB0TTnTAAIyRBzCgvXWFmEKrjYmzQSrgD8HRDhwewwoEApxjelgDXJZg2gWEwNqYYEIIDU5AIYDhiS/3/R+2ieTLjyWOdhukHP7YeVU0oQACdGI8LNAuBjCbE6NrAOsaXcDUP2+QrjcmCQkWCCQQT/eBnPe4XiEBJDWQYGVS4vmosPNJLuECBLR1lA+oAd8VfgncM2bgB3GX/3AJorojc+URGfUHjAlyinHgYR4SqIL8JWCGdAR/JYwVAF9dyoo38PjX3xNJK5YQ8TGABPEs5UAs+yQOMCQQlHAHvGADyoAIdOAN8cAKGOgFD5AFPFB5LREAQtACWnUBuFAAO4VkggVL9ycQeCN2BEEdYKIVYeMkJTAQlwAFEvADiKAP3udW8lBrNXEJOfAAt4UNHCAE8YZkxRZJIcAQCGMdtJMCCeBhUuEJKCAOQjAe0tYA5yAIt5UEJkAC+3AEZEiGxXAFjOAkHggTlcACCNADWKIPIUACoOB5lhSAfKQuCtEJX4IQ9WNzVoE3xgIJUwAH5zAIT6cDbLCGj3ADAv/CE5GABwuwB9wAAi0QBW8gCtIHRPMFS1RIEI9ABFRzEJwxelVBJHTzD6pwDSswRgZAGAvxCBXwDK9Ugz7xCATwBgxgBxpgAQCQiZuIQZpwW43RhA3hiLs1EMkDBFlRCQEGAFTgccHQVQthCjPQYAZihzcBCaYAAQLQAV0AAEIAAQEQjPijOpEkIw0RAqZyEAjDPVkhA0DGDUbwiQMBd+s0AJBxFJpQAWVQDAXgAzWQAZZgjtRTHnw0RQ4RPbRhEJfiZlmhAAIADHGgjY/AOD40bEtRCZ6wCzVQAxCQAZ2wfQGUCUXWGO3wEDSWklFkANhgj2BBCSSEDQb4FI+QCZ//4ACudwkwyTzbIErq2BDUkYoGsU80dBaUYCM9QHu2RAmZYAk9KTznxUcJ8DAO8QjY0DsHUQj+8DxmIQr7xAj/JxCoIAmrMAqlUAnJxHstEQmM1xhs4xCQQDhMKRChk2ll4Qaj9Q3F9w+PAAssIAFjEAi9AAhp8ARKwAZxkAkGyZYYQSSRtEsQkQXvAnZxORYsME0IIFOQwAlcAAiE4A30gA0XgA30QAdkAAgNcAYygAe0oI2OiRFT2RjZYEIQgRz8YRDBYXiL1QFj5E2p0QY/YAdE9nvyEF3NtgheEA1gUAZmQAG5sIaxWRGU8Ep8xJsPwQUGgjjB0JhREQnlgQLP/7AssdAKi/BbRlgAcfAelDAOMdAORSYOr7AHdZAGVdAHLIAHuYAJsDmdDPEnkbQ8EUEdxyAtOIACTQYWfwIPO4cJy9BgSTADLnB/lbAND6APY4QCilALfxB/+AAH80AOanAJmOCd/vkPs8kYFwCED/EICaCV5OEP+wgWnTM9AvEIWtBS+lAAJKk+4yAARMAYCTAC1QAGEvAGZ5AGcAAHUbUL4xAAlpAKvvAIkNCfn0cJQXqdE0E8EmYQxVBhX/EsPTB1EEAHWZQCE2CiBSYCt8cYrzAIdGAIzFkFTwADT1AGaTAGevoEXDAEReAAsHAJzGCllIYwAUoREQeIA2Ergv/nFZBwDH3EGNkwAOE2EZZQAIPgfcHADepwDAdwDYQAa3+ADGsABjbQAE9wBjAwBAqQaNNZGUtmmxJhQ7lZEFTyYGJBCSpwAjhQDkDwVxshCnigAh6AAwlwaVRJBK8AD/QgD7bgBdJgAxLQAGFAqMOlR5FElBKhOsBZEJFAZ9IpGQFwBxUAATNABqwQAYKAA2pCmnwED7VgA2fAC6nAli7GR7UqEbeqPrZzgtEhR5zwCd0wCzggVL0AAw0wBWqKTUO3ZAkqEZRwAcB3ECZylPUBCSywKReQBTAgAfOgC9aKTZEADw9lEY8AD9VyEAoUAwnyCOYwRosQCGZQBhBQqQr/dq+Nka8TQQeFYxA3My8KwgJ7dAEmYANLcAZQEJXvFE/b9bATYQ7+4AMHUQL+YAIUUgkdkEVJwABvsARvoAbhWkuR4HGNMWUXEVaBYhCakCwLaxx4xhj6cA5LsARmQF03K0rMeBEO4A+soD6vkHgewgOEo3RXYAZuoAVtELIflEa45bQTIT6NwFpjopEU8ghN0G8o0ALFUARaoAruAFgpFElKgxEpdAGVqkMsqyKasAB4lwAHQAJsUATd0KNLhLOMIUgYwZWO+w9hgwQ9YgkDcKz08AI8oAC7kA60G0M9h1vdhRE6IrUGQSTgpyIBQAhE8AsRYAQikAd4UA+WoLjC/xMJ1tkYIAC+BmEbY6O2KCAPbaseomANjKAIc9gNCuAADhALYWs+2sRHuIsRjWIlLZkNNqsiFMAAG7AB+UAC20ABCqAGo3AK5vs4SrZdzYsRzOEcB8FXLIokklAMXtAOUSAEItANoTAMkxAO7Ws34htJMagR7KGQBtEbSnAmmuAGM4AAMxADE+ACk9AGukAKlBDBbrO/jdG/GVE/dfkPySNBZ/IIdxADAnAETTABHzAK/RAAPEml7zPBfVTBGUFhOXAQ3SQomuACJFAG21AC3YBotKAJ7KDFzPMI45t3QmwQgcRL/iAPivIIoLAL5NANDuAIARAJydBl2lDHPfMBov+ksxnxJ8boTBKVvFyiCZvgepzQCa6QTHAMO1zsD9zlEZeARJNCOBs8KGzEk11WpYhcM6HIwqtMEJggUQnmKqkiIVWaO7brD60AErZAJgchGz51ot2xvBQMEi6jhwRhI2YlzNzxCNfHGIvwygURNuVQPpFwCSGTAivIzLCRy3jpEZXgRD2wADMwDVl6AcjHzdFBzG+1uxvRCS2loo2AAJSrzsRxspGEAdKsPt1QDHRYkPbMHc8SSeYQ0JTCzp7sxQYtJ7UTSWa70IIy0Hw0OhAtKIxbzBWdJ5EgWXz00BkdJ4QXSRT90XGC0OKQxCSNJI+gDw6d0nEiCoDHGDjl0lz/Yqjb9Vk0vSX/w0cwmtNSQmF8pA4+zSUhw0czM9RSQpl8BI9IjSSdrK1XsQklkAGXsM9NHRM6wkevsM1OUQczlw09MAIeAAw8QAGaeNVGQWORFMZXQbWTpaIpcAOFQAUyUAKcQHVozRPdF0ngoLRJIWpv7VbikAQrMA1AQAITEACUkMJ57RE2kq19CRVWFtiU3RgGQA+CMAvAUAOfUAmM3dgV0SiilAQqENlN4QjIWtmq3RgJEASC8AJHIAOgoAn5C9oYoW6TlQAbAADA8AagIAnAHdzCPdzEXdzGfdzIDdzlWBFusAINt9rQTZspwAdRIAAk4AhrCApI8ALc3d3e//3dA3BYtv0PnkCM0X3e6H3eGFDKLRrPb2Xe6b3aQYDTBuED51124/0PjoB38d3f/u1WUDgRkJCljTEDlRAAXGAM6LAHONAe4pDa//0KVJgDc9MFwJADK5fhGV4GhhAPF1Ax+U2lJMDf/13i/Z0Apr0QkOAlkSQEqlylAaAAccAFUeAB5YABPYCc/p2MA3EziKAHnicLP3AB3PDZzGwK9msKelAOz23iTk7ZBmCVEEEJomAEyIoCb+AJ9mu/oTAKo/AFpBDmXyALEFAGgdAB7aAOOPAKEE7ZCv0PlGDfWVAEnmcPgIACfEAKtZ3RlBAHjvDnk/AFwLAHJ/nkhj5ZB/9grStOAFawf4xxAuNwB38+6ZT+5wSgAKGwCl8gCabwBcIwB+vwA7PAComwAuzz1owgqwOBCpMADCgAAlnwBhMw67Re682wGi1AA53X2AEQyJNOAGipBa1gAoNADwlwAY+U7Mq+7Mze7M7+7Mt+AdMwB9YaCX4uBuQwAhdwARvAAvxQ6eAe7o5AAHcwDpOAlqTQBliAB1xQDABgAeXwDR0jDiCwDv+XCpOwD23+1tMgCQ5wC41NCr5O6QQQCl9gCmIgC7swAXjaAA7/8BAf8RI/8RRf8RafBjywCuPQmI/g66EQCm7ABR9/D+Je8iVP7uPgCehOAwrQDTUwD3fgCV/7MEEOIAutMAszkPM6v/M8zwXjQABGPp2PIAwDD+53oADjEAqTsPRM3/RO//RQH/VSP/VMHwr3MAoTMQq+fgeh4AmSbvJgH/bjfvSe4PVxIOUD4cSOsOnJLdyhEAelYNuUMAkEIPZ2f/d4H/YEIAmKCwml8PV5H/jiPg6ugBCP0Al5rwB8H+KP0PiO//iQH/mSP/mUX/mW//hCDAmXv/mcH/l22PmNb9X5PfqkX/qmf/qon/qqv/qs3/qu//qwH/uyP/u0X/u2f/u4n/u6v/u83/u+//vAH/zCP/zEX/zGf/zIn/zKv/zM3/zO//zQH/3SP/3UX/3Wf/1GERAAOw==" />';break;case void 0:this.overlay.innerHTML=""}}};var r=function(t){var r=this,i=t.autoPlay;void 0===i&&(i=!0);var o=t.pauseOnHand;void 0===o&&(o=!0);var a=t.resumeOnHandLost;void 0===a&&(a=!0);var s=t.timeBetweenLoops;void 0===s&&(s=50);var h=t.requiredProtocolVersion,u=t.pauseHotkey;void 0===u&&(u=32);var c=t.loop;void 0===c&&(c=!0);var l=t.overlay;void 0===l&&document.body&&(l=document.createElement("div"),document.body.appendChild(l),l.style.width="100%",l.style.position="absolute",l.style.top="0",l.style.left="-"+e.getComputedStyle(document.body).getPropertyValue("margin"),l.style.padding="10px",l.style.textAlign="center",l.style.fontSize="18px",l.style.opacity="0.8",l.style.display="none",l.style.zIndex="10",l.id="connect-leap",l.style.cursor="pointer",l.addEventListener("click",function(){return this.style.display="none",!1},!1)),t.player=new n(this,{recording:t.recording,loop:c,pauseHotkey:u,timeBetweenLoops:s}),t.player.overlay=l,t.player.pauseOnHand=o,t.player.resumeOnHandLost=a,t.player.requiredProtocolVersion=h,t.player.autoPlay=i;var f=function(){if(t.player.pauseOnHand&&r.connection.opts.requestProtocolVersion<t.requiredProtocolVersion)return console.log("Protocol Version too old ("+r.connection.opts.requestProtocolVersion+"), disabling device interaction."),void(t.player.pauseOnHand=!1);i&&(r.on("streamingStarted",function(){"recording"==t.player.state?(t.player.pause(),t.player.setGraphic("wave")):o?t.player.setGraphic("wave"):t.player.setGraphic()}),r.on("streamingStopped",function(){t.player.play()})),r.on("streamingStopped",function(){t.player.setGraphic("connect")})};return this.connection.connected?f():this.on("ready",f),{}};"undefined"!=typeof Leap&&Leap.Controller?Leap.Controller.plugin("playback",r):t.exports.playback=r}.call(this)}(window)}).call(this,n(17)(t))},function(t,e,n){(function(){var e;e=function(t){var e,n;return null==t&&(t={}),t.positioning||(t.positioning="absolute"),t.scale||(t.scale=1),t.scaleX||(t.scaleX=1),t.scaleY||(t.scaleY=1),t.scaleZ||(t.scaleZ=1),t.verticalOffset||(t.verticalOffset=0),6,-100,n={absolute:function(e){return[window.innerWidth/2+6*e[0]*t.scale*t.scaleX,window.innerHeight+-100+t.verticalOffset-6*e[1]*t.scale*t.scaleY,6*e[2]*t.scale*t.scaleZ]}},e=function(e,r){var i;return null==r&&(r=!1),i="function"==typeof t.positioning?t.positioning.call(this,e):n[t.positioning].call(this,e),r&&(this.screenPositionVec3=i),i},{hand:{screenPosition:function(t){return e.call(this,t||this.palmPosition,!t)}},pointable:{screenPosition:function(t){return e.call(this,t||this.tipPosition,!t)}}}},"undefined"!=typeof Leap&&Leap.Controller?Leap.Controller.plugin("screenPosition",e):t.exports.screenPosition=e}).call(this)},function(t,e){(function(){Leap.plugin("transform",function(t){var e,n,r,i,o,a;return null==t&&(t={}),e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=new THREE.Matrix4,!0===t.vr&&(this.setOptimizeHMD(!0),t.quaternion=(new THREE.Quaternion).setFromRotationMatrix((new THREE.Matrix4).set(-1,0,0,0,0,0,-1,0,0,-1,0,0,0,0,0,1)),t.scale=.001,t.position=new THREE.Vector3(0,0,-.08)),"desktop"===t.vr&&(t.scale=.001),t.getTransform=function(n){var r;return t.matrix?(r="function"==typeof t.matrix?t.matrix(n):t.matrix,window.THREE&&r instanceof THREE.Matrix4?r.elements:r):t.position||t.quaternion||t.scale?(a.set.apply(a,e),t.quaternion&&a.makeRotationFromQuaternion("function"==typeof t.quaternion?t.quaternion(n):t.quaternion),t.position&&a.setPosition("function"==typeof t.position?t.position(n):t.position),a.elements):e},t.getScale=function(e){return isNaN(t.scale)||(t.scale=new THREE.Vector3(t.scale,t.scale,t.scale)),"function"==typeof t.scale?t.scale(e):t.scale},i=function(t,e){var n,r,i,o;for(o=[],r=0,i=e.length;r<i;r++)(n=e[r])?o.push(Leap.vec3.transformMat4(n,n,t)):o.push(void 0);return o},r=function(t,e,n){var r,i,o;return r=e[0],i=e[1],o=e[2],t[0]=n[0]*r+n[4]*i+n[8]*o,t[1]=n[1]*r+n[5]*i+n[9]*o,t[2]=n[2]*r+n[6]*i+n[10]*o,t},n=function(t,e){var n,i,o,a;for(a=[],i=0,o=e.length;i<o;i++)(n=e[i])?a.push(r(n,n,t)):a.push(void 0);return a},o=function(t,e,r){var o,a,s,h,u,c,l,f;for(n(e,[t.direction,t.palmNormal,t.palmVelocity,t.arm.basis[0],t.arm.basis[1],t.arm.basis[2]]),s=0,u=(l=t.fingers).length;s<u;s++)o=l[s],n(e,[o.direction,o.metacarpal.basis[0],o.metacarpal.basis[1],o.metacarpal.basis[2],o.proximal.basis[0],o.proximal.basis[1],o.proximal.basis[2],o.medial.basis[0],o.medial.basis[1],o.medial.basis[2],o.distal.basis[0],o.distal.basis[1],o.distal.basis[2]]);for(Leap.glMatrix.mat4.scale(e,e,r),i(e,[t.palmPosition,t.stabilizedPalmPosition,t.sphereCenter,t.arm.nextJoint,t.arm.prevJoint]),h=0,c=(f=t.fingers).length;h<c;h++)o=f[h],i(e,[o.carpPosition,o.mcpPosition,o.pipPosition,o.dipPosition,o.distal.nextJoint,o.tipPosition]);return a=(r[0]+r[1]+r[2])/3,t.arm.width*=a},{frame:function(e){var n,r,i,a,s,h,u,c,l,f;if(e.valid&&!e.data.transformed){for(e.data.transformed=!0,f=[],a=0,h=(c=e.hands).length;a<h;a++){for(r=c[a],o(r,t.getTransform(r),(t.getScale(r)||new THREE.Vector3(1,1,1)).toArray()),t.effectiveParent&&o(r,t.effectiveParent.matrixWorld.elements,t.effectiveParent.scale.toArray()),i=null,s=0,u=(l=r.fingers).length;s<u;s++)n=l[s],i=Leap.vec3.create(),Leap.vec3.sub(i,n.mcpPosition,n.carpPosition),n.metacarpal.length=Leap.vec3.length(i),Leap.vec3.sub(i,n.pipPosition,n.mcpPosition),n.proximal.length=Leap.vec3.length(i),Leap.vec3.sub(i,n.dipPosition,n.pipPosition),n.medial.length=Leap.vec3.length(i),Leap.vec3.sub(i,n.tipPosition,n.dipPosition),n.distal.length=Leap.vec3.length(i);Leap.vec3.sub(i,r.arm.prevJoint,r.arm.nextJoint),f.push(r.arm.length=Leap.vec3.length(i))}return f}}}})}).call(this)},function(t,e,n){"use strict";n.r(e);var r=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},i=function(t){var e;return 1===t.length&&(e=t,t=function(t,n){return r(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}};var o=i(r);o.right,o.left;var a=Array.prototype;a.slice,a.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);var s=function(t){for(var e,n,r,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(n=new Array(a);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--a]=r[e];return n};Array.prototype.slice;var h={value:function(){}};function u(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r)throw new Error("illegal type: "+t);r[t]=[]}return new c(r)}function c(t){this._=t}function l(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function f(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=h,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}c.prototype=u.prototype={constructor:c,on:function(t,e){var n,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=o[a]).type)i[n]=f(i[n],t.name,e);else if(null==e)for(n in i)i[n]=f(i[n],t.name,null);return this}for(;++a<s;)if((n=(t=o[a]).type)&&(n=l(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new c(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var p=u,d="http://www.w3.org/1999/xhtml",m={svg:"http://www.w3.org/2000/svg",xhtml:d,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},g=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),m.hasOwnProperty(e)?{space:m[e],local:t}:t};var v=function(t){var e=g(t);return(e.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===d&&e.documentElement.namespaceURI===d?e.createElement(t):e.createElementNS(n,t)}})(e)};function _(){}var b=function(t){return null==t?_:function(){return this.querySelector(t)}};function w(){return[]}var M=function(t){return null==t?w:function(){return this.querySelectorAll(t)}},A=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var S=document.documentElement;if(!S.matches){var C=S.webkitMatchesSelector||S.msMatchesSelector||S.mozMatchesSelector||S.oMatchesSelector;A=function(t){return function(){return C.call(this,t)}}}}var T=A,E=function(t){return new Array(t.length)};function L(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}L.prototype={constructor:L,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var P="$";function D(t,e,n,r,i,o){for(var a,s=0,h=e.length,u=o.length;s<u;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new L(t,o[s]);for(;s<h;++s)(a=e[s])&&(i[s]=a)}function R(t,e,n,r,i,o,a){var s,h,u,c={},l=e.length,f=o.length,p=new Array(l);for(s=0;s<l;++s)(h=e[s])&&(p[s]=u=P+a.call(h,h.__data__,s,e),u in c?i[s]=h:c[u]=h);for(s=0;s<f;++s)(h=c[u=P+a.call(t,o[s],s,o)])?(r[s]=h,h.__data__=o[s],c[u]=null):n[s]=new L(t,o[s]);for(s=0;s<l;++s)(h=e[s])&&c[p[s]]===h&&(i[s]=h)}function F(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var k=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function B(t,e){return t.style.getPropertyValue(e)||k(t).getComputedStyle(t,null).getPropertyValue(e)}function z(t){return t.trim().split(/^|\s+/)}function N(t){return t.classList||new U(t)}function U(t){this._node=t,this._names=z(t.getAttribute("class")||"")}function I(t,e){for(var n=N(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function O(t,e){for(var n=N(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}U.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function V(){this.textContent=""}function H(){this.innerHTML=""}function G(){this.nextSibling&&this.parentNode.appendChild(this)}function j(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function W(){return null}function X(){var t=this.parentNode;t&&t.removeChild(this)}function q(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function Q(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var Y={},K=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(Y={mouseenter:"mouseover",mouseleave:"mouseout"}));function J(t,e,n){return t=Z(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function Z(t,e,n){return function(r){var i=K;K=r;try{t.call(this,this.__data__,e,n)}finally{K=i}}}function $(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function tt(t,e,n){var r=Y.hasOwnProperty(t.type)?J:Z;return function(i,o,a){var s,h=this.__on,u=r(e,o,a);if(h)for(var c=0,l=h.length;c<l;++c)if((s=h[c]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=u,s.capture=n),void(s.value=e);this.addEventListener(t.type,u,n),s={type:t.type,name:t.name,value:e,listener:u,capture:n},h?h.push(s):this.__on=[s]}}function et(t,e,n,r){var i=K;t.sourceEvent=K,K=t;try{return e.apply(n,r)}finally{K=i}}function nt(t,e,n){var r=k(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}var rt=[null];function it(t,e){this._groups=t,this._parents=e}function ot(){return new it([[document.documentElement]],rt)}it.prototype=ot.prototype={constructor:it,select:function(t){"function"!=typeof t&&(t=b(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,s=e[i],h=s.length,u=r[i]=new Array(h),c=0;c<h;++c)(o=s[c])&&(a=t.call(o,o.__data__,c,s))&&("__data__"in o&&(a.__data__=o.__data__),u[c]=a);return new it(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=M(t));for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,s=e[o],h=s.length,u=0;u<h;++u)(a=s[u])&&(r.push(t.call(a,a.__data__,u,s)),i.push(a));return new it(r,i)},filter:function(t){"function"!=typeof t&&(t=T(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,h=r[i]=[],u=0;u<s;++u)(o=a[u])&&t.call(o,o.__data__,u,a)&&h.push(o);return new it(r,this._parents)},data:function(t,e){if(!t)return d=new Array(this.size()),c=-1,this.each(function(t){d[++c]=t}),d;var n,r=e?R:D,i=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var a=o.length,s=new Array(a),h=new Array(a),u=new Array(a),c=0;c<a;++c){var l=i[c],f=o[c],p=f.length,d=t.call(l,l&&l.__data__,c,i),m=d.length,g=h[c]=new Array(m),v=s[c]=new Array(m);r(l,f,g,v,u[c]=new Array(p),d,e);for(var y,x,_=0,b=0;_<m;++_)if(y=g[_]){for(_>=b&&(b=_+1);!(x=v[b])&&++b<m;);y._next=x||null}}return(s=new it(s,i))._enter=h,s._exit=u,s},enter:function(){return new it(this._enter||this._groups.map(E),this._parents)},exit:function(){return new it(this._exit||this._groups.map(E),this._parents)},merge:function(t){for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var h,u=e[s],c=n[s],l=u.length,f=a[s]=new Array(l),p=0;p<l;++p)(h=u[p]||c[p])&&(f[p]=h);for(;s<r;++s)a[s]=e[s];return new it(a,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&a!==r.nextSibling&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=F);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],h=s.length,u=i[o]=new Array(h),c=0;c<h;++c)(a=s[c])&&(u[c]=a);u.sort(e)}return new it(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,s=o.length;a<s;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=g(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof e?n.local?function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}:function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}:n.local?function(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}:function(t,e){return function(){this.setAttribute(t,e)}})(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof e?function(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}:function(t,e,n){return function(){this.style.setProperty(t,e,n)}})(t,e,null==n?"":n)):B(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?function(t){return function(){delete this[t]}}:"function"==typeof e?function(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}:function(t,e){return function(){this[t]=e}})(t,e)):this.node()[t]},classed:function(t,e){var n=z(t+"");if(arguments.length<2){for(var r=N(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?function(t,e){return function(){(e.apply(this,arguments)?I:O)(this,t)}}:e?function(t){return function(){I(this,t)}}:function(t){return function(){O(this,t)}})(n,e))},text:function(t){return arguments.length?this.each(null==t?V:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?H:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(G)},lower:function(){return this.each(j)},append:function(t){var e="function"==typeof t?t:v(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:v(t),r=null==e?W:"function"==typeof e?e:b(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(X)},clone:function(t){return this.select(t?Q:q)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?tt:$,null==n&&(n=!1),r=0;r<a;++r)this.each(s(o[r],e,n));return this}var s=this.node().__on;if(s)for(var h,u=0,c=s.length;u<c;++u)for(r=0,h=s[u];r<a;++r)if((i=o[r]).type===h.type&&i.name===h.name)return h.value},dispatch:function(t,e){return this.each(("function"==typeof e?function(t,e){return function(){return nt(this,t,e.apply(this,arguments))}}:function(t,e){return function(){return nt(this,t,e)}})(t,e))}};var at=ot,st=function(t){return"string"==typeof t?new it([[document.querySelector(t)]],[document.documentElement]):new it([[t]],rt)},ht=0;function ut(){this._="@"+(++ht).toString(36)}ut.prototype=function(){return new ut}.prototype={constructor:ut,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var ct=function(){for(var t,e=K;t=e.sourceEvent;)e=t;return e},lt=function(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]},ft=function(t){var e=ct();return e.changedTouches&&(e=e.changedTouches[0]),lt(t,e)},pt=function(t){return"string"==typeof t?new it([document.querySelectorAll(t)],[document.documentElement]):new it([null==t?[]:t],rt)},dt=function(t,e,n){arguments.length<3&&(n=e,e=ct().changedTouches);for(var r,i=0,o=e?e.length:0;i<o;++i)if((r=e[i]).identifier===n)return lt(t,r);return null};function mt(){K.stopImmediatePropagation()}var gt=function(){K.preventDefault(),K.stopImmediatePropagation()},vt=function(t){var e=t.document.documentElement,n=st(t).on("dragstart.drag",gt,!0);"onselectstart"in e?n.on("selectstart.drag",gt,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function yt(t,e){var n=t.document.documentElement,r=st(t).on("dragstart.drag",null);e&&(r.on("click.drag",gt,!0),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var xt=function(t){return function(){return t}};function _t(t,e,n,r,i,o,a,s,h,u){this.target=t,this.type=e,this.subject=n,this.identifier=r,this.active=i,this.x=o,this.y=a,this.dx=s,this.dy=h,this._=u}function bt(){return!K.button}function wt(){return this.parentNode}function Mt(t){return null==t?{x:K.x,y:K.y}:t}function At(){return"ontouchstart"in this}_t.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var St=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function Ct(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Tt(){}var Et="\\s*([+-]?\\d+)\\s*",Lt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Dt=/^#([0-9a-f]{3})$/,Rt=/^#([0-9a-f]{6})$/,Ft=new RegExp("^rgb\\("+[Et,Et,Et]+"\\)$"),kt=new RegExp("^rgb\\("+[Pt,Pt,Pt]+"\\)$"),Bt=new RegExp("^rgba\\("+[Et,Et,Et,Lt]+"\\)$"),zt=new RegExp("^rgba\\("+[Pt,Pt,Pt,Lt]+"\\)$"),Nt=new RegExp("^hsl\\("+[Lt,Pt,Pt]+"\\)$"),Ut=new RegExp("^hsla\\("+[Lt,Pt,Pt,Lt]+"\\)$"),It={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ot(t){var e;return t=(t+"").trim().toLowerCase(),(e=Dt.exec(t))?new Wt((e=parseInt(e[1],16))>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):(e=Rt.exec(t))?Vt(parseInt(e[1],16)):(e=Ft.exec(t))?new Wt(e[1],e[2],e[3],1):(e=kt.exec(t))?new Wt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Bt.exec(t))?Ht(e[1],e[2],e[3],e[4]):(e=zt.exec(t))?Ht(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Nt.exec(t))?Xt(e[1],e[2]/100,e[3]/100,1):(e=Ut.exec(t))?Xt(e[1],e[2]/100,e[3]/100,e[4]):It.hasOwnProperty(t)?Vt(It[t]):"transparent"===t?new Wt(NaN,NaN,NaN,0):null}function Vt(t){return new Wt(t>>16&255,t>>8&255,255&t,1)}function Ht(t,e,n,r){return r<=0&&(t=e=n=NaN),new Wt(t,e,n,r)}function Gt(t){return t instanceof Tt||(t=Ot(t)),t?new Wt((t=t.rgb()).r,t.g,t.b,t.opacity):new Wt}function jt(t,e,n,r){return 1===arguments.length?Gt(t):new Wt(t,e,n,null==r?1:r)}function Wt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Xt(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Qt(t,e,n,r)}function qt(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Qt)return new Qt(t.h,t.s,t.l,t.opacity);if(t instanceof Tt||(t=Ot(t)),!t)return new Qt;if(t instanceof Qt)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,h=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=h<.5?o+i:2-o-i,a*=60):s=h>0&&h<1?0:a,new Qt(a,s,h,t.opacity)}(t):new Qt(t,e,n,null==r?1:r)}function Qt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Yt(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}St(Tt,Ot,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),St(Wt,jt,Ct(Tt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Wt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Wt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),St(Qt,qt,Ct(Tt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Qt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Qt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Wt(Yt(t>=240?t-240:t+120,i,r),Yt(t,i,r),Yt(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var Kt=Math.PI/180,Jt=180/Math.PI,Zt=.95047,$t=1,te=1.08883,ee=4/29,ne=6/29,re=3*ne*ne,ie=ne*ne*ne;function oe(t){if(t instanceof se)return new se(t.l,t.a,t.b,t.opacity);if(t instanceof pe){var e=t.h*Kt;return new se(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof Wt||(t=Gt(t));var n=le(t.r),r=le(t.g),i=le(t.b),o=he((.4124564*n+.3575761*r+.1804375*i)/Zt),a=he((.2126729*n+.7151522*r+.072175*i)/$t);return new se(116*a-16,500*(o-a),200*(a-he((.0193339*n+.119192*r+.9503041*i)/te)),t.opacity)}function ae(t,e,n,r){return 1===arguments.length?oe(t):new se(t,e,n,null==r?1:r)}function se(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function he(t){return t>ie?Math.pow(t,1/3):t/re+ee}function ue(t){return t>ne?t*t*t:re*(t-ee)}function ce(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function le(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function fe(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof pe)return new pe(t.h,t.c,t.l,t.opacity);t instanceof se||(t=oe(t));var e=Math.atan2(t.b,t.a)*Jt;return new pe(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}(t):new pe(t,e,n,null==r?1:r)}function pe(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}St(se,ae,Ct(Tt,{brighter:function(t){return new se(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new se(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=$t*ue(t),new Wt(ce(3.2404542*(e=Zt*ue(e))-1.5371385*t-.4985314*(n=te*ue(n))),ce(-.969266*e+1.8760108*t+.041556*n),ce(.0556434*e-.2040259*t+1.0572252*n),this.opacity)}})),St(pe,fe,Ct(Tt,{brighter:function(t){return new pe(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new pe(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return oe(this).rgb()}}));var de=-.29227,me=-.90649,ge=1.97294,ve=ge*me,ye=1.78277*ge,xe=1.78277*de- -.14861*me;function _e(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof be)return new be(t.h,t.s,t.l,t.opacity);t instanceof Wt||(t=Gt(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(xe*r+ve*e-ye*n)/(xe+ve-ye),o=r-i,a=(ge*(n-i)-de*o)/me,s=Math.sqrt(a*a+o*o)/(ge*i*(1-i)),h=s?Math.atan2(a,o)*Jt-120:NaN;return new be(h<0?h+360:h,s,i,t.opacity)}(t):new be(t,e,n,null==r?1:r)}function be(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function we(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}St(be,_e,Ct(Tt,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new be(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new be(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Kt,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new Wt(255*(e+n*(-.14861*r+1.78277*i)),255*(e+n*(de*r+me*i)),255*(e+n*(ge*r)),this.opacity)}}));var Me=function(t){return function(){return t}};function Ae(t,e){return function(n){return t+n*e}}function Se(t,e){var n=e-t;return n?Ae(t,n>180||n<-180?n-360*Math.round(n/360):n):Me(isNaN(t)?e:t)}function Ce(t){return 1==(t=+t)?Te:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Me(isNaN(e)?n:e)}}function Te(t,e){var n=e-t;return n?Ae(t,n):Me(isNaN(t)?e:t)}var Ee=function t(e){var n=Ce(e);function r(t,e){var r=n((t=jt(t)).r,(e=jt(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=Te(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function Le(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=jt(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}Le(function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return we((n-r/e)*e,a,i,o,s)}}),Le(function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return we((n-r/e)*e,i,o,a,s)}});var Pe=function(t,e){return e-=t=+t,function(n){return t+e*n}},De=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Re=new RegExp(De.source,"g");var Fe,ke,Be,ze,Ne=function(t,e){var n,r,i,o=De.lastIndex=Re.lastIndex=0,a=-1,s=[],h=[];for(t+="",e+="";(n=De.exec(t))&&(r=Re.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,h.push({i:a,x:Pe(n,r)})),o=Re.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?h[0]?function(t){return function(e){return t(e)+""}}(h[0].x):function(t){return function(){return t}}(e):(e=h.length,function(t){for(var n,r=0;r<e;++r)s[(n=h[r]).i]=n.x(t);return s.join("")})},Ue=180/Math.PI,Ie={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},Oe=function(t,e,n,r,i,o){var a,s,h;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(h=t*n+e*r)&&(n-=t*h,r-=e*h),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,h/=s),t*r<e*n&&(t=-t,e=-e,h=-h,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*Ue,skewX:Math.atan(h)*Ue,scaleX:a,scaleY:s}};function Ve(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],h=[];return o=t(o),a=t(a),function(t,r,i,o,a,s){if(t!==i||r!==o){var h=a.push("translate(",null,e,null,n);s.push({i:h-4,x:Pe(t,i)},{i:h-2,x:Pe(r,o)})}else(i||o)&&a.push("translate("+i+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,h),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Pe(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,a.rotate,s,h),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Pe(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,a.skewX,s,h),function(t,e,n,r,o,a){if(t!==n||e!==r){var s=o.push(i(o)+"scale(",null,",",null,")");a.push({i:s-4,x:Pe(t,n)},{i:s-2,x:Pe(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,h),o=a=null,function(t){for(var e,n=-1,r=h.length;++n<r;)s[(e=h[n]).i]=e.x(t);return s.join("")}}}var He=Ve(function(t){return"none"===t?Ie:(Fe||(Fe=document.createElement("DIV"),ke=document.documentElement,Be=document.defaultView),Fe.style.transform=t,t=Be.getComputedStyle(ke.appendChild(Fe),null).getPropertyValue("transform"),ke.removeChild(Fe),t=t.slice(7,-1).split(","),Oe(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))},"px, ","px)","deg)"),Ge=Ve(function(t){return null==t?Ie:(ze||(ze=document.createElementNS("http://www.w3.org/2000/svg","g")),ze.setAttribute("transform",t),(t=ze.transform.baseVal.consolidate())?(t=t.matrix,Oe(t.a,t.b,t.c,t.d,t.e,t.f)):Ie)},", ",")",")");Math.SQRT2;function je(t){return function(e,n){var r=t((e=qt(e)).h,(n=qt(n)).h),i=Te(e.s,n.s),o=Te(e.l,n.l),a=Te(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=i(t),e.l=o(t),e.opacity=a(t),e+""}}}je(Se),je(Te);function We(t){return function(e,n){var r=t((e=fe(e)).h,(n=fe(n)).h),i=Te(e.c,n.c),o=Te(e.l,n.l),a=Te(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=o(t),e.opacity=a(t),e+""}}}We(Se),We(Te);function Xe(t){return function e(n){function r(e,r){var i=t((e=_e(e)).h,(r=_e(r)).h),o=Te(e.s,r.s),a=Te(e.l,r.l),s=Te(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=s(t),e+""}}return n=+n,r.gamma=e,r}(1)}Xe(Se);var qe,Qe,Ye=Xe(Te),Ke=0,Je=0,Ze=0,$e=1e3,tn=0,en=0,nn=0,rn="object"==typeof performance&&performance.now?performance:Date,on="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function an(){return en||(on(sn),en=rn.now()+nn)}function sn(){en=0}function hn(){this._call=this._time=this._next=null}function un(t,e,n){var r=new hn;return r.restart(t,e,n),r}function cn(){en=(tn=rn.now())+nn,Ke=Je=0;try{!function(){an(),++Ke;for(var t,e=qe;e;)(t=en-e._time)>=0&&e._call.call(null,t),e=e._next;--Ke}()}finally{Ke=0,function(){var t,e,n=qe,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:qe=e);Qe=t,fn(r)}(),en=0}}function ln(){var t=rn.now(),e=t-tn;e>$e&&(nn-=e,tn=t)}function fn(t){Ke||(Je&&(Je=clearTimeout(Je)),t-en>24?(t<1/0&&(Je=setTimeout(cn,t-rn.now()-nn)),Ze&&(Ze=clearInterval(Ze))):(Ze||(tn=rn.now(),Ze=setInterval(ln,$e)),Ke=1,on(cn)))}hn.prototype=un.prototype={constructor:hn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?an():+n)+(null==e?0:+e),this._next||Qe===this||(Qe?Qe._next=this:qe=this,Qe=this),this._call=t,this._time=n,fn()},stop:function(){this._call&&(this._call=null,this._time=1/0,fn())}};var pn=function(t,e,n){var r=new hn;return e=null==e?0:+e,r.restart(function(n){r.stop(),t(n+e)},e,n),r},dn=p("start","end","interrupt"),mn=[],gn=0,vn=1,yn=2,xn=3,_n=4,bn=5,wn=6,Mn=function(t,e,n,r,i,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function o(h){var u,c,l,f;if(n.state!==vn)return s();for(u in i)if((f=i[u]).name===n.name){if(f.state===xn)return pn(o);f.state===_n?(f.state=wn,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete i[u]):+u<e&&(f.state=wn,f.timer.stop(),delete i[u])}if(pn(function(){n.state===xn&&(n.state=_n,n.timer.restart(a,n.delay,n.time),a(h))}),n.state=yn,n.on.call("start",t,t.__data__,n.index,n.group),n.state===yn){for(n.state=xn,r=new Array(l=n.tween.length),u=0,c=-1;u<l;++u)(f=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++c]=f);r.length=c+1}}function a(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=bn,1),o=-1,a=r.length;++o<a;)r[o].call(null,i);n.state===bn&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var r in n.state=wn,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=un(function(t){n.state=vn,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)},0,n.time)}(t,n,{name:e,index:r,group:i,on:dn,tween:mn,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:gn})};function An(t,e){var n=Cn(t,e);if(n.state>gn)throw new Error("too late; already scheduled");return n}function Sn(t,e){var n=Cn(t,e);if(n.state>yn)throw new Error("too late; already started");return n}function Cn(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}var Tn=function(t,e){var n,r,i,o=t.__transition,a=!0;if(o){for(i in e=null==e?null:e+"",o)(n=o[i]).name===e?(r=n.state>yn&&n.state<bn,n.state=wn,n.timer.stop(),r&&n.on.call("interrupt",t,t.__data__,n.index,n.group),delete o[i]):a=!1;a&&delete t.__transition}};function En(t,e,n){var r=t._id;return t.each(function(){var t=Sn(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return Cn(t,r).value[e]}}var Ln=function(t,e){var n;return("number"==typeof e?Pe:e instanceof Ot?Ee:(n=Ot(e))?(e=n,Ee):Ne)(t,e)};var Pn=at.prototype.constructor;var Dn=0;function Rn(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Fn(){return++Dn}var kn=at.prototype;Rn.prototype=function(t){return at().transition(t)}.prototype={constructor:Rn,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=b(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var s,h,u=r[a],c=u.length,l=o[a]=new Array(c),f=0;f<c;++f)(s=u[f])&&(h=t.call(s,s.__data__,f,u))&&("__data__"in s&&(h.__data__=s.__data__),l[f]=h,Mn(l[f],e,n,f,l,Cn(s,n)));return new Rn(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=M(t));for(var r=this._groups,i=r.length,o=[],a=[],s=0;s<i;++s)for(var h,u=r[s],c=u.length,l=0;l<c;++l)if(h=u[l]){for(var f,p=t.call(h,h.__data__,l,u),d=Cn(h,n),m=0,g=p.length;m<g;++m)(f=p[m])&&Mn(f,e,n,m,p,d);o.push(p),a.push(h)}return new Rn(o,a,e,n)},filter:function(t){"function"!=typeof t&&(t=T(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,h=r[i]=[],u=0;u<s;++u)(o=a[u])&&t.call(o,o.__data__,u,a)&&h.push(o);return new Rn(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var h,u=e[s],c=n[s],l=u.length,f=a[s]=new Array(l),p=0;p<l;++p)(h=u[p]||c[p])&&(f[p]=h);for(;s<r;++s)a[s]=e[s];return new Rn(a,this._parents,this._name,this._id)},selection:function(){return new Pn(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Fn(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],h=s.length,u=0;u<h;++u)if(a=s[u]){var c=Cn(a,e);Mn(a,t,n,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Rn(r,this._parents,t,n)},call:kn.call,nodes:kn.nodes,node:kn.node,size:kn.size,empty:kn.empty,each:kn.each,on:function(t,e){var n=this._id;return arguments.length<2?Cn(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?An:Sn;return function(){var a=o(this,t),s=a.on;s!==r&&(i=(r=s).copy()).on(e,n),a.on=i}}(n,t,e))},attr:function(t,e){var n=g(t),r="transform"===n?Ge:Ln;return this.attrTween(t,"function"==typeof e?(n.local?function(t,e,n){var r,i,o;return function(){var a,s=n(this);if(null!=s)return(a=this.getAttributeNS(t.space,t.local))===s?null:a===r&&s===i?o:o=e(r=a,i=s);this.removeAttributeNS(t.space,t.local)}}:function(t,e,n){var r,i,o;return function(){var a,s=n(this);if(null!=s)return(a=this.getAttribute(t))===s?null:a===r&&s===i?o:o=e(r=a,i=s);this.removeAttribute(t)}})(n,r,En(this,"attr."+t,e)):null==e?(n.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}})(n):(n.local?function(t,e,n){var r,i;return function(){var o=this.getAttributeNS(t.space,t.local);return o===n?null:o===r?i:i=e(r=o,n)}}:function(t,e,n){var r,i;return function(){var o=this.getAttribute(t);return o===n?null:o===r?i:i=e(r=o,n)}})(n,r,e+""))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=g(t);return this.tween(n,(r.local?function(t,e){function n(){var n=this,r=e.apply(n,arguments);return r&&function(e){n.setAttributeNS(t.space,t.local,r(e))}}return n._value=e,n}:function(t,e){function n(){var n=this,r=e.apply(n,arguments);return r&&function(e){n.setAttribute(t,r(e))}}return n._value=e,n})(r,e))},style:function(t,e,n){var r="transform"==(t+="")?He:Ln;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var o=B(this,t),a=(this.style.removeProperty(t),B(this,t));return o===a?null:o===n&&a===r?i:i=e(n=o,r=a)}}(t,r)).on("end.style."+t,function(t){return function(){this.style.removeProperty(t)}}(t)):this.styleTween(t,"function"==typeof e?function(t,e,n){var r,i,o;return function(){var a=B(this,t),s=n(this);return null==s&&(this.style.removeProperty(t),s=B(this,t)),a===s?null:a===r&&s===i?o:o=e(r=a,i=s)}}(t,r,En(this,"style."+t,e)):function(t,e,n){var r,i;return function(){var o=B(this,t);return o===n?null:o===r?i:i=e(r=o,n)}}(t,r,e+""),n)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){function r(){var r=this,i=e.apply(r,arguments);return i&&function(e){r.style.setProperty(t,i(e),n)}}return r._value=e,r}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(En(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=Cn(this.node(),n).tween,o=0,a=i.length;o<a;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==e?function(t,e){var n,r;return function(){var i=Sn(this,t),o=i.tween;if(o!==n)for(var a=0,s=(r=n=o).length;a<s;++a)if(r[a].name===e){(r=r.slice()).splice(a,1);break}i.tween=r}}:function(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=Sn(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var s={name:e,value:n},h=0,u=i.length;h<u;++h)if(i[h].name===e){i[h]=s;break}h===u&&i.push(s)}o.tween=i}})(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){An(this,t).delay=+e.apply(this,arguments)}}:function(t,e){return e=+e,function(){An(this,t).delay=e}})(e,t)):Cn(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){Sn(this,t).duration=+e.apply(this,arguments)}}:function(t,e){return e=+e,function(){Sn(this,t).duration=e}})(e,t)):Cn(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Sn(this,t).ease=e}}(e,t)):Cn(this.node(),e).ease}};(function t(e){function n(t){return Math.pow(t,e)}return e=+e,n.exponent=t,n})(3),function t(e){function n(t){return 1-Math.pow(1-t,e)}return e=+e,n.exponent=t,n}(3),function t(e){function n(t){return((t*=2)<=1?Math.pow(t,e):2-Math.pow(2-t,e))/2}return e=+e,n.exponent=t,n}(3),Math.PI;(function t(e){function n(t){return t*t*((e+1)*t-e)}return e=+e,n.overshoot=t,n})(1.70158),function t(e){function n(t){return--t*t*((e+1)*t+e)+1}return e=+e,n.overshoot=t,n}(1.70158),function t(e){function n(t){return((t*=2)<1?t*t*((e+1)*t-e):(t-=2)*t*((e+1)*t+e)+2)/2}return e=+e,n.overshoot=t,n}(1.70158);var Bn=2*Math.PI,zn=(function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=Bn);function i(t){return e*Math.pow(2,10*--t)*Math.sin((r-t)/n)}return i.amplitude=function(e){return t(e,n*Bn)},i.period=function(n){return t(e,n)},i}(1,.3),function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=Bn);function i(t){return 1-e*Math.pow(2,-10*(t=+t))*Math.sin((t+r)/n)}return i.amplitude=function(e){return t(e,n*Bn)},i.period=function(n){return t(e,n)},i}(1,.3),function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=Bn);function i(t){return((t=2*t-1)<0?e*Math.pow(2,10*t)*Math.sin((r-t)/n):2-e*Math.pow(2,-10*t)*Math.sin((r+t)/n))/2}return i.amplitude=function(e){return t(e,n*Bn)},i.period=function(n){return t(e,n)},i}(1,.3),{time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}});function Nn(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))return zn.time=an(),zn;return n}at.prototype.interrupt=function(t){return this.each(function(){Tn(this,t)})},at.prototype.transition=function(t){var e,n;t instanceof Rn?(e=t._id,t=t._name):(e=Fn(),(n=zn).time=an(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],h=s.length,u=0;u<h;++u)(a=s[u])&&Mn(a,t,e,u,s,n||Nn(a,e));return new Rn(r,this._parents,t,e)};["e","w"].map(Un),["n","s"].map(Un),["n","e","s","w","nw","ne","se","sw"].map(Un);function Un(t){return{type:t}}Math.cos,Math.sin,Math.PI,Math.max;Array.prototype.slice;var In=Math.PI,On=2*In,Vn=On-1e-6;function Hn(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Gn(){return new Hn}Hn.prototype=Gn.prototype={constructor:Hn,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,i,o){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(t,e,n,r,i){t=+t,e=+e,n=+n,r=+r,i=+i;var o=this._x1,a=this._y1,s=n-t,h=r-e,u=o-t,c=a-e,l=u*u+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(l>1e-6)if(Math.abs(c*s-h*u)>1e-6&&i){var f=n-o,p=r-a,d=s*s+h*h,m=f*f+p*p,g=Math.sqrt(d),v=Math.sqrt(l),y=i*Math.tan((In-Math.acos((d+l-m)/(2*g*v)))/2),x=y/v,_=y/g;Math.abs(x-1)>1e-6&&(this._+="L"+(t+x*u)+","+(e+x*c)),this._+="A"+i+","+i+",0,0,"+ +(c*f>u*p)+","+(this._x1=t+_*s)+","+(this._y1=e+_*h)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,r,i,o){t=+t,e=+e;var a=(n=+n)*Math.cos(r),s=n*Math.sin(r),h=t+a,u=e+s,c=1^o,l=o?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+h+","+u:(Math.abs(this._x1-h)>1e-6||Math.abs(this._y1-u)>1e-6)&&(this._+="L"+h+","+u),n&&(l<0&&(l=l%On+On),l>Vn?this._+="A"+n+","+n+",0,1,"+c+","+(t-a)+","+(e-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=h)+","+(this._y1=u):l>1e-6&&(this._+="A"+n+","+n+",0,"+ +(l>=In)+","+c+","+(this._x1=t+n*Math.cos(i))+","+(this._y1=e+n*Math.sin(i))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};function jn(){}function Wn(t,e){var n=new jn;if(t instanceof jn)t.each(function(t,e){n.set(e,t)});else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}jn.prototype=Wn.prototype={constructor:jn,has:function(t){return"$"+t in this},get:function(t){return this["$"+t]},set:function(t,e){return this["$"+t]=e,this},remove:function(t){var e="$"+t;return e in this&&delete this[e]},clear:function(){for(var t in this)"$"===t[0]&&delete this[t]},keys:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)"$"===e[0]&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)"$"===e[0]&&++t;return t},empty:function(){for(var t in this)if("$"===t[0])return!1;return!0},each:function(t){for(var e in this)"$"===e[0]&&t(this[e],e.slice(1),this)}};var Xn=Wn;function qn(){}var Qn=Xn.prototype;function Yn(t,e){var n=new qn;if(t instanceof qn)t.each(function(t){n.add(t)});else if(t){var r=-1,i=t.length;if(null==e)for(;++r<i;)n.add(t[r]);else for(;++r<i;)n.add(e(t[r],r,t))}return n}qn.prototype=Yn.prototype={constructor:qn,has:Qn.has,add:function(t){return this["$"+(t+="")]=t,this},remove:Qn.remove,clear:Qn.clear,values:Qn.keys,size:Qn.size,empty:Qn.empty,each:Qn.each};var Kn={},Jn={},Zn=34,$n=10,tr=13;function er(t){return new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}")}var nr=function(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,s=0,h=o<=0,u=!1;function c(){if(h)return Jn;if(u)return u=!1,Kn;var e,r,i=a;if(t.charCodeAt(i)===Zn){for(;a++<o&&t.charCodeAt(a)!==Zn||t.charCodeAt(++a)===Zn;);return(e=a)>=o?h=!0:(r=t.charCodeAt(a++))===$n?u=!0:r===tr&&(u=!0,t.charCodeAt(a)===$n&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if((r=t.charCodeAt(e=a++))===$n)u=!0;else if(r===tr)u=!0,t.charCodeAt(a)===$n&&++a;else if(r!==n)continue;return t.slice(i,e)}return h=!0,t.slice(i,o)}for(t.charCodeAt(o-1)===$n&&--o,t.charCodeAt(o-1)===tr&&--o;(r=c())!==Jn;){for(var l=[];r!==Kn&&r!==Jn;)l.push(r),r=c();e&&null==(l=e(l,s++))||i.push(l)}return i}function i(e){return e.map(o).join(t)}function o(t){return null==t?"":e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,o=r(t,function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=er(t);return function(r,i){return e(n(r),i,t)}}(t,e):er(t)});return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=function(t){var e=Object.create(null),n=[];return t.forEach(function(t){for(var r in t)r in e||n.push(e[r]=r)}),n}(e)),[n.map(o).join(t)].concat(e.map(function(e){return n.map(function(t){return o(e[t])}).join(t)})).join("\n")},formatRows:function(t){return t.map(i).join("\n")}}},rr=nr(","),ir=rr.parse,or=(rr.parseRows,rr.format,rr.formatRows,nr("\t")),ar=or.parse,sr=(or.parseRows,or.format,or.formatRows,function(t){return function(){return t}}),hr=function(){return 1e-6*(Math.random()-.5)};function ur(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,s,h,u,c,l,f,p=t._root,d={data:r},m=t._x0,g=t._y0,v=t._x1,y=t._y1;if(!p)return t._root=d,t;for(;p.length;)if((u=e>=(o=(m+v)/2))?m=o:v=o,(c=n>=(a=(g+y)/2))?g=a:y=a,i=p,!(p=p[l=c<<1|u]))return i[l]=d,t;if(s=+t._x.call(null,p.data),h=+t._y.call(null,p.data),e===s&&n===h)return d.next=p,i?i[l]=d:t._root=d,t;do{i=i?i[l]=new Array(4):t._root=new Array(4),(u=e>=(o=(m+v)/2))?m=o:v=o,(c=n>=(a=(g+y)/2))?g=a:y=a}while((l=c<<1|u)==(f=(h>=a)<<1|s>=o));return i[f]=p,i[l]=d,t}var cr=function(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i};function lr(t){return t[0]}function fr(t){return t[1]}function pr(t,e,n){var r=new dr(null==e?lr:e,null==n?fr:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function dr(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function mr(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var gr=pr.prototype=dr.prototype;gr.copy=function(){var t,e,n=new dr(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=mr(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=mr(e));return n},gr.add=function(t){var e=+this._x.call(null,t),n=+this._y.call(null,t);return ur(this.cover(e,n),e,n,t)},gr.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),s=new Array(o),h=1/0,u=1/0,c=-1/0,l=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,s[n]=i,r<h&&(h=r),r>c&&(c=r),i<u&&(u=i),i>l&&(l=i));for(c<h&&(h=this._x0,c=this._x1),l<u&&(u=this._y0,l=this._y1),this.cover(h,u).cover(c,l),n=0;n<o;++n)ur(this,a[n],s[n],t[n]);return this},gr.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{if(!(n>t||t>i||r>e||e>o))return this;var a,s,h=i-n,u=this._root;switch(s=(e<(r+o)/2)<<1|t<(n+i)/2){case 0:do{(a=new Array(4))[s]=u,u=a}while(o=r+(h*=2),t>(i=n+h)||e>o);break;case 1:do{(a=new Array(4))[s]=u,u=a}while(o=r+(h*=2),(n=i-h)>t||e>o);break;case 2:do{(a=new Array(4))[s]=u,u=a}while(r=o-(h*=2),t>(i=n+h)||r>e);break;case 3:do{(a=new Array(4))[s]=u,u=a}while(r=o-(h*=2),(n=i-h)>t||r>e)}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},gr.data=function(){var t=[];return this.visit(function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}),t},gr.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},gr.find=function(t,e,n){var r,i,o,a,s,h,u,c=this._x0,l=this._y0,f=this._x1,p=this._y1,d=[],m=this._root;for(m&&d.push(new cr(m,c,l,f,p)),null==n?n=1/0:(c=t-n,l=e-n,f=t+n,p=e+n,n*=n);h=d.pop();)if(!(!(m=h.node)||(i=h.x0)>f||(o=h.y0)>p||(a=h.x1)<c||(s=h.y1)<l))if(m.length){var g=(i+a)/2,v=(o+s)/2;d.push(new cr(m[3],g,v,a,s),new cr(m[2],i,v,g,s),new cr(m[1],g,o,a,v),new cr(m[0],i,o,g,v)),(u=(e>=v)<<1|t>=g)&&(h=d[d.length-1],d[d.length-1]=d[d.length-1-u],d[d.length-1-u]=h)}else{var y=t-+this._x.call(null,m.data),x=e-+this._y.call(null,m.data),_=y*y+x*x;if(_<n){var b=Math.sqrt(n=_);c=t-b,l=e-b,f=t+b,p=e+b,r=m.data}}return r},gr.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,s,h,u,c,l,f,p=this._root,d=this._x0,m=this._y0,g=this._x1,v=this._y1;if(!p)return this;if(p.length)for(;;){if((u=o>=(s=(d+g)/2))?d=s:g=s,(c=a>=(h=(m+v)/2))?m=h:v=h,e=p,!(p=p[l=c<<1|u]))return this;if(!p.length)break;(e[l+1&3]||e[l+2&3]||e[l+3&3])&&(n=e,f=l)}for(;p.data!==t;)if(r=p,!(p=p.next))return this;return(i=p.next)&&delete p.next,r?(i?r.next=i:delete r.next,this):e?(i?e[l]=i:delete e[l],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[f]=p:this._root=p),this):(this._root=i,this)},gr.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},gr.root=function(){return this._root},gr.size=function(){var t=0;return this.visit(function(e){if(!e.length)do{++t}while(e=e.next)}),t},gr.visit=function(t){var e,n,r,i,o,a,s=[],h=this._root;for(h&&s.push(new cr(h,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(h=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&h.length){var u=(r+o)/2,c=(i+a)/2;(n=h[3])&&s.push(new cr(n,u,c,o,a)),(n=h[2])&&s.push(new cr(n,r,c,u,a)),(n=h[1])&&s.push(new cr(n,u,i,o,c)),(n=h[0])&&s.push(new cr(n,r,i,u,c))}return this},gr.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new cr(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,h=e.x1,u=e.y1,c=(a+h)/2,l=(s+u)/2;(o=i[0])&&n.push(new cr(o,a,s,c,l)),(o=i[1])&&n.push(new cr(o,c,s,h,l)),(o=i[2])&&n.push(new cr(o,a,l,c,u)),(o=i[3])&&n.push(new cr(o,c,l,h,u))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},gr.x=function(t){return arguments.length?(this._x=t,this):this._x},gr.y=function(t){return arguments.length?(this._y=t,this):this._y};function vr(t){return t.index}function yr(t,e){var n=t.get(e);if(!n)throw new Error("missing: "+e);return n}function xr(t){return t.x}function _r(t){return t.y}var br,wr=10,Mr=Math.PI*(3-Math.sqrt(5)),Ar=function(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]},Sr=function(t){return(t=Ar(Math.abs(t)))?t[1]:NaN},Cr=function(t,e){var n=Ar(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")},Tr={"":function(t,e){t:for(var n,r=(t=t.toPrecision(e)).length,i=1,o=-1;i<r;++i)switch(t[i]){case".":o=n=i;break;case"0":0===o&&(o=i),n=i;break;case"e":break t;default:o>0&&(o=0)}return o>0?t.slice(0,o)+t.slice(n+1):t},"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Cr(100*t,e)},r:Cr,s:function(t,e){var n=Ar(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(br=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Ar(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},Er=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;function Lr(t){return new Pr(t)}function Pr(t){if(!(e=Er.exec(t)))throw new Error("invalid format: "+t);var e,n=e[1]||" ",r=e[2]||">",i=e[3]||"-",o=e[4]||"",a=!!e[5],s=e[6]&&+e[6],h=!!e[7],u=e[8]&&+e[8].slice(1),c=e[9]||"";"n"===c?(h=!0,c="g"):Tr[c]||(c=""),(a||"0"===n&&"="===r)&&(a=!0,n="0",r="="),this.fill=n,this.align=r,this.sign=i,this.symbol=o,this.zero=a,this.width=s,this.comma=h,this.precision=u,this.type=c}Lr.prototype=Pr.prototype,Pr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+this.type};var Dr,Rr=function(t){return t},Fr=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];Dr=function(t){var e,n,r=t.grouping&&t.thousands?(e=t.grouping,n=t.thousands,function(t,r){for(var i=t.length,o=[],a=0,s=e[0],h=0;i>0&&s>0&&(h+s+1>r&&(s=Math.max(1,r-h)),o.push(t.substring(i-=s,i+s)),!((h+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}):Rr,i=t.currency,o=t.decimal,a=t.numerals?function(t){return function(e){return e.replace(/[0-9]/g,function(e){return t[+e]})}}(t.numerals):Rr,s=t.percent||"%";function h(t){var e=(t=Lr(t)).fill,n=t.align,h=t.sign,u=t.symbol,c=t.zero,l=t.width,f=t.comma,p=t.precision,d=t.type,m="$"===u?i[0]:"#"===u&&/[boxX]/.test(d)?"0"+d.toLowerCase():"",g="$"===u?i[1]:/[%p]/.test(d)?s:"",v=Tr[d],y=!d||/[defgprs%]/.test(d);function x(t){var i,s,u,x=m,_=g;if("c"===d)_=v(t)+_,t="";else{var b=(t=+t)<0;if(t=v(Math.abs(t),p),b&&0==+t&&(b=!1),x=(b?"("===h?h:"-":"-"===h||"("===h?"":h)+x,_=("s"===d?Fr[8+br/3]:"")+_+(b&&"("===h?")":""),y)for(i=-1,s=t.length;++i<s;)if(48>(u=t.charCodeAt(i))||u>57){_=(46===u?o+t.slice(i+1):t.slice(i))+_,t=t.slice(0,i);break}}f&&!c&&(t=r(t,1/0));var w=x.length+t.length+_.length,M=w<l?new Array(l-w+1).join(e):"";switch(f&&c&&(t=r(M+t,M.length?l-_.length:1/0),M=""),n){case"<":t=x+t+_+M;break;case"=":t=x+M+t+_;break;case"^":t=M.slice(0,w=M.length>>1)+x+t+_+M.slice(w);break;default:t=M+x+t+_}return a(t)}return p=null==p?d?6:12:/[gprs]/.test(d)?Math.max(1,Math.min(21,p)):Math.max(0,Math.min(20,p)),x.toString=function(){return t+""},x}return{format:h,formatPrefix:function(t,e){var n=h(((t=Lr(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Sr(e)/3))),i=Math.pow(10,-r),o=Fr[8+r/3];return function(t){return n(i*t)+o}}}}({decimal:".",thousands:",",grouping:[3],currency:["$",""]}),Dr.format,Dr.formatPrefix;var kr=function(){return new Br};function Br(){this.reset()}Br.prototype={constructor:Br,reset:function(){this.s=this.t=0},add:function(t){Nr(zr,t,this.t),Nr(this,zr.s,this.s),this.s?this.t+=zr.t:this.s=zr.t},valueOf:function(){return this.s}};var zr=new Br;function Nr(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}var Ur=1e-6,Ir=Math.PI,Or=Ir/2,Vr=Ir/4,Hr=2*Ir,Gr=Ir/180,jr=Math.abs,Wr=Math.atan,Xr=Math.atan2,qr=Math.cos,Qr=(Math.ceil,Math.exp),Yr=(Math.floor,Math.log),Kr=(Math.pow,Math.sin),Jr=(Math.sign,Math.sqrt),Zr=Math.tan;function $r(t){return t>1?0:t<-1?Ir:Math.acos(t)}function ti(t){return t>1?Or:t<-1?-Or:Math.asin(t)}function ei(){}kr(),kr();function ni(t){var e=t[0],n=t[1],r=qr(n);return[r*qr(e),r*Kr(e),Kr(n)]}function ri(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ii(t){var e=Jr(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}kr();function oi(t,e){return[t>Ir?t-Hr:t<-Ir?t+Hr:t,e]}oi.invert=oi;var ai=function(){var t,e=[];return{point:function(e,n){t.push([e,n])},lineStart:function(){e.push(t=[])},lineEnd:ei,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}},si=function(t,e){return jr(t[0]-e[0])<Ur&&jr(t[1]-e[1])<Ur};function hi(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var ui=function(t,e,n,r,i){var o,a,s=[],h=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],a=t[e];if(si(r,a)){for(i.lineStart(),o=0;o<e;++o)i.point((r=t[o])[0],r[1]);i.lineEnd()}else s.push(n=new hi(r,t,null,!0)),h.push(n.o=new hi(r,null,n,!1)),s.push(n=new hi(a,t,null,!1)),h.push(n.o=new hi(a,null,n,!0))}}),s.length){for(h.sort(e),ci(s),ci(h),o=0,a=h.length;o<a;++o)h[o].e=n=!n;for(var u,c,l=s[0];;){for(var f=l,p=!0;f.v;)if((f=f.n)===l)return;u=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(o=0,a=u.length;o<a;++o)i.point((c=u[o])[0],c[1]);else r(f.x,f.n.x,1,i);f=f.n}else{if(p)for(u=f.p.z,o=u.length-1;o>=0;--o)i.point((c=u[o])[0],c[1]);else r(f.x,f.p.x,-1,i);f=f.p}u=(f=f.o).z,p=!p}while(!f.v);i.lineEnd()}}};function ci(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}var li=kr(),fi=function(t,e){var n=e[0],r=e[1],i=[Kr(n),-qr(n),0],o=0,a=0;li.reset();for(var s=0,h=t.length;s<h;++s)if(c=(u=t[s]).length)for(var u,c,l=u[c-1],f=l[0],p=l[1]/2+Vr,d=Kr(p),m=qr(p),g=0;g<c;++g,f=y,d=_,m=b,l=v){var v=u[g],y=v[0],x=v[1]/2+Vr,_=Kr(x),b=qr(x),w=y-f,M=w>=0?1:-1,A=M*w,S=A>Ir,C=d*_;if(li.add(Xr(C*M*Kr(A),m*b+C*qr(A))),o+=S?w+M*Hr:w,S^f>=n^y>=n){var T=ri(ni(l),ni(v));ii(T);var E=ri(i,T);ii(E);var L=(S^w>=0?-1:1)*ti(E[2]);(r>L||r===L&&(T[0]||T[1]))&&(a+=S^w>=0?1:-1)}}return(o<-Ur||o<Ur&&li<-Ur)^1&a},pi=function(t,e,n,r){return function(i){var o,a,h,u=e(i),c=ai(),l=e(c),f=!1,p={point:d,lineStart:g,lineEnd:v,polygonStart:function(){p.point=y,p.lineStart=x,p.lineEnd=_,a=[],o=[]},polygonEnd:function(){p.point=d,p.lineStart=g,p.lineEnd=v,a=s(a);var t=fi(o,r);a.length?(f||(i.polygonStart(),f=!0),ui(a,mi,t,n,i)):t&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),a=o=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(e,n){t(e,n)&&i.point(e,n)}function m(t,e){u.point(t,e)}function g(){p.point=m,u.lineStart()}function v(){p.point=d,u.lineEnd()}function y(t,e){h.push([t,e]),l.point(t,e)}function x(){l.lineStart(),h=[]}function _(){y(h[0][0],h[0][1]),l.lineEnd();var t,e,n,r,s=l.clean(),u=c.result(),p=u.length;if(h.pop(),o.push(h),h=null,p)if(1&s){if((e=(n=u[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),t=0;t<e;++t)i.point((r=n[t])[0],r[1]);i.lineEnd()}}else p>1&&2&s&&u.push(u.pop().concat(u.shift())),a.push(u.filter(di))}return p}};function di(t){return t.length>1}function mi(t,e){return((t=t.x)[0]<0?t[1]-Or-Ur:Or-t[1])-((e=e.x)[0]<0?e[1]-Or-Ur:Or-e[1])}pi(function(){return!0},function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var s=o>0?Ir:-Ir,h=jr(o-n);jr(h-Ir)<Ur?(t.point(n,r=(r+a)/2>0?Or:-Or),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),t.point(o,r),e=0):i!==s&&h>=Ir&&(jr(n-i)<Ur&&(n-=i*Ur),jr(o-s)<Ur&&(o-=s*Ur),r=function(t,e,n,r){var i,o,a=Kr(t-n);return jr(a)>Ur?Wr((Kr(e)*(o=qr(r))*Kr(n)-Kr(r)*(i=qr(e))*Kr(t))/(i*o*a)):(e+r)/2}(n,r,o,a),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),e=0),t.point(n=o,r=a),i=s},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}},function(t,e,n,r){var i;if(null==t)i=n*Or,r.point(-Ir,i),r.point(0,i),r.point(Ir,i),r.point(Ir,0),r.point(Ir,-i),r.point(0,-i),r.point(-Ir,-i),r.point(-Ir,0),r.point(-Ir,i);else if(jr(t[0]-e[0])>Ur){var o=t[0]<e[0]?Ir:-Ir;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])},[-Ir,-Or]);kr();kr(),kr();function gi(t){this._context=t}gi.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Hr)}},result:ei};kr();function vi(){this._string=[]}function yi(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}vi.prototype={_radius:4.5,_circle:yi(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=yi(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};function xi(t){return function(e){var n=new _i;for(var r in t)n[r]=t[r];return n.stream=e,n}}function _i(){}_i.prototype={constructor:_i,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};qr(30*Gr);xi({point:function(t,e){this.stream.point(t*Gr,e*Gr)}});function bi(t){return function(e,n){var r=qr(e),i=qr(n),o=t(r*i);return[o*i*Kr(e),o*Kr(n)]}}function wi(t){return function(e,n){var r=Jr(e*e+n*n),i=t(r),o=Kr(i),a=qr(i);return[Xr(e*o,r*a),ti(r&&n*o/r)]}}var Mi=bi(function(t){return Jr(2/(1+t))});Mi.invert=wi(function(t){return 2*ti(t/2)});var Ai=bi(function(t){return(t=$r(t))&&t/Kr(t)});Ai.invert=wi(function(t){return t});function Si(t,e){return[t,Yr(Zr((Or+e)/2))]}Si.invert=function(t,e){return[t,2*Wr(Qr(e))-Or]};function Ci(t,e){return[t,e]}Ci.invert=Ci;function Ti(t,e){var n=qr(e),r=qr(t)*n;return[n*Kr(t)/r,Kr(e)/r]}Ti.invert=wi(Wr);function Ei(t,e){var n=e*e,r=n*n;return[t*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),e*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}Ei.invert=function(t,e){var n,r=e,i=25;do{var o=r*r,a=o*o;r-=n=(r*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))-e)/(1.007226+o*(.045255+a*(.259866*o-.311325-.005916*11*a)))}while(jr(n)>Ur&&--i>0);return[t/(.8707+(o=r*r)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),r]};function Li(t,e){return[qr(e)*Kr(t),Kr(e)]}Li.invert=wi(ti);function Pi(t,e){var n=qr(e),r=1+qr(t)*n;return[n*Kr(t)/r,Kr(e)/r]}Pi.invert=wi(function(t){return 2*Wr(t)});function Di(t,e){return[Yr(Zr((Or+e)/2)),-t]}Di.invert=function(t,e){return[-e,2*Wr(Qr(t))-Or]};function Ri(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function Fi(t,e){var n,r,i,o,a,s=new Ni(t),h=+t.value&&(s.value=t.value),u=[s];for(null==e&&(e=ki);n=u.pop();)if(h&&(n.value=+n.data.value),(i=e(n.data))&&(a=i.length))for(n.children=new Array(a),o=a-1;o>=0;--o)u.push(r=n.children[o]=new Ni(i[o])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(zi)}function ki(t){return t.children}function Bi(t){t.data=t.data.data}function zi(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Ni(t){this.data=t,this.depth=this.height=0,this.parent=null}Ni.prototype=Fi.prototype={constructor:Ni,count:function(){return this.eachAfter(Ri)},each:function(t){var e,n,r,i,o=this,a=[o];do{for(e=a.reverse(),a=[];o=e.pop();)if(t(o),n=o.children)for(r=0,i=n.length;r<i;++r)a.push(n[r])}while(a.length);return this},eachAfter:function(t){for(var e,n,r,i=this,o=[i],a=[];i=o.pop();)if(a.push(i),e=i.children)for(n=0,r=e.length;n<r;++n)o.push(e[n]);for(;i=a.pop();)t(i);return this},eachBefore:function(t){for(var e,n,r=this,i=[r];r=i.pop();)if(t(r),e=r.children)for(n=e.length-1;n>=0;--n)i.push(e[n]);return this},sum:function(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n})},sort:function(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;for(t=n.pop(),e=r.pop();t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){var t=[];return this.each(function(e){t.push(e)}),t},leaves:function(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t},links:function(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e},copy:function(){return Fi(this).eachBefore(Bi)}};Array.prototype.slice;var Ui=function(t,e,n,r,i){for(var o,a=t.children,s=-1,h=a.length,u=t.value&&(r-e)/t.value;++s<h;)(o=a[s]).y0=n,o.y1=i,o.x0=e,o.x1=e+=o.value*u};function Ii(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}Ii.prototype=Object.create(Ni.prototype);var Oi=function(t,e,n,r,i){for(var o,a=t.children,s=-1,h=a.length,u=t.value&&(i-n)/t.value;++s<h;)(o=a[s]).x0=e,o.x1=r,o.y0=n,o.y1=n+=o.value*u},Vi=(1+Math.sqrt(5))/2;function Hi(t,e,n,r,i,o){for(var a,s,h,u,c,l,f,p,d,m,g,v=[],y=e.children,x=0,_=0,b=y.length,w=e.value;x<b;){h=i-n,u=o-r;do{c=y[_++].value}while(!c&&_<b);for(l=f=c,g=c*c*(m=Math.max(u/h,h/u)/(w*t)),d=Math.max(f/g,g/l);_<b;++_){if(c+=s=y[_].value,s<l&&(l=s),s>f&&(f=s),g=c*c*m,(p=Math.max(f/g,g/l))>d){c-=s;break}d=p}v.push(a={value:c,dice:h<u,children:y.slice(x,_)}),a.dice?Ui(a,n,r,i,w?r+=u*c/w:o):Oi(a,n,r,w?n+=h*c/w:i,o),w-=c,x=_}return v}(function t(e){function n(t,n,r,i,o){Hi(e,t,n,r,i,o)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n})(Vi),function t(e){function n(t,n,r,i,o){if((a=t._squarify)&&a.ratio===e)for(var a,s,h,u,c,l=-1,f=a.length,p=t.value;++l<f;){for(h=(s=a[l]).children,u=s.value=0,c=h.length;u<c;++u)s.value+=h[u].value;s.dice?Ui(s,n,r,i,r+=(o-r)*s.value/p):Oi(s,n,r,n+=(i-n)*s.value/p,o),p-=s.value}else t._squarify=a=Hi(e,t,n,r,i,o),a.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(Vi);var Gi=[].slice,ji={};function Wi(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function Xi(t){if(!t._start)try{!function(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,n=t._tasks[e],r=n.length-1,i=n[r];n[r]=qi(t,e),--t._waiting,++t._active,n=i.apply(null,n),t._tasks[e]&&(t._tasks[e]=n||ji)}}(t)}catch(e){if(t._tasks[t._ended+t._active-1])Qi(t,e);else if(!t._data)throw e}}function qi(t,e){return function(n,r){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,null==t._error&&(null!=n?Qi(t,n):(t._data[e]=r,t._waiting?Xi(t):Yi(t))))}}function Qi(t,e){var n,r=t._tasks.length;for(t._error=e,t._data=void 0,t._waiting=NaN;--r>=0;)if((n=t._tasks[r])&&(t._tasks[r]=null,n.abort))try{n.abort()}catch(e){}t._active=NaN,Yi(t)}function Yi(t){if(!t._active&&t._call){var e=t._data;t._data=void 0,t._call(t._error,e)}}Wi.prototype=function(t){if(null==t)t=1/0;else if(!((t=+t)>=1))throw new Error("invalid concurrency");return new Wi(t)}.prototype={constructor:Wi,defer:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("defer after await");if(null!=this._error)return this;var e=Gi.call(arguments,1);return e.push(t),++this._waiting,this._tasks.push(e),Xi(this),this},abort:function(){return null==this._error&&Qi(this,new Error("abort")),this},await:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=function(e,n){t.apply(null,[e].concat(n))},Yi(this),this},awaitAll:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=t,Yi(this),this}};var Ki=function(){return Math.random()},Ji=(function t(e){function n(t,n){return t=null==t?0:+t,n=null==n?1:+n,1===arguments.length?(n=t,t=0):n-=t,function(){return e()*n+t}}return n.source=t,n}(Ki),function t(e){function n(t,n){var r,i;return t=null==t?0:+t,n=null==n?1:+n,function(){var o;if(null!=r)o=r,r=null;else do{r=2*e()-1,o=2*e()-1,i=r*r+o*o}while(!i||i>1);return t+n*o*Math.sqrt(-2*Math.log(i)/i)}}return n.source=t,n}(Ki)),Zi=(function t(e){function n(){var t=Ji.source(e).apply(this,arguments);return function(){return Math.exp(t())}}return n.source=t,n}(Ki),function t(e){function n(t){return function(){for(var n=0,r=0;r<t;++r)n+=e();return n}}return n.source=t,n}(Ki)),$i=(function t(e){function n(t){var n=Zi.source(e)(t);return function(){return n()/t}}return n.source=t,n}(Ki),function t(e){function n(t){return function(){return-Math.log(1-e())/t}}return n.source=t,n}(Ki),function(t,e){var n,r,i,o,a=p("beforesend","progress","load","error"),s=Xn(),h=new XMLHttpRequest,u=null,c=null,l=0;function f(t){var e,r=h.status;if(!r&&function(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}(h)||r>=200&&r<300||304===r){if(i)try{e=i.call(n,h)}catch(t){return void a.call("error",n,t)}else e=h;a.call("load",n,e)}else a.call("error",n,t)}if("undefined"==typeof XDomainRequest||"withCredentials"in h||!/^(http(s)?:)?\/\//.test(t)||(h=new XDomainRequest),"onload"in h?h.onload=h.onerror=h.ontimeout=f:h.onreadystatechange=function(t){h.readyState>3&&f(t)},h.onprogress=function(t){a.call("progress",n,t)},n={header:function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s.get(t):(null==e?s.remove(t):s.set(t,e+""),n)},mimeType:function(t){return arguments.length?(r=null==t?null:t+"",n):r},responseType:function(t){return arguments.length?(o=t,n):o},timeout:function(t){return arguments.length?(l=+t,n):l},user:function(t){return arguments.length<1?u:(u=null==t?null:t+"",n)},password:function(t){return arguments.length<1?c:(c=null==t?null:t+"",n)},response:function(t){return i=t,n},get:function(t,e){return n.send("GET",t,e)},post:function(t,e){return n.send("POST",t,e)},send:function(e,i,f){return h.open(e,t,!0,u,c),null==r||s.has("accept")||s.set("accept",r+",*/*"),h.setRequestHeader&&s.each(function(t,e){h.setRequestHeader(e,t)}),null!=r&&h.overrideMimeType&&h.overrideMimeType(r),null!=o&&(h.responseType=o),l>0&&(h.timeout=l),null==f&&"function"==typeof i&&(f=i,i=null),null!=f&&1===f.length&&(f=function(t){return function(e,n){t(null==e?n:null)}}(f)),null!=f&&n.on("error",f).on("load",function(t){f(null,t)}),a.call("beforesend",n,h),h.send(null==i?null:i),n},abort:function(){return h.abort(),n},on:function(){var t=a.on.apply(a,arguments);return t===a?n:t}},null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return n.get(e)}return n});var to=function(t,e){return function(n,r){var i=$i(n).mimeType(t).response(e);if(null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return i.get(r)}return i}},eo=(to("text/html",function(t){return document.createRange().createContextualFragment(t.responseText)}),to("application/json",function(t){return JSON.parse(t.responseText)}),to("text/plain",function(t){return t.responseText}),to("application/xml",function(t){var e=t.responseXML;if(!e)throw new Error("parse error");return e}),function(t,e){return function(n,r,i){arguments.length<3&&(i=r,r=null);var o=$i(n).mimeType(t);return o.row=function(t){return arguments.length?o.response(function(t,e){return function(n){return t(n.responseText,e)}}(e,r=t)):r},o.row(r),i?o.get(i):o}});eo("text/csv",ir),eo("text/tab-separated-values",ar);var no=Array.prototype;no.map,no.slice;var ro=new Date,io=new Date;function oo(t,e,n,r){function i(e){return t(e=new Date(+e)),e}return i.floor=i,i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<r);return s},i.filter=function(n){return oo(function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)},function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););})},n&&(i.count=function(e,r){return ro.setTime(+e),io.setTime(+r),t(ro),t(io),Math.floor(n(ro,io))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var ao=oo(function(){},function(t,e){t.setTime(+t+e)},function(t,e){return e-t});ao.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?oo(function(e){e.setTime(Math.floor(e/t)*t)},function(e,n){e.setTime(+e+n*t)},function(e,n){return(n-e)/t}):ao:null};ao.range;var so=6e4,ho=6048e5,uo=oo(function(t){t.setTime(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(+t+1e3*e)},function(t,e){return(e-t)/1e3},function(t){return t.getUTCSeconds()}),co=(uo.range,oo(function(t){t.setTime(Math.floor(t/so)*so)},function(t,e){t.setTime(+t+e*so)},function(t,e){return(e-t)/so},function(t){return t.getMinutes()})),lo=(co.range,oo(function(t){var e=t.getTimezoneOffset()*so%36e5;e<0&&(e+=36e5),t.setTime(36e5*Math.floor((+t-e)/36e5)+e)},function(t,e){t.setTime(+t+36e5*e)},function(t,e){return(e-t)/36e5},function(t){return t.getHours()})),fo=(lo.range,oo(function(t){t.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*so)/864e5},function(t){return t.getDate()-1})),po=fo;fo.range;function mo(t){return oo(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+7*e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*so)/ho})}var go=mo(0),vo=mo(1),yo=mo(2),xo=mo(3),_o=mo(4),bo=mo(5),wo=mo(6),Mo=(go.range,vo.range,yo.range,xo.range,_o.range,bo.range,wo.range,oo(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,e){t.setMonth(t.getMonth()+e)},function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())},function(t){return t.getMonth()})),Ao=(Mo.range,oo(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()}));Ao.every=function(t){return isFinite(t=Math.floor(t))&&t>0?oo(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n*t)}):null};var So=Ao,Co=(Ao.range,oo(function(t){t.setUTCSeconds(0,0)},function(t,e){t.setTime(+t+e*so)},function(t,e){return(e-t)/so},function(t){return t.getUTCMinutes()})),To=(Co.range,oo(function(t){t.setUTCMinutes(0,0,0)},function(t,e){t.setTime(+t+36e5*e)},function(t,e){return(e-t)/36e5},function(t){return t.getUTCHours()})),Eo=(To.range,oo(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/864e5},function(t){return t.getUTCDate()-1})),Lo=Eo;Eo.range;function Po(t){return oo(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+7*e)},function(t,e){return(e-t)/ho})}var Do=Po(0),Ro=Po(1),Fo=Po(2),ko=Po(3),Bo=Po(4),zo=Po(5),No=Po(6),Uo=(Do.range,Ro.range,Fo.range,ko.range,Bo.range,zo.range,No.range,oo(function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCMonth(t.getUTCMonth()+e)},function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())},function(t){return t.getUTCMonth()})),Io=(Uo.range,oo(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()}));Io.every=function(t){return isFinite(t=Math.floor(t))&&t>0?oo(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)}):null};var Oo=Io;Io.range;function Vo(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Ho(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Go(t){return{y:t,m:0,d:1,H:0,M:0,S:0,L:0}}var jo,Wo,Xo,qo={"-":"",_:" ",0:"0"},Qo=/^\s*\d+/,Yo=/^%/,Ko=/[\\^$*+?|[\]().{}]/g;function Jo(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function Zo(t){return t.replace(Ko,"\\$&")}function $o(t){return new RegExp("^(?:"+t.map(Zo).join("|")+")","i")}function ta(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function ea(t,e,n){var r=Qo.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function na(t,e,n){var r=Qo.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function ra(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function ia(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function oa(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function aa(t,e,n){var r=Qo.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function sa(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function ha(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function ua(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function ca(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function la(t,e,n){var r=Qo.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function fa(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function pa(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function da(t,e,n){var r=Qo.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function ma(t,e,n){var r=Qo.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function ga(t,e,n){var r=Qo.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function va(t,e,n){var r=Yo.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function ya(t,e,n){var r=Qo.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function xa(t,e,n){var r=Qo.exec(e.slice(n));return r?(t.Q=1e3*+r[0],n+r[0].length):-1}function _a(t,e){return Jo(t.getDate(),e,2)}function ba(t,e){return Jo(t.getHours(),e,2)}function wa(t,e){return Jo(t.getHours()%12||12,e,2)}function Ma(t,e){return Jo(1+po.count(So(t),t),e,3)}function Aa(t,e){return Jo(t.getMilliseconds(),e,3)}function Sa(t,e){return Aa(t,e)+"000"}function Ca(t,e){return Jo(t.getMonth()+1,e,2)}function Ta(t,e){return Jo(t.getMinutes(),e,2)}function Ea(t,e){return Jo(t.getSeconds(),e,2)}function La(t){var e=t.getDay();return 0===e?7:e}function Pa(t,e){return Jo(go.count(So(t),t),e,2)}function Da(t,e){var n=t.getDay();return t=n>=4||0===n?_o(t):_o.ceil(t),Jo(_o.count(So(t),t)+(4===So(t).getDay()),e,2)}function Ra(t){return t.getDay()}function Fa(t,e){return Jo(vo.count(So(t),t),e,2)}function ka(t,e){return Jo(t.getFullYear()%100,e,2)}function Ba(t,e){return Jo(t.getFullYear()%1e4,e,4)}function za(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Jo(e/60|0,"0",2)+Jo(e%60,"0",2)}function Na(t,e){return Jo(t.getUTCDate(),e,2)}function Ua(t,e){return Jo(t.getUTCHours(),e,2)}function Ia(t,e){return Jo(t.getUTCHours()%12||12,e,2)}function Oa(t,e){return Jo(1+Lo.count(Oo(t),t),e,3)}function Va(t,e){return Jo(t.getUTCMilliseconds(),e,3)}function Ha(t,e){return Va(t,e)+"000"}function Ga(t,e){return Jo(t.getUTCMonth()+1,e,2)}function ja(t,e){return Jo(t.getUTCMinutes(),e,2)}function Wa(t,e){return Jo(t.getUTCSeconds(),e,2)}function Xa(t){var e=t.getUTCDay();return 0===e?7:e}function qa(t,e){return Jo(Do.count(Oo(t),t),e,2)}function Qa(t,e){var n=t.getUTCDay();return t=n>=4||0===n?Bo(t):Bo.ceil(t),Jo(Bo.count(Oo(t),t)+(4===Oo(t).getUTCDay()),e,2)}function Ya(t){return t.getUTCDay()}function Ka(t,e){return Jo(Ro.count(Oo(t),t),e,2)}function Ja(t,e){return Jo(t.getUTCFullYear()%100,e,2)}function Za(t,e){return Jo(t.getUTCFullYear()%1e4,e,4)}function $a(){return"+0000"}function ts(){return"%"}function es(t){return+t}function ns(t){return Math.floor(+t/1e3)}!function(t){jo=function(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,h=t.shortMonths,u=$o(i),c=ta(i),l=$o(o),f=ta(o),p=$o(a),d=ta(a),m=$o(s),g=ta(s),v=$o(h),y=ta(h),x={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return h[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:_a,e:_a,f:Sa,H:ba,I:wa,j:Ma,L:Aa,m:Ca,M:Ta,p:function(t){return i[+(t.getHours()>=12)]},Q:es,s:ns,S:Ea,u:La,U:Pa,V:Da,w:Ra,W:Fa,x:null,X:null,y:ka,Y:Ba,Z:za,"%":ts},_={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return h[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:Na,e:Na,f:Ha,H:Ua,I:Ia,j:Oa,L:Va,m:Ga,M:ja,p:function(t){return i[+(t.getUTCHours()>=12)]},Q:es,s:ns,S:Wa,u:Xa,U:qa,V:Qa,w:Ya,W:Ka,x:null,X:null,y:Ja,Y:Za,Z:$a,"%":ts},b={a:function(t,e,n){var r=p.exec(e.slice(n));return r?(t.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=l.exec(e.slice(n));return r?(t.w=f[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=v.exec(e.slice(n));return r?(t.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=m.exec(e.slice(n));return r?(t.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return A(t,e,n,r)},d:ca,e:ca,f:ga,H:fa,I:fa,j:la,L:ma,m:ua,M:pa,p:function(t,e,n){var r=u.exec(e.slice(n));return r?(t.p=c[r[0].toLowerCase()],n+r[0].length):-1},Q:ya,s:xa,S:da,u:na,U:ra,V:ia,w:ea,W:oa,x:function(t,e,r){return A(t,n,e,r)},X:function(t,e,n){return A(t,r,e,n)},y:sa,Y:aa,Z:ha,"%":va};function w(t,e){return function(n){var r,i,o,a=[],s=-1,h=0,u=t.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===t.charCodeAt(s)&&(a.push(t.slice(h,s)),null!=(i=qo[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),h=s+1);return a.push(t.slice(h,s)),a.join("")}}function M(t,e){return function(n){var r,i,o=Go(1900);if(A(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("p"in o&&(o.H=o.H%12+12*o.p),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=Ho(Go(o.y))).getUTCDay(),r=i>4||0===i?Ro.ceil(r):Ro(r),r=Lo.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=e(Go(o.y))).getDay(),r=i>4||0===i?vo.ceil(r):vo(r),r=po.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?Ho(Go(o.y)).getUTCDay():e(Go(o.y)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,Ho(o)):e(o)}}function A(t,e,n,r){for(var i,o,a=0,s=e.length,h=n.length;a<s;){if(r>=h)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=b[i in qo?e.charAt(a++):i])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return x.x=w(n,x),x.X=w(r,x),x.c=w(e,x),_.x=w(n,_),_.X=w(r,_),_.c=w(e,_),{format:function(t){var e=w(t+="",x);return e.toString=function(){return t},e},parse:function(t){var e=M(t+="",Vo);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},utcParse:function(t){var e=M(t,Ho);return e.toString=function(){return t},e}}}(t),jo.format,jo.parse,Wo=jo.utcFormat,Xo=jo.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Date.prototype.toISOString||Wo("%Y-%m-%dT%H:%M:%S.%LZ");+new Date("2000-01-01T00:00:00.000Z")||Xo("%Y-%m-%dT%H:%M:%S.%LZ");var rs=function(t){return t.match(/.{6}/g).map(function(t){return"#"+t})};rs("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),rs("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),rs("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),rs("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),Ye(_e(300,.5,0),_e(-240,.5,1)),Ye(_e(-100,.75,.35),_e(80,1.5,.8)),Ye(_e(260,.75,.35),_e(80,1.5,.8)),_e();function is(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}is(rs("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),is(rs("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),is(rs("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),is(rs("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));Math.abs,Math.atan2,Math.cos,Math.max,Math.min,Math.sin,Math.sqrt;var os=1e-12,as=Math.PI,ss=2*as;function hs(t){this._context=t}hs.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var us=function(t){return new hs(t)};ls(us);function cs(t){this._curve=t}function ls(t){function e(e){return new cs(t(e))}return e._curve=t,e}cs.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};Array.prototype.slice;Math.sqrt(1/3);var fs=Math.sin(as/10)/Math.sin(7*as/10),ps=(Math.sin(ss/10),Math.cos(ss/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12),function(){});function ds(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function ms(t){this._context=t}ms.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:ds(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:ds(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function gs(t){this._context=t}gs.prototype={areaStart:ps,areaEnd:ps,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:ds(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function vs(t){this._context=t}vs.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:ds(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function ys(t,e){this._basis=new ms(t),this._beta=e}ys.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r,i=t[0],o=e[0],a=t[n]-i,s=e[n]-o,h=-1;++h<=n;)r=h/n,this._basis.point(this._beta*t[h]+(1-this._beta)*(i+r*a),this._beta*e[h]+(1-this._beta)*(o+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};(function t(e){function n(t){return 1===e?new ms(t):new ys(t,e)}return n.beta=function(e){return t(+e)},n})(.85);function xs(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function _s(t,e){this._context=t,this._k=(1-e)/6}_s.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:xs(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:xs(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return new _s(t,e)}return n.tension=function(e){return t(+e)},n})(0);function bs(t,e){this._context=t,this._k=(1-e)/6}bs.prototype={areaStart:ps,areaEnd:ps,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:xs(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return new bs(t,e)}return n.tension=function(e){return t(+e)},n})(0);function ws(t,e){this._context=t,this._k=(1-e)/6}ws.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:xs(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return new ws(t,e)}return n.tension=function(e){return t(+e)},n})(0);function Ms(t,e,n){var r=t._x1,i=t._y1,o=t._x2,a=t._y2;if(t._l01_a>os){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,h=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/h,i=(i*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/h}if(t._l23_a>os){var u=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*u+t._x1*t._l23_2a-e*t._l12_2a)/c,a=(a*u+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(r,i,o,a,t._x2,t._y2)}function As(t,e){this._context=t,this._alpha=e}As.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Ms(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return e?new As(t,e):new _s(t,0)}return n.alpha=function(e){return t(+e)},n})(.5);function Ss(t,e){this._context=t,this._alpha=e}Ss.prototype={areaStart:ps,areaEnd:ps,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Ms(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return e?new Ss(t,e):new bs(t,0)}return n.alpha=function(e){return t(+e)},n})(.5);function Cs(t,e){this._context=t,this._alpha=e}Cs.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Ms(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return e?new Cs(t,e):new ws(t,0)}return n.alpha=function(e){return t(+e)},n})(.5);function Ts(t){this._context=t}Ts.prototype={areaStart:ps,areaEnd:ps,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function Es(t){return t<0?-1:1}function Ls(t,e,n){var r=t._x1-t._x0,i=e-t._x1,o=(t._y1-t._y0)/(r||i<0&&-0),a=(n-t._y1)/(i||r<0&&-0),s=(o*i+a*r)/(r+i);return(Es(o)+Es(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function Ps(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Ds(t,e,n){var r=t._x0,i=t._y0,o=t._x1,a=t._y1,s=(o-r)/3;t._context.bezierCurveTo(r+s,i+s*e,o-s,a-s*n,o,a)}function Rs(t){this._context=t}function Fs(t){this._context=new ks(t)}function ks(t){this._context=t}function Bs(t){this._context=t}function zs(t){var e,n,r=t.length-1,i=new Array(r),o=new Array(r),a=new Array(r);for(i[0]=0,o[0]=2,a[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,o[e]=4,a[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,o[r-1]=7,a[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/o[e-1],o[e]-=n,a[e]-=n*a[e-1];for(i[r-1]=a[r-1]/o[r-1],e=r-2;e>=0;--e)i[e]=(a[e]-i[e+1])/o[e];for(o[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)o[e]=2*t[e+1]-i[e+1];return[i,o]}Rs.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Ds(this,this._t0,Ps(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Ds(this,Ps(this,n=Ls(this,t,e)),n);break;default:Ds(this,this._t0,n=Ls(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(Fs.prototype=Object.create(Rs.prototype)).point=function(t,e){Rs.prototype.point.call(this,e,t)},ks.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,o){this._context.bezierCurveTo(e,t,r,n,o,i)}},Bs.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var r=zs(t),i=zs(e),o=0,a=1;a<n;++o,++a)this._context.bezierCurveTo(r[0][o],i[0][o],r[1][o],i[1][o],t[a],e[a]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function Ns(t,e){this._context=t,this._t=e}Ns.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};function Us(){this._=null}function Is(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Os(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function Vs(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function Hs(t){for(;t.L;)t=t.L;return t}Us.prototype={constructor:Us,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=Hs(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(Os(this,n),n=(t=n).U),n.C=!1,r.C=!0,Vs(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(Vs(this,n),n=(t=n).U),n.C=!1,r.C=!0,Os(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,a=t.R;if(n=o?a?Hs(a):o:a,i?i.L===t?i.L=n:i.R=n:this._=n,o&&a?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==a?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=a,a.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,Os(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,Vs(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,Os(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,Vs(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,Os(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,Vs(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};var Gs=Us;function js(t,e,n,r){var i=[null,null],o=dh.push(i)-1;return i.left=t,i.right=e,n&&Xs(i,t,e,n),r&&Xs(i,e,t,r),fh[t.index].halfedges.push(o),fh[e.index].halfedges.push(o),i}function Ws(t,e,n){var r=[e,n];return r.left=t,r}function Xs(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function qs(t,e,n,r,i){var o,a=t[0],s=t[1],h=a[0],u=a[1],c=0,l=1,f=s[0]-h,p=s[1]-u;if(o=e-h,f||!(o>0)){if(o/=f,f<0){if(o<c)return;o<l&&(l=o)}else if(f>0){if(o>l)return;o>c&&(c=o)}if(o=r-h,f||!(o<0)){if(o/=f,f<0){if(o>l)return;o>c&&(c=o)}else if(f>0){if(o<c)return;o<l&&(l=o)}if(o=n-u,p||!(o>0)){if(o/=p,p<0){if(o<c)return;o<l&&(l=o)}else if(p>0){if(o>l)return;o>c&&(c=o)}if(o=i-u,p||!(o<0)){if(o/=p,p<0){if(o>l)return;o>c&&(c=o)}else if(p>0){if(o<c)return;o<l&&(l=o)}return!(c>0||l<1)||(c>0&&(t[0]=[h+c*f,u+c*p]),l<1&&(t[1]=[h+l*f,u+l*p]),!0)}}}}}function Qs(t,e,n,r,i){var o=t[1];if(o)return!0;var a,s,h=t[0],u=t.left,c=t.right,l=u[0],f=u[1],p=c[0],d=c[1],m=(l+p)/2,g=(f+d)/2;if(d===f){if(m<e||m>=r)return;if(l>p){if(h){if(h[1]>=i)return}else h=[m,n];o=[m,i]}else{if(h){if(h[1]<n)return}else h=[m,i];o=[m,n]}}else if(s=g-(a=(l-p)/(d-f))*m,a<-1||a>1)if(l>p){if(h){if(h[1]>=i)return}else h=[(n-s)/a,n];o=[(i-s)/a,i]}else{if(h){if(h[1]<n)return}else h=[(i-s)/a,i];o=[(n-s)/a,n]}else if(f<d){if(h){if(h[0]>=r)return}else h=[e,a*e+s];o=[r,a*r+s]}else{if(h){if(h[0]<e)return}else h=[r,a*r+s];o=[e,a*e+s]}return t[0]=h,t[1]=o,!0}function Ys(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function Ks(t,e){return e[+(e.left!==t.site)]}function Js(t,e){return e[+(e.left===t.site)]}var Zs,$s=[];function th(){Is(this),this.x=this.y=this.arc=this.site=this.cy=null}function eh(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var a=i[0],s=i[1],h=r[0]-a,u=r[1]-s,c=o[0]-a,l=o[1]-s,f=2*(h*l-u*c);if(!(f>=-gh)){var p=h*h+u*u,d=c*c+l*l,m=(l*p-u*d)/f,g=(h*d-c*p)/f,v=$s.pop()||new th;v.arc=t,v.site=i,v.x=m+a,v.y=(v.cy=g+s)+Math.sqrt(m*m+g*g),t.circle=v;for(var y=null,x=ph._;x;)if(v.y<x.y||v.y===x.y&&v.x<=x.x){if(!x.L){y=x.P;break}x=x.L}else{if(!x.R){y=x;break}x=x.R}ph.insert(y,v),y||(Zs=v)}}}}function nh(t){var e=t.circle;e&&(e.P||(Zs=e.N),ph.remove(e),$s.push(e),Is(e),t.circle=null)}var rh=[];function ih(){Is(this),this.edge=this.site=this.circle=null}function oh(t){var e=rh.pop()||new ih;return e.site=t,e}function ah(t){nh(t),lh.remove(t),rh.push(t),Is(t)}function sh(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],o=t.P,a=t.N,s=[t];ah(t);for(var h=o;h.circle&&Math.abs(n-h.circle.x)<mh&&Math.abs(r-h.circle.cy)<mh;)o=h.P,s.unshift(h),ah(h),h=o;s.unshift(h),nh(h);for(var u=a;u.circle&&Math.abs(n-u.circle.x)<mh&&Math.abs(r-u.circle.cy)<mh;)a=u.N,s.push(u),ah(u),u=a;s.push(u),nh(u);var c,l=s.length;for(c=1;c<l;++c)u=s[c],h=s[c-1],Xs(u.edge,h.site,u.site,i);h=s[0],(u=s[l-1]).edge=js(h.site,u.site,null,i),eh(h),eh(u)}function hh(t){for(var e,n,r,i,o=t[0],a=t[1],s=lh._;s;)if((r=uh(s,a)-o)>mh)s=s.L;else{if(!((i=o-ch(s,a))>mh)){r>-mh?(e=s.P,n=s):i>-mh?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}!function(t){fh[t.index]={site:t,halfedges:[]}}(t);var h=oh(t);if(lh.insert(e,h),e||n){if(e===n)return nh(e),n=oh(e.site),lh.insert(h,n),h.edge=n.edge=js(e.site,h.site),eh(e),void eh(n);if(n){nh(e),nh(n);var u=e.site,c=u[0],l=u[1],f=t[0]-c,p=t[1]-l,d=n.site,m=d[0]-c,g=d[1]-l,v=2*(f*g-p*m),y=f*f+p*p,x=m*m+g*g,_=[(g*y-p*x)/v+c,(f*x-m*y)/v+l];Xs(n.edge,u,d,_),h.edge=js(u,t,null,_),n.edge=js(t,d,null,_),eh(e),eh(n)}else h.edge=js(e.site,h.site)}}function uh(t,e){var n=t.site,r=n[0],i=n[1],o=i-e;if(!o)return r;var a=t.P;if(!a)return-1/0;var s=(n=a.site)[0],h=n[1],u=h-e;if(!u)return s;var c=s-r,l=1/o-1/u,f=c/u;return l?(-f+Math.sqrt(f*f-2*l*(c*c/(-2*u)-h+u/2+i-o/2)))/l+r:(r+s)/2}function ch(t,e){var n=t.N;if(n)return uh(n,e);var r=t.site;return r[1]===e?r[0]:1/0}var lh,fh,ph,dh,mh=1e-6,gh=1e-12;function vh(t,e){return e[1]-t[1]||e[0]-t[0]}function yh(t,e){var n,r,i,o=t.sort(vh).pop();for(dh=[],fh=new Array(t.length),lh=new Gs,ph=new Gs;;)if(i=Zs,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(hh(o),n=o[0],r=o[1]),o=t.pop();else{if(!i)break;sh(i.arc)}if(function(){for(var t,e,n,r,i=0,o=fh.length;i<o;++i)if((t=fh[i])&&(r=(e=t.halfedges).length)){var a=new Array(r),s=new Array(r);for(n=0;n<r;++n)a[n]=n,s[n]=Ys(t,dh[e[n]]);for(a.sort(function(t,e){return s[e]-s[t]}),n=0;n<r;++n)s[n]=e[a[n]];for(n=0;n<r;++n)e[n]=s[n]}}(),e){var a=+e[0][0],s=+e[0][1],h=+e[1][0],u=+e[1][1];!function(t,e,n,r){for(var i,o=dh.length;o--;)Qs(i=dh[o],t,e,n,r)&&qs(i,t,e,n,r)&&(Math.abs(i[0][0]-i[1][0])>mh||Math.abs(i[0][1]-i[1][1])>mh)||delete dh[o]}(a,s,h,u),function(t,e,n,r){var i,o,a,s,h,u,c,l,f,p,d,m,g=fh.length,v=!0;for(i=0;i<g;++i)if(o=fh[i]){for(a=o.site,s=(h=o.halfedges).length;s--;)dh[h[s]]||h.splice(s,1);for(s=0,u=h.length;s<u;)d=(p=Js(o,dh[h[s]]))[0],m=p[1],l=(c=Ks(o,dh[h[++s%u]]))[0],f=c[1],(Math.abs(d-l)>mh||Math.abs(m-f)>mh)&&(h.splice(s,0,dh.push(Ws(a,p,Math.abs(d-t)<mh&&r-m>mh?[t,Math.abs(l-t)<mh?f:r]:Math.abs(m-r)<mh&&n-d>mh?[Math.abs(f-r)<mh?l:n,r]:Math.abs(d-n)<mh&&m-e>mh?[n,Math.abs(l-n)<mh?f:e]:Math.abs(m-e)<mh&&d-t>mh?[Math.abs(f-e)<mh?l:t,e]:null))-1),++u);u&&(v=!1)}if(v){var y,x,_,b=1/0;for(i=0,v=null;i<g;++i)(o=fh[i])&&(_=(y=(a=o.site)[0]-t)*y+(x=a[1]-e)*x)<b&&(b=_,v=o);if(v){var w=[t,e],M=[t,r],A=[n,r],S=[n,e];v.halfedges.push(dh.push(Ws(a=v.site,w,M))-1,dh.push(Ws(a,M,A))-1,dh.push(Ws(a,A,S))-1,dh.push(Ws(a,S,w))-1)}}for(i=0;i<g;++i)(o=fh[i])&&(o.halfedges.length||delete fh[i])}(a,s,h,u)}this.edges=dh,this.cells=fh,lh=ph=dh=fh=null}yh.prototype={constructor:yh,polygons:function(){var t=this.edges;return this.cells.map(function(e){var n=e.halfedges.map(function(n){return Ks(e,t[n])});return n.data=e.site.data,n})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(n,r){if(o=(i=n.halfedges).length)for(var i,o,a,s,h,u,c=n.site,l=-1,f=e[i[o-1]],p=f.left===c?f.right:f.left;++l<o;)a=p,p=(f=e[i[l]]).left===c?f.right:f.left,a&&p&&r<a.index&&r<p.index&&(h=a,u=p,((s=c)[0]-u[0])*(h[1]-s[1])-(s[0]-h[0])*(u[1]-s[1])<0)&&t.push([c.data,a.data,p.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,n){for(var r,i,o=this,a=o._found||0,s=o.cells.length;!(i=o.cells[a]);)if(++a>=s)return null;var h=t-i.site[0],u=e-i.site[1],c=h*h+u*u;do{i=o.cells[r=a],a=null,i.halfedges.forEach(function(n){var r=o.edges[n],s=r.left;if(s!==i.site&&s||(s=r.right)){var h=t-s[0],u=e-s[1],l=h*h+u*u;l<c&&(c=l,a=s.index)}})}while(null!==a);return o._found=r,null==n||c<=n*n?i.site:null}};function xh(t,e,n){this.k=t,this.x=e,this.y=n}xh.prototype={constructor:xh,scale:function(t){return 1===t?this:new xh(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new xh(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};new xh(1,0,0);xh.prototype;var _h=n(8),bh=(n(28),n(18)),wh=n.n(bh),Mh=[{id:"mammal",group:0,label:"Mammals",level:1},{id:"dog",group:0,label:"Dogs",level:2},{id:"cat",group:0,label:"Cats",level:2},{id:"fox",group:0,label:"Foxes",level:2},{id:"elk",group:0,label:"Elk",level:2},{id:"insect",group:1,label:"Insects",level:1},{id:"ant",group:1,label:"Ants",level:2},{id:"bee",group:1,label:"Bees",level:2},{id:"fish",group:2,label:"Fish",level:1},{id:"carp",group:2,label:"Carp",level:2},{id:"pike",group:2,label:"Pikes",level:2}],Ah=[{target:"mammal",source:"dog",strength:.1},{target:"mammal",source:"cat",strength:.1},{target:"mammal",source:"fox",strength:.1},{target:"mammal",source:"elk",strength:.1},{target:"insect",source:"ant",strength:.1},{target:"insect",source:"bee",strength:.1},{target:"fish",source:"carp",strength:.1},{target:"fish",source:"pike",strength:.1},{target:"cat",source:"elk",strength:.1},{target:"carp",source:"ant",strength:.1},{target:"elk",source:"bee",strength:.1},{target:"dog",source:"cat",strength:.1},{target:"fox",source:"ant",strength:.1},{target:"pike",source:"cat",strength:.1}];window.speechSynthesis.onvoiceschanged=function(){!0};function Sh(t,e){return Array.isArray(e)&&e.indexOf(t.id)>-1?1===t.level?"blue":"green":(t.level,"gray")}var Ch=window.innerWidth,Th=window.innerHeight,Eh=st("svg");Eh.attr("width",Ch).attr("height",Th);var Lh=function(t){var e,n,r,i,o,a=vr,s=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},h=sr(30),u=1;function c(r){for(var i=0,a=t.length;i<u;++i)for(var s,h,c,l,f,p,d,m=0;m<a;++m)h=(s=t[m]).source,l=(c=s.target).x+c.vx-h.x-h.vx||hr(),f=c.y+c.vy-h.y-h.vy||hr(),l*=p=((p=Math.sqrt(l*l+f*f))-n[m])/p*r*e[m],f*=p,c.vx-=l*(d=o[m]),c.vy-=f*d,h.vx+=l*(d=1-d),h.vy+=f*d}function l(){if(r){var s,h,u=r.length,c=t.length,l=Xn(r,a);for(s=0,i=new Array(u);s<c;++s)(h=t[s]).index=s,"object"!=typeof h.source&&(h.source=yr(l,h.source)),"object"!=typeof h.target&&(h.target=yr(l,h.target)),i[h.source.index]=(i[h.source.index]||0)+1,i[h.target.index]=(i[h.target.index]||0)+1;for(s=0,o=new Array(c);s<c;++s)h=t[s],o[s]=i[h.source.index]/(i[h.source.index]+i[h.target.index]);e=new Array(c),f(),n=new Array(c),p()}}function f(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+s(t[n],n,t)}function p(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+h(t[e],e,t)}return null==t&&(t=[]),c.initialize=function(t){r=t,l()},c.links=function(e){return arguments.length?(t=e,l(),c):t},c.id=function(t){return arguments.length?(a=t,c):a},c.iterations=function(t){return arguments.length?(u=+t,c):u},c.strength=function(t){return arguments.length?(s="function"==typeof t?t:sr(+t),f(),c):s},c.distance=function(t){return arguments.length?(h="function"==typeof t?t:sr(+t),p(),c):h},c}().id(function(t){return t.id}).strength(function(t){return t.strength}),Ph=function(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,s=Xn(),h=un(c),u=p("tick","end");function c(){l(),u.call("tick",e),n<r&&(h.stop(),u.call("end",e))}function l(){var e,r,h=t.length;for(n+=(o-n)*i,s.each(function(t){t(n)}),e=0;e<h;++e)null==(r=t[e]).fx?r.x+=r.vx*=a:(r.x=r.fx,r.vx=0),null==r.fy?r.y+=r.vy*=a:(r.y=r.fy,r.vy=0)}function f(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,isNaN(e.x)||isNaN(e.y)){var i=wr*Math.sqrt(n),o=n*Mr;e.x=i*Math.cos(o),e.y=i*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function d(e){return e.initialize&&e.initialize(t),e}return null==t&&(t=[]),f(),e={tick:l,restart:function(){return h.restart(c),e},stop:function(){return h.stop(),e},nodes:function(n){return arguments.length?(t=n,f(),s.each(d),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},force:function(t,n){return arguments.length>1?(null==n?s.remove(t):s.set(t,d(n)),e):s.get(t)},find:function(e,n,r){var i,o,a,s,h,u=0,c=t.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(a=(i=e-(s=t[u]).x)*i+(o=n-s.y)*o)<r&&(h=s,r=a);return h},on:function(t,n){return arguments.length>1?(u.on(t,n),e):u.on(t)}}}().force("link",Lh).force("charge",function(){var t,e,n,r,i=sr(-30),o=1,a=1/0,s=.81;function h(r){var i,o=t.length,a=pr(t,xr,_r).visitAfter(c);for(n=r,i=0;i<o;++i)e=t[i],a.visit(l)}function u(){if(t){var e,n,o=t.length;for(r=new Array(o),e=0;e<o;++e)n=t[e],r[n.index]=+i(n,e,t)}}function c(t){var e,n,i,o,a,s=0,h=0;if(t.length){for(i=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,h+=n,i+=n*e.x,o+=n*e.y);t.x=i/h,t.y=o/h}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=r[e.data.index]}while(e=e.next)}t.value=s}function l(t,i,h,u){if(!t.value)return!0;var c=t.x-e.x,l=t.y-e.y,f=u-i,p=c*c+l*l;if(f*f/s<p)return p<a&&(0===c&&(p+=(c=hr())*c),0===l&&(p+=(l=hr())*l),p<o&&(p=Math.sqrt(o*p)),e.vx+=c*t.value*n/p,e.vy+=l*t.value*n/p),!0;if(!(t.length||p>=a)){(t.data!==e||t.next)&&(0===c&&(p+=(c=hr())*c),0===l&&(p+=(l=hr())*l),p<o&&(p=Math.sqrt(o*p)));do{t.data!==e&&(f=r[t.data.index]*n/p,e.vx+=c*f,e.vy+=l*f)}while(t=t.next)}}return h.initialize=function(e){t=e,u()},h.strength=function(t){return arguments.length?(i="function"==typeof t?t:sr(+t),u(),h):i},h.distanceMin=function(t){return arguments.length?(o=t*t,h):Math.sqrt(o)},h.distanceMax=function(t){return arguments.length?(a=t*t,h):Math.sqrt(a)},h.theta=function(t){return arguments.length?(s=t*t,h):Math.sqrt(s)},h}().strength(-120)).force("center",function(t,e){var n;function r(){var r,i,o=n.length,a=0,s=0;for(r=0;r<o;++r)a+=(i=n[r]).x,s+=i.y;for(a=a/o-t,s=s/o-e,r=0;r<o;++r)(i=n[r]).x-=a,i.y-=s}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r}(Ch/2,Th/2)),Dh=function(){var t,e,n,r,i=bt,o=wt,a=Mt,s=At,h={},u=p("start","drag","end"),c=0,l=0;function f(t){t.on("mousedown.drag",d).filter(s).on("touchstart.drag",v).on("touchmove.drag",y).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(){if(!r&&i.apply(this,arguments)){var a=_("mouse",o.apply(this,arguments),ft,this,arguments);a&&(st(K.view).on("mousemove.drag",m,!0).on("mouseup.drag",g,!0),vt(K.view),mt(),n=!1,t=K.clientX,e=K.clientY,a("start"))}}function m(){if(gt(),!n){var r=K.clientX-t,i=K.clientY-e;n=r*r+i*i>l}h.mouse("drag")}function g(){st(K.view).on("mousemove.drag mouseup.drag",null),yt(K.view,n),gt(),h.mouse("end")}function v(){if(i.apply(this,arguments)){var t,e,n=K.changedTouches,r=o.apply(this,arguments),a=n.length;for(t=0;t<a;++t)(e=_(n[t].identifier,r,dt,this,arguments))&&(mt(),e("start"))}}function y(){var t,e,n=K.changedTouches,r=n.length;for(t=0;t<r;++t)(e=h[n[t].identifier])&&(gt(),e("drag"))}function x(){var t,e,n=K.changedTouches,i=n.length;for(r&&clearTimeout(r),r=setTimeout(function(){r=null},500),t=0;t<i;++t)(e=h[n[t].identifier])&&(mt(),e("end"))}function _(t,e,n,r,i){var o,s,l,p=n(e,t),d=u.copy();if(et(new _t(f,"beforestart",o,t,c,p[0],p[1],0,0,d),function(){return null!=(K.subject=o=a.apply(r,i))&&(s=o.x-p[0]||0,l=o.y-p[1]||0,!0)}))return function a(u){var m,g=p;switch(u){case"start":h[t]=a,m=c++;break;case"end":delete h[t],--c;case"drag":p=n(e,t),m=c}et(new _t(f,u,o,t,m,p[0]+s,p[1]+l,p[0]-g[0],p[1]-g[1],d),d.apply,d,[u,r,i])}}return f.filter=function(t){return arguments.length?(i="function"==typeof t?t:xt(!!t),f):i},f.container=function(t){return arguments.length?(o="function"==typeof t?t:xt(t),f):o},f.subject=function(t){return arguments.length?(a="function"==typeof t?t:xt(t),f):a},f.touchable=function(t){return arguments.length?(s="function"==typeof t?t:xt(!!t),f):s},f.on=function(){var t=u.on.apply(u,arguments);return t===u?f:t},f.clickDistance=function(t){return arguments.length?(l=(t=+t)*t,f):Math.sqrt(l)},f}().on("start",function(t){t.fx=t.x,t.fy=t.y}).on("drag",function(t){Ph.alphaTarget(.4).restart(),t.fx=K.x,t.fy=K.y}).on("end",function(t){K.active||Ph.alphaTarget(0),t.fx=null,t.fy=null});var Rh=Eh.append("g").attr("class","links").selectAll("line").data(Ah).enter().append("line").attr("stroke-width",5).attr("stroke","rgba(50, 50, 50, 0.2)"),Fh=Eh.append("g").attr("class","nodes").selectAll("circle").data(Mh).enter().append("circle").attr("r",30).attr("fill",Sh).call(Dh).on("click",function(t){var e,n=(e=t,Ah.reduce(function(t,n){return n.target.id===e.id?t.push(n.source.id):n.source.id===e.id&&t.push(n.target.id),t},[e.id]));Fh.attr("fill",function(t){return Sh(t,n)}),Rh.attr("stroke",function(e){return function(t,e){return function(t,e){return e.target.id===t.id||e.source.id===t.id}(t,e)?"green":"#E5E5E5"}(t,e)})});Ph.nodes(Mh).on("tick",()=>{Fh.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),Rh.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y})}),Ph.force("link").links(Ah);var kh=[0,0],Bh=[0,0],zh=!1;_h.loop({hand:function(t){st("#cursor").remove(),Bh=t.screenPosition(),kh=[Bh[0],Bh[1]+300],st("svg").append("circle").attr("id","cursor").attr("cx",kh[0]).attr("cy",kh[1]).attr("fill","blue").attr("r",20),t.grabStrength>=.95||t.pinchStrength>=.95?(0!=zh&&(Ph.alphaTarget(.4).restart(),zh.x=kh[0],zh.y=kh[1]),0==zh&&pt("circle").each(function(t){if("cursor"!=st(this).attr("id")){x=t.x,y=t.y;var e={x1:x-30,x2:x+30,y1:y-30,y2:y+30};e.x1<=kh[0]&&e.x2>=kh[0]&&e.y1<=kh[1]&&e.y2>=kh[1]&&([x,y],zh=t,st(this).attr("fill","black"),console.log("intersects"))}})):0!=zh&&(pt("circle").each(function(t){"cursor"!=st(this).attr("id")&&t.id==zh.id&&st(this).attr("fill","gray")}),zh=!1,Ph.restart()),console.log("insersect node is: "+JSON.stringify(zh))}}).use("screenPosition",{scale:.6});var Nh=function(t){var e=function(t,e){for(var n=t.toLowerCase(),r=0;r<e.length;r++)if(n.indexOf(e[r])>-1)return e[r];return!1},n=!1;e(t,["delete"])&&(pt("circle").each(function(t){if("cursor"!=st(this).attr("id")){x=t.x,y=t.y;var e={x1:x-30,x2:x+30,y1:y-30,y2:y+30};e.x1<=kh[0]&&e.x2>=kh[0]&&e.y1<=kh[1]&&e.y2>=kh[1]&&st(this).remove()}}),n=!0);var r=e(t,["blue","red","green"]);return r&&(pt("circle").each(function(t){if("cursor"!=st(this).attr("id")){x=t.x,y=t.y;var e={x1:x-30,x2:x+30,y1:y-30,y2:y+30};e.x1<=kh[0]&&e.x2>=kh[0]&&e.y1<=kh[1]&&e.y2>=kh[1]&&st(this).attr("fill",r)}}),console.log(),n=!0),e(t,["reset"])&&pt("circle").each(function(t){"cursor"!=st(this).attr("id")&&st(this).attr("fill","gray")}),n};console.log(Nh);var Uh=wh.a.debounce(Nh,500);console.log("loading setup speech");var Ih=new webkitSpeechRecognition;Ih.continuous=!0,Ih.interimResults=!0,Ih.onresult=function(t){for(var e="",n=t.resultIndex;n<t.results.length;++n)t.results[n].isFinal?!0:e+=t.results[n][0].transcript;Uh(e)&&Ih.stop()},Ih.onend=function(t){setTimeout(function(){Ih.start()},1e3)},Ih.start()}]);
  var data = [
    {
      "Cereal Name": "100%_Bran",
      "Manufacturer": "Nabisco",
      "Type": "C",
      "Calories": 70,
      "Protein (g)": 4,
      "Fat": 1,
      "Sodium": 130,
      "Dietary Fiber": 10,
      "Carbs": 5,
      "Sugars": 6,
      "Display Shelf": 3,
      "Potassium": 280,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.33
    },
    {
      "Cereal Name": "100%_Natural_Bran",
      "Manufacturer": "Quaker Oats",
      "Type": "C",
      "Calories": 120,
      "Protein (g)": 3,
      "Fat": 5,
      "Sodium": 15,
      "Dietary Fiber": 2,
      "Carbs": 8,
      "Sugars": 8,
      "Display Shelf": 3,
      "Potassium": 135,
      "Vitamins and Minerals": 0,
      "Serving Size Weight": 1,
      "Cups per Serving": -1
    },
    {
      "Cereal Name": "All-Bran",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 70,
      "Protein (g)": 4,
      "Fat": 1,
      "Sodium": 260,
      "Dietary Fiber": 9,
      "Carbs": 7,
      "Sugars": 5,
      "Display Shelf": 3,
      "Potassium": 320,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.33
    },
    {
      "Cereal Name": "All-Bran_with_Extra_Fiber",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 50,
      "Protein (g)": 4,
      "Fat": 0,
      "Sodium": 140,
      "Dietary Fiber": 14,
      "Carbs": 8,
      "Sugars": 0,
      "Display Shelf": 3,
      "Potassium": 330,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.5
    },
    {
      "Cereal Name": "Almond_Delight",
      "Manufacturer": "Ralston Purina",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 2,
      "Fat": 2,
      "Sodium": 200,
      "Dietary Fiber": 1,
      "Carbs": 14,
      "Sugars": 8,
      "Display Shelf": 3,
      "Potassium": -1,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Apple_Cinnamon_Cheerios",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 2,
      "Fat": 2,
      "Sodium": 180,
      "Dietary Fiber": 1.5,
      "Carbs": 10.5,
      "Sugars": 10,
      "Display Shelf": 1,
      "Potassium": 70,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Apple_Jacks",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 2,
      "Fat": 0,
      "Sodium": 125,
      "Dietary Fiber": 1,
      "Carbs": 11,
      "Sugars": 14,
      "Display Shelf": 2,
      "Potassium": 30,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Basic_4",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 130,
      "Protein (g)": 3,
      "Fat": 2,
      "Sodium": 210,
      "Dietary Fiber": 2,
      "Carbs": 18,
      "Sugars": 8,
      "Display Shelf": 3,
      "Potassium": 100,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1.33,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Bran_Chex",
      "Manufacturer": "Ralston Purina",
      "Type": "C",
      "Calories": 90,
      "Protein (g)": 2,
      "Fat": 1,
      "Sodium": 200,
      "Dietary Fiber": 4,
      "Carbs": 15,
      "Sugars": 6,
      "Display Shelf": 1,
      "Potassium": 125,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.67
    },
    {
      "Cereal Name": "Bran_Flakes",
      "Manufacturer": "Post",
      "Type": "C",
      "Calories": 90,
      "Protein (g)": 3,
      "Fat": 0,
      "Sodium": 210,
      "Dietary Fiber": 5,
      "Carbs": 13,
      "Sugars": 5,
      "Display Shelf": 3,
      "Potassium": 190,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.67
    },
    {
      "Cereal Name": "Cap'n'Crunch",
      "Manufacturer": "Quaker Oats",
      "Type": "C",
      "Calories": 120,
      "Protein (g)": 1,
      "Fat": 2,
      "Sodium": 220,
      "Dietary Fiber": 0,
      "Carbs": 12,
      "Sugars": 12,
      "Display Shelf": 2,
      "Potassium": 35,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Cheerios",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 6,
      "Fat": 2,
      "Sodium": 290,
      "Dietary Fiber": 2,
      "Carbs": 17,
      "Sugars": 1,
      "Display Shelf": 1,
      "Potassium": 105,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1.25
    },
    {
      "Cereal Name": "Cinnamon_Toast_Crunch",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 120,
      "Protein (g)": 1,
      "Fat": 3,
      "Sodium": 210,
      "Dietary Fiber": 0,
      "Carbs": 13,
      "Sugars": 9,
      "Display Shelf": 2,
      "Potassium": 45,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Clusters",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 3,
      "Fat": 2,
      "Sodium": 140,
      "Dietary Fiber": 2,
      "Carbs": 13,
      "Sugars": 7,
      "Display Shelf": 3,
      "Potassium": 105,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.5
    },
    {
      "Cereal Name": "Cocoa_Puffs",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 1,
      "Fat": 1,
      "Sodium": 180,
      "Dietary Fiber": 0,
      "Carbs": 12,
      "Sugars": 13,
      "Display Shelf": 2,
      "Potassium": 55,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Corn_Chex",
      "Manufacturer": "Ralston Purina",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 2,
      "Fat": 0,
      "Sodium": 280,
      "Dietary Fiber": 0,
      "Carbs": 22,
      "Sugars": 3,
      "Display Shelf": 1,
      "Potassium": 25,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Corn_Flakes",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 100,
      "Protein (g)": 2,
      "Fat": 0,
      "Sodium": 290,
      "Dietary Fiber": 1,
      "Carbs": 21,
      "Sugars": 2,
      "Display Shelf": 1,
      "Potassium": 35,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Corn_Pops",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 1,
      "Fat": 0,
      "Sodium": 90,
      "Dietary Fiber": 1,
      "Carbs": 13,
      "Sugars": 12,
      "Display Shelf": 2,
      "Potassium": 20,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Count_Chocula",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 1,
      "Fat": 1,
      "Sodium": 180,
      "Dietary Fiber": 0,
      "Carbs": 12,
      "Sugars": 13,
      "Display Shelf": 2,
      "Potassium": 65,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Cracklin'_Oat_Bran",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 3,
      "Fat": 3,
      "Sodium": 140,
      "Dietary Fiber": 4,
      "Carbs": 10,
      "Sugars": 7,
      "Display Shelf": 3,
      "Potassium": 160,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.5
    },
    {
      "Cereal Name": "Cream_of_Wheat_(Quick)",
      "Manufacturer": "Nabisco",
      "Type": "H",
      "Calories": 100,
      "Protein (g)": 3,
      "Fat": 0,
      "Sodium": 80,
      "Dietary Fiber": 1,
      "Carbs": 21,
      "Sugars": 0,
      "Display Shelf": 2,
      "Potassium": -1,
      "Vitamins and Minerals": 0,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Crispix",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 2,
      "Fat": 0,
      "Sodium": 220,
      "Dietary Fiber": 1,
      "Carbs": 21,
      "Sugars": 3,
      "Display Shelf": 3,
      "Potassium": 30,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Crispy_Wheat_&_Raisins",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 100,
      "Protein (g)": 2,
      "Fat": 1,
      "Sodium": 140,
      "Dietary Fiber": 2,
      "Carbs": 11,
      "Sugars": 10,
      "Display Shelf": 3,
      "Potassium": 120,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Double_Chex",
      "Manufacturer": "Ralston Purina",
      "Type": "C",
      "Calories": 100,
      "Protein (g)": 2,
      "Fat": 0,
      "Sodium": 190,
      "Dietary Fiber": 1,
      "Carbs": 18,
      "Sugars": 5,
      "Display Shelf": 3,
      "Potassium": 80,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Froot_Loops",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 2,
      "Fat": 1,
      "Sodium": 125,
      "Dietary Fiber": 1,
      "Carbs": 11,
      "Sugars": 13,
      "Display Shelf": 2,
      "Potassium": 30,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Frosted_Flakes",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 1,
      "Fat": 0,
      "Sodium": 200,
      "Dietary Fiber": 1,
      "Carbs": 14,
      "Sugars": 11,
      "Display Shelf": 1,
      "Potassium": 25,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Frosted_Mini-Wheats",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 100,
      "Protein (g)": 3,
      "Fat": 0,
      "Sodium": 0,
      "Dietary Fiber": 3,
      "Carbs": 14,
      "Sugars": 7,
      "Display Shelf": 2,
      "Potassium": 100,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.8
    },
    {
      "Cereal Name": "Fruitful_Bran",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 120,
      "Protein (g)": 3,
      "Fat": 0,
      "Sodium": 240,
      "Dietary Fiber": 5,
      "Carbs": 14,
      "Sugars": 12,
      "Display Shelf": 3,
      "Potassium": 190,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1.33,
      "Cups per Serving": 0.67
    },
    {
      "Cereal Name": "Fruity_Pebbles",
      "Manufacturer": "Post",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 1,
      "Fat": 1,
      "Sodium": 135,
      "Dietary Fiber": 0,
      "Carbs": 13,
      "Sugars": 12,
      "Display Shelf": 2,
      "Potassium": 25,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Golden_Crisp",
      "Manufacturer": "Post",
      "Type": "C",
      "Calories": 100,
      "Protein (g)": 2,
      "Fat": 0,
      "Sodium": 45,
      "Dietary Fiber": 0,
      "Carbs": 11,
      "Sugars": 15,
      "Display Shelf": 1,
      "Potassium": 40,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.88
    },
    {
      "Cereal Name": "Golden_Grahams",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 1,
      "Fat": 1,
      "Sodium": 280,
      "Dietary Fiber": 0,
      "Carbs": 15,
      "Sugars": 9,
      "Display Shelf": 2,
      "Potassium": 45,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Grape_Nuts_Flakes",
      "Manufacturer": "Post",
      "Type": "C",
      "Calories": 100,
      "Protein (g)": 3,
      "Fat": 1,
      "Sodium": 140,
      "Dietary Fiber": 3,
      "Carbs": 15,
      "Sugars": 5,
      "Display Shelf": 3,
      "Potassium": 85,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.88
    },
    {
      "Cereal Name": "Grape-Nuts",
      "Manufacturer": "Post",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 3,
      "Fat": 0,
      "Sodium": 170,
      "Dietary Fiber": 3,
      "Carbs": 17,
      "Sugars": 3,
      "Display Shelf": 3,
      "Potassium": 90,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.25
    },
    {
      "Cereal Name": "Great_Grains_Pecan",
      "Manufacturer": "Post",
      "Type": "C",
      "Calories": 120,
      "Protein (g)": 3,
      "Fat": 3,
      "Sodium": 75,
      "Dietary Fiber": 3,
      "Carbs": 13,
      "Sugars": 4,
      "Display Shelf": 3,
      "Potassium": 100,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.33
    },
    {
      "Cereal Name": "Honey_Graham_Ohs",
      "Manufacturer": "Quaker Oats",
      "Type": "C",
      "Calories": 120,
      "Protein (g)": 1,
      "Fat": 2,
      "Sodium": 220,
      "Dietary Fiber": 1,
      "Carbs": 12,
      "Sugars": 11,
      "Display Shelf": 2,
      "Potassium": 45,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    },
    {
      "Cereal Name": "Honey_Nut_Cheerios",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 3,
      "Fat": 1,
      "Sodium": 250,
      "Dietary Fiber": 1.5,
      "Carbs": 11.5,
      "Sugars": 10,
      "Display Shelf": 1,
      "Potassium": 90,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Honey-comb",
      "Manufacturer": "Post",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 1,
      "Fat": 0,
      "Sodium": 180,
      "Dietary Fiber": 0,
      "Carbs": 14,
      "Sugars": 11,
      "Display Shelf": 1,
      "Potassium": 35,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1.33
    },
    {
      "Cereal Name": "Just_Right_Crunchy__Nuggets",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 2,
      "Fat": 1,
      "Sodium": 170,
      "Dietary Fiber": 1,
      "Carbs": 17,
      "Sugars": 6,
      "Display Shelf": 3,
      "Potassium": 60,
      "Vitamins and Minerals": 100,
      "Serving Size Weight": 1,
      "Cups per Serving": -1
    },
    {
      "Cereal Name": "Just_Right_Fruit_&_Nut",
      "Manufacturer": "Kelloggs",
      "Type": "C",
      "Calories": 140,
      "Protein (g)": 3,
      "Fat": 1,
      "Sodium": 170,
      "Dietary Fiber": 2,
      "Carbs": 20,
      "Sugars": 9,
      "Display Shelf": 3,
      "Potassium": 95,
      "Vitamins and Minerals": 100,
      "Serving Size Weight": 1.3,
      "Cups per Serving": 0.75
    },
    {
      "Cereal Name": "Kix",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 2,
      "Fat": 1,
      "Sodium": 260,
      "Dietary Fiber": 0,
      "Carbs": 21,
      "Sugars": 3,
      "Display Shelf": 2,
      "Potassium": 40,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1.5
    },
    {
      "Cereal Name": "Life",
      "Manufacturer": "Quaker Oats",
      "Type": "C",
      "Calories": 100,
      "Protein (g)": 4,
      "Fat": 2,
      "Sodium": 150,
      "Dietary Fiber": 2,
      "Carbs": 12,
      "Sugars": 6,
      "Display Shelf": 2,
      "Potassium": 95,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 0.67
    },
    {
      "Cereal Name": "Lucky_Charms",
      "Manufacturer": "General Mills",
      "Type": "C",
      "Calories": 110,
      "Protein (g)": 2,
      "Fat": 1,
      "Sodium": 180,
      "Dietary Fiber": 0,
      "Carbs": 12,
      "Sugars": 12,
      "Display Shelf": 2,
      "Potassium": 55,
      "Vitamins and Minerals": 25,
      "Serving Size Weight": 1,
      "Cups per Serving": 1
    }];

  
  var margin = { top: 50, right: 300, bottom: 50, left: 50 },
      outerWidth = 1050,
      outerHeight = 500,
      width = outerWidth - margin.left - margin.right,
      height = outerHeight - margin.top - margin.bottom;
  
  var x = d3.scale.linear()
      .range([0, width]).nice();
  
  var y = d3.scale.linear()
      .range([height, 0]).nice();
  
  var xCat = "Calories",
      yCat = "Potassium",
      rCat = "Protein (g)",
      colorCat = "Manufacturer";
  
data.forEach(function(d) {
    d.Calories = +d.Calories;
    d.Carbs = +d.Carbs;
    d["Cups per Serving"] = +d["Cups per Serving"];
    d["Dietary Fiber"] = +d["Dietary Fiber"];
    d["Display Shelf"] = +d["Display Shelf"];
    d.Fat = +d.Fat;
    d.Potassium = +d.Potassium;
    d["Protein (g)"] = +d["Protein (g)"];
    d["Serving Size Weight"] = +d["Serving Size Weight"];
    d.Sodium = +d.Sodium;
    d.Sugars = +d.Sugars;
    d["Vitamins and Minerals"] = +d["Vitamins and Minerals"];
});

var xMax = d3.max(data, function(d) { return d[xCat]; }) * 1.05,
    xMin = d3.min(data, function(d) { return d[xCat]; }),
    xMin = xMin > 0 ? 0 : xMin,
    yMax = d3.max(data, function(d) { return d[yCat]; }) * 1.05,
    yMin = d3.min(data, function(d) { return d[yCat]; }),
    yMin = yMin > 0 ? 0 : yMin;

x.domain([xMin, xMax]);
y.domain([yMin, yMax]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")
    .tickSize(-height);

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickSize(-width);

var color = d3.scale.category10();

var tip = d3.tip()
    .attr("class", "d3-tip")
    .offset([-10, 0])
    .html(function(d) {
        return xCat + ": " + d[xCat] + "<br>" + yCat + ": " + d[yCat];
    });

var zoomBeh = d3.behavior.zoom()
    .x(x)
    .y(y)
    .scaleExtent([0, 500])
    .on("zoom", zoom);

var svg = d3.select("#scatter")
    .append("svg")
    .attr("width", outerWidth)
    .attr("height", outerHeight)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .call(zoomBeh);

svg.call(tip);

svg.append("rect")
    .attr("width", width)
    .attr("height", height);

svg.append("g")
    .classed("x axis", true)
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis)
    .append("text")
    .classed("label", true)
    .attr("x", width)
    .attr("y", margin.bottom - 10)
    .style("text-anchor", "end")
    .text(xCat);

svg.append("g")
    .classed("y axis", true)
    .call(yAxis)
    .append("text")
    .classed("label", true)
    .attr("transform", "rotate(-90)")
    .attr("y", -margin.left)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text(yCat);

var objects = svg.append("svg")
    .classed("objects", true)
    .attr("width", width)
    .attr("height", height);

objects.append("svg:line")
    .classed("axisLine hAxisLine", true)
    .attr("x1", 0)
    .attr("y1", 0)
    .attr("x2", width)
    .attr("y2", 0)
    .attr("transform", "translate(0," + height + ")");

objects.append("svg:line")
    .classed("axisLine vAxisLine", true)
    .attr("x1", 0)
    .attr("y1", 0)
    .attr("x2", 0)
    .attr("y2", height);

objects.selectAll(".dot")
    .data(data)
    .enter().append("circle")
    .classed("dot", true)
    .attr("r", function (d) { return 6 * Math.sqrt(d[rCat] / Math.PI); })
    .attr("transform", transform)
    .style("fill", function(d) { return color(d[colorCat]); })
    .on("mouseover", tip.show)
    .on("mouseout", tip.hide);

var legend = svg.selectAll(".legend")
    .data(color.domain())
    .enter().append("g")
    .classed("legend", true)
    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

legend.append("circle")
    .attr("r", 3.5)
    .attr("cx", width + 20)
    .attr("fill", color);

legend.append("text")
    .attr("x", width + 26)
    .attr("dy", ".35em")
    .text(function(d) { return d; });

d3.select("input").on("click", change);

function change() {
    xCat = "Carbs";
    xMax = d3.max(data, function(d) { return d[xCat]; });
    xMin = d3.min(data, function(d) { return d[xCat]; });

    zoomBeh.x(x.domain([xMin, xMax])).y(y.domain([yMin, yMax]));

    var svg = d3.select("#scatter").transition();

    svg.select(".x.axis").duration(750).call(xAxis).select(".label").text(xCat);

    objects.selectAll(".dot").transition().duration(1000).attr("transform", transform);
}

function zoom() {
    svg.select(".x.axis").call(xAxis);
    svg.select(".y.axis").call(yAxis);

    svg.selectAll(".dot")
        .attr("transform", transform);
}

function transform(d) {
    return "translate(" + x(d[xCat]) + "," + y(d[yCat]) + ")";
}

var cursorPosition = [0,0];
var screenPosition = [0,0];

var LEAPSCALE = 0.6;

var controller = Leap.loop({ hand: function(hand){
    d3.select('#cursor').remove();

    screenPosition = hand.screenPosition();
    cursorPosition = [screenPosition[0], screenPosition[1]+300];

    d3.select('svg')
          .append('circle')
          .attr('id', 'cursor')
          .attr('cx', cursorPosition[0])
          .attr('cy', cursorPosition[1])
          .attr('fill', 'blue')
          .attr('r', 5);

    // if(frame.valid && frame.gestures.length > 0){
    //   frame.gestures.forEach(function(gesture){
    //       switch (gesture.type){
    //         case "circle":
    //             console.log("Circle Gesture");
    //             break;
    //         case "keyTap":
    //             console.log("Key Tap Gesture");
    //             break;
    //         case "screenTap":
    //             console.log("Screen Tap Gesture");
    //             break;
    //         case "swipe":
    //             console.log("Swipe Gesture");
    //             break;
    //       }
    //   });

    }



}).use('screenPosition', {scale: LEAPSCALE});


xCursorOffset = 430.24996;
yCursorOffset = 234.6844;


var processSpeech = function(transcript) {
    // Helper function to detect if any commands appear in a string
    var userSaid = function(str, commands) {
      var lowercaseStr = str.toLowerCase();
      for (var i = 0; i < commands.length; i++) {
        if (lowercaseStr.indexOf(commands[i]) > -1)
          return true;
      }
      return false;
    };
  
    // console.log("transcript below:");
    console.log(transcript);

    if (userSaid(transcript, ['zoom'])) {
        console.log('zoom in');
        svg.call(zoomBeh);
        console.log("current screen pointer at: " + cursorPosition);
        // experimentally have derived linear relationsihp desiredX = 35 - 0.1*x
        // and linear relationship for y: desiredY = 260 + 0.4*y
        var desiredZoomLocation = [cursorPosition[0] - xCursorOffset, cursorPosition[1] - yCursorOffset];
        var xTrans = (desiredZoomLocation[0] - 35) / (-0.1);
        var yTrans = (desiredZoomLocation[1] - 260) / 0.4;
        var zoomTranslationOffset = [xTrans, yTrans];
        console.log("desired zoom at: " + desiredZoomLocation);
        console.log("translating by: " + zoomTranslationOffset);
        zoomBeh.scale(2);
        zoomBeh.translate(zoomTranslationOffset);


        // zoomBeh.translate(normalizedCursorPosition);
        // zoomBeh.center(normalizedCursorPosition);
        // debugging....
        zoomBeh.event(svg);
    } else if (userSaid(transcript, ['zoom out'])) {
        console.log('zoom out');
        //placeholder for now, need to figure out how to implement
    } else {
        console.log('false');
    }
};
  
  